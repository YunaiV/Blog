title: æ·±å…¥ç†è§£ RPC ä¹‹ä¼ è¾“ç¯‡
date: 2018-05-22
tags:
categories:
permalink: RPC/laoxu/rpc-transport/
author: è€å¾
from_url: https://www.cnkirito.moe/rpc-transport/
wechat_url: https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247484515&idx=1&sn=7d95b03ea7d885792733637d92392536&chksm=fa497bd2cd3ef2c4bf943b6e4be8848f48c4f1b0c857fd35f2312d87cae90472d9cffcc1b437#rd

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.cnkirito.moe/rpc-transport/ ã€Œè€å¾ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

  - [RpcRequest å’Œ RpcResponse](http://www.iocoder.cn/RPC/laoxu/rpc-transport//)
  - [Socketä¼ è¾“](http://www.iocoder.cn/RPC/laoxu/rpc-transport//)
  - [Netty ä¼ è¾“](http://www.iocoder.cn/RPC/laoxu/rpc-transport//)
  - [åŒæ­¥ä¸å¼‚æ­¥ é˜»å¡ä¸éé˜»å¡](http://www.iocoder.cn/RPC/laoxu/rpc-transport//)
  - [æ€»ç»“](http://www.iocoder.cn/RPC/laoxu/rpc-transport//)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

RPC è¢«ç§°ä¸ºâ€œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨â€ï¼Œè¡¨æ˜äº†ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¼šè·¨è¶Šç½‘ç»œï¼Œè·¨è¶Šè¿›ç¨‹ï¼Œæ‰€ä»¥ä¼ è¾“å±‚æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ä¸€è¯´åˆ°ç½‘ç»œä¼ è¾“ï¼Œä¸€å †åè¯å°±è¹¦äº†å‡ºæ¥ï¼šTCPã€UDPã€HTTPï¼ŒåŒæ­¥ or å¼‚æ­¥ï¼Œé˜»å¡ or éé˜»å¡ï¼Œé•¿è¿æ¥ or çŸ­è¿æ¥â€¦

æœ¬æ–‡ä»‹ç»ä¸¤ç§ä¼ è¾“å±‚çš„å®ç°ï¼šä½¿ç”¨ Socket å’Œä½¿ç”¨ Nettyã€‚å‰è€…å®ç°çš„æ˜¯é˜»å¡å¼çš„é€šä¿¡ï¼Œæ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„ä¼ è¾“å±‚å®ç°æ–¹å¼ï¼Œå€Ÿæ­¤å¯ä»¥äº†è§£ä¼ è¾“å±‚çš„å·¥ä½œåŸç†åŠå·¥ä½œå†…å®¹ï¼›åè€…æ˜¯éé˜»å¡å¼çš„ï¼Œåœ¨ä¸€èˆ¬çš„ RPC åœºæ™¯ä¸‹ï¼Œæ€§èƒ½ä¼šè¡¨ç°çš„å¾ˆå¥½ï¼Œæ‰€ä»¥è¢«å¾ˆå¤šå¼€æº RPC æ¡†æ¶ä½œä¸ºä¼ è¾“å±‚çš„å®ç°æ–¹å¼ã€‚

## RpcRequest å’Œ RpcResponse

ä¼ è¾“å±‚ä¼ è¾“çš„ä¸»è¦å¯¹è±¡å…¶å®å°±æ˜¯è¿™ä¸¤ä¸ªç±»ï¼Œå®ƒä»¬å°è£…äº†è¯·æ±‚ idï¼Œæ–¹æ³•åï¼Œæ–¹æ³•å‚æ•°ï¼Œè¿”å›å€¼ï¼Œå¼‚å¸¸ç­‰ RPC è°ƒç”¨ä¸­éœ€è¦çš„ä¸€ç³»åˆ—ä¿¡æ¯ã€‚

```Java
public class RpcRequest implements Serializable {
    private String interfaceName;
    private String methodName;
    private String parametersDesc;
    private Object[] arguments;
    private Map<String, String> attachments;
    private int retries = 0;
    private long requestId;
    private byte rpcProtocolVersion;
}
```

```Java
public class RpcResponse implements Serializable {
    private Object value;
    private Exception exception;
    private long requestId;
    private long processTime;
    private int timeout;
    private Map<String, String> attachments;// rpcåè®®ç‰ˆæœ¬å…¼å®¹æ—¶å¯ä»¥å›ä¼ ä¸€äº›é¢å¤–çš„ä¿¡æ¯
    private byte rpcProtocolVersion;
}
```

## Socketä¼ è¾“

Server

```Java
public class RpcServerSocketProvider {


    public static void main(String[] args) throws Exception {

        //åºåˆ—åŒ–å±‚å®ç°å‚è€ƒä¹‹å‰çš„ç« èŠ‚
        Serialization serialization = new Hessian2Serialization();

        ServerSocket serverSocket = new ServerSocket(8088);
        ExecutorService executorService = Executors.newFixedThreadPool(10);
        while (true) {
            final Socket socket = serverSocket.accept();
            executorService.execute(() -> {
                try {
                    InputStream is = socket.getInputStream();
                    OutputStream os = socket.getOutputStream();
                    try {
                        DataInputStream dis = new DataInputStream(is);
                        int length = dis.readInt();
                        byte[] requestBody = new byte[length];
                        dis.read(requestBody);
                        //ååºåˆ—åŒ–requestBody => RpcRequest
                        RpcRequest rpcRequest = serialization.deserialize(requestBody, RpcRequest.class);
                        //åå°„è°ƒç”¨ç”Ÿæˆå“åº” å¹¶ç»„è£…æˆ rpcResponse
                        RpcResponse rpcResponse = invoke(rpcRequest);
                        //åºåˆ—åŒ–rpcResponse => responseBody
                        byte[] responseBody = serialization.serialize(rpcResponse);
                        DataOutputStream dos = new DataOutputStream(os);
                        dos.writeInt(responseBody.length);
                        dos.write(responseBody);
                        dos.flush();
                    } catch (Exception e) {
                        e.printStackTrace();
                    } finally {
                        is.close();
                        os.close();
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                } finally {
                    try {
                        socket.close();
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            });
        }

    }

    public static RpcResponse invoke(RpcRequest rpcRequest) {
        //æ¨¡æ‹Ÿåå°„è°ƒç”¨
        RpcResponse rpcResponse = new RpcResponse();
        rpcResponse.setRequestId(rpcRequest.getRequestId());
        //... some operation
        return rpcResponse;
    }

}
```

Client

```Java
public class RpcSocketConsumer {

    public static void main(String[] args) throws Exception {

        //åºåˆ—åŒ–å±‚å®ç°å‚è€ƒä¹‹å‰çš„ç« èŠ‚
        Serialization serialization = new Hessian2Serialization();

        Socket socket = new Socket("localhost", 8088);
        InputStream is = socket.getInputStream();
        OutputStream os = socket.getOutputStream();
        //å°è£…rpcè¯·æ±‚
        RpcRequest rpcRequest = new RpcRequest();
        rpcRequest.setRequestId(12345L);
        //åºåˆ—åŒ– rpcRequest => requestBody
        byte[] requestBody = serialization.serialize(rpcRequest);
        DataOutputStream dos = new DataOutputStream(os);
        dos.writeInt(requestBody.length);
        dos.write(requestBody);
        dos.flush();
        DataInputStream dis = new DataInputStream(is);
        int length = dis.readInt();
        byte[] responseBody = new byte[length];
        dis.read(responseBody);
        //ååºåˆ—åŒ– responseBody => rpcResponse
        RpcResponse rpcResponse = serialization.deserialize(responseBody, RpcResponse.class);
        is.close();
        os.close();
        socket.close();

        System.out.println(rpcResponse.getRequestId());
    }
}
```

dis.readInt() å’Œ dis.read(byte[] bytes) å†³å®šäº†ä½¿ç”¨ Socket é€šä¿¡æ˜¯ä¸€ç§é˜»å¡å¼çš„æ“ä½œï¼ŒæŠ¥æ–‡å¤´+æŠ¥æ–‡ä½“çš„ä¼ è¾“æ ¼å¼æ˜¯ä¸€ç§å¸¸è§çš„æ ¼å¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ç‰¹æ®Šçš„å­—ç¬¦å¦‚ç©ºè¡Œä¹Ÿå¯ä»¥åˆ’åˆ†å‡ºæŠ¥æ–‡ç»“æ„ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª intï¼ˆ4å­—èŠ‚ï¼‰æ¥ä¼ é€’æŠ¥é—®é¢˜çš„é•¿åº¦ï¼Œä¹‹åä¼ é€’æŠ¥æ–‡ä½“ï¼Œåœ¨å¤æ‚çš„é€šä¿¡åè®®ä¸­ï¼ŒæŠ¥æ–‡å¤´é™¤äº†å­˜å‚¨æŠ¥æ–‡ä½“è¿˜ä¼šé¢å¤–å­˜å‚¨ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬åè®®åç§°ï¼Œç‰ˆæœ¬ï¼Œå¿ƒè·³æ ‡è¯†ç­‰ã€‚

åœ¨ç½‘ç»œä¼ è¾“ä¸­ï¼Œåªæœ‰å­—èŠ‚èƒ½å¤Ÿè¢«è¯†åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¼€å¤´å¼•å…¥äº† Serialization æ¥å£ï¼Œè´Ÿè´£å®Œæˆ RpcRequest å’Œ RpcResponse ä¸å­—èŠ‚çš„ç›¸äº’è½¬æ¢ã€‚ï¼ˆSerialization çš„å·¥ä½œæœºåˆ¶å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼‰

ä½¿ç”¨ Socket é€šä¿¡å¯ä»¥å‘ç°ï¼šæ¯æ¬¡ Server å¤„ç† Client è¯·æ±‚éƒ½ä¼šä»çº¿ç¨‹æ± ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ï¼Œè¿™æ ·çš„å¼€é”€å¯¹äºä¸€èˆ¬çš„ Rpc è°ƒç”¨æ˜¯ä¸èƒ½å¤Ÿæ¥å—çš„ï¼Œè€Œ Netty ä¸€ç±»çš„ç½‘ç»œæ¡†æ¶ä¾¿æ´¾ä¸Šäº†ç”¨åœºã€‚

## Netty ä¼ è¾“

Server å’Œ ServerHandler

```Java
public class RpcNettyProvider {

    public static void main(String[] args) throws Exception{

        EventLoopGroup bossGroup = new NioEventLoopGroup();
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        try {
            // åˆ›å»ºå¹¶åˆå§‹åŒ– Netty æœåŠ¡ç«¯ Bootstrap å¯¹è±¡
            ServerBootstrap bootstrap = new ServerBootstrap();
            bootstrap.group(bossGroup, workerGroup);
            bootstrap.channel(NioServerSocketChannel.class);
            bootstrap.childHandler(new ChannelInitializer<SocketChannel>() {
                @Override
                public void initChannel(SocketChannel channel) throws Exception {
                    ChannelPipeline pipeline = channel.pipeline();
                    pipeline.addLast(new RpcDecoder(RpcRequest.class)); // è§£ç  RPC è¯·æ±‚
                    pipeline.addLast(new RpcEncoder(RpcResponse.class)); // ç¼–ç  RPC å“åº”
                    pipeline.addLast(new RpcServerHandler()); // å¤„ç† RPC è¯·æ±‚
                }
            });
            bootstrap.option(ChannelOption.SO_BACKLOG, 1024);
            bootstrap.childOption(ChannelOption.SO_KEEPALIVE, true);
            ChannelFuture future = bootstrap.bind("127.0.0.1", 8087).sync();
            // å…³é—­ RPC æœåŠ¡å™¨
            future.channel().closeFuture().sync();
        } finally {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

}
```

```Java
public class RpcServerHandler extends SimpleChannelInboundHandler<RpcRequest> {

    @Override
    public void channelRead0(final ChannelHandlerContext ctx, RpcRequest request) throws Exception {
        RpcResponse rpcResponse = invoke(request);
        // å†™å…¥ RPC å“åº”å¯¹è±¡å¹¶è‡ªåŠ¨å…³é—­è¿æ¥
        ctx.writeAndFlush(rpcResponse).addListener(ChannelFutureListener.CLOSE);
    }

    private RpcResponse invoke(RpcRequest rpcRequest) {
        //æ¨¡æ‹Ÿåå°„è°ƒç”¨
        RpcResponse rpcResponse = new RpcResponse();
        rpcResponse.setRequestId(rpcRequest.getRequestId());
        //... some operation
        return rpcResponse;
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {
        cause.printStackTrace();
        ctx.close();
    }
}
```

Client å’Œ ClientHandler

```Java
public class RpcNettyConsumer {

    public static void main(String[] args) throws Exception{
        EventLoopGroup group = new NioEventLoopGroup();
        try {
            // åˆ›å»ºå¹¶åˆå§‹åŒ– Netty å®¢æˆ·ç«¯ Bootstrap å¯¹è±¡
            Bootstrap bootstrap = new Bootstrap();
            bootstrap.group(group);
            bootstrap.channel(NioSocketChannel.class);
            bootstrap.handler(new ChannelInitializer<SocketChannel>() {
                @Override
                public void initChannel(SocketChannel channel) throws Exception {
                    ChannelPipeline pipeline = channel.pipeline();
                    pipeline.addLast(new RpcEncoder(RpcRequest.class)); // ç¼–ç  RPC è¯·æ±‚
                    pipeline.addLast(new RpcDecoder(RpcResponse.class)); // è§£ç  RPC å“åº”
                    pipeline.addLast(new RpcClientHandler()); // å¤„ç† RPC å“åº”
                }
            });
            bootstrap.option(ChannelOption.TCP_NODELAY, true);
            // è¿æ¥ RPC æœåŠ¡å™¨
            ChannelFuture future = bootstrap.connect("127.0.0.1", 8087).sync();
            // å†™å…¥ RPC è¯·æ±‚æ•°æ®å¹¶å…³é—­è¿æ¥
            Channel channel = future.channel();

            RpcRequest rpcRequest = new RpcRequest();
            rpcRequest.setRequestId(123456L);

            channel.writeAndFlush(rpcRequest).sync();
            channel.closeFuture().sync();
        } finally {
            group.shutdownGracefully();
        }
    }

}
```

```Java
public class RpcClientHandler extends SimpleChannelInboundHandler<RpcResponse> {

    @Override
    public void channelRead0(ChannelHandlerContext ctx, RpcResponse response) throws Exception {
        System.out.println(response.getRequestId());//å¤„ç†å“åº”
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {
        cause.printStackTrace();
        ctx.close();
    }

}
```

ä½¿ç”¨ Netty çš„å¥½å¤„æ˜¯å¾ˆæ–¹ä¾¿åœ°å®ç°äº†éé˜»å¡å¼çš„è°ƒç”¨ï¼Œå…³é”®éƒ¨åˆ†éƒ½ç»™å‡ºäº†æ³¨é‡Šã€‚ä¸Šè¿°çš„ä»£ç è™½ç„¶å¾ˆå¤šï¼Œå¹¶ä¸”å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ Socket é€šä¿¡ä»£ç å¤§ç›¸å¾„åº­ï¼Œä½†å¤§å¤šæ•°éƒ½æ˜¯ Netty çš„æ¨¡æ¿ä»£ç ï¼Œå¯åŠ¨æœåŠ¡å™¨ï¼Œé…ç½®ç¼–è§£ç å™¨ç­‰ã€‚çœŸæ­£çš„ RPC å°è£…æ“ä½œå¤§å¤šé›†ä¸­åœ¨ Handler çš„ channelRead æ–¹æ³•ï¼ˆè´Ÿè´£è¯»å–ï¼‰ä»¥åŠ channel.writeAndFlush æ–¹æ³•ï¼ˆè´Ÿè´£å†™å…¥ï¼‰ä¸­ã€‚

```Java
public class RpcEncoder extends MessageToByteEncoder {

    private Class<?> genericClass;

    Serialization serialization = new Hessian2Serialization();

    public RpcEncoder(Class<?> genericClass) {
        this.genericClass = genericClass;
    }

    @Override
    public void encode(ChannelHandlerContext ctx, Object in, ByteBuf out) throws Exception {
        if (genericClass.isInstance(in)) {
            byte[] data = serialization.serialize(in);
            out.writeInt(data.length);
            out.writeBytes(data);
        }
    }
}
```

```Java
public class RpcDecoder extends ByteToMessageDecoder {

    private Class<?> genericClass;

    public RpcDecoder(Class<?> genericClass) {
        this.genericClass = genericClass;
    }

    Serialization serialization = new Hessian2Serialization();

    @Override
    public void decode(ChannelHandlerContext ctx, ByteBuf in, List<Object> out) throws Exception {
        if (in.readableBytes() < 4) {
            return;
        }
        in.markReaderIndex();
        int dataLength = in.readInt();
        if (in.readableBytes() < dataLength) {
            in.resetReaderIndex();
            return;
        }
        byte[] data = new byte[dataLength];
        in.readBytes(data);
        out.add(serialization.deserialize(data, genericClass));
    }
}
```

ä½¿ç”¨ Netty ä¸èƒ½ä¿è¯è¿”å›çš„å­—èŠ‚å¤§å°ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š in.readableBytes() < 4 è¿™æ ·çš„åˆ¤æ–­ï¼Œä»¥åŠ in.markReaderIndex() è¿™æ ·çš„æ ‡è®°ï¼Œç”¨æ¥åŒºåˆ†æŠ¥æ–‡å¤´å’ŒæŠ¥æ–‡ä½“ã€‚

## åŒæ­¥ä¸å¼‚æ­¥ é˜»å¡ä¸éé˜»å¡

è¿™ä¸¤ç»„ä¼ è¾“ç‰¹æ€§ç»å¸¸è¢«æ‹¿æ¥åšå¯¹æ¯”ï¼Œå¾ˆå¤šæ–‡ç« å£°ç§° Socket æ˜¯åŒæ­¥é˜»å¡çš„ï¼ŒNetty æ˜¯å¼‚æ­¥éé˜»å¡ï¼Œå…¶å®æœ‰ç‚¹é—®é¢˜ã€‚

å…¶å®è¿™ä¸¤ç»„å¹¶æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼ŒåŒæ­¥é˜»å¡ï¼ŒåŒæ­¥éé˜»å¡ï¼Œå¼‚æ­¥éé˜»å¡éƒ½æœ‰å¯èƒ½ï¼ˆåŒæ­¥éé˜»å¡å€’æ˜¯æ²¡è§è¿‡ï¼‰ï¼Œè€Œå¤§å¤šæ•°ä½¿ç”¨ Netty å®ç°çš„ RPC è°ƒç”¨å…¶å®åº”å½“æ˜¯åŒæ­¥éé˜»å¡çš„ï¼ˆå½“ç„¶ä¸€èˆ¬ RPC ä¹Ÿæ”¯æŒå¼‚æ­¥éé˜»å¡ï¼‰ã€‚

> åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯**æ¶ˆæ¯é€šä¿¡æœºåˆ¶**
> æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ª*è°ƒç”¨*æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥*è°ƒç”¨*å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚
> æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±*è°ƒç”¨è€…*ä¸»åŠ¨ç­‰å¾…è¿™ä¸ª*è°ƒç”¨*çš„ç»“æœã€‚
>
> è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœã€‚è€Œæ˜¯åœ¨*è°ƒç”¨*å‘å‡ºåï¼Œ*è¢«è°ƒç”¨è€…*é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚

å¦‚æœéœ€è¦ RPC è°ƒç”¨è¿”å›ä¸€ä¸ªç»“æœï¼Œè¯¥ç»“æœç«‹åˆ»è¢«ä½¿ç”¨ï¼Œé‚£æ„å‘³ç€ç€å¤§æ¦‚ç‡éœ€è¦æ˜¯ä¸€ä¸ªåŒæ­¥è°ƒç”¨ã€‚å¦‚æœä¸å…³å¿ƒå…¶è¿”å›å€¼ï¼Œåˆ™å¯ä»¥å°†å…¶åšæˆå¼‚æ­¥æ¥å£ï¼Œä»¥æå‡æ•ˆç‡ã€‚

> é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯**ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€**.
>
> é˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚
> éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚

åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡º Socket é€šä¿¡æˆ‘ä»¬æ˜¾ç¤ºå£°æ˜äº†ä¸€ä¸ªåŒ…å«10ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ¯æ¬¡è¯·æ±‚åˆ°æ¥ï¼Œåˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œç­‰å¾…å®¢æˆ·ç«¯ä¼ é€’æŠ¥æ–‡å¤´å’ŒæŠ¥æ–‡ä½“çš„è¡Œä¸ºéƒ½ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œå¯ä»¥è§å¾—å…¶æ•´ä½“æ˜¯é˜»å¡çš„ã€‚è€Œåœ¨ Netty é€šä¿¡çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚å¹¶æ²¡æœ‰åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡ Handler çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼ˆè”æƒ³ NIO ä¸­ Selectorï¼‰ï¼Œæ˜¯éé˜»å¡çš„ã€‚

ä½¿ç”¨åŒæ­¥éé˜»å¡æ–¹å¼çš„é€šä¿¡æœºåˆ¶å¹¶ä¸ä¸€å®šåŒæ­¥é˜»å¡å¼çš„é€šä¿¡å¼ºï¼Œæ‰€è°“æ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æ›´åˆé€‚ï¼Œè€Œä¸€èˆ¬çš„åŒæ­¥éé˜»å¡ é€šä¿¡é€‚ç”¨äº 1.ç½‘ç»œè¿æ¥æ•°é‡å¤š 2.æ¯ä¸ªè¿æ¥çš„ioä¸é¢‘ç¹ çš„åœºæ™¯ï¼Œä¸ RPC è°ƒç”¨è¾ƒä¸ºå¥‘åˆã€‚è€Œæˆç†Ÿçš„ RPC æ¡†æ¶çš„ä¼ è¾“å±‚å’Œåè®®å±‚é€šå¸¸ä¹Ÿä¼šæä¾›å¤šç§é€‰æ‹©ï¼Œä»¥åº”å¯¹ä¸åŒçš„åœºæ™¯ã€‚

## æ€»ç»“

æœ¬æ–‡å †ç Œäº†ä¸€äº›ä»£ç ï¼Œè€Œéš¾ç‚¹ä¸»è¦æ˜¯å¯¹ Socket çš„ç†è§£ï¼Œå’Œ Netty æ¡†æ¶çš„æŒæ¡ã€‚Netty çš„å­¦ä¹ æœ‰ä¸€å®šçš„é—¨æ§›ï¼Œä½†å®é™…éœ€è¦æŒæ¡çš„çŸ¥è¯†ç‚¹å…¶å®å¹¶ä¸å¤šï¼ˆä»…ä»…é’ˆå¯¹ RPC æ¡†æ¶æ‰€æ¶‰åŠçš„çŸ¥è¯†ç‚¹è€Œè¨€ï¼‰ï¼Œå­¦ä¹  Netty ï¼Œä¸ªäººæ¨èã€ŠNetty IN ACTIONã€‹ä»¥åŠ <https://waylau.gitbooks.io/netty-4-user-guide/Getting%20Started/Before%20Getting%20Started.html> è¯¥ç½‘ç«™çš„ä¾‹å­ã€‚

å‚è€ƒèµ„æ–™ï¼š

<http://javatar.iteye.com/blog/1123915> â€“ æ¢é£

<https://gitee.com/huangyong/rpc> â€“ é»„å‹‡

# 666. å½©è›‹

å¦‚æœä½ å¯¹ RPC å¹¶å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†ä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)