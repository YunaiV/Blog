title: è°ˆ `AOP` çš„é€šä¿—ç†è§£
date: 2018-01-02
tag: 
categories: Spring
permalink: Spring/AOP
author: ä¸€å¶çŸ¥ç§‹
from_url: https://muyinchen.github.io/2016/12/25/%E8%B0%88%20%60AOP%60%20%E7%9A%84%E9%80%9A%E4%BF%97%E7%90%86%E8%A7%A3/
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://muyinchen.github.io/2016/12/25/%E8%B0%88%20%60AOP%60%20%E7%9A%84%E9%80%9A%E4%BF%97%E7%90%86%E8%A7%A3/ ã€Œä¸€å¶çŸ¥ç§‹ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

æœ€è¿‘åœ¨ç¿»è¯‘[Spring Framework 5.0.0.M3ä¸­æ–‡æ–‡æ¡£](https://www.gitbook.com/book/muyinchen/spring-framework-5-0-0-m3/details) ,çœ‹åˆ°`AOP`æ—¶ç´¢æ€§æŠŠè‡ªå·±çš„ç†è§£å†™å†™ã€‚
Springçš„é¢å‘æ–¹é¢çš„ç¼–ç¨‹ï¼ˆ`AOP`ï¼‰,å›½å†…å¤§éƒ½è¯´é¢å‘åˆ‡é¢ï¼Œå…¶å®æˆ‘è¿˜æ˜¯è§‰å¾—é¢å‘æ–¹é¢æœ€æ°å½“ï¼Œä½•è§£ï¼Ÿé‚£å°±æ‰¯ä¸€æ‰¯ã€‚

**1.** `AOP`ç›¸å…³çš„æ¦‚å¿µ

1ï¼‰ *Aspect* ï¼šåˆ‡é¢ï¼Œåˆ‡å…¥ç³»ç»Ÿçš„ä¸€ä¸ªåˆ‡é¢ã€‚æ¯”å¦‚äº‹åŠ¡ç®¡ç†æ˜¯ä¸€ä¸ªåˆ‡é¢ï¼Œæƒé™ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªåˆ‡é¢ï¼›

2ï¼‰ *Join point* ï¼šè¿æ¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è¿›è¡Œæ¨ªå‘åˆ‡å…¥çš„ä½ç½®ï¼›

3ï¼‰ *Advice* ï¼šé€šçŸ¥ï¼Œåˆ‡é¢åœ¨æŸä¸ªè¿æ¥ç‚¹æ‰§è¡Œçš„æ“ä½œ(åˆ†ä¸º: *Before advice* , *After returning advice* , *After throwing advice* , *After (finally) advice* , *Around advice* )ï¼›

4ï¼‰ *Pointcut* ï¼šåˆ‡ç‚¹ï¼Œç¬¦åˆåˆ‡ç‚¹è¡¨è¾¾å¼çš„è¿æ¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£è¢«åˆ‡å…¥çš„åœ°æ–¹ï¼›

 è¿™å°±å¥½æ¯”ä¸€å›¢é¢ï¼Œéƒ½æ˜¯ä¸€å›¢ç™½é¢ï¼Œæ ¹æ®é£Ÿè°±çš„ä¸åŒï¼Œæˆ‘ä»¬åšä»€ä¹ˆæ ·çš„é¢é£Ÿå³å¯ï¼Œå¨å¸ˆå…³å¿ƒçš„æ˜¯åšæ³•ï¼Œè€Œå®¢äººå…³å¿ƒçš„æ˜¯è‰²é¦™å‘³ï¼Œå†è¿›ä¸€æ­¥çš„è¯´ï¼Œæˆ‘åŒæ ·çš„åšé¢æ–¹æ³•ï¼Œå®Œå…¨å¯ä»¥ç”¨ä¸ä¸€æ ·çš„é¢ç²‰(ç™½é¢ï¼Œç‰ç±³é¢ï¼Œèéº¦é¢ç­‰ç­‰)ï¼Œç”±æ­¤ä¾¿å¯æŠ½è±¡å‡ºé¢å›¢ä¾¿æ˜¯æ‰€è°“çš„åˆ‡ç‚¹ï¼Œè€Œé¢å›¢çš„åŠ å·¥ï¼Œæ¯”å¦‚åŠ æ°´ï¼Œæ”¾é¸¡è›‹ï¼Œæ”¾æ²¹ï¼Œç›ç­‰çš„å„ç§åŠ å·¥ä¾¿æ˜¯é¢çš„å‰ç½®æ–¹æ³•*Before advice*ï¼Œå°†é¢å›¢ç‚¸ï¼Œç…ï¼Œç…®ç­‰åšå‡ºæˆå“æ¥ä¾¿æ˜¯å…¶åç½®æ–¹æ³•*After advice* ï¼ŒæœŸé—´æœ‰æ‰€è°“çš„ç¯ç»•æ–¹æ³•*Around advice* ï¼Œè€Œå®¢äººçš„å“è¯„åˆ™æ˜¯*finally advice* ä¸­é—´å‡ºç°é—®é¢˜äº†æ‰€é€ æˆçš„äº‹ä»¶ *After throwing advice* ä»…ä¾›ç†è§£ï¼Œé‡Œé¢å¯èƒ½æœ‰ä¸æ°å½“çš„åœ°æ–¹ï¼Œä½†è‡ªå·±å†™ä»£ç çš„æ—¶æ³¨æ„å³å¯ï¼Œç”±æ­¤ï¼Œè¿™ä¸ªåšé¢çš„è¿‡ç¨‹ä¾¿æ˜¯é¢å‘æ–¹é¢ç¼–ç¨‹å³æ‰€è°“çš„ä¸€ä¸ªåˆ‡é¢(*Aspect* )

 è€Œ`AOP`çš„æ ¸å¿ƒæ€æƒ³æ‰€åœ¨ä¾¿æ˜¯è¦æ±‚ç¨‹åºå‘˜ä¸“æ³¨äºè‡ªå·±çš„é€»è¾‘ä¸šåŠ¡ï¼Œè€Œéè¿™å›¢é¢ï¼Œå¾—ä»¥æ›´å¥½çš„å»å¤„ç†å„ç§é—®é¢˜ï¼Œä»æœ¬è´¨ä¸Šè¿›è¡Œè§£è€¦ã€‚

 æœ€åï¼Œå†è´´ä¸Šä¸€æ®µä»£ç æ¥åšå‚è€ƒå¯¹æ¯”ï¼š

```java
@Aspect
@Component // for auto scan
//@Order(2)
public class LogInterceptor {
	@Pointcut("execution(public * net.aazj.service..*.getUser(..))")
	public void myMethod(){};
	@Before("myMethod()")
	public void before() {
		System.out.println("method start");
	}
	@After("myMethod()")
	public void after() {
		System.out.println("method after");
	}
	@AfterReturning("execution(public * net.aazj.mapper..*.*(..))")
	public void AfterReturning() {
		System.out.println("method AfterReturning");
	}
	@AfterThrowing("execution(public * net.aazj.mapper..*.*(..))")
//  @Around("execution(public * net.aazj.mapper..*.*(..))")
	public void AfterThrowing() {
		System.out.println("method AfterThrowing");
	}
	@Around("execution(public * net.aazj.mapper..*.*(..))")
	public Object Around(ProceedingJoinPoint jp) throws Throwable {
		System.out.println("method Around");
		SourceLocation sl = jp.getSourceLocation();
		Object ret = jp.proceed();
		System.out.println(jp.getTarget());
		return ret;
	}
	@Before("execution(public * net.aazj.service..*.getUser(..)) && args(userId,..)")
	public void before3(int userId) {
		System.out.println("userId-----" + userId);
	}
	@Before("myMethod()")
	public void before2(JoinPoint jp) {
		Object[] args = jp.getArgs();
		System.out.println("userId11111: " + (Integer)args[0]);
		System.out.println(jp.getTarget());
		System.out.println(jp.getThis());
		System.out.println(jp.getSignature());
		System.out.println("method start");
	}
}
```

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Spring æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)