title: Spring æ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼(ä¸€)
date: 2018-01-03
tag: 
categories: Spring
permalink: Spring/DesignPattern-1
author: ä¸€å¶çŸ¥ç§‹
from_url: https://muyinchen.github.io/2017/07/20/Spring%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%B8%80)/
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://muyinchen.github.io/2017/07/20/Spring%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%B8%80)/ ã€Œä¸€å¶çŸ¥ç§‹ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [è§£é‡Šå™¨è®¾è®¡æ¨¡å¼](http://www.iocoder.cn/Spring/DesignPattern-1)
- [å»ºè®¾è€…æ¨¡å¼](http://www.iocoder.cn/Spring/DesignPattern-1)
- [å·¥å‚æ–¹æ³•](http://www.iocoder.cn/Spring/DesignPattern-1)
- [æŠ½è±¡å·¥å‚](http://www.iocoder.cn/Spring/DesignPattern-1)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

è®¾è®¡æ¨¡å¼æœ‰åŠ©äºéµå¾ªè‰¯å¥½çš„ç¼–ç¨‹å®è·µã€‚ä½œä¸ºæœ€æµè¡Œçš„Webæ¡†æ¶ä¹‹ä¸€çš„Springæ¡†æ¶ä¹Ÿä½¿ç”¨å…¶ä¸­çš„ä¸€äº›ã€‚

æœ¬æ–‡å°†ä»‹ç»Spring Frameworkä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚è¿™æ˜¯5ç¯‡ä¸“é¢˜æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚è¿™æ¬¡æˆ‘ä»¬å°†å‘ç°Springæ¡†æ¶ä¸­ä½¿ç”¨çš„4ç§è®¾è®¡æ¨¡å¼ï¼šè§£é‡Šå™¨ï¼Œæ„å»ºå™¨ï¼Œå·¥å‚æ–¹æ³•å’ŒæŠ½è±¡å·¥å‚ã€‚æ¯éƒ¨åˆ†å°†é¦–å…ˆè§£é‡Šç»™å®šæ¨¡å¼çš„åŸç†ã€‚ç´§æ¥ç€ï¼Œå°†ä¼šä½¿ç”¨Springçš„ä¸€ä¸ªä¾‹å­æ¥åŠ æ·±ç†è§£ã€‚

## è§£é‡Šå™¨è®¾è®¡æ¨¡å¼

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬äººç±»éœ€è¦è§£é‡Šæ‰‹åŠ¿ã€‚ä»–ä»¬å¯ä»¥å¯¹æ–‡åŒ–æœ‰ä¸åŒçš„å«ä¹‰ã€‚è¿™æ˜¯æˆ‘ä»¬çš„è§£é‡Šï¼Œç»™ä»–ä»¬ä¸€ä¸ªæ„ä¹‰ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ†æä¸€ä»¶äº‹æƒ…ï¼Œå¹¶å†³å®šå®ƒæ˜¯ä»€ä¹ˆæ„æ€ã€‚æˆ‘ä»¬å¯ä»¥ç”¨**è§£é‡Šè®¾è®¡æ¨¡å¼**æ¥åšã€‚

æ­¤æ¨¡å¼åŸºäºè¡¨è¾¾å¼å’Œè¯„ä¼°å™¨éƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªä»£è¡¨ä¸€ä¸ªè¦åˆ†æçš„äº‹æƒ…ã€‚è¿™ä¸ªåˆ†ææ˜¯ç”±è¯„ä»·è€…æ¥åšå‡ºçš„ï¼Œå®ƒä»¬çŸ¥é“æ„æˆè¡¨è¾¾çš„äººç‰©çš„æ„ä¹‰ã€‚ä¸å¿…è¦çš„æ“ä½œæ˜¯åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è¿›è¡Œçš„ã€‚

Springä¸»è¦ä»¥*Spring Expression Language*ï¼ˆSpelï¼‰ä¸ºä¾‹ã€‚è¿™é‡Œå¿«é€Ÿæä¸ªé†’ï¼ŒSpELæ˜¯ä¸€ç§ç”±Springçš„**org.springframework.expression.ExpressionParser**å®ç°åˆ†æå’Œæ‰§è¡Œçš„è¯­è¨€ã€‚è¿™äº›å®ç°ä½¿ç”¨ä½œä¸ºå­—ç¬¦ä¸²ç»™å‡ºçš„Spelè¡¨è¾¾å¼ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸º**org.springframework.expression.Expressionçš„**å®ä¾‹ã€‚ä¸Šä¸‹æ–‡ç»„ä»¶ç”±**org.springframework.expression.EvaluationContext**å®ç°è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šStandardEvaluationContextã€‚

ä¸¾ä¸ªSpelçš„ä¸€ä¸ªä¾‹å­ï¼š

```java
Writer writer = new Writer();
writer.setName("Writer's name");
StandardEvaluationContext modifierContext = new StandardEvaluationContext(subscriberContext);
modifierContext.setVariable("name", "Overriden writer's name");
parser.parseExpression("name = #name").getValue(modifierContext);
System.out.println("writer's name is : " + writer.getName());
```

è¾“å‡ºåº”æ‰“å°â€œOverriden writerâ€™s nameâ€ã€‚å¦‚ä½ æ‰€è§ï¼Œä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯é€šè¿‡ä¸€ä¸ªè¡¨è¾¾å¼`name = #name`è¿›è¡Œä¿®æ”¹çš„ï¼Œè¿™ä¸ªè¡¨è¾¾å¼åªæœ‰åœ¨`ExpressionParser`æ‰èƒ½ç†è§£ï¼Œå› ä¸ºæä¾›äº†`context`ï¼ˆå‰é¢çš„æ ·ä¾‹ä¸­çš„`modifierContext`å®ä¾‹ï¼‰ã€‚

## å»ºè®¾è€…æ¨¡å¼

**å»ºè®¾è€…è®¾è®¡æ¨¡å¼**æ˜¯å±äºåˆ›å»ºå¯¹è±¡æ¨¡å¼ä¸‰å‰‘å®¢çš„ç¬¬ä¸€ç§æ¨¡å¼ã€‚è¯¥æ¨¡å¼ç”¨äºç®€åŒ–å¤æ‚å¯¹è±¡çš„æ„é€ ã€‚è¦ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæƒ³è±¡ä¸€ä¸ªè¯´æ˜ç¨‹åºå‘˜ç®€å†çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬æƒ³å­˜å‚¨ä¸ªäººä¿¡æ¯ï¼ˆåå­—ï¼Œåœ°å€ç­‰ï¼‰ä»¥åŠæŠ€æœ¯ä¿¡æ¯ï¼ˆçŸ¥è¯†è¯­è¨€ï¼Œå·²å®ç°çš„é¡¹ç›®ç­‰ï¼‰ã€‚è¯¥å¯¹è±¡çš„æ„é€ å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
// with constructor
Programmer programmer = new Programmer("first name", "last name", "address Street 39", "ZIP code", "City", "Country", birthDateObject, new String[] {"Java", "PHP", "Perl", "SQL"}, new String[] {"CRM system", "CMS system for government"});
// or with setters
Programmer programmer = new Programmer();
programmer.setName("first name");
programmer.setLastName("last name");
// ... multiple lines after
programmer.setProjects(new String[] {"CRM system", "CMS system for government"});
```

Builderå…è®¸æˆ‘ä»¬é€šè¿‡ä½¿ç”¨å°†å€¼ä¼ é€’ç»™çˆ¶ç±»çš„å†…éƒ¨æ„å»ºå™¨å¯¹è±¡æ¥æ¸…æ¥šåœ°åˆ†è§£å¯¹è±¡æ„é€ ã€‚æ‰€ä»¥å¯¹äºæˆ‘ä»¬è¿™ä¸ªç¨‹åºå‘˜ç®€å†çš„å¯¹è±¡çš„åˆ›å»ºï¼Œæ„å»ºå™¨å¯ä»¥çœ‹èµ·æ¥åƒï¼š

```java
public class BuilderTest {

  @Test
  public void test() {
    Programmer programmer = new Programmer.ProgrammerBuilder().setFirstName("F").setLastName("L")
            .setCity("City").setZipCode("0000A").setAddress("Street 39")
            .setLanguages(new String[] {"bash", "Perl"}).setProjects(new String[] {"Linux kernel"}).build();
    assertTrue("Programmer should be 'F L' but was '"+ programmer+"'", programmer.toString().equals("F L"));
  }

}

class Programmer {
  private String firstName;
  private String lastName;
  private String address;
  private String zipCode;
  private String city;
  private String[] languages;
  private String[] projects;

  private Programmer(String fName, String lName, String addr, String zip, String city, String[] langs, String[] projects) {
    this.firstName = fName;
    this.lastName = lName;
    this.address = addr;
    this.zipCode = zip;
    this.city = city;
    this.languages = langs;
    this.projects = projects;
  }

  public static class ProgrammerBuilder {
    private String firstName;
    private String lastName;
    private String address;
    private String zipCode;
    private String city;
    private String[] languages;
    private String[] projects;

    public ProgrammerBuilder setFirstName(String firstName) {
      this.firstName = firstName;
      return this;
    }

    public ProgrammerBuilder setLastName(String lastName) {
      this.lastName = lastName;
      return this;
    }

    public ProgrammerBuilder setAddress(String address) {
      this.address = address;
      return this;
    }

    public ProgrammerBuilder setZipCode(String zipCode) {
      this.zipCode = zipCode;
      return this;
    }

    public ProgrammerBuilder setCity(String city) {
      this.city = city;
      return this;
    }

    public ProgrammerBuilder setLanguages(String[] languages) {
      this.languages = languages;
      return this;
    }
    public ProgrammerBuilder setProjects(String[] projects) {
      this.projects = projects;
      return this;
    }

    public Programmer build() {
      return new Programmer(firstName, lastName, address, zipCode, city, languages, projects);
    }
  }

  @Override
  public String toString() {
    return this.firstName + " "+this.lastName;
  }

}
```

å¯ä»¥çœ‹å‡ºï¼Œæ„å»ºå™¨åé¢éšè—äº†å¯¹è±¡æ„é€ çš„å¤æ‚æ€§ï¼Œå†…éƒ¨é™æ€ç±»æ¥å—é“¾æ¥æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨Springä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨**org.springframework.beans.factory.support.BeanDefinitionBuilder**ç±»ä¸­æ£€ç´¢è¿™ä¸ªé€»è¾‘ã€‚è¿™æ˜¯ä¸€ä¸ªå…è®¸æˆ‘ä»¬ä»¥ç¼–ç¨‹æ–¹å¼å®šä¹‰beançš„ç±»ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å…³äº[beanå·¥å‚åå¤„ç†å™¨çš„](https://muyinchen.github.io/2017/09/16/Spring5%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-Spring%E4%B8%AD%E7%9A%84bean%E5%B7%A5%E5%8E%82%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8/)æ–‡ç« ä¸­çœ‹åˆ°å®ƒï¼Œ`BeanDefinitionBuilder`åŒ…å«å‡ ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬ä¸º**AbstractBeanDefinition**æŠ½è±¡ç±»çš„ç›¸å…³å®ç°è®¾ç½®å€¼ï¼Œæ¯”å¦‚ä½œç”¨åŸŸï¼Œå·¥å‚æ–¹æ³•ï¼Œå±æ€§ç­‰ã€‚æƒ³çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼š

```java
public class BeanDefinitionBuilder {
       /**
    * The {@code BeanDefinition} instance we are creating.
    */
  private AbstractBeanDefinition beanDefinition;

  // ... some not important methods for this article

  // Some of building methods
  /**
    * Set the name of the parent definition of this bean definition.
    */
  public BeanDefinitionBuilder setParentName(String parentName) {
    this.beanDefinition.setParentName(parentName);
    return this;
  }

  /**
    * Set the name of the factory method to use for this definition.
    */
  public BeanDefinitionBuilder setFactoryMethod(String factoryMethod) {
    this.beanDefinition.setFactoryMethodName(factoryMethod);
    return this;
  }

  /**
    * Add an indexed constructor arg value. The current index is tracked internally
    * and all additions are at the present point.
    * @deprecated since Spring 2.5, in favor of {@link #addConstructorArgValue}
    */
  @Deprecated
  public BeanDefinitionBuilder addConstructorArg(Object value) {
    return addConstructorArgValue(value);
  }

  /**
    * Add an indexed constructor arg value. The current index is tracked internally
    * and all additions are at the present point.
    */
  public BeanDefinitionBuilder addConstructorArgValue(Object value) {
    this.beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(
                    this.constructorArgIndex++, value);
    return this;
  }

  /**
    * Add a reference to a named bean as a constructor arg.
    * @see #addConstructorArgValue(Object)
    */
  public BeanDefinitionBuilder addConstructorArgReference(String beanName) {
    this.beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(
                    this.constructorArgIndex++, new RuntimeBeanReference(beanName));
    return this;
  }

  /**
    * Add the supplied property value under the given name.
    */
  public BeanDefinitionBuilder addPropertyValue(String name, Object value) {
    this.beanDefinition.getPropertyValues().add(name, value);
    return this;
  }

  /**
    * Add a reference to the specified bean name under the property specified.
    * @param name the name of the property to add the reference to
    * @param beanName the name of the bean being referenced
    */
  public BeanDefinitionBuilder addPropertyReference(String name, String beanName) {
    this.beanDefinition.getPropertyValues().add(name, new RuntimeBeanReference(beanName));
    return this;
  }

  /**
    * Set the init method for this definition.
    */
  public BeanDefinitionBuilder setInitMethodName(String methodName) {
    this.beanDefinition.setInitMethodName(methodName);
    return this;
  }

  // Methods that can be used to construct BeanDefinition
  /**
    * Return the current BeanDefinition object in its raw (unvalidated) form.
    * @see #getBeanDefinition()
    */
  public AbstractBeanDefinition getRawBeanDefinition() {
    return this.beanDefinition;
  }

  /**
    * Validate and return the created BeanDefinition object.
    */
  public AbstractBeanDefinition getBeanDefinition() {
    this.beanDefinition.validate();
    return this.beanDefinition;
  }
}
```

## å·¥å‚æ–¹æ³•

åˆ›å»ºå¯¹è±¡æ¨¡å¼ä¸‰å‰‘å®¢çš„ç¬¬äºŒä¸ªæˆå‘˜æ˜¯**å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼**ã€‚å®ƒå®Œå…¨é€‚äºä½¿ç”¨åŠ¨æ€ç¯å¢ƒä½œä¸ºSpringæ¡†æ¶ã€‚å®é™…ä¸Šï¼Œè¿™ç§æ¨¡å¼å…è®¸é€šè¿‡å…¬å…±é™æ€æ–¹æ³•å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œç§°ä¸ºå·¥å‚æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ¦‚å¿µä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£æ¥åˆ›å»ºå¯¹è±¡ã€‚ä½†æ˜¯åˆ›å»ºæ˜¯ç”±ä½¿ç”¨ç›¸å…³å¯¹è±¡çš„ç±»åˆ›å»ºçš„ã€‚

ä½†æ˜¯åœ¨è·³åˆ°Springä¸–ç•Œä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç”¨Javaä»£ç åšä¸€ä¸ªä¾‹å­ï¼š

```java
public class FactoryMethodTest {

  @Test
  public void test() {
    Meal fruit = Meal.valueOf("banana");
    Meal vegetable = Meal.valueOf("carrot");
    assertTrue("Banana should be a fruit but is "+fruit.getType(), fruit.getType().equals("fruit"));
    assertTrue("Carrot should be a vegetable but is "+vegetable.getType(), vegetable.getType().equals("vegetable"));
  }

}

class Meal {

  private String type;

  public Meal(String type) {
    this.type = type;
  }

  public String getType() {
    return this.type;
  }

  // Example of factory method - different object is created depending on current context
  public static Meal valueOf(String ingredient) {
    if (ingredient.equals("banana")) {
      return new Meal("fruit");
    }
    return new Meal("vegetable");
  }
}
```

åœ¨Springä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šçš„å·¥å‚æ–¹æ³•åˆ›å»ºbeanã€‚è¯¥æ–¹æ³•ä¸ä»¥å‰ä»£ç ç¤ºä¾‹ä¸­çœ‹åˆ°çš„valueOfæ–¹æ³•å®Œå…¨ç›¸åŒã€‚å®ƒæ˜¯é™æ€çš„ï¼Œå¯ä»¥é‡‡å–æ²¡æœ‰æˆ–å¤šä¸ªå‚æ•°ã€‚ä¸ºäº†æ›´å¥½åœ°äº†è§£æ¡ˆä¾‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ä¾‹ã€‚é¦–å…ˆæå®šä¸‹é…ç½®ï¼š

```java
<bean id="welcomerBean" class="com.mysite.Welcomer" factory-method="createWelcomer">
    <constructor-arg ref="messagesLocator"></constructor-arg>
</bean>

<bean id="messagesLocator" class="com.mysite.MessageLocator">
    <property name="messages" value="messages_file.properties"></property>
</bean>
```

ç°åœ¨è¯·å…³æ³¨è¿™ä¸ªbeançš„åˆå§‹åŒ–ï¼š

```java
public class Welcomer {
  private String message;

  public Welcomer(String message) {
    this.message = message;
  }

  public static Welcomer createWelcomer(MessageLocator messagesLocator) {
    Calendar cal = Calendar.getInstance();
    String msgKey = "welcome.pm";
    if (cal.get(Calendar.AM_PM) == Calendar.AM) {
      msgKey = "welcome.am";
    }
    return new Welcomer(messagesLocator.getMessageByKey(msgKey));
  }
}
```

å½“Springå°†æ„é€ welcomerBeanæ—¶ï¼Œå®ƒä¸ä¼šé€šè¿‡ä¼ ç»Ÿçš„æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡å®šä¹‰çš„é™æ€å·¥å‚æ–¹æ³•createWelcomeræ¥å®ç°ã€‚è¿˜è¦æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€äº›å‚æ•°ï¼ˆMessageLocator beançš„å®ä¾‹åŒ…å«æ‰€æœ‰å¯ç”¨çš„æ¶ˆæ¯ï¼‰ æ ‡ç­¾ï¼Œé€šå¸¸ä¿ç•™ç»™ä¼ ç»Ÿçš„æ„é€ å‡½æ•°ã€‚

## æŠ½è±¡å·¥å‚

æœ€åä¸€ä¸ªï¼Œ**æŠ½è±¡çš„å·¥å‚è®¾è®¡æ¨¡å¼**ï¼Œçœ‹èµ·æ¥ç±»ä¼¼äºå·¥å‚æ–¹æ³•ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥å°†æŠ½è±¡å·¥å‚è§†ä¸ºè¿™ä¸ªè¯çš„å·¥ä¸šæ„ä¹‰ä¸Šçš„å·¥å‚ï¼Œå³ã€‚ä½œä¸ºæä¾›æ‰€éœ€å¯¹è±¡çš„ä¸œè¥¿ã€‚å·¥å‚éƒ¨ä»¶æœ‰ï¼šæŠ½è±¡å·¥å‚ï¼ŒæŠ½è±¡äº§å“ï¼Œäº§å“å’Œå®¢æˆ·ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼ŒæŠ½è±¡å·¥å‚å®šä¹‰äº†æ„å»ºå¯¹è±¡çš„æ–¹æ³•ã€‚æŠ½è±¡äº§å“æ˜¯è¿™ç§ç»“æ„çš„ç»“æœã€‚äº§å“æ˜¯å…·æœ‰åŒæ ·ç»“æ„çš„å…·ä½“ç»“æœã€‚å®¢æˆ·æ˜¯è¦æ±‚åˆ›é€ äº§å“æ¥æŠ½è±¡å·¥å‚çš„äººã€‚

åŒæ ·çš„ï¼Œåœ¨è¿›å…¥Springçš„ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆé€šè¿‡ç¤ºä¾‹Javaä»£ç è¯´æ˜è¿™ä¸ªæ¦‚å¿µï¼š

```java
public class FactoryTest {

  // Test method which is the client
  @Test
  public void test() {
    Kitchen factory = new KitchenFactory();
    KitchenMeal meal = factory.getMeal("P.1");
    KitchenMeal dessert = factory.getDessert("I.1");
    assertTrue("Meal's name should be 'protein meal' and was '"+meal.getName()+"'", meal.getName().equals("protein meal"));
    assertTrue("Dessert's name should be 'ice-cream' and was '"+dessert.getName()+"'", dessert.getName().equals("ice-cream"));
  }

}

// abstract factory
abstract class Kitchen {
  public abstract KitchenMeal getMeal(String preferency);
  public abstract KitchenMeal getDessert(String preferency);
}

// concrete factory
class KitchenFactory extends Kitchen {
  @Override
  public KitchenMeal getMeal(String preferency) {
    if (preferency.equals("F.1")) {
      return new FastFoodMeal();
    } else if (preferency.equals("P.1")) {
      return new ProteinMeal();
    }
    return new VegetarianMeal();
  }

  @Override
  public KitchenMeal getDessert(String preferency) {
    if (preferency.equals("I.1")) {
      return new IceCreamMeal();
    }
    return null;
  }
}

// abstract product
abstract class KitchenMeal {
  public abstract String getName();
}

// concrete products
class ProteinMeal extends KitchenMeal {
  @Override
  public String getName() {
    return "protein meal";
  }
}

class VegetarianMeal extends KitchenMeal {
  @Override
  public String getName() {
    return "vegetarian meal";
  }
}

class FastFoodMeal extends KitchenMeal {
  @Override
  public String getName() {
    return "fast-food meal";
  }
}

class IceCreamMeal extends KitchenMeal {
  @Override
  public String getName() {
    return "ice-cream";
  }
}
```

æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°ï¼ŒæŠ½è±¡å·¥å‚å°è£…äº†å¯¹è±¡çš„åˆ›å»ºã€‚å¯¹è±¡åˆ›å»ºå¯ä»¥ä½¿ç”¨ä¸ç»å…¸æ„é€ å‡½æ•°ä¸€æ ·ä½¿ç”¨çš„å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚åœ¨Springä¸­ï¼Œå·¥å‚çš„ä¾‹å­æ˜¯**org.springframework.beans.factory.BeanFactory**ã€‚é€šè¿‡å®ƒçš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä»Springçš„å®¹å™¨è®¿é—®beanã€‚æ ¹æ®é‡‡ç”¨çš„ç­–ç•¥ï¼Œ**getBean**æ–¹æ³•å¯ä»¥è¿”å›å·²åˆ›å»ºçš„å¯¹è±¡ï¼ˆå…±äº«å®ä¾‹ï¼Œå•ä¾‹ä½œç”¨åŸŸï¼‰æˆ–åˆå§‹åŒ–æ–°çš„å¯¹è±¡ï¼ˆåŸå‹ä½œç”¨åŸŸï¼‰ã€‚åœ¨`BeanFactory`çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒºåˆ†ï¼š`ClassPathXmlApplicationContext`ï¼Œ`XmlWebApplicationContext`ï¼Œ`StaticWebApplicationContext`ï¼Œ`StaticPortletApplicationContext`ï¼Œ`GenericApplicationContext`ï¼Œ`StaticApplicationContext`ã€‚

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"file:test-context.xml"})
public class TestProduct {

  @Autowired
  private BeanFactory factory;

  @Test
  public void test() {
    System.out.println("Concrete factory is: "+factory.getClass());
    assertTrue("Factory can't be null", factory != null);
    ShoppingCart cart = (ShoppingCart) factory.getBean("shoppingCart");
    assertTrue("Shopping cart object can't be null", cart != null);
    System.out.println("Found shopping cart bean:"+cart.getClass());
  }
}
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠ½è±¡å·¥å‚ç”±BeanFactoryæ¥å£è¡¨ç¤ºã€‚å…·ä½“å·¥å‚æ˜¯åœ¨ç¬¬ä¸€ä¸ªSystem.outä¸­æ‰“å°çš„ï¼Œæ˜¯**org.springframework.beans.factory.support.DefaultListableBeanFactory**çš„å®ä¾‹ã€‚å®ƒçš„æŠ½è±¡äº§ç‰©æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå…·ä½“çš„äº§å“å°±æ˜¯è¢«å¼ºè½¬ä¸ºShoppingCartå®ä¾‹çš„æŠ½è±¡äº§å“ï¼ˆObjectï¼‰ã€‚

ç¬¬ä¸€ç¯‡æ–‡ç« ä»‹ç»äº†é€šè¿‡è®¾è®¡æ¨¡å¼æ¥æ­£ç¡®ç»„ç»‡çš„æˆ‘ä»¬å®ç°è‰¯å¥½çš„ç¼–ç¨‹é£æ ¼ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨è§£é‡Šå™¨ï¼Œæ„å»ºå™¨ï¼Œå·¥å‚æ–¹æ³•å’Œå·¥å‚ã€‚ç¬¬ä¸€ä¸ªæ˜¯å¸®åŠ©è§£é‡Šä»¥SpELè¡¨è¾¾çš„æ–‡æœ¬ã€‚ä¸‰ä¸ªæœ€åçš„æ¨¡å¼å±äºåˆ›å»ºè®¾è®¡æ¨¡å¼çš„ä¸‰å‰‘å®¢ï¼Œå®ƒä»¬åœ¨Springä¸­çš„ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºã€‚ä»–ä»¬é€šè¿‡åˆ†è§£å¤æ‚å¯¹è±¡ï¼ˆæ„å»ºå™¨ï¼‰çš„åˆå§‹åŒ–æˆ–é€šè¿‡é›†ä¸­åœ¨å…¬å…±ç‚¹çš„åˆå§‹åŒ–æ¥åšåˆ°å¯¹è±¡çš„åˆ›å»º(è¦ä¸ç„¶æ€ä¹ˆå«å·¥å‚å‘¢ï¼Œå¿…é¡»æœ‰é€šç”¨ç‚¹çš„)ã€‚

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Spring æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)