title: SOFA RPC æºç è§£æ â€”â€” æœåŠ¡è°ƒç”¨
date: 2018-01-05
tag: 
categories: SOFA RPC
permalink: SOFARPC/Nic/service-invoke
author: é‹’Nic
from_url: https://www.jianshu.com/p/a21c6e7a8e3a
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.jianshu.com/p/47816d0f1317 ã€Œé‹’Nicã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼


-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

**ç®€ä»‹æ‘˜è¦**
 SOFARPCæœåŠ¡è°ƒç”¨åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigï¼Œè‡ªå®šä¹‰è®¾ç½®æ¥å£åç§°ã€è°ƒç”¨åè®®ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ç­‰åŸºç¡€é…ç½®ï¼›é€šè¿‡æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapå¼•ç”¨æœåŠ¡ï¼Œå®¢æˆ·ç«¯é›†ç¾¤Clusterè°ƒç”¨æ¶ˆè´¹ç«¯è°ƒç”¨å™¨ConsumerInvokerå®ç°Clientå‘é€æ•°æ®ç»™Serverè°ƒç”¨è¿‡ç¨‹ã€‚
 SOFARPCä»¥åŸºäºNettyå®ç°çš„ç½‘ç»œé€šä¿¡æ¡†æ¶SOFABoltç”¨ä½œè¿œç¨‹é€šä¿¡æ¡†æ¶ï¼Œä½¿ç”¨è€…ä¸ç”¨å…³å¿ƒå¦‚ä½•å®ç°ç§æœ‰åè®®çš„ç»†èŠ‚ï¼Œç›´æ¥ä½¿ç”¨å†…ç½®RPCé€šä¿¡åè®®ï¼Œå¯åŠ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŒæ—¶æ³¨å†Œç”¨æˆ·è¯·æ±‚å¤„ç†å™¨å³å¯å®Œæˆè¿œç¨‹è°ƒç”¨ï¼š
 1.è°ƒç”¨æ–¹å¼
 SOFARPCæœåŠ¡è°ƒç”¨æä¾›åŒæ­¥Syncã€å¼‚æ­¥Futureã€å›è°ƒCallbackä»¥åŠå•å‘Onewayå››ç§è°ƒç”¨ç±»å‹ï¼š



![img](https:////upload-images.jianshu.io/upload_images/6739367-bbbdbac31a692579.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/554/format/jpeg)

æœåŠ¡è°ƒç”¨åŸºç¡€é€šä¿¡æ¨¡å‹.png

 (1)SyncåŒæ­¥è°ƒç”¨

 åŒæ­¥è°ƒç”¨æ–¹å¼ï¼Œå®¢æˆ·ç«¯å‘èµ·è°ƒç”¨åç­‰å¾…æœåŠ¡ç«¯è¿”å›ç»“æœå†è¿›è¡Œåç»­çš„æ“ä½œï¼Œæ˜¯SOFARPCçš„é»˜è®¤è°ƒç”¨æ–¹å¼ï¼Œæ— éœ€è¿›è¡Œä»»ä½•è®¾ç½®å³å¯ã€‚å½“å‰çº¿ç¨‹å‘èµ·è°ƒç”¨åé˜»å¡è¯·æ±‚çº¿ç¨‹,éœ€è¦åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…ç­‰åˆ°å“åº”ç»“æœæ‰èƒ½å®Œæˆæœ¬æ¬¡è°ƒç”¨ã€‚å¦‚æœè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å¾—åˆ°å“åº”ç»“æœï¼Œé‚£ä¹ˆæŠ›å‡ºè¶…æ—¶å¼‚å¸¸ã€‚SyncåŒæ­¥è°ƒç”¨æ¨¡å¼æœ€å¸¸ç”¨ï¼Œæ³¨æ„è¦æ ¹æ®å¯¹ç«¯çš„å¤„ç†èƒ½åŠ›åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚

 (2)Futureå¼‚æ­¥è°ƒç”¨

 å®¢æˆ·ç«¯å‘èµ·è°ƒç”¨åä¸ä¼šç­‰å¾…æœåŠ¡ç«¯çš„ç»“æœï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ä¸šåŠ¡é€»è¾‘ã€‚æœåŠ¡ç«¯è¿”å›å“åº”ç»“æœè¢«SOFARPCç¼“å­˜ï¼Œå½“å®¢æˆ·ç«¯éœ€è¦å“åº”ç»“æœçš„æ—¶å€™éœ€è¦ä¸»åŠ¨è·å–ç»“æœï¼Œè°ƒç”¨è¿‡ç¨‹ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œè·å–ç»“æœçš„è¿‡ç¨‹é˜»å¡çº¿ç¨‹ï¼Œç›®å‰æ”¯æŒboltåè®®ï¼š



```Java
ConsumerConfig<HelloService> consumer = new ConsumerConfig<HelloService>()
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_FUTURE);
```

ä½¿ç”¨Futureå¼‚æ­¥è°ƒç”¨SOFABooté…ç½®æœåŠ¡å¼•ç”¨éœ€è¦è®¾ç½®sofa:global-attrså…ƒç´ çš„typeå±æ€§å£°æ˜è°ƒç”¨æ–¹å¼ä¸ºfutureï¼š

```XML
<sofa:reference id="sampleFacadeReferenceBolt" interface="com.alipay.sofa.rpc.bean.SampleFacade" >
    <sofa:binding.bolt>
        <sofa:global-attrs type="future"/>
    </sofa:binding.bolt>
</sofa:reference>
<sofa:reference id="helloFutureServiceReference" interface="com.alipay.sofa.rpc.samples.invoke.HelloFutureService">
    <sofa:binding.bolt>
        <sofa:global-attrs type="future"/>
    </sofa:binding.bolt>
</sofa:reference>
```

å¦‚ä¸Šè®¾ç½®ä¸ºå¼‚æ­¥è°ƒç”¨çš„æ–¹å¼ã€‚å®¢æˆ·ç«¯è·å–å“åº”ç»“æœæœ‰ä¸¤ç§æ–¹å¼ï¼š
 (1)é€šè¿‡ SofaResponseFutureç›´æ¥è·å–ç»“æœã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è·å–ç»“æœçš„è¶…æ—¶æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦æ¸…é™¤çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ç»“æœã€‚

```Java
String result = (String)SofaResponseFuture.getResponse(0,true);
```

(2)è·å–åŸç”ŸFutrueï¼Œè¯¥ç§æ–¹å¼è·å–JDKåŸç”Ÿçš„Futureï¼Œå‚æ•°è¡¨ç¤ºæ˜¯å¦æ¸…é™¤çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ç»“æœã€‚å› ä¸ºå“åº”ç»“æœæ”¾åœ¨JDKåŸç”Ÿçš„Futureï¼Œéœ€è¦é€šè¿‡JDK Futureçš„get()æ–¹æ³•è·å–å“åº”ç»“æœã€‚

```Java
Future future = SofaResponseFuture.getFuture(true);
```

å½“å‰çº¿ç¨‹å‘èµ·è°ƒç”¨å¾—åˆ°RpcResponseFutureå¯¹è±¡ï¼Œå½“å‰çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚åœ¨ä»»æ„æ—¶åˆ»ä½¿ç”¨RpcResponseFutureå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å–ç»“æœï¼Œå¦‚æœå“åº”å·²ç»å›æ¥æ­¤æ—¶å°±é©¬ä¸Šå¾—åˆ°ç»“æœï¼›å¦‚æœå“åº”æ²¡æœ‰å›æ¥åˆ™é˜»å¡ä½å½“å‰çº¿ç¨‹ç›´åˆ°å“åº”å›æ¥æˆ–è€…è¶…æ—¶æ—¶é—´åˆ°ã€‚
 (3)Callbackå›è°ƒè°ƒç”¨
 å®¢æˆ·ç«¯æå‰è®¾ç½®å›è°ƒå®ç°ç±»ï¼Œåœ¨å‘èµ·è°ƒç”¨åä¸ä¼šç­‰å¾…ç»“æœï¼Œæ˜¯çœŸæ­£çš„å¼‚æ­¥è°ƒç”¨ï¼Œæ°¸è¿œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œç»“æœå¤„ç†æ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹é‡Œæ‰§è¡Œã€‚SOFA-RPCåœ¨è·å–åˆ°æœåŠ¡ç«¯çš„æ¥å£åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥å›è°ƒå®ç°ï¼Œç›®å‰æ”¯æŒ bolt åè®®ã€‚å®¢æˆ·ç«¯å›è°ƒç±»éœ€è¦å®ç°com.alipay.sofa.rpc.core.invoke.SofaResponseCallbackæ¥å£ï¼š

```Java
SofaResponseCallback sofaResponseCallbackImpl = new SofaResponseCallbackImpl();

ConsumerConfig<HelloService> consumer = new ConsumerConfig<HelloService>()
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
            .setOnReturn(sofaResponseCallbackImpl)
```

å¦‚ä¸Šè®¾ç½®æ˜¯æœåŠ¡çº§åˆ«çš„è®¾ç½®ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè°ƒç”¨çº§åˆ«çš„è®¾ç½®ï¼š

```Java
RpcInvokeContext.getContext().setResponseCallback(sofaResponseCallbackImpl);
```

ä½¿ç”¨Callbackå›è°ƒè°ƒç”¨SOFABooté…ç½®æœåŠ¡å¼•ç”¨éœ€è¦è®¾ç½®sofa:global-attrså…ƒç´ çš„typeå±æ€§å£°æ˜è°ƒç”¨æ–¹å¼ä¸ºcallbackï¼Œé€šè¿‡callback-refå±æ€§å£°æ˜å›è°ƒçš„å®ç°ç±»ï¼Œä½¿ç”¨è¯¥æœåŠ¡å¼•ç”¨å‘èµ·è°ƒç”¨æ—¶ç»“æœè¿”å›æ—¶ç”±SOFARPCè‡ªåŠ¨æ‰§è¡Œè¯¥å›è°ƒç±»ï¼š

```XML
<bean id="callback" class="xxx.xxx.sofaResponseCallbackImpl"/>
<sofa:reference id="sampleFacadeReferenceBolt" interface="com.alipay.sofa.rpc.bean.SampleFacade">
    <sofa:binding.bolt>
        <sofa:global-attrs type="callback" callback-ref="callback"/>
    </sofa:binding.bolt>
</sofa:reference>
<bean id="callbackImpl" class="com.alipay.sofa.rpc.samples.invoke.CallbackImpl"/>
<sofa:reference id="helloCallbackServiceReference" interface="com.alipay.sofa.rpc.samples.invoke.HelloCallbackService">
    <sofa:binding.bolt>
        <sofa:global-attrs type="callback" callback-ref="callbackImpl"/>
    </sofa:binding.bolt>
</sofa:reference>
```

å½“å‰çº¿ç¨‹å‘èµ·è°ƒç”¨åˆ™æœ¬æ¬¡è°ƒç”¨é©¬ä¸Šç»“æŸæ‰§è¡Œä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚å‘èµ·è°ƒç”¨æ—¶éœ€è¦æ³¨å†Œå›è°ƒï¼Œè¯¥å›è°ƒéœ€è¦åˆ†é…å¼‚æ­¥çº¿ç¨‹æ± ä»¥å¾…å“åº”å›æ¥ååœ¨å›è°ƒçš„å¼‚æ­¥çº¿ç¨‹æ± æ¥æ‰§è¡Œå›è°ƒé€»è¾‘ã€‚
 (4)Onewayå•å‘è°ƒç”¨
 å®¢æˆ·ç«¯å‘é€è¯·æ±‚åä¸ä¼šç­‰å¾…æœåŠ¡ç«¯è¿”å›çš„ç»“æœï¼Œå¹¶ä¸”ä¼šå¿½ç•¥æœåŠ¡ç«¯çš„å¤„ç†ç»“æœï¼Œç›®å‰æ”¯æŒboltåè®®ï¼š

```Java
ConsumerConfig<HelloService> consumer = new ConsumerConfig<HelloService>()
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_ONEWAY);
```

ä½¿ç”¨Onewayå•å‘è°ƒç”¨SOFABooté…ç½®æœåŠ¡å¼•ç”¨éœ€è¦è®¾ç½®sofa:global-attrså…ƒç´ çš„typeå±æ€§å£°æ˜è°ƒç”¨æ–¹å¼ä¸ºonewayï¼š

```XML
<bean id="callback" class="xxx"/>
<sofa:reference id="sampleFacadeReferenceBolt" interface="com.alipay.sofa.rpc.bean.SampleFacade" local-first="false">
    <sofa:binding.bolt>
        <sofa:global-attrs type="oneway"/>
    </sofa:binding.bolt>
</sofa:reference>
<sofa:reference id="helloOneWayServiceReference" interface="com.alipay.sofa.rpc.samples.invoke.HelloOneWayService">
    <sofa:binding.bolt>
        <sofa:global-attrs type="oneway"/>
    </sofa:binding.bolt>
</sofa:reference>
```

å½“å‰çº¿ç¨‹å‘èµ·è°ƒç”¨åï¼Œä¸å…³å¿ƒè°ƒç”¨ç»“æœä¸åšè¶…æ—¶æ§åˆ¶ï¼Œåªè¦è¯·æ±‚å·²ç»å‘å‡ºå°±å®Œæˆæœ¬æ¬¡è°ƒç”¨ã€‚å•å‘è°ƒç”¨ä¸å…³å¿ƒå“åº”ç»“æœï¼Œè¯·æ±‚çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ï¼Œä½¿ç”¨Onewayè°ƒç”¨éœ€è¦æ³¨æ„æ§åˆ¶è°ƒç”¨èŠ‚å¥é˜²æ­¢å‹å®æ¥æ”¶æ–¹ã€‚æ³¨æ„Onewayè°ƒç”¨ä¸ä¿è¯æˆåŠŸï¼Œè€Œä¸”å‘èµ·æ–¹æ— æ³•çŸ¥é“è°ƒç”¨ç»“æœã€‚å› æ­¤é€šå¸¸ç”¨äºå¯ä»¥é‡è¯•ï¼Œæˆ–è€…å®šæ—¶é€šçŸ¥ç±»çš„åœºæ™¯ï¼Œè°ƒç”¨è¿‡ç¨‹æ˜¯æœ‰å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜ã€æœºå™¨æ•…éšœç­‰åŸå› å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œä¸šåŠ¡åœºæ™¯éœ€è¦èƒ½æ¥å—è¿™æ ·çš„å¼‚å¸¸åœºæ™¯æ‰èƒ½å¤Ÿä½¿ç”¨ã€‚
 2.ç›´è¿è°ƒç”¨
 SOFARPCæ”¯æŒæŒ‡å®šåœ°å€è¿›è¡Œè°ƒç”¨çš„åœºæ™¯ï¼Œè®¾ç½®ç›´è¿åœ°å€å³å¯ï¼š

```Java
ConsumerConfig<HelloService> consumer = new ConsumerConfig<HelloService>()
            .setInterfaceId(HelloService.class.getName())
            .setRegistry(registryConfig)
            .setDirectUrl("bolt://127.0.0.1:12201");
```

3.æ³›åŒ–è°ƒç”¨
 SOFARPCæ³›åŒ–è°ƒç”¨æ–¹å¼èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯ä¸éœ€è¦ä¾èµ–æœåŠ¡ç«¯çš„æ¥å£æƒ…å†µä¸‹å‘èµ·è°ƒç”¨ï¼Œç›®å‰æ”¯æŒboltåè®®ã€‚ç”±äºä¸çŸ¥é“æœåŠ¡ç«¯çš„æ¥å£ï¼Œå› æ­¤éœ€è¦é€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼å°†æœåŠ¡ç«¯çš„æ¥å£ï¼Œè°ƒç”¨çš„æ–¹æ³•ï¼Œå‚æ•°åŠç»“æœç±»è¿›è¡Œæè¿°ï¼š

```Java
ConsumerConfig<GenericService> consumerConfig = new ConsumerConfig<GenericService>()
           .setInterfaceId("com.alipay.sofa.rpc.quickstart.HelloService")
           .setGeneric(true);
GenericService testService = consumerConfig.refer();

String result = (String) testService.$invoke("sayHello", new String[] { "java.lang.String" },new Object[] { "1111" });
```

å¦‚ä¸Šé€šè¿‡setGenericè®¾ç½®è¯¥æœåŠ¡ä¸ºæ³›åŒ–æœåŠ¡ï¼Œè®¾ç½®æœåŠ¡æ–¹çš„æ¥å£åã€‚ä»¥GenericServiceä½œä¸ºæ³›åŒ–æœåŠ¡ï¼Œé€šè¿‡GenericServiceèƒ½å¤Ÿå‘èµ·æ³›åŒ–è°ƒç”¨ã€‚å‘èµ·è°ƒç”¨æ—¶éœ€è¦ä¼ å…¥æ–¹æ³•åã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å‚æ•°ã€‚å¦‚æœå‚æ•°æˆ–è€…è¿”å›ç»“æœåœ¨å®¢æˆ·ç«¯ä¹Ÿéœ€è¦æ³›åŒ–è¡¨ç¤ºåˆ™é€šè¿‡GenericObjectæ¥å®ç°è·å–åºåˆ—åŒ–ç»“æœç­‰ï¼š

```Java
GenericObject param = new GenericObject("com.alipay.sofa.rpc.invoke.generic.TestObj");

genericObject.putField("str", "xxxx");
genericObject.putField("num", 222);

GenericObject result = (GenericObject) testService.$genericInvoke("echoObj",
                    new String[] { "com.alipay.sofa.rpc.invoke.generic.TestObj" },
                    new Object[] { param });

String str = result.getField("str");
String num = result.getField("num");
```

(1)æ¥å£æè¿°ï¼šæ‰€æœ‰æ³›åŒ–è°ƒç”¨éƒ½éœ€è¦åœ¨æœåŠ¡å¼•ç”¨çš„æ—¶å€™å£°æ˜interfaceä¸ºcom.alipay.sofa.rpc.api.GenericServiceï¼Œè¿™æ˜¯SOFARPCæä¾›çš„ç±»ã€‚çœŸæ­£çš„æœåŠ¡æ¥å£é€šè¿‡sofa:global-attrså…ƒç´ çš„generic-interfaceå±æ€§å£°æ˜å®Œæˆæ¥å£çš„æè¿°ã€‚

```XML
<sofa:reference id="sampleGenericServiceReference" interface="com.alipay.sofa.rpc.api.GenericService">
   <sofa:binding.bolt>
      <sofa:global-attrs generic-interface="com.alipay.sofa.rpc.samples.generic.SampleGenericService"/>
   </sofa:binding.bolt>
</sofa:reference>
```

(2)å‚æ•°æè¿°ï¼šç”±äºå®¢æˆ·ç«¯æ²¡æœ‰è°ƒç”¨æœåŠ¡çš„å‚æ•°ç±»ï¼Œå› æ­¤é€šè¿‡GenericObjectè¿›è¡Œæè¿°ï¼ŒGenericObjectæŒæœ‰Map<String, Object>ç±»å‹çš„å˜é‡ï¼Œèƒ½å¤Ÿé€šè¿‡GenericObjectæä¾›çš„å¯¹è¯¥å˜é‡çš„æ“ä½œæ–¹æ³•å°†å‚æ•°ç±»çš„å±æ€§æ”¾åˆ°Mapä»¥æ­¤æ¥æè¿°å‚æ•°ç±»ã€‚

```Java
GenericObject genericObject = new GenericObject("com.alipay.sofa.rpc.samples.generic.SampleGenericParamModel");
genericObject.putField("name", "Bible");
```

(3)å‘èµ·æ³›åŒ–è°ƒç”¨ï¼šæ¥å£æè¿°é€šè¿‡XMLé…ç½®å£°æ˜æ³›åŒ–å¼•ç”¨çš„beanï¼Œé€šè¿‡è¯¥æ³›åŒ–å¼•ç”¨èƒ½å¤Ÿå‘èµ·æœåŠ¡è°ƒç”¨ï¼Œå‘èµ·æ³›åŒ–è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å‚æ•°ç±»çš„å…¨ç±»åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æè¿°å‚æ•°ç±»çš„ GenericObjectã€‚

```Java
(GenericObject) sampleGenericServiceReference.$genericInvoke("sayGeneric",
            new String[] { "com.alipay.sofa.rpc.samples.generic.SampleGenericParamModel" },
            new Object[] { genericObject });
```

(4)è·å–æ³›åŒ–ç»“æœï¼šå‘èµ·æ³›åŒ–è°ƒç”¨å¦‚æœå®¢æˆ·ç«¯åŒæ ·æ²¡æœ‰æ³›åŒ–ç»“æœçš„ç±»ï¼Œé‚£ä¹ˆåŒæ ·ä»¥GenericObjectå¯¹è°ƒç”¨ç»“æœè¿›è¡Œæè¿°ï¼Œé€šè¿‡GenericObjectçš„getFieldæ–¹æ³•èƒ½å¤Ÿè·å–ç»“æœç±»çš„å±æ€§å€¼ï¼Œé€šè¿‡GenericObjectçš„getTypeæ–¹æ³•èƒ½å¤Ÿè·å–ç»“æœç±»çš„å…¨ç±»åã€‚

```Java
GenericObject result = (GenericObject) sampleGenericServiceReference.$genericInvoke("sayGeneric",
            new String[] { "com.alipay.sofa.rpc.samples.generic.SampleGenericParamModel" },
            new Object[] { genericObject });

System.out.println(result.getType());
System.out.println(result.getField("name"));
System.out.println(result.getField("value"));
```

(5)æ³›åŒ–è°ƒç”¨ç¤ºä¾‹:SOFARPCæ³›åŒ–è°ƒç”¨å®Œæ•´çš„æ³›åŒ–è°ƒç”¨æ–¹å¼ï¼š

```Java
/**
* Java Bean
*/
public class People {
    private String name;
    private int    age;

    // getters and setters
}


/**
 * æœåŠ¡æ–¹æä¾›çš„æ¥å£
 */
interface SampleService {
   String hello(String arg);
   People hello(People people);
   String[] hello(String[] args);
}

/**
 * å®¢æˆ·ç«¯
 */
public class ConsumerClass {
   GenericService genericService;

   public void do() {
      // 1. $invokeä»…æ”¯æŒæ–¹æ³•å‚æ•°ç±»å‹åœ¨å½“å‰åº”ç”¨çš„ ClassLoader ä¸­å­˜åœ¨çš„æƒ…å†µ
      genericService.$invoke("hello", new String[]{ String.class.getName() }, "I'm an arg");

      // 2. $genericInvokeæ”¯æŒæ–¹æ³•å‚æ•°ç±»å‹åœ¨å½“å‰åº”ç”¨çš„ ClassLoader ä¸­ä¸å­˜åœ¨çš„æƒ…å†µã€‚
      // 2.1 æ„é€ å‚æ•°
      GenericObject genericObject = new GenericObject("com.alipay.sofa.rpc.test.generic.bean.People"); // æ„é€ å‡½æ•°ä¸­æŒ‡å®šå…¨è·¯å¾„ç±»å
      genericObject.putField("name", "Lilei"); // è°ƒç”¨putFieldï¼ŒæŒ‡å®šfieldå€¼
      genericObject.putField("age", 15);

      // 2.2 è¿›è¡Œè°ƒç”¨ï¼Œä¸æŒ‡å®šè¿”å›ç±»å‹ï¼Œè¿”å›ç»“æœç±»å‹ä¸ºGenericObject
      Object obj = genericService.$genericInvoke("hello", new String[]{"com.alipay.sofa.rpc.test.generic.bean.People"}, new Object[] { genericObject });
      Assert.assertTrue(obj.getClass == GenericObject.class);

      // 2.3 è¿›è¡Œè°ƒç”¨ï¼ŒæŒ‡å®šè¿”å›ç±»å‹
      People people = genericService.$genericInvoke("hello", new String[]{"com.alipay.sofa.rpc.test.generic.bean.People"}, new Object[] { genericObject }, People.class);

      // 2.4 è¿›è¡Œè°ƒç”¨ï¼Œå‚æ•°ç±»å‹æ˜¯æ•°ç»„ç±»å‹
      String[] result = (String[]) proxy.$genericInvoke("hello", new String[]{new String[0].getClass().getName()}, new Object[]{ new String[]{"args"} });
   }
}
```

**æºç è§£æ**
 1.è°ƒç”¨æ–¹å¼
 å‚è€ƒsofa-rpc-boot-projectsèŒƒä¾‹æ¨¡å—([com.alipay.sofa.rpc.samples.invoke](https://github.com/alipay/sofa-rpc-boot-projects/tree/master/sofa-boot-samples/src/main/java/com/alipay/sofa/rpc/samples/invoke))ï¼š

```Java
<!-- invoke sync-->
<bean id="helloSyncServiceImpl" class="com.alipay.sofa.rpc.samples.invoke.HelloSyncServiceImpl"/>
<sofa:service ref="helloSyncServiceImpl" interface="com.alipay.sofa.rpc.samples.invoke.HelloSyncService">
    <sofa:binding.bolt/>
</sofa:service>
<!-- invoke future -->
<bean id="helloFutureServiceImpl" class="com.alipay.sofa.rpc.samples.invoke.HelloFutureServiceImpl"/>
<sofa:service ref="helloFutureServiceImpl" interface="com.alipay.sofa.rpc.samples.invoke.HelloFutureService">
    <sofa:binding.bolt/>
</sofa:service>
<!-- invoke callback -->
<bean id="helloCallbackServiceImpl" class="com.alipay.sofa.rpc.samples.invoke.HelloCallbackServiceImpl"/>
<sofa:service ref="helloCallbackServiceImpl" interface="com.alipay.sofa.rpc.samples.invoke.HelloCallbackService">
    <sofa:binding.bolt/>
</sofa:service>
package com.alipay.sofa.rpc.samples.invoke;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.ImportResource;

@ImportResource({ "classpath:invoke-server-example.xml" })
@SpringBootApplication
public class InvokeServerApplication {

    public static void main(String[] args) {

        SpringApplication springApplication = new SpringApplication(InvokeServerApplication.class);
        ApplicationContext applicationContext = springApplication.run(args);
    }
}
package com.alipay.sofa.rpc.samples.invoke;

import com.alipay.sofa.rpc.api.future.SofaResponseFuture;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.ImportResource;

@ImportResource({ "classpath:invoke-client-example.xml" })
@SpringBootApplication
public class InvokeClientApplication {

    public static void main(String[] args) {

        //change port to run in local machine
        System.setProperty("server.port", "8081");

        SpringApplication springApplication = new SpringApplication(InvokeClientApplication.class);
        ApplicationContext applicationContext = springApplication.run(args);

        HelloSyncService helloSyncServiceReference = (HelloSyncService) applicationContext
            .getBean("helloSyncServiceReference");
        HelloFutureService helloFutureServiceReference = (HelloFutureService) applicationContext
            .getBean("helloFutureServiceReference");
        HelloCallbackService helloCallbackServiceReference = (HelloCallbackService) applicationContext
            .getBean("helloCallbackServiceReference");

        String result = helloSyncServiceReference.saySync("sync");
        System.out.println(result);

        helloFutureServiceReference.sayFuture("future");
        try {
            System.out.println(SofaResponseFuture.getResponse(1000, true));
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        helloCallbackServiceReference.sayCallback("callback");

        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

    }
}
```

è¿è¡Œè°ƒç”¨æ–¹å¼æœåŠ¡ç«¯èŒƒä¾‹ç±»InvokeServerApplicationæŸ¥çœ‹è°ƒç”¨æ–¹å¼æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.4.2.RELEASE)

Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
2018-06-03 18:41:23.848  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
2018-06-03 18:41:23.938  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-03 18:41:24.496  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-03 18:41:24.619  INFO 12840 --- [           main] c.a.s.r.s.i.InvokeServerApplication      : Starting InvokeServerApplication on Program with PID 12840 (D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes started by Administrator in D:\Program\Github\sofa-rpc-boot-projects)
2018-06-03 18:41:24.621  INFO 12840 --- [           main] c.a.s.r.s.i.InvokeServerApplication      : No active profile set, falling back to default profiles: default
2018-06-03 18:41:24.929  INFO 12840 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sun Jun 03 18:41:24 CST 2018]; root of context hierarchy
2018-06-03 18:41:28.758  INFO 12840 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [invoke-client-example.xml]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-03 18:41:29.561  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-03 18:41:29.889  INFO 12840 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [invoke-server-example.xml]
2018-06-03 18:41:31.866  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration' of type [class com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration$$EnhancerBySpringCGLIB$$80ecb4c1] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:31.893  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:31.896  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:32.147  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingConverterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingConverterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.151  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:32.154  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:32.277  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingAdapterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingAdapterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.279  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:32.281  WARN 12840 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:41:32.283  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeProperties' of type [class com.alipay.sofa.runtime.spring.config.SofaRuntimeProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.291  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeContext' of type [class com.alipay.sofa.runtime.spi.component.SofaRuntimeContext] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-03 18:41:32.415  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-03 18:41:32.454  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration' of type [class com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration$$EnhancerBySpringCGLIB$$b54b6dd6] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.632  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigHelper' of type [class com.alipay.sofa.rpc.boot.runtime.adapter.helper.ConsumerConfigHelper] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.699  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'callbackImpl' of type [class com.alipay.sofa.rpc.samples.invoke.CallbackImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.703  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaBootRpcProperties' of type [class com.alipay.sofa.rpc.boot.config.SofaBootRpcProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.705  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'zookeeperConfigurator' of type [class com.alipay.sofa.rpc.boot.config.ZookeeperConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.707  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'localFileConfigurator' of type [class com.alipay.sofa.rpc.boot.config.LocalFileConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:32.708  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'registryConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.RegistryConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-03 18:41:32.998  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
./logs\tracelog\static-info.log -> ./logs\tracelog\static-info.log.2018-06-02
./logs\tracelog\tracer-self.log -> ./logs\tracelog\tracer-self.log.2018-06-02
2018-06-03 18:41:33.392  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.ConsumerConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:33.930  INFO 12840 --- [           main] o.a.c.f.imps.CuratorFrameworkImpl        : Starting
2018-06-03 18:41:33.966  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT
2018-06-03 18:41:33.966  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:host.name=Program
2018-06-03 18:41:33.966  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.version=1.8.0_141
2018-06-03 18:41:33.966  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.vendor=Oracle Corporation
2018-06-03 18:41:33.966  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.home=C:\Program Files\Java\jdk1.8.0_141\jre
2018-06-03 18:41:33.967  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.class.path=C:\Program Files\Java\jdk1.8.0_141\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\rt.jar;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-starter\target\classes;C:\Users\Administrator\.m2\repository\com\alipay\sofa\sofa-rpc-all\5.4.0\sofa-rpc-all-5.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\bolt\1.4.1\bolt-1.4.1.jar;C:\Users\Administrator\.m2\repository\org\slf4j\slf4j-api\1.7.21\slf4j-api-1.7.21.jar;C:\Users\Administrator\.m2\repository\io\netty\netty-all\4.1.25.Final\netty-all-4.1.25.Final.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\hessian\3.3.0\hessian-3.3.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\tracer-core\2.1.1\tracer-core-2.1.1.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-api\0.22.0\opentracing-api-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-noop\0.22.0\opentracing-noop-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-mock\0.22.0\opentracing-mock-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-util\0.22.0\opentracing-util-0.22.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\lookout\lookout-api\1.4.0\lookout-api-1.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\runtime-sofa-boot-starter\2.4.0\runtime-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-client\2.9.1\curator-client-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-framework\2.9.1\curator-framework-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-recipes\2.9.1\curator-recipes-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxrs\3.0.12.Final\resteasy-jaxrs-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\spec\javax\annotation\jboss-annotations-api_1.1_spec\1.0.1.Final\jboss-annotations-api_1.1_spec-1.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\activation\activation\1.1.1\activation-1.1.1.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpclient\4.3.6\httpclient-4.3.6.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpcore\4.3.3\httpcore-4.3.3.jar;C:\Users\Administrator\.m2\repository\commons-logging\commons-logging\1.1.3\commons-logging-1.1.3.jar;C:\Users\Administrator\.m2\repository\commons-codec\commons-codec\1.6\commons-codec-1.6.jar;C:\Users\Administrator\.m2\repository\commons-io\commons-io\2.1\commons-io-2.1.jar;C:\Users\Administrator\.m2\repository\net\jcip\jcip-annotations\1.0\jcip-annotations-1.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-client\3.0.12.Final\resteasy-client-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jackson-provider\3.0.12.Final\resteasy-jackson-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.12\jackson-core-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.12\jackson-mapper-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-jaxrs\1.9.12\jackson-jaxrs-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-xc\1.9.12\jackson-xc-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-netty4\3.0.12.Final\resteasy-netty4-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-validator-provider-11\3.0.12.Final\resteasy-validator-provider-11-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\hibernate\hibernate-validator\5.0.1.Final\hibernate-validator-5.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\validation\validation-api\1.1.0.Final\validation-api-1.1.0.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\logging\jboss-logging\3.1.1.GA\jboss-logging-3.1.1.GA.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\classmate\0.8.0\classmate-0.8.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\jaxrs-api\3.0.12.Final\jaxrs-api-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-multipart-provider\3.0.12.Final\resteasy-multipart-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxb-provider\3.0.12.Final\resteasy-jaxb-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-impl\2.2.7\jaxb-impl-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-core\2.2.7\jaxb-core-2.2.7.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jaxb-api\2.2.7\jaxb-api-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\istack\istack-commons-runtime\2.16\istack-commons-runtime-2.16.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\fastinfoset\FastInfoset\1.2.12\FastInfoset-1.2.12.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar;C:\Users\Administrator\.m2\repository\javax\mail\mail\1.5.0-b01\mail-1.5.0-b01.jar;C:\Users\Administrator\.m2\repository\org\apache\james\apache-mime4j\0.6\apache-mime4j-0.6.jar;C:\Users\Administrator\.m2\repository\javax\el\javax.el-api\2.2.5\javax.el-api-2.2.5.jar;C:\Users\Administrator\.m2\repository\org\glassfish\web\javax.el\2.2.6\javax.el-2.2.6.jar;C:\Users\Administrator\.m2\repository\com\alibaba\dubbo\2.4.10\dubbo-2.4.10.jar;C:\Users\Administrator\.m2\repository\org\jboss\netty\netty\3.2.5.Final\netty-3.2.5.Final.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-beans\4.3.4.RELEASE\spring-beans-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-core\4.3.4.RELEASE\spring-core-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\1.4.2.RELEASE\spring-boot-autoconfigure-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\test-sofa-boot-starter\2.4.0\test-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\healthcheck-sofa-boot-starter\2.4.0\healthcheck-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\infra-sofa-boot-starter\2.4.0\infra-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-context\4.3.4.RELEASE\spring-context-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-aop\4.3.4.RELEASE\spring-aop-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-expression\4.3.4.RELEASE\spring-expression-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot\1.4.2.RELEASE\spring-boot-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-actuator\1.4.2.RELEASE\spring-boot-starter-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter\1.4.2.RELEASE\spring-boot-starter-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-logging\1.4.2.RELEASE\spring-boot-starter-logging-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-classic\1.1.7\logback-classic-1.1.7.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-core\1.1.7\logback-core-1.1.7.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jcl-over-slf4j\1.7.21\jcl-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jul-to-slf4j\1.7.21\jul-to-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\log4j-over-slf4j\1.7.21\log4j-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\yaml\snakeyaml\1.17\snakeyaml-1.17.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-actuator\1.4.2.RELEASE\spring-boot-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-web\1.4.2.RELEASE\spring-boot-starter-web-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-tomcat\1.4.2.RELEASE\spring-boot-starter-tomcat-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\8.5.6\tomcat-embed-core-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-el\8.5.6\tomcat-embed-el-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-websocket\8.5.6\tomcat-embed-websocket-8.5.6.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.8.4\jackson-databind-2.8.4.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.8.0\jackson-annotations-2.8.0.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.8.4\jackson-core-2.8.4.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-web\4.3.4.RELEASE\spring-web-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-webmvc\4.3.4.RELEASE\spring-webmvc-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alibaba\fastjson\1.2.47\fastjson-1.2.47.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\common\sofa-common-tools\1.0.12\sofa-common-tools-1.0.12.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-test\2.9.1\curator-test-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\zookeeper\zookeeper\3.4.6\zookeeper-3.4.6.jar;C:\Users\Administrator\.m2\repository\log4j\log4j\1.2.16\log4j-1.2.16.jar;C:\Users\Administrator\.m2\repository\jline\jline\0.9.94\jline-0.9.94.jar;C:\Users\Administrator\.m2\repository\io\netty\netty\3.7.0.Final\netty-3.7.0.Final.jar;C:\Users\Administrator\.m2\repository\org\javassist\javassist\3.18.1-GA\javassist-3.18.1-GA.jar;C:\Users\Administrator\.m2\repository\org\apache\commons\commons-math\2.2\commons-math-2.2.jar;C:\Users\Administrator\.m2\repository\com\google\guava\guava\16.0.1\guava-16.0.1.jar;C:\Users\Administrator\.m2\repository\com\101tec\zkclient\0.10\zkclient-0.10.jar;D:\Program\JetBrains\IntelliJ\lib\idea_rt.jar
2018-06-03 18:41:33.969  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.library.path=C:\Program Files\Java\jdk1.8.0_141\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\ProgramData\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\Program Files\Java\jdk1.8.0_141\bin;C:\Program Files\Java\jdk1.8.0_141\jre\bin;C:\Program Files\Maven\bin;C:\Program Files (x86)\Git\cmd;C:\Program Files\MySQL\MySQL Utilities 1.6\;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;;C:\Program Files\Mercurial;.
2018-06-03 18:41:33.969  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.io.tmpdir=C:\Users\ADMINI~1\AppData\Local\Temp\
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.compiler=<NA>
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.name=Windows 10
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.arch=amd64
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.version=10.0
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.name=Administrator
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.home=C:\Users\Administrator
2018-06-03 18:41:33.970  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.dir=D:\Program\Github\sofa-rpc-boot-projects
2018-06-03 18:41:33.972  INFO 12840 --- [           main] org.apache.zookeeper.ZooKeeper           : Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=60000 watcher=org.apache.curator.ConnectionState@71a3a190
2018-06-03 18:41:34.129  INFO 12840 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
2018-06-03 18:41:34.133  INFO 12840 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session
2018-06-03 18:41:36.034  INFO 12840 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x10001e7028f0002, negotiated timeout = 40000
2018-06-03 18:41:36.047  INFO 12840 --- [ain-EventThread] o.a.c.f.state.ConnectionStateManager     : State change: CONNECTED
2018-06-03 18:41:36.610  WARN 12840 --- [           main] org.apache.curator.utils.ZKPaths         : The version of ZooKeeper being used doesn't support Container nodes. CreateMode.PERSISTENT will be used instead.
2018-06-03 18:41:37.759  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloCallbackServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:37.929  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloFutureServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:38.098  INFO 12840 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloSyncServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:41:39.747  INFO 12840 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)
2018-06-03 18:41:39.794  INFO 12840 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2018-06-03 18:41:39.796  INFO 12840 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.6
2018-06-03 18:41:41.360  INFO 12840 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2018-06-03 18:41:41.361  INFO 12840 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 16433 ms
2018-06-03 18:41:41.896  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: 'dispatcherServlet' to [/]
2018-06-03 18:41:41.906  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'metricsFilter' to: [/*]
2018-06-03 18:41:41.907  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
2018-06-03 18:41:41.907  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
2018-06-03 18:41:41.908  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
2018-06-03 18:41:41.908  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
2018-06-03 18:41:41.908  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'webRequestLoggingFilter' to: [/*]
2018-06-03 18:41:41.908  INFO 12840 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'applicationContextIdFilter' to: [/*]
2018-06-03 18:41:46.482  INFO 12840 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sun Jun 03 18:41:24 CST 2018]; root of context hierarchy
2018-06-03 18:41:48.970  INFO 12840 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity<java.util.Map<java.lang.String, java.lang.Object>> org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2018-06-03 18:41:48.972  INFO 12840 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=[text/html]}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
2018-06-03 18:41:49.032  INFO 12840 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:41:49.032  INFO 12840 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:41:49.628  INFO 12840 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:41:52.669  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/autoconfig || /autoconfig.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.671  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/heapdump || /heapdump.json],methods=[GET],produces=[application/octet-stream]}" onto public void org.springframework.boot.actuate.endpoint.mvc.HeapdumpMvcEndpoint.invoke(boolean,javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws java.io.IOException,javax.servlet.ServletException
2018-06-03 18:41:52.674  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/trace || /trace.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.676  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health/readiness || /health/readiness.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.healthcheck.service.SofaBootReadinessCheckMvcEndpoint.invoke(java.security.Principal)
2018-06-03 18:41:52.681  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/info || /info.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.683  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/configprops || /configprops.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.686  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/mappings || /mappings.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.688  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/sofaboot/versions || /sofaboot/versions.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.infra.endpoint.SofaBootVersionEndpointMvcAdapter.invoke()
2018-06-03 18:41:52.691  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.MetricsMvcEndpoint.value(java.lang.String)
2018-06-03 18:41:52.692  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics || /metrics.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.693  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/logfile || /logfile.json],methods=[GET || HEAD]}" onto public void org.springframework.boot.actuate.endpoint.mvc.LogFileMvcEndpoint.invoke(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws javax.servlet.ServletException,java.io.IOException
2018-06-03 18:41:52.694  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health || /health.json],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.HealthMvcEndpoint.invoke(java.security.Principal)
2018-06-03 18:41:52.698  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/dump || /dump.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.704  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EnvironmentMvcEndpoint.value(java.lang.String)
2018-06-03 18:41:52.705  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env || /env.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:52.707  INFO 12840 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/beans || /beans.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:41:54.276  INFO 12840 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-06-03 18:41:54.362  INFO 12840 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-03 18:41:56.646  INFO 12840 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-03 18:42:02.021  INFO 12840 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2018-06-03 18:42:02.035  INFO 12840 --- [           main] c.a.s.r.s.i.InvokeServerApplication      : Started InvokeServerApplication in 40.355 seconds (JVM running for 51.286)
./logs\tracelog\rpc-server-digest.log -> ./logs\tracelog\rpc-server-digest.log.2018-06-02
```

è¿è¡Œè°ƒç”¨æ–¹å¼å®¢æˆ·ç«¯èŒƒä¾‹ç±»InvokeClientApplicationæŸ¥çœ‹è°ƒç”¨æ–¹å¼å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.4.2.RELEASE)

Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
2018-06-03 18:43:17.320  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
2018-06-03 18:43:17.345  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-03 18:43:17.883  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-03 18:43:17.936  INFO 8380 --- [           main] c.a.s.r.s.i.InvokeClientApplication      : Starting InvokeClientApplication on Program with PID 8380 (D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes started by Administrator in D:\Program\Github\sofa-rpc-boot-projects)
2018-06-03 18:43:17.937  INFO 8380 --- [           main] c.a.s.r.s.i.InvokeClientApplication      : No active profile set, falling back to default profiles: default
2018-06-03 18:43:18.039  INFO 8380 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sun Jun 03 18:43:18 CST 2018]; root of context hierarchy
2018-06-03 18:43:20.152  INFO 8380 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [invoke-server-example.xml]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-03 18:43:20.645  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-03 18:43:20.766  INFO 8380 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [invoke-client-example.xml]
2018-06-03 18:43:22.872  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration' of type [class com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration$$EnhancerBySpringCGLIB$$bc04971c] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:22.904  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:22.907  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:23.118  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingConverterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingConverterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.121  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:23.123  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:23.295  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingAdapterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingAdapterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.298  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloFutureServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:23.301  WARN 8380 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Bean creation exception on non-lazy FactoryBean type check: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloCallbackServiceReference': Invocation of init method failed; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'sofaRuntimeContext': Requested bean is currently in creation: Is there an unresolvable circular reference?
2018-06-03 18:43:23.303  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeProperties' of type [class com.alipay.sofa.runtime.spring.config.SofaRuntimeProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.309  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeContext' of type [class com.alipay.sofa.runtime.spi.component.SofaRuntimeContext] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-03 18:43:23.442  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-03 18:43:23.457  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration' of type [class com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration$$EnhancerBySpringCGLIB$$f0635031] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.512  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigHelper' of type [class com.alipay.sofa.rpc.boot.runtime.adapter.helper.ConsumerConfigHelper] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.527  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'callbackImpl' of type [class com.alipay.sofa.rpc.samples.invoke.CallbackImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.531  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaBootRpcProperties' of type [class com.alipay.sofa.rpc.boot.config.SofaBootRpcProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.533  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'zookeeperConfigurator' of type [class com.alipay.sofa.rpc.boot.config.ZookeeperConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.535  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'localFileConfigurator' of type [class com.alipay.sofa.rpc.boot.config.LocalFileConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:23.535  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'registryConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.RegistryConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-03 18:43:23.655  INFO 8380 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-03 18:43:23.961  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.ConsumerConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:24.257  INFO 8380 --- [           main] o.a.c.f.imps.CuratorFrameworkImpl        : Starting
2018-06-03 18:43:24.267  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT
2018-06-03 18:43:24.267  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:host.name=Program
2018-06-03 18:43:24.267  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.version=1.8.0_141
2018-06-03 18:43:24.267  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.vendor=Oracle Corporation
2018-06-03 18:43:24.267  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.home=C:\Program Files\Java\jdk1.8.0_141\jre
2018-06-03 18:43:24.268  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.class.path=C:\Program Files\Java\jdk1.8.0_141\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\rt.jar;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-starter\target\classes;C:\Users\Administrator\.m2\repository\com\alipay\sofa\sofa-rpc-all\5.4.0\sofa-rpc-all-5.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\bolt\1.4.1\bolt-1.4.1.jar;C:\Users\Administrator\.m2\repository\org\slf4j\slf4j-api\1.7.21\slf4j-api-1.7.21.jar;C:\Users\Administrator\.m2\repository\io\netty\netty-all\4.1.25.Final\netty-all-4.1.25.Final.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\hessian\3.3.0\hessian-3.3.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\tracer-core\2.1.1\tracer-core-2.1.1.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-api\0.22.0\opentracing-api-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-noop\0.22.0\opentracing-noop-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-mock\0.22.0\opentracing-mock-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-util\0.22.0\opentracing-util-0.22.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\lookout\lookout-api\1.4.0\lookout-api-1.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\runtime-sofa-boot-starter\2.4.0\runtime-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-client\2.9.1\curator-client-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-framework\2.9.1\curator-framework-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-recipes\2.9.1\curator-recipes-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxrs\3.0.12.Final\resteasy-jaxrs-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\spec\javax\annotation\jboss-annotations-api_1.1_spec\1.0.1.Final\jboss-annotations-api_1.1_spec-1.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\activation\activation\1.1.1\activation-1.1.1.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpclient\4.3.6\httpclient-4.3.6.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpcore\4.3.3\httpcore-4.3.3.jar;C:\Users\Administrator\.m2\repository\commons-logging\commons-logging\1.1.3\commons-logging-1.1.3.jar;C:\Users\Administrator\.m2\repository\commons-codec\commons-codec\1.6\commons-codec-1.6.jar;C:\Users\Administrator\.m2\repository\commons-io\commons-io\2.1\commons-io-2.1.jar;C:\Users\Administrator\.m2\repository\net\jcip\jcip-annotations\1.0\jcip-annotations-1.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-client\3.0.12.Final\resteasy-client-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jackson-provider\3.0.12.Final\resteasy-jackson-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.12\jackson-core-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.12\jackson-mapper-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-jaxrs\1.9.12\jackson-jaxrs-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-xc\1.9.12\jackson-xc-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-netty4\3.0.12.Final\resteasy-netty4-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-validator-provider-11\3.0.12.Final\resteasy-validator-provider-11-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\hibernate\hibernate-validator\5.0.1.Final\hibernate-validator-5.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\validation\validation-api\1.1.0.Final\validation-api-1.1.0.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\logging\jboss-logging\3.1.1.GA\jboss-logging-3.1.1.GA.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\classmate\0.8.0\classmate-0.8.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\jaxrs-api\3.0.12.Final\jaxrs-api-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-multipart-provider\3.0.12.Final\resteasy-multipart-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxb-provider\3.0.12.Final\resteasy-jaxb-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-impl\2.2.7\jaxb-impl-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-core\2.2.7\jaxb-core-2.2.7.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jaxb-api\2.2.7\jaxb-api-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\istack\istack-commons-runtime\2.16\istack-commons-runtime-2.16.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\fastinfoset\FastInfoset\1.2.12\FastInfoset-1.2.12.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar;C:\Users\Administrator\.m2\repository\javax\mail\mail\1.5.0-b01\mail-1.5.0-b01.jar;C:\Users\Administrator\.m2\repository\org\apache\james\apache-mime4j\0.6\apache-mime4j-0.6.jar;C:\Users\Administrator\.m2\repository\javax\el\javax.el-api\2.2.5\javax.el-api-2.2.5.jar;C:\Users\Administrator\.m2\repository\org\glassfish\web\javax.el\2.2.6\javax.el-2.2.6.jar;C:\Users\Administrator\.m2\repository\com\alibaba\dubbo\2.4.10\dubbo-2.4.10.jar;C:\Users\Administrator\.m2\repository\org\jboss\netty\netty\3.2.5.Final\netty-3.2.5.Final.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-beans\4.3.4.RELEASE\spring-beans-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-core\4.3.4.RELEASE\spring-core-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\1.4.2.RELEASE\spring-boot-autoconfigure-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\test-sofa-boot-starter\2.4.0\test-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\healthcheck-sofa-boot-starter\2.4.0\healthcheck-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\infra-sofa-boot-starter\2.4.0\infra-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-context\4.3.4.RELEASE\spring-context-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-aop\4.3.4.RELEASE\spring-aop-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-expression\4.3.4.RELEASE\spring-expression-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot\1.4.2.RELEASE\spring-boot-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-actuator\1.4.2.RELEASE\spring-boot-starter-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter\1.4.2.RELEASE\spring-boot-starter-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-logging\1.4.2.RELEASE\spring-boot-starter-logging-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-classic\1.1.7\logback-classic-1.1.7.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-core\1.1.7\logback-core-1.1.7.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jcl-over-slf4j\1.7.21\jcl-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jul-to-slf4j\1.7.21\jul-to-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\log4j-over-slf4j\1.7.21\log4j-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\yaml\snakeyaml\1.17\snakeyaml-1.17.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-actuator\1.4.2.RELEASE\spring-boot-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-web\1.4.2.RELEASE\spring-boot-starter-web-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-tomcat\1.4.2.RELEASE\spring-boot-starter-tomcat-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\8.5.6\tomcat-embed-core-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-el\8.5.6\tomcat-embed-el-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-websocket\8.5.6\tomcat-embed-websocket-8.5.6.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.8.4\jackson-databind-2.8.4.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.8.0\jackson-annotations-2.8.0.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.8.4\jackson-core-2.8.4.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-web\4.3.4.RELEASE\spring-web-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-webmvc\4.3.4.RELEASE\spring-webmvc-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alibaba\fastjson\1.2.47\fastjson-1.2.47.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\common\sofa-common-tools\1.0.12\sofa-common-tools-1.0.12.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-test\2.9.1\curator-test-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\zookeeper\zookeeper\3.4.6\zookeeper-3.4.6.jar;C:\Users\Administrator\.m2\repository\log4j\log4j\1.2.16\log4j-1.2.16.jar;C:\Users\Administrator\.m2\repository\jline\jline\0.9.94\jline-0.9.94.jar;C:\Users\Administrator\.m2\repository\io\netty\netty\3.7.0.Final\netty-3.7.0.Final.jar;C:\Users\Administrator\.m2\repository\org\javassist\javassist\3.18.1-GA\javassist-3.18.1-GA.jar;C:\Users\Administrator\.m2\repository\org\apache\commons\commons-math\2.2\commons-math-2.2.jar;C:\Users\Administrator\.m2\repository\com\google\guava\guava\16.0.1\guava-16.0.1.jar;C:\Users\Administrator\.m2\repository\com\101tec\zkclient\0.10\zkclient-0.10.jar;D:\Program\JetBrains\IntelliJ\lib\idea_rt.jar
2018-06-03 18:43:24.269  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.library.path=C:\Program Files\Java\jdk1.8.0_141\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\ProgramData\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\Program Files\Java\jdk1.8.0_141\bin;C:\Program Files\Java\jdk1.8.0_141\jre\bin;C:\Program Files\Maven\bin;C:\Program Files (x86)\Git\cmd;C:\Program Files\MySQL\MySQL Utilities 1.6\;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;;C:\Program Files\Mercurial;.
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.io.tmpdir=C:\Users\ADMINI~1\AppData\Local\Temp\
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.compiler=<NA>
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.name=Windows 10
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.arch=amd64
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.version=10.0
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.name=Administrator
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.home=C:\Users\Administrator
2018-06-03 18:43:24.270  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.dir=D:\Program\Github\sofa-rpc-boot-projects
2018-06-03 18:43:24.272  INFO 8380 --- [           main] org.apache.zookeeper.ZooKeeper           : Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=60000 watcher=org.apache.curator.ConnectionState@4b1c0397
2018-06-03 18:43:24.374  INFO 8380 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
2018-06-03 18:43:24.378  INFO 8380 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session
2018-06-03 18:43:24.423  INFO 8380 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x10001e7028f0003, negotiated timeout = 40000
2018-06-03 18:43:24.434  INFO 8380 --- [ain-EventThread] o.a.c.f.state.ConnectionStateManager     : State change: CONNECTED
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-03 18:43:24.700  INFO 8380 --- [ackService-3-T1] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-03 18:43:25.482  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloCallbackServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:25.630  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloFutureServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:25.790  INFO 8380 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'helloSyncServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-03 18:43:27.129  INFO 8380 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8081 (http)
2018-06-03 18:43:27.158  INFO 8380 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2018-06-03 18:43:27.161  INFO 8380 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.6
2018-06-03 18:43:28.863  INFO 8380 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2018-06-03 18:43:28.864  INFO 8380 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 10825 ms
2018-06-03 18:43:29.378  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: 'dispatcherServlet' to [/]
2018-06-03 18:43:29.385  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'metricsFilter' to: [/*]
2018-06-03 18:43:29.386  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
2018-06-03 18:43:29.386  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
2018-06-03 18:43:29.386  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
2018-06-03 18:43:29.387  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
2018-06-03 18:43:29.387  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'webRequestLoggingFilter' to: [/*]
2018-06-03 18:43:29.387  INFO 8380 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'applicationContextIdFilter' to: [/*]
2018-06-03 18:43:30.579  INFO 8380 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sun Jun 03 18:43:18 CST 2018]; root of context hierarchy
2018-06-03 18:43:30.711  INFO 8380 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity<java.util.Map<java.lang.String, java.lang.Object>> org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2018-06-03 18:43:30.714  INFO 8380 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=[text/html]}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
2018-06-03 18:43:30.786  INFO 8380 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:43:30.787  INFO 8380 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:43:30.870  INFO 8380 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-03 18:43:31.416  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/logfile || /logfile.json],methods=[GET || HEAD]}" onto public void org.springframework.boot.actuate.endpoint.mvc.LogFileMvcEndpoint.invoke(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws javax.servlet.ServletException,java.io.IOException
2018-06-03 18:43:31.423  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/mappings || /mappings.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.424  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/info || /info.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.427  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/trace || /trace.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.427  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/sofaboot/versions || /sofaboot/versions.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.infra.endpoint.SofaBootVersionEndpointMvcAdapter.invoke()
2018-06-03 18:43:31.428  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/autoconfig || /autoconfig.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.430  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/beans || /beans.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.432  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/configprops || /configprops.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.433  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/heapdump || /heapdump.json],methods=[GET],produces=[application/octet-stream]}" onto public void org.springframework.boot.actuate.endpoint.mvc.HeapdumpMvcEndpoint.invoke(boolean,javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws java.io.IOException,javax.servlet.ServletException
2018-06-03 18:43:31.433  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health/readiness || /health/readiness.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.healthcheck.service.SofaBootReadinessCheckMvcEndpoint.invoke(java.security.Principal)
2018-06-03 18:43:31.434  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health || /health.json],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.HealthMvcEndpoint.invoke(java.security.Principal)
2018-06-03 18:43:31.437  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/dump || /dump.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.442  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EnvironmentMvcEndpoint.value(java.lang.String)
2018-06-03 18:43:31.442  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env || /env.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.444  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.MetricsMvcEndpoint.value(java.lang.String)
2018-06-03 18:43:31.444  INFO 8380 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics || /metrics.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-03 18:43:31.696  INFO 8380 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-06-03 18:43:31.720  INFO 8380 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
2018-06-03 18:43:33.884  INFO 8380 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8081 (http)
2018-06-03 18:43:33.891  INFO 8380 --- [           main] c.a.s.r.s.i.InvokeClientApplication      : Started InvokeClientApplication in 17.344 seconds (JVM running for 19.729)
./logs\tracelog\rpc-client-digest.log -> ./logs\tracelog\rpc-client-digest.log.2018-06-02
sync
future
callback client process:callback
```

(1)SyncåŒæ­¥è°ƒç”¨
 SOFARPCåŒæ­¥è°ƒç”¨æµç¨‹ï¼š
 [1]åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigï¼Œè®¾ç½®ConsumerConfigå®ä¾‹åº”ç”¨ä¿¡æ¯é…ç½®ã€æ¥å£åç§°ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡setInvokeTypeè®¾ç½®æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹ä¸ºRpcConstants.INVOKER_TYPE_SYNC(sync)ï¼Œé»˜è®¤æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹invokeTypeä¸ºsyncã€‚å®¢æˆ·ç«¯ä»£ç†è°ƒç”¨å™¨ClientProxyInvokerå®æ–½Proxyæ‹¦æˆªè°ƒç”¨åŒ…è£…è¯·æ±‚ï¼Œé»˜è®¤å®¢æˆ·ç«¯ä»£ç†è°ƒç”¨å™¨DefaultClientProxyInvokeråˆ¤æ–­æ˜¯å¦æ³›åŒ–è°ƒç”¨æ ¹æ®è¯·æ±‚æ–¹æ³•è°ƒç”¨ç±»å‹è®¾ç½®è¯·æ±‚è°ƒç”¨ç±»å‹invokeTypeï¼š

```Java
/**
 * è°ƒç”¨æ–¹å¼ï¼šåŒæ­¥è°ƒç”¨
 */
public static final String  INVOKER_TYPE_SYNC  = "sync";

protected void decorateRequest(SofaRequest request) {
    // å…¬å…±çš„è®¾ç½®
    super.decorateRequest(request);

    // ç¼“å­˜æ˜¯ä¸ºäº†åŠ å¿«é€Ÿåº¦
    request.setTargetServiceUniqueName(serviceName);
    request.setSerializeType(serializeType == null ? 0 : serializeType);

    if (!consumerConfig.isGeneric()) {
        // æ‰¾åˆ°è°ƒç”¨ç±»å‹ï¼Œ genericçš„æ—¶å€™ç±»å‹åœ¨filteré‡Œè¿›è¡Œåˆ¤æ–­
        request.setInvokeType(consumerConfig.getMethodInvokeType(request.getMethodName()));
    }

    RpcInvokeContext invokeCtx = RpcInvokeContext.peekContext();
    RpcInternalContext internalContext = RpcInternalContext.getContext();
    if (invokeCtx != null) {
        // å¦‚æœç”¨æˆ·è®¾ç½®äº†è°ƒç”¨çº§åˆ«å›è°ƒå‡½æ•°
        SofaResponseCallback responseCallback = invokeCtx.getResponseCallback();
        if (responseCallback != null) {
            request.setSofaResponseCallback(responseCallback);
            invokeCtx.setResponseCallback(null); // ä¸€æ¬¡æ€§ç”¨å®Œ
            invokeCtx.put(RemotingConstants.INVOKE_CTX_IS_ASYNC_CHAIN,
                isSendableResponseCallback(responseCallback));
        }
        // å¦‚æœç”¨æˆ·è®¾ç½®äº†è°ƒç”¨çº§åˆ«è¶…æ—¶æ—¶é—´
        Integer timeout = invokeCtx.getTimeout();
        if (timeout != null) {
            request.setTimeout(timeout);
            invokeCtx.setTimeout(null);// ä¸€æ¬¡æ€§ç”¨å®Œ
        }
        // å¦‚æœç”¨æˆ·æŒ‡å®šäº†è°ƒç”¨çš„URL
        String targetURL = invokeCtx.getTargetURL();
        if (targetURL != null) {
            internalContext.setAttachment(HIDDEN_KEY_PINPOINT, targetURL);
            invokeCtx.setTargetURL(null);// ä¸€æ¬¡æ€§ç”¨å®Œ
        }
        // å¦‚æœç”¨æˆ·æŒ‡å®šäº†é€ä¼ æ•°æ®
        if (RpcInvokeContext.isBaggageEnable()) {
            // éœ€è¦é€ä¼ 
            BaggageResolver.carryWithRequest(invokeCtx, request);
            internalContext.setAttachment(HIDDEN_KEY_INVOKE_CONTEXT, invokeCtx);
        }
    }
    if (RpcInternalContext.isAttachmentEnable()) {
        internalContext.setAttachment(INTERNAL_KEY_APP_NAME, consumerConfig.getAppName());
        internalContext.setAttachment(INTERNAL_KEY_PROTOCOL_NAME, consumerConfig.getProtocol());
    }

    // é¢å¤–å±æ€§é€šè¿‡HEADä¼ é€’ç»™æœåŠ¡ç«¯
    request.addRequestProp(RemotingConstants.HEAD_APP_NAME, consumerConfig.getAppName());
    request.addRequestProp(RemotingConstants.HEAD_PROTOCOL, consumerConfig.getProtocol());
}
rpc-config-default.json:
// é»˜è®¤æ˜¯å¦å¼‚æ­¥
"consumer.invokeType": "sync"
```

[2]æœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigè°ƒç”¨æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapçš„refer()æ–¹æ³•å¼•ç”¨æœåŠ¡ï¼Œæ¶ˆè´¹è€…è°ƒç”¨å™¨ConsumerInvokerè°ƒç”¨invoke()æ–¹æ³•ä½¿ç”¨å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡å™¨æ‰§è¡Œå®¢æˆ·ç«¯é›†ç¾¤Clusterçš„doSendMsg()æ–¹æ³•SyncåŒæ­¥è°ƒç”¨ï¼š

```Java
/**
 * è°ƒç”¨å®¢æˆ·ç«¯
 *
 * @param transport å®¢æˆ·ç«¯è¿æ¥
 * @param request   Requestå¯¹è±¡
 * @return è°ƒç”¨ç»“æœ
 * @throws SofaRpcException rpcå¼‚å¸¸
 */
protected SofaResponse doSendMsg(ProviderInfo providerInfo, ClientTransport transport,
                                 SofaRequest request) throws SofaRpcException {
    RpcInternalContext context = RpcInternalContext.getContext();
    // æ·»åŠ è°ƒç”¨çš„æœåŠ¡ç«¯è¿œç¨‹åœ°å€
    RpcInternalContext.getContext().setRemoteAddress(providerInfo.getHost(), providerInfo.getPort());
    try {
        checkProviderVersion(providerInfo, request); // æ ¹æ®æœåŠ¡ç«¯ç‰ˆæœ¬ç‰¹æ®Šå¤„ç†
        String invokeType = request.getInvokeType();
        int timeout = resolveTimeout(request, consumerConfig, providerInfo);

        SofaResponse response = null;
        // åŒæ­¥è°ƒç”¨
        if (RpcConstants.INVOKER_TYPE_SYNC.equals(invokeType)) {
            long start = RpcRuntimeContext.now();
            try {
                response = transport.syncSend(request, timeout);
            } finally {
                if (RpcInternalContext.isAttachmentEnable()) {
                    long elapsed = RpcRuntimeContext.now() - start;
                    context.setAttachment(RpcConstants.INTERNAL_KEY_CLIENT_ELAPSE, elapsed);
                }
            }
        } else {
            throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, "Unknown invoke type:" + invokeType);
        }
        return response;
    } catch (SofaRpcException e) {
        throw e;
    } catch (Throwable e) { // å®¢æˆ·ç«¯å…¶å®ƒå¼‚å¸¸
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e);
    }
}
```

å®¢æˆ·ç«¯é›†ç¾¤Clusteræ ¹æ®è¯·æ±‚è°ƒç”¨ç±»å‹åˆ¤æ–­æ˜¯å¦ä¸ºåŒæ­¥è°ƒç”¨ç±»å‹ï¼Œå®¢æˆ·ç«¯ä¼ è¾“ClientTransportè°ƒç”¨syncSend()æ–¹æ³•æŒ‡å®šè¶…æ—¶æ—¶é—´èŒƒç•´åŒæ­¥è°ƒç”¨å‘é€è¯·æ±‚é˜»å¡ç­‰å¾…å“åº”è·å–è°ƒç”¨ç»“æœï¼ŒåŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextè®°å½•å®¢æˆ·ç«¯æ€»è€—æ—¶ï¼š

```Java
/**
 * åŒæ­¥è°ƒç”¨
 *
 * @param message æ¶ˆæ¯
 * @param timeout è¶…æ—¶æ—¶é—´
 * @return SofaResponse base message
 * @throws SofaRpcException SofaRpcException
 */
public abstract SofaResponse syncSend(SofaRequest message, int timeout) throws SofaRpcException;
```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport/H2&H2Cå®¢æˆ·ç«¯ä¼ è¾“AbstractHttp2ClientTransport/ç¬¬ä¸‰æ–¹åè®®ä»£ç†å®¢æˆ·ç«¯ä¼ è¾“AbstractProxyClientTransportåŒæ­¥è°ƒç”¨syncSendè¿‡ç¨‹ï¼šæ£€æŸ¥é•¿è¿æ¥ï¼Œè·å–åŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextï¼Œ[BoltClientTransportæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºè°ƒç”¨ä¸Šä¸‹æ–‡]ï¼Œé€šè¿‡doInvokeSync()æ–¹æ³•æ‰§è¡ŒåŒæ­¥è°ƒç”¨ã€‚

```Java
/**
 * æ³¨æ„ï¼Œboltçš„å®ç°åªæ”¯æŒé•¿è¿æ¥å…±äº«æ¨¡å¼ã€‚
 */
@Extension("bolt")
public class BoltClientTransport extends ClientTransport {
  public SofaResponse syncSend(SofaRequest request, int timeout) throws SofaRpcException {
    checkConnection();
    RpcInternalContext context = RpcInternalContext.getContext();
    InvokeContext boltInvokeContext = createInvokeContext(request);
    SofaResponse response = null;
    SofaRpcException throwable = null;
    try {
        beforeSend(context, request);
        response = doInvokeSync(request, boltInvokeContext, timeout);
        return response;
    } catch (Exception e) { // å…¶å®ƒå¼‚å¸¸
        throwable = convertToRpcException(e);
        throw throwable;
    } finally {
        afterSend(context, boltInvokeContext, request);
        if (EventBus.isEnable(ClientSyncReceiveEvent.class)) {
            EventBus.post(new ClientSyncReceiveEvent(transportConfig.getConsumerConfig(),
                transportConfig.getProviderInfo(), request, response, throwable));
        }
    }
 }

/**
 * åŒæ­¥è°ƒç”¨
 *
 * @param request       è¯·æ±‚å¯¹è±¡
 * @param invokeContext è°ƒç”¨ä¸Šä¸‹æ–‡
 * @param timeoutMillis è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * @return è¿”å›å¯¹è±¡
 * @throws RemotingException    è¿œç¨‹è°ƒç”¨å¼‚å¸¸
 * @throws InterruptedException ä¸­æ–­å¼‚å¸¸
 * @since 5.2.0
 */
 protected SofaResponse doInvokeSync(SofaRequest request, InvokeContext invokeContext, int timeoutMillis)
    throws RemotingException, InterruptedException {
    return (SofaResponse) RPC_CLIENT.invokeSync(url, request, invokeContext, timeoutMillis);
  }
}
/**
 * h2å’Œh2cé€šç”¨çš„å®¢æˆ·ç«¯ä¼ è¾“å±‚
 */
public abstract class AbstractHttp2ClientTransport extends ClientTransport {
  public SofaResponse syncSend(SofaRequest request, int timeout) throws SofaRpcException {
    checkConnection();
    RpcInternalContext context = RpcInternalContext.getContext();
    try {
        beforeSend(context, request);
        return doInvokeSync(request, timeout);
    } catch (TimeoutException e) {
        throw timeoutException(request, timeout, e);
    } catch (SofaRpcException e) {
        throw e;
    } catch (Exception e) {
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e.getMessage(), e);
    } finally {
        afterSend(context, request);
    }
 }

 /**
 * åŒæ­¥è°ƒç”¨
 *
 * @param request è¯·æ±‚å¯¹è±¡
 * @param timeout è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * @return è¿”å›å¯¹è±¡
 * @throws InterruptedException ä¸­æ–­å¼‚å¸¸
 * @throws ExecutionException   æ‰§è¡Œå¼‚å¸¸
 * @throws TimeoutException     è¶…æ—¶å¼‚å¸¸
 */
  protected SofaResponse doInvokeSync(SofaRequest request, int timeout) throws InterruptedException,
    ExecutionException, TimeoutException {
    HttpResponseFuture future = new HttpResponseFuture(request, timeout);
    AbstractHttpClientHandler callback = new SyncInvokeClientHandler(transportConfig.getConsumerConfig(),
        transportConfig.getProviderInfo(), future, request, RpcInternalContext.getContext(),
        ClassLoaderUtils.getCurrentClassLoader());
    future.setSentTime();
    doSend(request, callback, timeout);
    future.setSentTime();
    return future.getSofaResponse(timeout, TimeUnit.MILLISECONDS);
  }
}

/**
 * Abstract ProxyClientTransport for 3rd protocol, like cxf/resteasy.
 */
public abstract class AbstractProxyClientTransport extends ClientTransport {
  public SofaResponse syncSend(SofaRequest request, int timeout) throws SofaRpcException {
    RpcInternalContext context = RpcInternalContext.getContext();
    SofaResponse response = null;
    SofaRpcException throwable = null;
    try {
        beforeSend(context, request);
        if (EventBus.isEnable(ClientBeforeSendEvent.class)) {
            EventBus.post(new ClientBeforeSendEvent(request));
        }
        response = doInvokeSync(request, timeout);
        return response;
    } catch (InvocationTargetException e) {
        throwable = convertToRpcException(e);
        throw throwable;
    } catch (SofaRpcException e) {
        throwable = e;
        throw e;
    } catch (Exception e) {
        throwable = new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR,
            "Failed to send message to remote", e);
        throw throwable;
    } finally {
        afterSend(context, request);
        if (EventBus.isEnable(ClientSyncReceiveEvent.class)) {
            EventBus.post(new ClientSyncReceiveEvent(transportConfig.getConsumerConfig(),
                transportConfig.getProviderInfo(), request, response, throwable));
        }
    }
 }

/**
 * åŒæ­¥è°ƒç”¨
 *
 * @param request       è¯·æ±‚å¯¹è±¡
 * @param timeoutMillis è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * @return è¿”å›å¯¹è±¡
 * @throws InvocationTargetException åå°„è°ƒç”¨å¼‚å¸¸
 * @since 5.2.0
 */
 protected SofaResponse doInvokeSync(SofaRequest request, int timeoutMillis)
    throws InvocationTargetException, IllegalAccessException {
    SofaResponse response = new SofaResponse();
    Method method = getMethod(request);
    if (method == null) {
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR,
            "Not found method :" + request.getInterfaceName() + "." + request.getMethodName());
    }
    Object o = method.invoke(proxy, request.getMethodArgs());
    response.setAppResponse(o);
    return response;
 }
}
```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport doInvokeSyncåŒæ­¥è°ƒç”¨é€šè¿‡RpcClientè°ƒç”¨RPCè¿œç¨‹è¿æ¥RpcRemotingçš„invokeSync()æ–¹æ³•æ ¹æ®è°ƒç”¨è¯·æ±‚URLè·å–æ£€æŸ¥è¿œç¨‹è¿æ¥ï¼Œæ ¹æ®è¿œç¨‹è¯·æ±‚å‘½ä»¤RemotingCommandå’Œè°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextåˆ›å»ºInvokeFutureæ·»åŠ åˆ°è¿œç¨‹è¿æ¥çš„invokeFutureMapé”®å€¼å¯¹<invokeId,future>ï¼Œä½¿ç”¨ç®¡é“Channelçš„writeAndFlush(Object msg)æ–¹æ³•å¼‚æ­¥å‘é€å®¢æˆ·ç«¯æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æ·»åŠ ç›‘å¬å™¨æä¾›æ“ä½œå®Œæˆå‘é€å¤±è´¥Futureæ·»åŠ å¤±è´¥å“åº”åœºæ™¯ç›‘å¬ï¼ŒInvokeFutureæ ¹æ®è¶…æ—¶æ—¶é—´ç­‰å¾…è·å–å“åº”å‘½ä»¤å¹¶ä¸”å”¤é†’ç­‰å¾…å“åº”ç»“æœçº¿ç¨‹ï¼Œå“åº”å‘½ä»¤è§£æååºåˆ—åŒ–è¿”å›å“åº”å¯¹è±¡ç»“æœï¼š

```Java
/**
 * Synchronous rpc invocation.<br>
 * Notice! DO NOT modify the request object concurrently when this method is called.
 *
 * @param conn
 * @param request
 * @param invokeContext
 * @param timeoutMillis
 * @return
 * @throws RemotingException
 * @throws InterruptedException
 */
public Object invokeSync(Connection conn, Object request, InvokeContext invokeContext, int timeoutMillis) throws RemotingException, InterruptedException {
    RemotingCommand requestCommand = this.toRemotingCommand(request, conn, invokeContext, timeoutMillis);
    this.preProcessInvokeContext(invokeContext, requestCommand, conn);
    ResponseCommand responseCommand = (ResponseCommand)super.invokeSync(conn, requestCommand, timeoutMillis);
    responseCommand.setInvokeContext(invokeContext);
    Object responseObject = RpcResponseResolver.resolveResponseObject(responseCommand, RemotingUtil.parseRemoteAddress(conn.getChannel()));
    return responseObject;
}
/**
 * Synchronous invocation
 *
 * @param conn
 * @param request
 * @param timeoutMillis
 * @return
 * @throws InterruptedException
 * @throws RemotingException
 */
protected RemotingCommand invokeSync(final Connection conn, final RemotingCommand request, int timeoutMillis) throws RemotingException, InterruptedException {
    final InvokeFuture future = this.createInvokeFuture(request, request.getInvokeContext());
    conn.addInvokeFuture(future);

    try {
        conn.getChannel().writeAndFlush(request).addListener(new ChannelFutureListener() {
            public void operationComplete(ChannelFuture f) throws Exception {
                if (!f.isSuccess()) {
                    conn.removeInvokeFuture(request.getId());
                    future.putResponse(BaseRemoting.this.commandFactory.createSendFailedResponse(conn.getRemoteAddress(), f.cause()));
                    BaseRemoting.logger.error("Invoke send failed, id={}", request.getId(), f.cause());
                }

            }
        });
    } catch (Exception var6) {
        conn.removeInvokeFuture(request.getId());
        if (future != null) {
            future.putResponse(this.commandFactory.createSendFailedResponse(conn.getRemoteAddress(), var6));
        }

        logger.error("Exception caught when sending invocation, id={}", request.getId(), var6);
    }

    RemotingCommand response = future.waitResponse((long)timeoutMillis);
    if (response == null) {
        conn.removeInvokeFuture(request.getId());
        response = this.commandFactory.createTimeoutResponse(conn.getRemoteAddress());
        logger.warn("Wait response, request id={} timeout!", request.getId());
    }

    return response;
}
/**
 * Wait response with timeout.
 *
 * @param timeoutMillis
 * @return
 * @throws InterruptedException
 */
public ResponseCommand waitResponse(long timeoutMillis) throws InterruptedException {
    this.countDownLatch.await(timeoutMillis, TimeUnit.MILLISECONDS);
    return this.responseCommand;
}
```





 ä»€ä¹ˆæ—¶å€™è°ƒç”¨DefaultInvokeFutureçš„putResponseæ–¹æ³•è®¾ç½®å“åº”å‘½ä»¤ResponseCommandï¼ŸæŸ¥çœ‹DefaultInvokeFutureçš„putResponseæ–¹æ³•è°ƒç”¨é“¾ï¼š



![img](https:////upload-images.jianshu.io/upload_images/6739367-69b2546065e9ebe1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/554/format/jpeg)

DefaultInvokeFutureçš„putResponseæ–¹æ³•è°ƒç”¨é“¾

DefaultInvokeFutureçš„putResponseæ–¹æ³•è°ƒç”¨é“¾é¡¶ç«¯æ˜¯é€šè¿‡RpcRequestProcessorå¤„ç†å™¨ProcessTaskå¤„ç†ä»»åŠ¡è°ƒç”¨ï¼ŒProcessTaskæ„é€ æ–¹æ³•è°ƒç”¨é“¾é¡¶ç«¯æ˜¯é€šè¿‡RpcHandlerå¤„ç†å™¨çš„channelReadæ–¹æ³•è¯»å–ç®¡é“ChannelæœåŠ¡ç«¯å“åº”è¿”å›ç»“æœã€‚
 (2)Futureå¼‚æ­¥è°ƒç”¨
 å‚è€ƒSOFARPC Exampleç¤ºä¾‹æ¨¡å—([com.alipay.sofa.rpc.invoke.future](https://github.com/alipay/sofa-rpc/tree/master/example/src/test/java/com/alipay/sofa/rpc/invoke/future))ï¼š

```Java
package com.alipay.sofa.rpc.invoke.future;

import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ProviderConfig;
import com.alipay.sofa.rpc.config.ServerConfig;
import com.alipay.sofa.rpc.test.EchoService;
import com.alipay.sofa.rpc.test.EchoServiceImpl;
import com.alipay.sofa.rpc.test.HelloService;
import com.alipay.sofa.rpc.test.HelloServiceImpl;

public class FutureServerMain {

    public static void main(String[] args) {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-server");

        ServerConfig serverConfig2 = new ServerConfig()
            .setPort(22222)
            .setDaemon(false);

        ProviderConfig<HelloService> providerConfig = new ProviderConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setRef(new HelloServiceImpl(1000))
            .setServer(serverConfig2);
        providerConfig.export();

        ProviderConfig<EchoService> providerConfig2 = new ProviderConfig<EchoService>()
            .setApplication(applicationConfig)
            .setInterfaceId(EchoService.class.getName())
            .setRef(new EchoServiceImpl())
            .setServer(serverConfig2);
        providerConfig2.export();
    }
}
package com.alipay.sofa.rpc.invoke.future;

import com.alipay.sofa.rpc.api.future.SofaResponseFuture;
import com.alipay.sofa.rpc.common.RpcConstants;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;
import com.alipay.sofa.rpc.message.bolt.BoltResponseFuture;
import com.alipay.sofa.rpc.test.EchoService;
import com.alipay.sofa.rpc.test.HelloService;

/**
 * <p>æ¥å£çº§åˆ«çš„Callback</p>
 */
public class FutureClientMain {

    /**
     * slf4j Logger for this class
     */
    private final static Logger LOGGER = LoggerFactory.getLogger(FutureClientMain.class);

    public static void main(String[] args) throws InterruptedException {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-client");

        ConsumerConfig<HelloService> consumerConfig = new ConsumerConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_FUTURE)
            .setTimeout(50000)
            .setDirectUrl("bolt://127.0.0.1:22222?appName=future-server");
        HelloService helloService = consumerConfig.refer();

        ConsumerConfig<EchoService> consumerConfig2 = new ConsumerConfig<EchoService>()
            .setApplication(applicationConfig)
            .setInterfaceId(EchoService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_FUTURE)
            .setTimeout(50000)
            .setDirectUrl("bolt://127.0.0.1:22222?appName=future-server");
        EchoService echoService = consumerConfig2.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        while (true) {
            try {
                String s1 = helloService.sayHello("xxx", 22);
                LOGGER.warn("must null :{}", s1);
                BoltResponseFuture future1 = (BoltResponseFuture) SofaResponseFuture.getFuture();

                String s2 = echoService.echoStr("yyy");
                LOGGER.warn("must null :{}", s2);
                BoltResponseFuture future2 = (BoltResponseFuture) SofaResponseFuture.getFuture();

                s1 = (String) future1.get();
                LOGGER.warn("get future1: {}, elapse: {}", s1, future1.getElapsedTime());
                s2 = (String) future2.get();
                LOGGER.warn("get future2: {}, elapse: {}", s2, future2.getElapsedTime());

            } catch (Exception e) {
                LOGGER.error(e.getMessage(), e);
            }
            try {
                Thread.sleep(2000);
            } catch (Exception ignore) {
            }
        }

    }

}
```

è¿è¡Œå¼‚æ­¥è°ƒç”¨æœåŠ¡ç«¯ç¤ºä¾‹ç±»FutureServerMainæŸ¥çœ‹å¼‚æ­¥è°ƒç”¨æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 17:55:39,466 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:4208
2018-06-03 17:55:39,806 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 17:55:39,915 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 17:55:41,136 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 17:55:41,175 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 17:55:42,157 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [future-server]Export provider config : com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 17:55:43,673 main  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 17:55:45,134 main  INFO [com.alipay.sofa.rpc.server.bolt.BoltServer:info:102] - Bolt server has been bind to 0.0.0.0:22222
2018-06-03 17:55:45,255 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [future-server]Export provider config : com.alipay.sofa.rpc.test.EchoService: with bean id rpc-cfg-1
2018-06-03 17:56:15,090 SOFA-SEV-BOLT-BIZ-22222-3-T1  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@33cb737a
name:xxx, age:22
C:\Users\Administrator\logs\tracelog\rpc-server-digest.log -> C:\Users\Administrator\logs\tracelog\rpc-server-digest.log.2018-06-02
name:xxx, age:22
```

è¿è¡Œå¼‚æ­¥è°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»FutureClientMainæŸ¥çœ‹å¼‚æ­¥è°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 17:56:01,298 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:14812
2018-06-03 17:56:01,902 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 17:56:02,442 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 17:56:04,501 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 17:56:04,540 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 17:56:05,855 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [future-client]Refer consumer config : bolt://com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
2018-06-03 17:56:08,650 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-client]Add provider of com.alipay.sofa.rpc.test.HelloService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 17:56:09,367 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 17:56:11,735 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-client]Connect to com.alipay.sofa.rpc.test.HelloService provider:bolt://127.0.0.1:22222?appName=future-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:50693
2018-06-03 17:56:12,460 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [future-client]Refer consumer config : bolt://com.alipay.sofa.rpc.test.EchoService: with bean id rpc-cfg-1
2018-06-03 17:56:12,463 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-client]Add provider of com.alipay.sofa.rpc.test.EchoService, size is : 1
2018-06-03 17:56:12,564 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.EchoService-5-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-client]Connect to com.alipay.sofa.rpc.test.EchoService provider:bolt://127.0.0.1:22222?appName=future-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:50693
2018-06-03 17:56:12,586 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - started at pid 14812
2018-06-03 17:56:12,650 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@1794d431
2018-06-03 17:56:14,331 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
2018-06-03 17:56:14,380 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
C:\Users\Administrator\logs\tracelog\rpc-client-digest.log -> C:\Users\Administrator\logs\tracelog\rpc-client-digest.log.2018-06-02
2018-06-03 17:56:16,147 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - get future1: hello xxx from server! age: 22, elapse: 3162
2018-06-03 17:56:16,147 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - get future2: yyy, elapse: 1130
2018-06-03 17:56:18,152 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
2018-06-03 17:56:18,155 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
2018-06-03 17:56:19,162 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - get future1: hello xxx from server! age: 22, elapse: 1013
2018-06-03 17:56:19,162 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - get future2: yyy, elapse: 17
2018-06-03 17:56:21,166 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
2018-06-03 17:56:21,170 main  WARN [com.alipay.sofa.rpc.invoke.future.FutureClientMain:warn:142] - must null :null
```

SOFARPCå¼‚æ­¥è°ƒç”¨æµç¨‹ï¼š
 [1]åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigï¼Œè®¾ç½®ConsumerConfigå®ä¾‹åº”ç”¨ä¿¡æ¯é…ç½®ã€æ¥å£åç§°ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡setInvokeTypeè®¾ç½®æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹ä¸ºRpcConstants.INVOKER_TYPE_FUTURE(future)ï¼š

```Java
/**
 * è°ƒç”¨æ–¹å¼ï¼šfuture
 */
public static final String  INVOKER_TYPE_FUTURE   = "future";
```

[2]æœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigè°ƒç”¨æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapçš„refer()æ–¹æ³•å¼•ç”¨æœåŠ¡ï¼Œæ¶ˆè´¹è€…è°ƒç”¨å™¨ConsumerInvokerè°ƒç”¨invoke()æ–¹æ³•ä½¿ç”¨å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡å™¨æ‰§è¡Œå®¢æˆ·ç«¯é›†ç¾¤Clusterçš„doSendMsg()æ–¹æ³•Futureå¼‚æ­¥è°ƒç”¨ï¼š

```Java
/**
 * è°ƒç”¨å®¢æˆ·ç«¯
 *
 * @param transport å®¢æˆ·ç«¯è¿æ¥
 * @param request   Requestå¯¹è±¡
 * @return è°ƒç”¨ç»“æœ
 * @throws SofaRpcException rpcå¼‚å¸¸
 */
protected SofaResponse doSendMsg(ProviderInfo providerInfo, ClientTransport transport,
                                 SofaRequest request) throws SofaRpcException {
    RpcInternalContext context = RpcInternalContext.getContext();
    // æ·»åŠ è°ƒç”¨çš„æœåŠ¡ç«¯è¿œç¨‹åœ°å€
    RpcInternalContext.getContext().setRemoteAddress(providerInfo.getHost(), providerInfo.getPort());
    try {
        checkProviderVersion(providerInfo, request); // æ ¹æ®æœåŠ¡ç«¯ç‰ˆæœ¬ç‰¹æ®Šå¤„ç†
        String invokeType = request.getInvokeType();
        int timeout = resolveTimeout(request, consumerConfig, providerInfo);

        SofaResponse response = null;
        // Futureè°ƒç”¨
        if (RpcConstants.INVOKER_TYPE_FUTURE.equals(invokeType)) {
            // è®°å½•å‘é€å¼€å§‹æ—¶é—´
            context.setAttachment(RpcConstants.INTERNAL_KEY_CLIENT_SEND_TIME, RpcRuntimeContext.now());
            // å¼€å§‹è°ƒç”¨
            ResponseFuture future = transport.asyncSend(request, timeout);
            // æ”¾å…¥çº¿ç¨‹ä¸Šä¸‹æ–‡
            RpcInternalContext.getContext().setFuture(future);
            response = buildEmptyResponse(request);
        } else {
            throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, "Unknown invoke type:" + invokeType);
        }
        return response;
    } catch (SofaRpcException e) {
        throw e;
    } catch (Throwable e) { // å®¢æˆ·ç«¯å…¶å®ƒå¼‚å¸¸
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e);
    }
}
```

å®¢æˆ·ç«¯é›†ç¾¤Clusteræ ¹æ®è¯·æ±‚è°ƒç”¨ç±»å‹åˆ¤æ–­æ˜¯å¦ä¸ºå¼‚æ­¥è°ƒç”¨ç±»å‹ï¼ŒåŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextè®°å½•å‘é€å¼€å§‹æ—¶é—´ï¼Œå®¢æˆ·ç«¯ä¼ è¾“ClientTransportè°ƒç”¨asyncSend()æ–¹æ³•æŒ‡å®šè¶…æ—¶èŒƒç•´å¼‚æ­¥è°ƒç”¨å‘é€è¯·æ±‚è·å–å“åº”Futureå³è°ƒç”¨get()æ–¹æ³•è¿›è¡Œè·å–å“åº”æˆ–è€…æ³¨å…¥ç›‘å¬å™¨é€šçŸ¥ç»“æœï¼Œå¹¶ä¸”æä¾›ç»™ä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextï¼Œæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºç©ºå“åº”è°ƒç”¨ç»“æœï¼š

```Java
/**
 * å¼‚æ­¥è°ƒç”¨
 *
 * @param message æ¶ˆæ¯
 * @param timeout è¶…æ—¶æ—¶é—´
 * @return å¼‚æ­¥Future response future
 * @throws SofaRpcException SofaRpcException
 */
public abstract ResponseFuture asyncSend(SofaRequest message, int timeout) throws SofaRpcException;

```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport/H2&H2Cå®¢æˆ·ç«¯ä¼ è¾“AbstractHttp2ClientTransport/ç¬¬ä¸‰æ–¹åè®®ä»£ç†å®¢æˆ·ç«¯ä¼ è¾“AbstractProxyClientTransport[æŠ›å‡ºçŸ­è¿æ¥ä¸æ”¯æŒå¼‚æ­¥RPCå¼‚å¸¸]å¼‚æ­¥è°ƒç”¨asyncSendè¿‡ç¨‹ï¼šæ£€æŸ¥é•¿è¿æ¥ï¼Œè·å–åŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextï¼Œ[BoltClientTransportæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºè°ƒç”¨ä¸Šä¸‹æ–‡]ï¼Œé€šè¿‡doInvokeAsync()æ–¹æ³•æ‰§è¡Œå¼‚æ­¥è°ƒç”¨ã€‚

```Java
@Extension("bolt")
public class BoltClientTransport extends ClientTransport {
 public ResponseFuture asyncSend(SofaRequest request, int timeout) throws SofaRpcException {
    checkConnection();
    RpcInternalContext context = RpcInternalContext.getContext();
    InvokeContext boltInvokeContext = createInvokeContext(request);
    try {
        beforeSend(context, request);
        boltInvokeContext.put(RemotingConstants.INVOKE_CTX_RPC_CTX, context);
        return doInvokeAsync(request, context, boltInvokeContext, timeout);
    } catch (Exception e) {
        throw convertToRpcException(e);
    } finally {
        afterSend(context, boltInvokeContext, request);
    }
 }

/**
 * å¼‚æ­¥è°ƒç”¨
 *
 * @param request       è¯·æ±‚å¯¹è±¡
 * @param rpcContext    RPCå†…ç½®ä¸Šä¸‹æ–‡
 * @param invokeContext è°ƒç”¨ä¸Šä¸‹æ–‡
 * @param timeoutMillis è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * @throws RemotingException    è¿œç¨‹è°ƒç”¨å¼‚å¸¸
 * @throws InterruptedException ä¸­æ–­å¼‚å¸¸
 * @since 5.2.0
 */
 protected ResponseFuture doInvokeAsync(SofaRequest request, RpcInternalContext rpcContext,
                                       InvokeContext invokeContext, int timeoutMillis)
    throws RemotingException, InterruptedException {
    SofaResponseCallback listener = request.getSofaResponseCallback();
    if (listener != null) {
        // callbackè°ƒç”¨
        InvokeCallback callback = new BoltInvokerCallback(transportConfig.getConsumerConfig(),
            transportConfig.getProviderInfo(), listener, request, rpcContext,
            ClassLoaderUtils.getCurrentClassLoader());
        // å‘èµ·è°ƒç”¨
        RPC_CLIENT.invokeWithCallback(url, request, invokeContext, callback, timeoutMillis);
        return null;
    } else {
        // future è½¬ä¸º callback
        BoltResponseFuture future = new BoltResponseFuture(request, timeoutMillis);
        InvokeCallback callback = new BoltFutureInvokeCallback(transportConfig.getConsumerConfig(),
            transportConfig.getProviderInfo(), future, request, rpcContext,
            ClassLoaderUtils.getCurrentClassLoader());
        // å‘èµ·è°ƒç”¨
        RPC_CLIENT.invokeWithCallback(url, request, invokeContext, callback, timeoutMillis);
        future.setSentTime();
        return future;
    }
 }
}
public abstract class AbstractHttp2ClientTransport extends ClientTransport {
 public ResponseFuture asyncSend(SofaRequest request, int timeout) throws SofaRpcException {
    checkConnection();
    RpcInternalContext context = RpcInternalContext.getContext();
    try {
        beforeSend(context, request);
        return doInvokeAsync(request, context, timeout);
    } catch (SofaRpcException e) {
        throw e;
    } catch (Exception e) {
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e.getMessage(), e);
    } finally {
        afterSend(context, request);
    }
 }

/**
 * å¼‚æ­¥è°ƒç”¨
 *
 * @param request       è¯·æ±‚å¯¹è±¡
 * @param rpcContext    RPCå†…ç½®ä¸Šä¸‹æ–‡
 * @param timeoutMillis è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 */
protected ResponseFuture doInvokeAsync(SofaRequest request, RpcInternalContext rpcContext, int timeoutMillis) {
    SofaResponseCallback listener = request.getSofaResponseCallback();
    if (listener != null) {
        AbstractHttpClientHandler callback = new CallbackInvokeClientHandler(transportConfig.getConsumerConfig(),
            transportConfig.getProviderInfo(), listener, request, rpcContext,
            ClassLoaderUtils.getCurrentClassLoader());
        doSend(request, callback, timeoutMillis);
        return null;
    } else {
        HttpResponseFuture future = new HttpResponseFuture(request, timeoutMillis);
        AbstractHttpClientHandler callback = new FutureInvokeClientHandler(transportConfig.getConsumerConfig(),
            transportConfig.getProviderInfo(), future, request, rpcContext,
            ClassLoaderUtils.getCurrentClassLoader());
        doSend(request, callback, timeoutMillis);
        future.setSentTime();
        return future;
    }
 }
}

```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport doInvokeAsyncå¼‚æ­¥è°ƒç”¨åˆ¤æ–­ç”¨æˆ·å±‚è°ƒç”¨çº§åˆ«æœåŠ¡å›è°ƒç±»å®ä¾‹æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºFutureè°ƒç”¨æ–¹å¼æœªè®¾ç½®æœåŠ¡å›è°ƒç±»å®ä¾‹ï¼Œéœ€è¦æ ¹æ®SofaRequstè¯·æ±‚å’Œè¶…æ—¶æ—¶é—´æ„å»ºBoltResponseFutureï¼Œä»¥å®¢æˆ·ç«¯æœåŠ¡å‘å¸ƒé…ç½®ã€æœåŠ¡å¼•ç”¨é…ç½®ã€BoltResponseFutureã€SofaRequstè¯·æ±‚ã€ä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextä»¥åŠå½“å‰ç±»åŠ è½½å™¨æ„é€ Callbackæ¨¡å¼è°ƒç”¨åŒ…è£…BoltFutureInvokeCallbackè½¬æˆCallbackå›è°ƒè°ƒç”¨ã€‚BoltClientTransporté€šè¿‡RpcClientè°ƒç”¨RPCè¿œç¨‹è¿æ¥RpcRemotingçš„invokeWithCallback()æ–¹æ³•æ ¹æ®è°ƒç”¨è¯·æ±‚URLè·å–æ£€æŸ¥è¿œç¨‹è¿æ¥ï¼Œæ ¹æ®è¿œç¨‹è¯·æ±‚å‘½ä»¤RemotingCommandå’Œè°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextåˆ›å»ºInvokeFutureç»‘å®šRpcè°ƒç”¨å›è°ƒç›‘å¬å™¨RpcInvokeCallbackListenerï¼ŒInvokeFutureæ·»åŠ åˆ°è¿œç¨‹è¿æ¥çš„invokeFutureMapé”®å€¼å¯¹<invokeId,future>ï¼ŒInvokeFutureæ–°å¢è®¡æ—¶å™¨è¶…æ—¶çº¿ç¨‹æä¾›è¶…æ—¶å“åº”ç»“æœéæ­£å¸¸æ‰§è¡Œå¼‚æ­¥è°ƒç”¨å›è°ƒä»»åŠ¡ï¼Œä½¿ç”¨ç®¡é“Channelçš„writeAndFlush(Object msg)æ–¹æ³•å¼‚æ­¥å‘é€å®¢æˆ·ç«¯æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æ·»åŠ ç›‘å¬å™¨æä¾›æ“ä½œå®Œæˆå‘é€å¤±è´¥Futureæ·»åŠ å¤±è´¥å“åº”åœºæ™¯ç›‘å¬ï¼š

```Java
/**
 * Rpc invocation with callback.<br>
 * Notice! DO NOT modify the request object concurrently when this method is called.
 *
 * @param conn
 * @param request
 * @param invokeContext
 * @param invokeCallback
 * @param timeoutMillis
 * @throws RemotingException
 */
public void invokeWithCallback(final Connection conn, final Object request,
                               final InvokeContext invokeContext,
                               final InvokeCallback invokeCallback, final int timeoutMillis)
                                                                                            throws RemotingException {
    RemotingCommand requestCommand = toRemotingCommand(request, conn, invokeContext,
        timeoutMillis);
    preProcessInvokeContext(invokeContext, requestCommand, conn);
    super.invokeWithCallback(conn, requestCommand, invokeCallback, timeoutMillis);
}
/**
 * Invocation with callback.
 *
 * @param conn
 * @param request
 * @param invokeCallback
 * @param timeoutMillis
 * @throws InterruptedException
 */
protected void invokeWithCallback(final Connection conn, final RemotingCommand request,
                                  final InvokeCallback invokeCallback, final int timeoutMillis) {
    final InvokeFuture future = createInvokeFuture(conn, request, request.getInvokeContext(),
        invokeCallback);
    conn.addInvokeFuture(future);

    try {
        //add timeout
        Timeout timeout = TimerHolder.getTimer().newTimeout(new TimerTask() {
            @Override
            public void run(Timeout timeout) throws Exception {
                InvokeFuture future = conn.removeInvokeFuture(request.getId());
                if (future != null) {
                    future.putResponse(commandFactory.createTimeoutResponse(conn
                        .getRemoteAddress()));
                    future.tryAsyncExecuteInvokeCallbackAbnormally();
                }
            }

        }, timeoutMillis, TimeUnit.MILLISECONDS);
        future.addTimeout(timeout);
        conn.getChannel().writeAndFlush(request).addListener(new ChannelFutureListener() {

            @Override
            public void operationComplete(ChannelFuture cf) throws Exception {
                if (!cf.isSuccess()) {
                    InvokeFuture f = conn.removeInvokeFuture(request.getId());
                    if (f != null) {
                        f.cancelTimeout();
                        f.putResponse(commandFactory.createSendFailedResponse(
                            conn.getRemoteAddress(), cf.cause()));
                        f.tryAsyncExecuteInvokeCallbackAbnormally();
                    }
                    logger.error("Invoke send failed. The address is {}",
                        RemotingUtil.parseRemoteAddress(conn.getChannel()), cf.cause());
                }
            }

        });
    } catch (Exception e) {
        InvokeFuture f = conn.removeInvokeFuture(request.getId());
        if (f != null) {
            f.cancelTimeout();
            f.putResponse(commandFactory.createSendFailedResponse(conn.getRemoteAddress(), e));
            f.tryAsyncExecuteInvokeCallbackAbnormally();
        }
        logger.error("Exception caught when sending invocation. The address is {}",
            RemotingUtil.parseRemoteAddress(conn.getChannel()), e);
    }
}
/**
 * Create invoke future with {@link InvokeContext}.
 * @param conn
 * @param request
 * @param invokeContext
 * @param invokeCallback
 * @return
 */
protected InvokeFuture createInvokeFuture(Connection conn, RemotingCommand request,
                                          InvokeContext invokeContext,
                                          InvokeCallback invokeCallback) {
    return new DefaultInvokeFuture(request.getId(), new RpcInvokeCallbackListener(
        RemotingUtil.parseRemoteAddress(conn.getChannel())), invokeCallback, request
        .getProtocolCode().getFirstByte(), this.getCommandFactory(), invokeContext);
}

```

RpcInvokeCallbackListenerè°ƒç”¨å›è°ƒç›‘å¬å™¨ä½¿ç”¨onResponse()æ–¹æ³•ç›‘å¬RpcæœåŠ¡è°ƒç”¨ç»“æœè·å–InvokeFutureçš„è°ƒç”¨å›è°ƒBoltFutureInvokeCallbackå¹¶ä¸”å¯åŠ¨å›è°ƒçº¿ç¨‹æ‰§è¡ŒCallbackTaskä»»åŠ¡é˜»å¡ç­‰å¾…è·å–å“åº”å‘½ä»¤ååºåˆ—åŒ–ï¼Œè°ƒç”¨å›è°ƒBoltFutureInvokeCallbackè°ƒç”¨onResponse()æ–¹æ³•æ¥æ”¶è°ƒç”¨å“åº”å¯¹è±¡ã€‚RpcHandlerå¤„ç†å™¨çš„channelRead()æ–¹æ³•è¯»å–ç®¡é“ChannelæœåŠ¡ç«¯å“åº”è¿”å›ç»“æœï¼Œè°ƒåº¦RpcRequestProcessorå¤„ç†å™¨ProcessTaskå¤„ç†ä»»åŠ¡ï¼ŒRpcResponseProcessorå¤„ç†å™¨doProcess()æ–¹æ³•ä½¿ç”¨DefaultInvokeFutureçš„executeInvokeCallback()æ–¹æ³•æ‰§è¡Œè°ƒç”¨å›è°ƒï¼Œé€šè¿‡RpcInvokeCallbackListenerè°ƒç”¨å›è°ƒç›‘å¬å™¨çš„onResponse()æ–¹æ³•ä½¿ç”¨Callbackæ¨¡å¼åŒ…è£…BoltFutureInvokeCallbackçš„onResponse()æ–¹æ³•ä»¥BoltResponseFutureè¯·æ±‚ç»“æœFutureçš„setSuccess()æ–¹æ³•è®¾ç½®æœåŠ¡è°ƒç”¨æ­£å¸¸å“åº”è¿”å›ç»“æœï¼š

```Java
public void onResponse(InvokeFuture future) {
    InvokeCallback callback = future.getInvokeCallback();
    if (callback != null) {
        CallbackTask task = new CallbackTask(this.getRemoteAddress(), future);
        if (callback.getExecutor() != null) {
            // There is no need to switch classloader, because executor is provided by user.
            try {
                callback.getExecutor().execute(task);
            } catch (RejectedExecutionException e) {
                logger.warn("Callback thread pool busy.");
            }
        } else {
            task.run();
        }
    }
}

class CallbackTask implements Runnable {

    InvokeFuture future;
    String       remoteAddress;

    /**
     *
     */
    public CallbackTask(String remoteAddress, InvokeFuture future) {
        this.remoteAddress = remoteAddress;
        this.future = future;
    }

    /**
     * @see java.lang.Runnable#run()
     */
    @Override
    public void run() {
        InvokeCallback callback = future.getInvokeCallback();
        // a lot of try-catches to protect thread pool
        ResponseCommand response = null;

        try {
            response = (ResponseCommand) future.waitResponse(0);
        } catch (InterruptedException e) {
            String msg = "Exception caught when getting response from InvokeFuture. The address is "
                         + this.remoteAddress;
            logger.error(msg, e);
        }
        if (response == null || response.getResponseStatus() != ResponseStatus.SUCCESS) {
            try {
                Exception e;
                if (response == null) {
                    e = new InvokeException("Exception caught in invocation. The address is "
                                            + this.remoteAddress + " responseStatus:"
                                            + ResponseStatus.UNKNOWN, future.getCause());
                } else {
                    response.setInvokeContext(future.getInvokeContext());
                    switch (response.getResponseStatus()) {
                        case TIMEOUT:
                            e = new InvokeTimeoutException(
                                "Invoke timeout when invoke with callback.The address is "
                                        + this.remoteAddress);
                            break;
                        case CONNECTION_CLOSED:
                            e = new ConnectionClosedException(
                                "Connection closed when invoke with callback.The address is "
                                        + this.remoteAddress);
                            break;
                        case SERVER_THREADPOOL_BUSY:
                            e = new InvokeServerBusyException(
                                "Server thread pool busy when invoke with callback.The address is "
                                        + this.remoteAddress);
                            break;
                        case SERVER_EXCEPTION:
                            String msg = "Server exception when invoke with callback.Please check the server log! The address is "
                                         + this.remoteAddress;
                            RpcResponseCommand resp = (RpcResponseCommand) response;
                            resp.deserialize();
                            Object ex = resp.getResponseObject();
                            if (ex != null && ex instanceof Throwable) {
                                e = new InvokeServerException(msg, (Throwable) ex);
                            } else {
                                e = new InvokeServerException(msg);
                            }
                            break;
                        default:
                            e = new InvokeException(
                                "Exception caught in invocation. The address is "
                                        + this.remoteAddress + " responseStatus:"
                                        + response.getResponseStatus(), future.getCause());

                    }
                }
                callback.onException(e);
            } catch (Throwable e) {
                logger
                    .error(
                        "Exception occurred in user defined InvokeCallback#onException() logic, The address is {}",
                        this.remoteAddress, e);
            }
        } else {
            ClassLoader oldClassLoader = null;
            try {
                if (future.getAppClassLoader() != null) {
                    oldClassLoader = Thread.currentThread().getContextClassLoader();
                    Thread.currentThread().setContextClassLoader(future.getAppClassLoader());
                }
                response.setInvokeContext(future.getInvokeContext());
                RpcResponseCommand rpcResponse = (RpcResponseCommand) response;
                response.deserialize();
                try {
                    callback.onResponse(rpcResponse.getResponseObject());
                } catch (Throwable e) {
                    logger
                        .error(
                            "Exception occurred in user defined InvokeCallback#onResponse() logic.",
                            e);
                }
            } catch (CodecException e) {
                logger
                    .error(
                        "CodecException caught on when deserialize response in RpcInvokeCallbackListener. The address is {}.",
                        this.remoteAddress, e);
            } catch (Throwable e) {
                logger.error(
                    "Exception caught in RpcInvokeCallbackListener. The address is {}",
                    this.remoteAddress, e);
            } finally {
                if (oldClassLoader != null) {
                    Thread.currentThread().setContextClassLoader(oldClassLoader);
                }
            }
        } // enf of else
    } // end of run
}
public void onResponse(Object result) {
    if (rpcFuture == null) {
        return;
    }
    ClassLoader oldCl = Thread.currentThread().getContextClassLoader();
    SofaResponse response = (SofaResponse) result;
    Throwable throwable = null;
    try {
        Thread.currentThread().setContextClassLoader(this.classLoader);
        RpcInternalContext.setContext(context);

        if (EventBus.isEnable(ClientAsyncReceiveEvent.class)) {
            EventBus.post(new ClientAsyncReceiveEvent(consumerConfig, providerInfo,
                request, response, null));
        }

        pickupBaggage(response);

        // do async filter after respond server
        FilterChain chain = consumerConfig.getConsumerBootstrap().getCluster().getFilterChain();
        if (chain != null) {
            chain.onAsyncResponse(consumerConfig, request, response, null);
        }

        recordClientElapseTime();
        if (EventBus.isEnable(ClientEndInvokeEvent.class)) {
            EventBus.post(new ClientEndInvokeEvent(request, response, null));
        }

        Object appResp = response.getAppResponse();
        if (response.isError()) { // rpcå±‚å¼‚å¸¸
            SofaRpcException sofaRpcException = new SofaRpcException(
                RpcErrorType.SERVER_UNDECLARED_ERROR, response.getErrorMsg());
            rpcFuture.setFailure(sofaRpcException);
        } else if (appResp instanceof Throwable) { // ä¸šåŠ¡å±‚å¼‚å¸¸
            throwable = (Throwable) appResp;
            rpcFuture.setFailure(throwable);
        } else {
            rpcFuture.setSuccess(appResp);
        }
    } finally {
        Thread.currentThread().setContextClassLoader(oldCl);
        RpcInvokeContext.removeContext();
        RpcInternalContext.removeAllContext();
    }
}
/**
 * è®¾ç½®æ­£å¸¸è¿”å›ç»“æœ
 *
 * @param result æ­£å¸¸è¿”å›å€¼
 */
public void setSuccess(V result) {
    if (this.isCancelled()) {
        this.releaseIfNeed(result);
    }
    if (setSuccess0(result)) {
        notifyListeners();
        return;
    }
    throw new IllegalStateException("complete already: " + this);
}

protected boolean setSuccess0(V result) {
    if (isDone()) {
        return false;
    }
    synchronized (this) {
        // Allow only once.
        if (isDone()) {
            return false;
        }
        if (this.result == null) {
            this.result = result;
        }
        this.setDoneTime();
        if (hasWaiters()) {
            notifyAll();
        }
    }
    return true;
}

```

é€è¿‡Futureå¼‚æ­¥è°ƒç”¨æœºåˆ¶ä½¿ç”¨åŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInvokeContextè·å–åŸç”ŸJava Futureå¯¹è±¡BoltResponseFutureï¼ŒBoltResponseFutureé€šè¿‡åŸç”ŸJava Futureçš„get()æ–¹æ³•é˜»å¡ç­‰å¾…æœåŠ¡å¼‚æ­¥è°ƒç”¨å“åº”ç»“æœresultï¼š

```Java
BoltResponseFuture future = (BoltResponseFuture) SofaResponseFuture.getFuture();

/**
 * @return åŸç”Ÿ Java Future å¯¹è±¡
 * @throws SofaRpcException å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡æ²¡æœ‰å€¼çš„æ—¶å€™
 */
public static Future getFuture() throws SofaRpcException {
    return getFuture(false);
}

/**
 * @param clear æ˜¯å¦æ¸…é™¤çº¿ç¨‹ä¸Šä¸‹æ–‡
 * @return åŸç”Ÿ Java Future å¯¹è±¡
 * @throws SofaRpcException å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡æ²¡æœ‰å€¼çš„æ—¶å€™
 */
public static Future getFuture(boolean clear) throws SofaRpcException {
    RpcInvokeContext context = RpcInvokeContext.getContext();
    Future future = context.getFuture();
    if (future == null) {
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR,
            LogCodes.getLog(LogCodes.ERROR_RESPONSE_FUTURE_NULL,
                Thread.currentThread()));
    }
    if (clear) {
        context.setFuture(null);
    }
    return future;
}
public V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException {
    long realTimeOut = unit.toMillis(timeout);
    long remainTime = realTimeOut - (sentTime - genTime); // å‰©ä½™æ—¶é—´
    if (remainTime <= 0) { // æ²¡æœ‰å‰©ä½™æ—¶é—´ä¸ç­‰å¾…
        if (isDone()) { // ç›´æ¥çœ‹æ˜¯å¦å·²ç»è¿”å›
            return getNow();
        }
    } else { // ç­‰å¾…å‰©ä½™æ—¶é—´
        if (await(remainTime, TimeUnit.MILLISECONDS)) {
            return getNow();
        }
    }
    this.setDoneTime();
    throw clientTimeoutException();
}
protected V getNow() throws ExecutionException {
    if (cause != null) {
        throw new ExecutionException(cause);
    } else {
        return (V) result;
    }
}

```



![img](https:////upload-images.jianshu.io/upload_images/6739367-3a17e004119cba4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/827/format/jpeg)

FutureæœåŠ¡å¼‚æ­¥è°ƒç”¨å“åº”

(3)Callbackå›è°ƒè°ƒç”¨
 å‚è€ƒSOFARPC Exampleç¤ºä¾‹æ¨¡å—([com.alipay.sofa.rpc.invoke.callback](https://github.com/alipay/sofa-rpc/tree/master/example/src/test/java/com/alipay/sofa/rpc/invoke/callback))ï¼š

```Java
package com.alipay.sofa.rpc.invoke.callback;

import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ProviderConfig;
import com.alipay.sofa.rpc.config.ServerConfig;
import com.alipay.sofa.rpc.test.HelloService;
import com.alipay.sofa.rpc.test.HelloServiceImpl;

public class CallbackServerMain {

    public static void main(String[] args) {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-server");

        ServerConfig serverConfig2 = new ServerConfig()
            .setPort(22222)
            .setDaemon(false);

        // CæœåŠ¡çš„æœåŠ¡ç«¯
        ProviderConfig<HelloService> CProvider = new ProviderConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setRef(new HelloServiceImpl(1000))
            .setServer(serverConfig2);
        CProvider.export();
    }
}
package com.alipay.sofa.rpc.invoke.callback;

import com.alipay.sofa.rpc.common.RpcConstants;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.core.exception.SofaRpcException;
import com.alipay.sofa.rpc.core.invoke.SofaResponseCallback;
import com.alipay.sofa.rpc.core.request.RequestBase;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;
import com.alipay.sofa.rpc.test.HelloService;

/**
 * <p>æ¥å£çº§åˆ«çš„Callback</p>
 */
public class CallbackClientMain {

    /**
     * slf4j Logger for this class
     */
    private final static Logger LOGGER = LoggerFactory.getLogger(CallbackClientMain.class);

    public static void main(String[] args) throws InterruptedException {
        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-server");

        ConsumerConfig<HelloService> consumerConfig = new ConsumerConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
            .setTimeout(5000)
            .setOnReturn(new SofaResponseCallback() {
                @Override
                public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
                    LOGGER.info("Interface get result: {}", appResponse);
                }

                @Override
                public void onAppException(Throwable throwable, String methodName, RequestBase request) {
                    LOGGER.info("Interface get app exception: {}", throwable);
                }

                @Override
                public void onSofaException(SofaRpcException sofaException, String methodName,
                                            RequestBase request) {
                    LOGGER.info("Interface get sofa exception: {}", sofaException);
                }
            }) // ä¸è®¾ç½® è°ƒç”¨çº§åˆ«è®¾ç½®
            .setDirectUrl("bolt://127.0.0.1:22222?appName=future-server");
        HelloService helloService = consumerConfig.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        try {
            for (int i = 0; i < 100; i++) {
                try {
                    String s = helloService.sayHello("xxx", 22);
                    LOGGER.warn("{}", s);
                } catch (Exception e) {
                    LOGGER.error(e.getMessage(), e);
                }
                try {
                    Thread.sleep(2000);
                } catch (Exception e) {
                }
            }

        } catch (Exception e) {
            LOGGER.error("", e);
        }

        synchronized (CallbackClientMain.class) {
            while (true) {
                CallbackClientMain.class.wait();
            }
        }
    }

}
package com.alipay.sofa.rpc.invoke.callback;

import com.alipay.sofa.rpc.common.RpcConstants;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.context.RpcInvokeContext;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.core.exception.SofaRpcException;
import com.alipay.sofa.rpc.core.invoke.SofaResponseCallback;
import com.alipay.sofa.rpc.core.request.RequestBase;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;
import com.alipay.sofa.rpc.test.HelloService;

/**
 * <p>è°ƒç”¨çº§åˆ«çš„Callback</p>
 */
public class CallbackInvokeClientMain {

    /**
     * slf4j Logger for this class
     */
    private final static Logger LOGGER = LoggerFactory.getLogger(CallbackInvokeClientMain.class);

    public static void main(String[] args) throws InterruptedException {
        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-server");

        ConsumerConfig<HelloService> consumerConfig = new ConsumerConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
            .setTimeout(3000)
            //.setOnReturn() // ä¸è®¾ç½® è°ƒç”¨çº§åˆ«è®¾ç½®
            .setDirectUrl("bolt://127.0.0.1:22222?appName=future-server");
        HelloService helloService = consumerConfig.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        for (int i = 0; i < 100; i++) {
            try {
                RpcInvokeContext.getContext().setResponseCallback(
                    new SofaResponseCallback() {
                        @Override
                        public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
                            LOGGER.info("Invoke get result: {}", appResponse);
                        }

                        @Override
                        public void onAppException(Throwable throwable, String methodName, RequestBase request) {
                            LOGGER.info("Invoke get app exception: {}", throwable);
                        }

                        @Override
                        public void onSofaException(SofaRpcException sofaException, String methodName,
                                                    RequestBase request) {
                            LOGGER.info("Invoke get sofa exception: {}", sofaException);
                        }
                    }
                    );

                String s = helloService.sayHello("xxx", 22);
                LOGGER.warn("{}", s);
            } catch (Exception e) {
                LOGGER.error(e.getMessage(), e);
            }
            try {
                Thread.sleep(2000);
            } catch (Exception e) {
            }
        }

    }

}
package com.alipay.sofa.rpc.invoke.callback;

import com.alipay.sofa.rpc.common.RpcConstants;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.config.MethodConfig;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.core.exception.SofaRpcException;
import com.alipay.sofa.rpc.core.invoke.SofaResponseCallback;
import com.alipay.sofa.rpc.core.request.RequestBase;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;
import com.alipay.sofa.rpc.test.HelloService;

import java.util.Collections;

/**
 * <p>æ–¹æ³•çº§åˆ«çš„Callback</p>
 */
public class CallbackMethodClientMain {

    /**
     * slf4j Logger for this class
     */
    private final static Logger LOGGER = LoggerFactory.getLogger(CallbackMethodClientMain.class);

    public static void main(String[] args) throws InterruptedException {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("future-server");

        MethodConfig methodConfig = new MethodConfig();
        methodConfig.setName("sayHello")
            .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
            .setOnReturn(new SofaResponseCallback() {
                @Override
                public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
                    LOGGER.info("Method get result: {}", appResponse);
                }

                @Override
                public void onAppException(Throwable throwable, String methodName, RequestBase request) {
                    LOGGER.info("Method get app exception: {}", throwable);
                }

                @Override
                public void onSofaException(SofaRpcException sofaException, String methodName,
                                            RequestBase request) {
                    LOGGER.info("Method get sofa exception: {}", sofaException);
                }
            });

        ConsumerConfig<HelloService> consumerConfig = new ConsumerConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setTimeout(5000)
            .setMethods(Collections.singletonList(methodConfig))
            .setDirectUrl("bolt://127.0.0.1:22222?appName=future-server");
        HelloService helloService = consumerConfig.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        try {
            for (int i = 0; i < 100; i++) {
                try {
                    String s = helloService.sayHello("xxx", 22);
                    LOGGER.warn("{}", s);
                } catch (Exception e) {
                    LOGGER.error(e.getMessage(), e);
                }
                try {
                    Thread.sleep(2000);
                } catch (Exception e) {
                }
            }

        } catch (Exception e) {
            LOGGER.error("", e);
        }

        synchronized (CallbackMethodClientMain.class) {
            while (true) {
                CallbackMethodClientMain.class.wait();
            }
        }
    }

}

```

è¿è¡Œå›è°ƒè°ƒç”¨æœåŠ¡ç«¯ç¤ºä¾‹ç±»æ¥å£çº§åˆ«CallbackServerMainæŸ¥çœ‹å›è°ƒè°ƒç”¨æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:14:43,963 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:5640
2018-06-03 18:14:44,088 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:14:44,291 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:14:44,858 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:14:44,861 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:14:44,913 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [future-server]Export provider config : com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:14:45,407 main  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:14:48,876 main  INFO [com.alipay.sofa.rpc.server.bolt.BoltServer:info:102] - Bolt server has been bind to 0.0.0.0:22222
2018-06-03 18:14:57,701 SOFA-SEV-BOLT-BIZ-22222-3-T1  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@3a2888ed
name:xxx, age:22
name:xxx, age:22

```

è¿è¡Œå›è°ƒè°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»æ¥å£çº§åˆ«CallbackClientMainæŸ¥çœ‹å›è°ƒè°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:14:52,109 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:8744
2018-06-03 18:14:52,207 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:14:52,425 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:14:53,003 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:14:53,006 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:14:53,048 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [future-server]Refer consumer config : bolt://com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
2018-06-03 18:14:53,284 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Add provider of com.alipay.sofa.rpc.test.HelloService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:14:53,649 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:14:56,616 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Connect to com.alipay.sofa.rpc.test.HelloService provider:bolt://127.0.0.1:22222?appName=future-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:51037
2018-06-03 18:14:57,007 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackClientMain:warn:142] - started at pid 8744
2018-06-03 18:14:57,012 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@6d4b1c02
2018-06-03 18:14:57,404 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackClientMain:warn:142] - null
2018-06-03 18:14:58,868 SOFA-RPC-CB-4-T1  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackClientMain:info:102] - Interface get result: hello xxx from server! age: 22
2018-06-03 18:14:59,412 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackClientMain:warn:142] - null
2018-06-03 18:15:00,421 SOFA-RPC-CB-4-T3  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackClientMain:info:102] - Interface get result: hello xxx from server! age: 22

```

è¿è¡Œå›è°ƒè°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»è°ƒç”¨çº§åˆ«CallbackInvokeClientMainæŸ¥çœ‹å›è°ƒè°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:17:43,337 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:1292
2018-06-03 18:17:43,453 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:17:43,634 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:17:44,429 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:17:44,434 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:17:44,515 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [future-server]Refer consumer config : bolt://com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
2018-06-03 18:17:44,861 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Add provider of com.alipay.sofa.rpc.test.HelloService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:17:45,241 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:17:48,427 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Connect to com.alipay.sofa.rpc.test.HelloService provider:bolt://127.0.0.1:22222?appName=future-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:51151
2018-06-03 18:17:48,784 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackInvokeClientMain:warn:142] - started at pid 1292
2018-06-03 18:17:48,790 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@6d4b1c02
2018-06-03 18:17:49,188 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackInvokeClientMain:warn:142] - null
2018-06-03 18:17:50,858 SOFA-RPC-CB-4-T1  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackInvokeClientMain:info:102] - Invoke get result: hello xxx from server! age: 22
2018-06-03 18:17:51,194 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackInvokeClientMain:warn:142] - null
2018-06-03 18:17:52,206 SOFA-RPC-CB-4-T3  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackInvokeClientMain:info:102] - Invoke get result: hello xxx from server! age: 22

```

è¿è¡Œå›è°ƒè°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»æ–¹æ³•çº§åˆ«CallbackMethodClientMainæŸ¥çœ‹å›è°ƒè°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:18:38,999 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:12104
2018-06-03 18:18:39,115 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:18:39,282 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:18:40,109 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:18:40,113 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:18:40,204 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [future-server]Refer consumer config : bolt://com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
2018-06-03 18:18:40,487 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Add provider of com.alipay.sofa.rpc.test.HelloService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:18:40,799 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:18:43,598 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [future-server]Connect to com.alipay.sofa.rpc.test.HelloService provider:bolt://127.0.0.1:22222?appName=future-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:51178
2018-06-03 18:18:43,992 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackMethodClientMain:warn:142] - started at pid 12104
2018-06-03 18:18:43,996 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@6093dd95
2018-06-03 18:18:44,345 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackMethodClientMain:warn:142] - null
2018-06-03 18:18:45,527 SOFA-RPC-CB-4-T1  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackMethodClientMain:info:102] - Method get result: hello xxx from server! age: 22
2018-06-03 18:18:46,351 main  WARN [com.alipay.sofa.rpc.invoke.callback.CallbackMethodClientMain:warn:142] - null
2018-06-03 18:18:47,364 SOFA-RPC-CB-4-T3  INFO [com.alipay.sofa.rpc.invoke.callback.CallbackMethodClientMain:info:102] - Method get result: hello xxx from server! age: 22

```

SOFARPCå›è°ƒè°ƒç”¨æµç¨‹ï¼š
 [1]åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigï¼Œè®¾ç½®ConsumerConfigå®ä¾‹åº”ç”¨ä¿¡æ¯é…ç½®ã€æ¥å£åç§°ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡setInvokeTypeè®¾ç½®æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹ä¸ºRpcConstants. INVOKER_TYPE_CALLBACK(callback)ï¼Œæ”¯æŒæ¥å£çº§åˆ«[setOnReturnè®¾ç½®æœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigè¿”å›å€¼ä¹‹å‰çš„ç›‘å¬å™¨,å¤„ç†ç»“æœæˆ–è€…å¼‚å¸¸]ã€è°ƒç”¨çº§åˆ«[ä¸è®¾ç½®æœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigè¿”å›å€¼ä¹‹å‰çš„ç›‘å¬å™¨ï¼ŒåŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInvokeContexté€šè¿‡setResponseCallbackè®¾ç½®å•æ¬¡è¯·æ±‚çš„æŒ‡å®šå›è°ƒæ–¹æ³•]ä»¥åŠæ–¹æ³•çº§åˆ«[åˆ›å»ºæ–¹æ³•çº§é…ç½®ç±»MethodConfigï¼ŒsetOnReturnè®¾ç½®æ–¹æ³•çº§é…ç½®MethodConfigè¿”å›å€¼ä¹‹å‰çš„ç›‘å¬å™¨ï¼ŒsetMethodsæœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigæ–¹æ³•é…ç½®]Callbackå›è°ƒï¼š

```Java
/**
 * è°ƒç”¨æ–¹å¼ï¼šå›è°ƒ
 */
public static final String  INVOKER_TYPE_CALLBACK   = "callback";
/*æ¥å£çº§åˆ«Callback*/
ConsumerConfig<***Service> consumerConfig = new ConsumerConfig<***Service>()
    .setApplication(applicationConfig)
    .setInterfaceId(***Service.class.getName())
    .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
    .setTimeout(5000)
    .setOnReturn(new SofaResponseCallback() {
        @Override
        public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
            LOGGER.info("Interface get result: {}", appResponse);
        }

        @Override
        public void onAppException(Throwable throwable, String methodName, RequestBase request) {
            LOGGER.info("Interface get app exception: {}", throwable);
        }

        @Override
        public void onSofaException(SofaRpcException sofaException, String methodName,
                                    RequestBase request) {
            LOGGER.info("Interface get sofa exception: {}", sofaException);
        }
    })
    .setDirectUrl("bolt://host:port?appName=future-server");
/*è°ƒç”¨çº§åˆ«Callback*/
ConsumerConfig<***Service> consumerConfig = new ConsumerConfig<***Service>()
    .setApplication(applicationConfig)
    .setInterfaceId(***Service.class.getName())
    .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
    .setTimeout(5000)
    //.setOnReturn() // ä¸è®¾ç½® è°ƒç”¨çº§åˆ«è®¾ç½®
    .setDirectUrl("bolt://host:port?appName=future-server");
RpcInvokeContext.getContext().setResponseCallback(
    new SofaResponseCallback() {
        @Override
        public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
            LOGGER.info("Invoke get result: {}", appResponse);
        }

        @Override
        public void onAppException(Throwable throwable, String methodName, RequestBase request) {
            LOGGER.info("Invoke get app exception: {}", throwable);
        }

        @Override
        public void onSofaException(SofaRpcException sofaException, String methodName,
                                    RequestBase request) {
            LOGGER.info("Invoke get sofa exception: {}", sofaException);
        }
    }
);
/*æ–¹æ³•çº§åˆ«Callback*/
MethodConfig methodConfig = new MethodConfig();
methodConfig.setName("***")
    .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
    .setOnReturn(new SofaResponseCallback() {
        @Override
        public void onAppResponse(Object appResponse, String methodName, RequestBase request) {
            LOGGER.info("Method get result: {}", appResponse);
        }

        @Override
        public void onAppException(Throwable throwable, String methodName, RequestBase request) {
            LOGGER.info("Method get app exception: {}", throwable);
        }

        @Override
        public void onSofaException(SofaRpcException sofaException, String methodName,
                                    RequestBase request) {
            LOGGER.info("Method get sofa exception: {}", sofaException);
        }
    });
ConsumerConfig<***Service> consumerConfig = new ConsumerConfig<***Service>()
    .setApplication(applicationConfig)
    .setInterfaceId(***Service.class.getName())
    .setInvokeType(RpcConstants.INVOKER_TYPE_CALLBACK)
    .setTimeout(5000)
    .setMethods(Collections.singletonList(methodConfig))
    .setDirectUrl("bolt://host:port?appName=future-server");

```

[2]æœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigè°ƒç”¨æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapçš„refer()æ–¹æ³•å¼•ç”¨æœåŠ¡ï¼Œæ¶ˆè´¹è€…è°ƒç”¨å™¨ConsumerInvokerè°ƒç”¨invoke()æ–¹æ³•ä½¿ç”¨å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡å™¨æ‰§è¡Œå®¢æˆ·ç«¯é›†ç¾¤Clusterçš„doSendMsg()æ–¹æ³•Callbackå›è°ƒè°ƒç”¨ï¼š

```Java
/**
 * è°ƒç”¨å®¢æˆ·ç«¯
 *
 * @param transport å®¢æˆ·ç«¯è¿æ¥
 * @param request   Requestå¯¹è±¡
 * @return è°ƒç”¨ç»“æœ
 * @throws SofaRpcException rpcå¼‚å¸¸
 */
protected SofaResponse doSendMsg(ProviderInfo providerInfo, ClientTransport transport,
                                 SofaRequest request) throws SofaRpcException {
    RpcInternalContext context = RpcInternalContext.getContext();
    // æ·»åŠ è°ƒç”¨çš„æœåŠ¡ç«¯è¿œç¨‹åœ°å€
    RpcInternalContext.getContext().setRemoteAddress(providerInfo.getHost(), providerInfo.getPort());
    try {
        checkProviderVersion(providerInfo, request); // æ ¹æ®æœåŠ¡ç«¯ç‰ˆæœ¬ç‰¹æ®Šå¤„ç†
        String invokeType = request.getInvokeType();
        int timeout = resolveTimeout(request, consumerConfig, providerInfo);

        SofaResponse response = null;
        // Callbackè°ƒç”¨
        if (RpcConstants.INVOKER_TYPE_CALLBACK.equals(invokeType)) {
            // è°ƒç”¨çº§åˆ«å›è°ƒç›‘å¬å™¨
            SofaResponseCallback sofaResponseCallback = request.getSofaResponseCallback();
            if (sofaResponseCallback == null) {
                SofaResponseCallback methodResponseCallback = consumerConfig
                    .getMethodOnreturn(request.getMethodName());
                if (methodResponseCallback != null) { // æ–¹æ³•çš„Callback
                    request.setSofaResponseCallback(methodResponseCallback);
                }
            }
            // è®°å½•å‘é€å¼€å§‹æ—¶é—´
            context.setAttachment(RpcConstants.INTERNAL_KEY_CLIENT_SEND_TIME, RpcRuntimeContext.now());
            // å¼€å§‹è°ƒç”¨
            transport.asyncSend(request, timeout);
            response = buildEmptyResponse(request);
        } else {
            throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, "Unknown invoke type:" + invokeType);
        }
        return response;
    } catch (SofaRpcException e) {
        throw e;
    } catch (Throwable e) { // å®¢æˆ·ç«¯å…¶å®ƒå¼‚å¸¸
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e);
    }
}

```

å®¢æˆ·ç«¯é›†ç¾¤Clusteræ ¹æ®è¯·æ±‚è°ƒç”¨ç±»å‹åˆ¤æ–­æ˜¯å¦ä¸ºå›è°ƒè°ƒç”¨ç±»å‹ï¼Œè·å–SofaRequestè¯·æ±‚è°ƒç”¨çº§åˆ«æœåŠ¡å›è°ƒç›‘å¬å™¨ï¼Œå›è°ƒç›‘å¬å™¨ä¸ºç©ºåˆ™è·å–æœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigæ–¹æ³•çº§åˆ«æœåŠ¡å›è°ƒç›‘å¬å™¨ï¼Œæ–¹æ³•çº§åˆ«æœåŠ¡å›è°ƒç›‘å¬å™¨éç©ºåˆ™è®¾ç½®SofaRequestè¯·æ±‚æœåŠ¡å›è°ƒç›‘å¬å™¨(ä¼˜å…ˆçº§æ’åºï¼šè°ƒç”¨çº§åˆ«->æ–¹æ³•çº§åˆ«->æ¥å£çº§åˆ«)ï¼ŒåŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextè®°å½•å‘é€å¼€å§‹æ—¶é—´ï¼Œå®¢æˆ·ç«¯ä¼ è¾“ClientTransportè°ƒç”¨asyncSend()æ–¹æ³•æŒ‡å®šè¶…æ—¶èŒƒç•´å›è°ƒè°ƒç”¨å‘é€è¯·æ±‚ï¼Œæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºç©ºå“åº”è°ƒç”¨ç»“æœã€‚
 Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport/H2&H2Cå®¢æˆ·ç«¯ä¼ è¾“AbstractHttp2ClientTransport/ç¬¬ä¸‰æ–¹åè®®ä»£ç†å®¢æˆ·ç«¯ä¼ è¾“AbstractProxyClientTransport[æŠ›å‡ºçŸ­è¿æ¥ä¸æ”¯æŒå¼‚æ­¥RPCå¼‚å¸¸]å›è°ƒè°ƒç”¨asyncSendè¿‡ç¨‹ï¼šæ£€æŸ¥é•¿è¿æ¥ï¼Œè·å–åŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextï¼Œ[BoltClientTransportæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºè°ƒç”¨ä¸Šä¸‹æ–‡]ï¼Œé€šè¿‡doInvokeAsync()æ–¹æ³•æ‰§è¡Œå›è°ƒè°ƒç”¨ã€‚
 Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport doInvokeAsyncå›è°ƒè°ƒç”¨åˆ¤æ–­ç”¨æˆ·å±‚è°ƒç”¨çº§åˆ«æœåŠ¡å›è°ƒç›‘å¬å™¨æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºè°ƒç”¨/æ–¹æ³•çº§åˆ«Callbackè°ƒç”¨æ–¹å¼è®¾ç½®æä¾›æœåŠ¡å›è°ƒç›‘å¬å™¨ï¼Œæ ¹æ®å®¢æˆ·ç«¯æœåŠ¡å‘å¸ƒé…ç½®ã€æœåŠ¡å¼•ç”¨é…ç½®ã€æœåŠ¡å›è°ƒç›‘å¬å™¨SofaResponseCallbackã€SofaRequstè¯·æ±‚ã€ä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextä»¥åŠå½“å‰ç±»åŠ è½½å™¨æ„å»ºCallbackæ¨¡å¼è°ƒç”¨åŒ…è£…BoltInvokerCallbackç»‘å®šRpcè¯·æ±‚ç»“æœç›‘å¬å™¨
 SofaResponseCallbackã€‚BoltClientTransporté€šè¿‡RpcClientè°ƒç”¨RPCè¿œç¨‹è¿æ¥RpcRemotingçš„invokeWithCallback()æ–¹æ³•æ ¹æ®è°ƒç”¨è¯·æ±‚URLè·å–æ£€æŸ¥è¿œç¨‹è¿æ¥ï¼Œæ ¹æ®è¿œç¨‹è¯·æ±‚å‘½ä»¤RemotingCommandå’Œè°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextåˆ›å»ºInvokeFutureæ·»åŠ åˆ°è¿œç¨‹è¿æ¥çš„invokeFutureMapé”®å€¼å¯¹<invokeId,future>ï¼ŒInvokeFutureæ–°å¢è®¡æ—¶å™¨è¶…æ—¶çº¿ç¨‹æä¾›è¶…æ—¶å“åº”ç»“æœéæ­£å¸¸æ‰§è¡Œå›è°ƒè°ƒç”¨å›è°ƒä»»åŠ¡ï¼Œä½¿ç”¨ç®¡é“Channelçš„writeAndFlush(Object msg)æ–¹æ³•å¼‚æ­¥å‘é€å®¢æˆ·ç«¯æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æ·»åŠ ç›‘å¬å™¨æä¾›æ“ä½œå®Œæˆå‘é€å¤±è´¥Futureæ·»åŠ å¤±è´¥å“åº”åœºæ™¯ç›‘å¬ã€‚
 RpcInvokeCallbackListenerè°ƒç”¨å›è°ƒç›‘å¬å™¨ä½¿ç”¨onResponse()æ–¹æ³•ç›‘å¬RpcæœåŠ¡è°ƒç”¨ç»“æœè·å–InvokeFutureçš„è°ƒç”¨å›è°ƒBoltFutureInvokeCallbackå¹¶ä¸”å¯åŠ¨å›è°ƒçº¿ç¨‹æ‰§è¡ŒCallbackTaskä»»åŠ¡é˜»å¡ç­‰å¾…è·å–å“åº”å‘½ä»¤ååºåˆ—åŒ–ï¼Œè°ƒç”¨å›è°ƒBoltFutureInvokeCallbackè°ƒç”¨onResponse()æ–¹æ³•æ¥æ”¶è°ƒç”¨å“åº”å¯¹è±¡ã€‚RpcHandlerå¤„ç†å™¨çš„channelRead()æ–¹æ³•è¯»å–ç®¡é“ChannelæœåŠ¡ç«¯å“åº”è¿”å›ç»“æœï¼Œè°ƒåº¦RpcRequestProcessorå¤„ç†å™¨ProcessTaskå¤„ç†ä»»åŠ¡ï¼ŒRpcResponseProcessorå¤„ç†å™¨doProcess()æ–¹æ³•ä½¿ç”¨DefaultInvokeFutureçš„executeInvokeCallback()æ–¹æ³•æ‰§è¡Œè°ƒç”¨å›è°ƒï¼Œé€šè¿‡RpcInvokeCallbackListenerè°ƒç”¨å›è°ƒç›‘å¬å™¨çš„onResponse()æ–¹æ³•ä½¿ç”¨Callbacké€‚é…BoltInvokerCallbackçš„onResponse()æ–¹æ³•ä»¥SofaResponseCallbackçš„onAppResponse()/onAppException()/onSofaException()æ–¹æ³•å®æ–½è¿”å›å“åº”è°ƒç”¨ç»“æœè‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼š

```Java
public void onResponse(Object result) {
    if (callback == null) {
        return;
    }
    ClassLoader oldCl = Thread.currentThread().getContextClassLoader();
    SofaResponse response = (SofaResponse) result;
    Throwable throwable = null;
    try {
        Thread.currentThread().setContextClassLoader(this.classLoader);
        RpcInternalContext.setContext(context);

        if (EventBus.isEnable(ClientAsyncReceiveEvent.class)) {
            EventBus.post(new ClientAsyncReceiveEvent(consumerConfig, providerInfo,
                request, response, null));
        }

        pickupBaggage(response);

        // do async filter after respond server
        FilterChain chain = consumerConfig.getConsumerBootstrap().getCluster().getFilterChain();
        if (chain != null) {
            chain.onAsyncResponse(consumerConfig, request, response, null);
        }

        recordClientElapseTime();
        if (EventBus.isEnable(ClientEndInvokeEvent.class)) {
            EventBus.post(new ClientEndInvokeEvent(request, response, null));
        }

        Object appResp = response.getAppResponse();
        if (response.isError()) { // rpcå±‚å¼‚å¸¸
            SofaRpcException sofaRpcException = new SofaRpcException(
                RpcErrorType.SERVER_UNDECLARED_ERROR, response.getErrorMsg());
            callback.onSofaException(sofaRpcException, request.getMethodName(), request);
        } else if (appResp instanceof Throwable) { // ä¸šåŠ¡å±‚å¼‚å¸¸
            throwable = (Throwable) appResp;
            callback.onAppException(throwable, request.getMethodName(), request);
        } else {
            callback.onAppResponse(appResp, request.getMethodName(), request);
        }
    } finally {
        Thread.currentThread().setContextClassLoader(oldCl);
        RpcInvokeContext.removeContext();
        RpcInternalContext.removeAllContext();
    }
}
/**
 * é¢å‘ç”¨æˆ·çš„Rpcè¯·æ±‚ç»“æœç›‘å¬å™¨
 */
public interface SofaResponseCallback<T> {
    /**
     * SOFA RPC will callback this method when server return response success
     *
     * @param appResponse response object
     * @param methodName the invoked method
     * @param request the invoked request object
     */
    public void onAppResponse(Object appResponse, String methodName, RequestBase request);

    /**
     * SOFA RPC will callback this method when server meet exception
     *
     * @param throwable app's exception
     * @param methodName the invoked method
     * @param request the invoked request
     */
    public void onAppException(Throwable throwable, String methodName, RequestBase request);

    /**
     * SOFA RPC will callback this method when framework meet exception
     *
     * @param sofaException framework exception
     *  @param methodName the invoked method
     * @param request the invoked request object
     */
    public void onSofaException(SofaRpcException sofaException, String methodName,
                                RequestBase request);
}

```



![img](https:////upload-images.jianshu.io/upload_images/6739367-a210f058594adeba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/827/format/jpeg)

CallbackæœåŠ¡å›è°ƒè°ƒç”¨å“åº”

(4)Onewayå•å‘è°ƒç”¨
 å‚è€ƒSOFARPC Exampleç¤ºä¾‹æ¨¡å—([com.alipay.sofa.rpc.invoke.oneway](https://github.com/alipay/sofa-rpc/tree/master/example/src/test/java/com/alipay/sofa/rpc/invoke/oneway))ï¼š

```Java
package com.alipay.sofa.rpc.invoke.oneway;

import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ProviderConfig;
import com.alipay.sofa.rpc.config.ServerConfig;
import com.alipay.sofa.rpc.test.EchoService;
import com.alipay.sofa.rpc.test.EchoServiceImpl;
import com.alipay.sofa.rpc.test.HelloService;
import com.alipay.sofa.rpc.test.HelloServiceImpl;

public class OnewayServerMain {

    public static void main(String[] args) {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("oneway-server");

        ServerConfig serverConfig2 = new ServerConfig()
            .setPort(22222)
            .setDaemon(false);

        ProviderConfig<HelloService> providerConfig = new ProviderConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setRef(new HelloServiceImpl(1000))
            .setServer(serverConfig2);
        providerConfig.export();

        ProviderConfig<EchoService> providerConfig2 = new ProviderConfig<EchoService>()
            .setApplication(applicationConfig)
            .setInterfaceId(EchoService.class.getName())
            .setRef(new EchoServiceImpl())
            .setServer(serverConfig2);
        providerConfig2.export();
    }
}
package com.alipay.sofa.rpc.invoke.oneway;

import com.alipay.sofa.rpc.common.RpcConstants;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;
import com.alipay.sofa.rpc.test.EchoService;
import com.alipay.sofa.rpc.test.HelloService;

/**
 * æ¥å£çº§åˆ«çš„Callback
 */
public class OnewayClientMain {

    /**
     * slf4j Logger for this class
     */
    private final static Logger LOGGER = LoggerFactory.getLogger(OnewayClientMain.class);

    public static void main(String[] args) throws InterruptedException {

        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("oneway-client");

        ConsumerConfig<HelloService> consumerConfig = new ConsumerConfig<HelloService>()
            .setApplication(applicationConfig)
            .setInterfaceId(HelloService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_ONEWAY)
            .setTimeout(50000)
            .setDirectUrl("bolt://127.0.0.1:22222?appName=oneway-server");
        HelloService helloService = consumerConfig.refer();

        ConsumerConfig<EchoService> consumerConfig2 = new ConsumerConfig<EchoService>()
            .setApplication(applicationConfig)
            .setInterfaceId(EchoService.class.getName())
            .setInvokeType(RpcConstants.INVOKER_TYPE_ONEWAY)
            .setTimeout(50000)
            .setDirectUrl("bolt://127.0.0.1:22222?appName=oneway-server");
        EchoService echoService = consumerConfig2.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        while (true) {
            try {
                String s1 = helloService.sayHello("xxx", 22);
                LOGGER.warn("must null :{}", s1);

                String s2 = echoService.echoStr("yyy");
                LOGGER.warn("must null :{}", s2);

            } catch (Exception e) {
                LOGGER.error(e.getMessage(), e);
            }
            try {
                Thread.sleep(2000);
            } catch (Exception ignore) {
            }
        }

    }

}

```

è¿è¡Œå•å‘è°ƒç”¨æœåŠ¡ç«¯ç¤ºä¾‹ç±»OnewayServerMainæŸ¥çœ‹å•å‘è°ƒç”¨æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:23:16,397 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:4608
2018-06-03 18:23:16,554 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:23:16,695 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:23:17,181 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:23:17,184 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:23:17,229 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [oneway-server]Export provider config : com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:23:17,760 main  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:23:20,291 main  INFO [com.alipay.sofa.rpc.server.bolt.BoltServer:info:102] - Bolt server has been bind to 0.0.0.0:22222
2018-06-03 18:23:20,347 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [oneway-server]Export provider config : com.alipay.sofa.rpc.test.EchoService: with bean id rpc-cfg-1
2018-06-03 18:23:30,936 SOFA-SEV-BOLT-BIZ-22222-3-T2  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@28d8faed
name:xxx, age:22
name:xxx, age:22

```

è¿è¡Œå•å‘è°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»OnewayClientMainæŸ¥çœ‹å•å‘è°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-03 18:23:25,581 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:1268
2018-06-03 18:23:25,764 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-03 18:23:25,968 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-03 18:23:26,605 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-03 18:23:26,608 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-03 18:23:26,653 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [oneway-client]Refer consumer config : bolt://com.alipay.sofa.rpc.test.HelloService: with bean id rpc-cfg-0
2018-06-03 18:23:27,044 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [oneway-client]Add provider of com.alipay.sofa.rpc.test.HelloService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:23:27,407 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-03 18:23:29,797 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.HelloService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [oneway-client]Connect to com.alipay.sofa.rpc.test.HelloService provider:bolt://127.0.0.1:22222?appName=oneway-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:51305
2018-06-03 18:23:30,185 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [oneway-client]Refer consumer config : bolt://com.alipay.sofa.rpc.test.EchoService: with bean id rpc-cfg-1
2018-06-03 18:23:30,188 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [oneway-client]Add provider of com.alipay.sofa.rpc.test.EchoService, size is : 1
2018-06-03 18:23:30,288 SOFA-CLI-CONN-com.alipay.sofa.rpc.test.EchoService-5-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [oneway-client]Connect to com.alipay.sofa.rpc.test.EchoService provider:bolt://127.0.0.1:22222?appName=oneway-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:51305
2018-06-03 18:23:30,310 main  WARN [com.alipay.sofa.rpc.invoke.oneway.OnewayClientMain:warn:142] - started at pid 1268
2018-06-03 18:23:30,317 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@1794d431
2018-06-03 18:23:30,661 main  WARN [com.alipay.sofa.rpc.invoke.oneway.OnewayClientMain:warn:142] - must null :null
2018-06-03 18:23:30,665 main  WARN [com.alipay.sofa.rpc.invoke.oneway.OnewayClientMain:warn:142] - must null :null
2018-06-03 18:23:32,670 main  WARN [com.alipay.sofa.rpc.invoke.oneway.OnewayClientMain:warn:142] - must null :null
2018-06-03 18:23:32,676 main  WARN [com.alipay.sofa.rpc.invoke.oneway.OnewayClientMain:warn:142] - must null :null

```

SOFARPCå•å‘è°ƒç”¨æµç¨‹ï¼š
 [1]åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigï¼Œè®¾ç½®ConsumerConfigå®ä¾‹åº”ç”¨ä¿¡æ¯é…ç½®ã€æ¥å£åç§°ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡setInvokeTypeè®¾ç½®æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹ä¸ºRpcConstants.INVOKER_TYPE_ONEWAY(oneway)ï¼š

```Java
/**
 * è°ƒç”¨æ–¹å¼ï¼šå•å‘
 */
public static final String  INVOKER_TYPE_ONEWAY  = "oneway";

```

[2]æœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigè°ƒç”¨æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapçš„refer()æ–¹æ³•å¼•ç”¨æœåŠ¡ï¼Œæ¶ˆè´¹è€…è°ƒç”¨å™¨ConsumerInvokerè°ƒç”¨invoke()æ–¹æ³•ä½¿ç”¨å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡å™¨æ‰§è¡Œå®¢æˆ·ç«¯é›†ç¾¤Clusterçš„doSendMsg()æ–¹æ³•Onewayå•å‘è°ƒç”¨ï¼š

```Java
/**
 * è°ƒç”¨å®¢æˆ·ç«¯
 *
 * @param transport å®¢æˆ·ç«¯è¿æ¥
 * @param request   Requestå¯¹è±¡
 * @return è°ƒç”¨ç»“æœ
 * @throws SofaRpcException rpcå¼‚å¸¸
 */
protected SofaResponse doSendMsg(ProviderInfo providerInfo, ClientTransport transport,
                                 SofaRequest request) throws SofaRpcException {
    RpcInternalContext context = RpcInternalContext.getContext();
    // æ·»åŠ è°ƒç”¨çš„æœåŠ¡ç«¯è¿œç¨‹åœ°å€
    RpcInternalContext.getContext().setRemoteAddress(providerInfo.getHost(), providerInfo.getPort());
    try {
        checkProviderVersion(providerInfo, request); // æ ¹æ®æœåŠ¡ç«¯ç‰ˆæœ¬ç‰¹æ®Šå¤„ç†
        String invokeType = request.getInvokeType();
        int timeout = resolveTimeout(request, consumerConfig, providerInfo);

        SofaResponse response = null;
        // å•å‘è°ƒç”¨
        if (RpcConstants.INVOKER_TYPE_ONEWAY.equals(invokeType)) {
            long start = RpcRuntimeContext.now();
            try {
                transport.oneWaySend(request, timeout);
                response = buildEmptyResponse(request);
            } finally {
                if (RpcInternalContext.isAttachmentEnable()) {
                    long elapsed = RpcRuntimeContext.now() - start;
                    context.setAttachment(RpcConstants.INTERNAL_KEY_CLIENT_ELAPSE, elapsed);
                }
            }
        } else {
            throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, "Unknown invoke type:" + invokeType);
        }
        return response;
    } catch (SofaRpcException e) {
        throw e;
    } catch (Throwable e) { // å®¢æˆ·ç«¯å…¶å®ƒå¼‚å¸¸
        throw new SofaRpcException(RpcErrorType.CLIENT_UNDECLARED_ERROR, e);
    }
}

```

å®¢æˆ·ç«¯é›†ç¾¤Clusteræ ¹æ®è¯·æ±‚è°ƒç”¨ç±»å‹åˆ¤æ–­æ˜¯å¦ä¸ºå•å‘è°ƒç”¨ç±»å‹ï¼Œå®¢æˆ·ç«¯ä¼ è¾“ClientTransportè°ƒç”¨oneWaySend()æ–¹æ³•æŒ‡å®šè¶…æ—¶èŒƒç•´å•å‘è°ƒç”¨å‘é€è¯·æ±‚ï¼Œæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºç©ºå“åº”è°ƒç”¨ç»“æœï¼ŒåŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextè®°å½•å®¢æˆ·ç«¯æ€»è€—æ—¶ï¼š

```Java
/**
 * å•å‘è°ƒç”¨
 *
 * @param message æ¶ˆæ¯
 * @param timeout è¶…æ—¶æ—¶é—´
 * @throws SofaRpcException SofaRpcException
 */
public abstract void oneWaySend(SofaRequest message, int timeout) throws SofaRpcException;

```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport/H2&H2Cå®¢æˆ·ç«¯ä¼ è¾“AbstractHttp2ClientTransport[æŠ›å‡ºä¸æ”¯æŒæ“ä½œå¼‚å¸¸]/ç¬¬ä¸‰æ–¹åè®®ä»£ç†å®¢æˆ·ç«¯ä¼ è¾“AbstractProxyClientTransport[æŠ›å‡ºä¸æ”¯æŒæ“ä½œå¼‚å¸¸]å•å‘è°ƒç”¨oneWaySendè¿‡ç¨‹ï¼šæ£€æŸ¥é•¿è¿æ¥ï¼Œè·å–åŸºäºThreadLocalä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextï¼Œæ ¹æ®SofaRequestè¯·æ±‚åˆ›å»ºè°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œé€šè¿‡doOneWay()æ–¹æ³•æ‰§è¡Œå•å‘è°ƒç”¨ã€‚

```Java
@Extension("bolt")
public class BoltClientTransport extends ClientTransport {
 public void oneWaySend(SofaRequest request, int timeout) throws SofaRpcException {
    checkConnection();
    RpcInternalContext context = RpcInternalContext.getContext();
    InvokeContext invokeContext = createInvokeContext(request);
    SofaRpcException throwable = null;
    try {
        beforeSend(context, request);
        doOneWay(request, invokeContext, timeout);
    } catch (Exception e) { // å…¶å®ƒå¼‚å¸¸
        throwable = convertToRpcException(e);
        throw throwable;
    } finally {
        afterSend(context, invokeContext, request);
        if (EventBus.isEnable(ClientSyncReceiveEvent.class)) {
            EventBus.post(new ClientSyncReceiveEvent(transportConfig.getConsumerConfig(),
                transportConfig.getProviderInfo(), request, null, throwable));
        }
    }
 }

/**
 * åŒæ­¥è°ƒç”¨
 *
 * @param request       è¯·æ±‚å¯¹è±¡
 * @param invokeContext è°ƒç”¨ä¸Šä¸‹æ–‡
 * @param timeoutMillis è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 * @throws RemotingException    è¿œç¨‹è°ƒç”¨å¼‚å¸¸
 * @throws InterruptedException ä¸­æ–­å¼‚å¸¸
 * @since 5.2.0
 */
 protected void doOneWay(SofaRequest request, InvokeContext invokeContext, int timeoutMillis)
    throws RemotingException, InterruptedException {
    RPC_CLIENT.oneway(url, request, invokeContext);
 }
}

```

Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport doOneWayå•å‘è°ƒç”¨é€šè¿‡RpcClientè°ƒç”¨RPCè¿œç¨‹è¿æ¥RpcRemotingçš„oneway()æ–¹æ³•æ ¹æ®è°ƒç”¨è¯·æ±‚URLè·å–æ£€æŸ¥è¿œç¨‹è¿æ¥ï¼Œä½¿ç”¨ç®¡é“Channelçš„writeAndFlush(Object msg)æ–¹æ³•å¼‚æ­¥å‘é€å®¢æˆ·ç«¯æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æ·»åŠ ç›‘å¬å™¨æä¾›æ“ä½œå®Œæˆå‘é€å¤±è´¥æ‰“å°ERRORæ—¥å¿—åœºæ™¯ç›‘å¬ï¼š

```Java
/**
 * Oneway rpc invocation.<br>
 * Notice! DO NOT modify the request object concurrently when this method is called.
 *
 * @param conn
 * @param request
 * @param invokeContext
 * @throws RemotingException
 */
public void oneway(final Connection conn, final Object request,
                   final InvokeContext invokeContext) throws RemotingException {
    RequestCommand requestCommand = (RequestCommand) toRemotingCommand(request, conn,
        invokeContext, -1);
    requestCommand.setType(RpcCommandType.REQUEST_ONEWAY);
    preProcessInvokeContext(invokeContext, requestCommand, conn);
    super.oneway(conn, requestCommand);
}
/**
 * Oneway invocation.
 *
 * @param conn
 * @param request
 * @throws InterruptedException
 */
protected void oneway(final Connection conn, final RemotingCommand request) {
    try {
        conn.getChannel().writeAndFlush(request).addListener(new ChannelFutureListener() {

            @Override
            public void operationComplete(ChannelFuture f) throws Exception {
                if (!f.isSuccess()) {
                    logger.error("Invoke send failed. The address is {}",
                        RemotingUtil.parseRemoteAddress(conn.getChannel()), f.cause());
                }
            }

        });
    } catch (Exception e) {
        if (null == conn) {
            logger.error("Conn is null");
        } else {
            logger.error("Exception caught when sending invocation. The address is {}",
                RemotingUtil.parseRemoteAddress(conn.getChannel()), e);
        }
    }
}

```

2.æ³›åŒ–è°ƒç”¨
 å‚è€ƒSOFARPC Exampleç¤ºä¾‹æ¨¡å—([com.alipay.sofa.rpc.invoke.generic](https://github.com/alipay/sofa-rpc/tree/master/example/src/test/java/com/alipay/sofa/rpc/invoke/generic))ï¼š

```Java
package com.alipay.sofa.rpc.invoke.generic;

import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ProviderConfig;
import com.alipay.sofa.rpc.config.ServerConfig;

public class GenericServerMain {

    public static void main(String[] args) {
        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("generic-server");

        ServerConfig serverConfig2 = new ServerConfig()
            .setPort(22222)
            .setDaemon(false);

        ProviderConfig<TestGenericService> providerConfig = new ProviderConfig<TestGenericService>()
            .setApplication(applicationConfig)
            .setInterfaceId(TestGenericService.class.getName())
            .setRef(new TestGenericServiceImpl())
            .setServer(serverConfig2);
        providerConfig.export();
    }
}
package com.alipay.sofa.rpc.invoke.generic;

import com.alipay.hessian.generic.model.GenericObject;
import com.alipay.sofa.rpc.api.GenericService;
import com.alipay.sofa.rpc.config.ApplicationConfig;
import com.alipay.sofa.rpc.config.ConsumerConfig;
import com.alipay.sofa.rpc.context.RpcRuntimeContext;
import com.alipay.sofa.rpc.log.Logger;
import com.alipay.sofa.rpc.log.LoggerFactory;

public class GenericClientMain {

    private static final Logger LOGGER = LoggerFactory.getLogger(GenericClientMain.class);

    public static void main(String[] args) {
        ApplicationConfig applicationConfig = new ApplicationConfig().setAppName("generic-client");

        ConsumerConfig<GenericService> consumerConfig = new ConsumerConfig<GenericService>()
            .setApplication(applicationConfig)
            .setInterfaceId(TestGenericService.class.getName())
            .setGeneric(true)
            .setTimeout(50000)
            .setDirectUrl("bolt://127.0.0.1:22222?appName=generic-server");
        GenericService testService = consumerConfig.refer();

        LOGGER.warn("started at pid {}", RpcRuntimeContext.PID);

        while (true) {
            try {
                String s1 = (String) testService.$invoke("echoStr", new String[] { "java.lang.String" },
                    new Object[] { "1111" });
                LOGGER.warn("generic return :{}", s1);

                GenericObject genericObject = new GenericObject(
                    "com.alipay.sofa.rpc.invoke.generic.TestObj");
                genericObject.putField("str", "xxxx");
                genericObject.putField("num", 222);

                GenericObject o2 = (GenericObject) testService.$genericInvoke("echoObj",
                    new String[] { "com.alipay.sofa.rpc.invoke.generic.TestObj" },
                    new Object[] { genericObject });
                LOGGER.warn("generic return :{}", o2);

                TestObj o3 = testService.$genericInvoke("echoObj",
                    new String[] { "com.alipay.sofa.rpc.invoke.generic.TestObj" },
                    new Object[] { genericObject }, TestObj.class);
                LOGGER.warn("generic return :{}", o3);

            } catch (Exception e) {
                LOGGER.error(e.getMessage(), e);
            }
            try {
                Thread.sleep(2000);
            } catch (Exception ignore) {
            }
        }

    }
}

```

è¿è¡Œæ³›åŒ–è°ƒç”¨æœåŠ¡ç«¯ç¤ºä¾‹ç±»GenericServerMainæŸ¥çœ‹æ³›åŒ–è°ƒç”¨æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-02 22:25:22,746 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:12556
2018-06-02 22:25:24,285 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-02 22:25:25,259 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-02 22:25:26,899 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-02 22:25:26,930 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-02 22:25:27,450 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultProviderBootstrap:infoWithApp:122] - [generic-server]Export provider config : com.alipay.sofa.rpc.invoke.generic.TestGenericService: with bean id rpc-cfg-0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-02 22:25:29,737 main  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-02 22:25:33,102 main  INFO [com.alipay.sofa.rpc.server.bolt.BoltServer:info:102] - Bolt server has been bind to 0.0.0.0:22222
2018-06-02 22:38:26,495 SOFA-SEV-BOLT-BIZ-22222-3-T1  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@7a34d8b5
2018-06-02 22:38:26,575 SOFA-SEV-BOLT-BIZ-22222-3-T1  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive str: 1111
2018-06-02 22:38:27,046 SOFA-SEV-BOLT-BIZ-22222-3-T2  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive obj: TestObj{str='xxxx', num=222}
2018-06-02 22:38:27,174 SOFA-SEV-BOLT-BIZ-22222-3-T3  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive obj: TestObj{str='xxxx', num=222}
2018-06-02 22:38:29,194 SOFA-SEV-BOLT-BIZ-22222-3-T4  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive str: 1111
2018-06-02 22:38:29,202 SOFA-SEV-BOLT-BIZ-22222-3-T5  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive obj: TestObj{str='xxxx', num=222}
2018-06-02 22:38:29,212 SOFA-SEV-BOLT-BIZ-22222-3-T6  INFO [com.alipay.sofa.rpc.invoke.generic.TestGenericServiceImpl:info:102] - receive obj: TestObj{str='xxxx', num=222}

```

è¿è¡Œæ³›åŒ–è°ƒç”¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±»GenericClientMainæŸ¥çœ‹æ³›åŒ–è°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
2018-06-02 22:38:15,849 main  INFO [com.alipay.sofa.rpc.context.RpcRuntimeContext:info:102] - Welcome! Loading SOFA RPC Framework : 5.4.0_20180530235405, PID is:7640
2018-06-02 22:38:16,833 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: fault-tolerance
2018-06-02 22:38:17,444 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer-resteasy
2018-06-02 22:38:18,655 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:97] - The module lookout does not need to be loaded.
2018-06-02 22:38:18,667 main  INFO [com.alipay.sofa.rpc.module.ModuleFactory:info:102] - Install Module: sofaTracer
2018-06-02 22:38:19,470 main  INFO [com.alipay.sofa.rpc.bootstrap.DefaultConsumerBootstrap:infoWithApp:122] - [generic-client]Refer consumer config : bolt://com.alipay.sofa.rpc.invoke.generic.TestGenericService: with bean id rpc-cfg-0
2018-06-02 22:38:21,322 main  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [generic-client]Add provider of com.alipay.sofa.rpc.invoke.generic.TestGenericService, size is : 1
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-02 22:38:22,119 SOFA-CLI-CONN-com.alipay.sofa.rpc.invoke.generic.TestGenericService-3-T1  INFO [com.alipay.sofa.common.log:report:30] - Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Log4j ]
2018-06-02 22:38:24,058 SOFA-CLI-CONN-com.alipay.sofa.rpc.invoke.generic.TestGenericService-3-T1  INFO [com.alipay.sofa.rpc.client.AllConnectConnectionHolder:infoWithApp:122] - [generic-client]Connect to com.alipay.sofa.rpc.invoke.generic.TestGenericService provider:bolt://127.0.0.1:22222?appName=generic-server success ! The connection is 127.0.0.1:22222 <-> 127.0.0.1:53301
2018-06-02 22:38:24,901 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - started at pid 7640
2018-06-02 22:38:25,024 main  INFO [com.alipay.sofa.rpc.tracer.Tracers:info:102] - Load tracer impl success: sofaTracer, com.alipay.sofa.rpc.tracer.sofatracer.RpcSofaTracer@7cd62f43
2018-06-02 22:38:26,952 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :1111
2018-06-02 22:38:27,095 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :{type: com.alipay.sofa.rpc.invoke.generic.TestObj, fields: {num=222, str=xxxx}}
2018-06-02 22:38:27,188 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :TestObj{str='xxxx', num=222}
2018-06-02 22:38:29,197 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :1111
2018-06-02 22:38:29,207 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :{type: com.alipay.sofa.rpc.invoke.generic.TestObj, fields: {num=222, str=xxxx}}
2018-06-02 22:38:29,215 main  WARN [com.alipay.sofa.rpc.invoke.generic.GenericClientMain:warn:142] - generic return :TestObj{str='xxxx', num=222}

```

å‚è€ƒsofa-rpc-boot-projectsèŒƒä¾‹æ¨¡å—([com.alipay.sofa.rpc.samples.generic](https://github.com/alipay/sofa-rpc-boot-projects/tree/master/sofa-boot-samples/src/main/java/com/alipay/sofa/rpc/samples/generic))ï¼š

```Java
<!-- generic -->
<bean id="sampleGenericServiceImpl" class="com.alipay.sofa.rpc.samples.generic.SampleGenericServiceImpl"/>
<sofa:service ref="sampleGenericServiceImpl" interface="com.alipay.sofa.rpc.samples.generic.SampleGenericService">
    <sofa:binding.bolt/>
</sofa:service>
<!-- generic -->
<sofa:reference jvm-first="false" id="sampleGenericServiceReference" interface="com.alipay.sofa.rpc.api.GenericService">
    <sofa:binding.bolt>
        <sofa:global-attrs generic-interface="com.alipay.sofa.rpc.samples.generic.SampleGenericService"/>
    </sofa:binding.bolt>
</sofa:reference>
package com.alipay.sofa.rpc.samples.generic;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.ImportResource;

@ImportResource({ "classpath:generic-server-example.xml" })
@SpringBootApplication
public class GenericServerApplication {

    public static void main(String[] args) {

        SpringApplication springApplication = new SpringApplication(GenericServerApplication.class);
        ApplicationContext applicationContext = springApplication.run(args);
    }
}
package com.alipay.sofa.rpc.samples.generic;

import com.alipay.hessian.generic.model.GenericObject;
import com.alipay.sofa.rpc.api.GenericService;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.ImportResource;

@ImportResource({ "classpath:generic-client-example.xml" })
@SpringBootApplication
public class GenericClientApplication {

    public static void main(String[] args) {

        //change port to run in local machine
        System.setProperty("server.port", "8081");

        SpringApplication springApplication = new SpringApplication(GenericClientApplication.class);
        ApplicationContext applicationContext = springApplication.run(args);

        GenericService sampleGenericServiceReference = (GenericService) applicationContext
            .getBean("sampleGenericServiceReference");

        GenericObject genericObject = new GenericObject(
            "com.alipay.sofa.rpc.samples.generic.SampleGenericParamModel");
        genericObject.putField("name", "Bible");

        GenericObject genericResult = (GenericObject) sampleGenericServiceReference.$genericInvoke("sayGeneric",
            new String[] { "com.alipay.sofa.rpc.samples.generic.SampleGenericParamModel" },
            new Object[] { genericObject });

        System.out.println(genericResult.getType());
        System.out.println(genericResult.getField("name"));
        System.out.println(genericResult.getField("value"));

        String result = (String) genericResult.getField("value");

        System.out.println("invoke result:" + result);

        if ("sample generic value".equalsIgnoreCase(result)) {
            System.out.println("generic invoke success");
        } else {
            System.out.println("generic invoke fail");
        }

    }
}

```

è¿è¡Œæ³›åŒ–è°ƒç”¨æœåŠ¡ç«¯èŒƒä¾‹ç±»GenericServerApplicationæŸ¥çœ‹æ³›åŒ–è°ƒç”¨æœåŠ¡ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.4.2.RELEASE)

Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
2018-06-02 23:26:32.427  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
2018-06-02 23:26:32.442  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-02 23:26:32.714  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-02 23:26:32.761  INFO 1236 --- [           main] c.a.s.r.s.g.GenericServerApplication     : Starting GenericServerApplication on Program with PID 1236 (D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes started by Administrator in D:\Program\Github\sofa-rpc-boot-projects)
2018-06-02 23:26:32.762  INFO 1236 --- [           main] c.a.s.r.s.g.GenericServerApplication     : No active profile set, falling back to default profiles: default
2018-06-02 23:26:32.851  INFO 1236 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sat Jun 02 23:26:32 CST 2018]; root of context hierarchy
2018-06-02 23:26:35.088  INFO 1236 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [generic-client-example.xml]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-02 23:26:35.486  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-02 23:26:35.611  INFO 1236 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [generic-server-example.xml]
2018-06-02 23:26:36.882  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration' of type [class com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration$$EnhancerBySpringCGLIB$$99aaf0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.031  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingConverterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingConverterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.091  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingAdapterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingAdapterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.097  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeProperties' of type [class com.alipay.sofa.runtime.spring.config.SofaRuntimeProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.110  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeContext' of type [class com.alipay.sofa.runtime.spi.component.SofaRuntimeContext] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-02 23:26:37.178  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-02 23:26:37.191  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration' of type [class com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration$$EnhancerBySpringCGLIB$$34f86405] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.236  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigHelper' of type [class com.alipay.sofa.rpc.boot.runtime.adapter.helper.ConsumerConfigHelper] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.242  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaBootRpcProperties' of type [class com.alipay.sofa.rpc.boot.config.SofaBootRpcProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.244  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'zookeeperConfigurator' of type [class com.alipay.sofa.rpc.boot.config.ZookeeperConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.246  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'localFileConfigurator' of type [class com.alipay.sofa.rpc.boot.config.LocalFileConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.246  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'registryConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.RegistryConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-02 23:26:37.288  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-02 23:26:37.589  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.ConsumerConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:37.717  INFO 1236 --- [           main] o.a.c.f.imps.CuratorFrameworkImpl        : Starting
2018-06-02 23:26:37.725  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT
2018-06-02 23:26:37.726  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:host.name=Program
2018-06-02 23:26:37.726  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.version=1.8.0_141
2018-06-02 23:26:37.726  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.vendor=Oracle Corporation
2018-06-02 23:26:37.726  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.home=C:\Program Files\Java\jdk1.8.0_141\jre
2018-06-02 23:26:37.726  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.class.path=C:\Program Files\Java\jdk1.8.0_141\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\rt.jar;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-starter\target\classes;C:\Users\Administrator\.m2\repository\com\alipay\sofa\sofa-rpc-all\5.4.0\sofa-rpc-all-5.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\bolt\1.4.1\bolt-1.4.1.jar;C:\Users\Administrator\.m2\repository\org\slf4j\slf4j-api\1.7.21\slf4j-api-1.7.21.jar;C:\Users\Administrator\.m2\repository\io\netty\netty-all\4.1.25.Final\netty-all-4.1.25.Final.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\hessian\3.3.0\hessian-3.3.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\tracer-core\2.1.1\tracer-core-2.1.1.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-api\0.22.0\opentracing-api-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-noop\0.22.0\opentracing-noop-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-mock\0.22.0\opentracing-mock-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-util\0.22.0\opentracing-util-0.22.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\lookout\lookout-api\1.4.0\lookout-api-1.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\runtime-sofa-boot-starter\2.4.0\runtime-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-client\2.9.1\curator-client-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-framework\2.9.1\curator-framework-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-recipes\2.9.1\curator-recipes-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxrs\3.0.12.Final\resteasy-jaxrs-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\spec\javax\annotation\jboss-annotations-api_1.1_spec\1.0.1.Final\jboss-annotations-api_1.1_spec-1.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\activation\activation\1.1.1\activation-1.1.1.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpclient\4.3.6\httpclient-4.3.6.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpcore\4.3.3\httpcore-4.3.3.jar;C:\Users\Administrator\.m2\repository\commons-logging\commons-logging\1.1.3\commons-logging-1.1.3.jar;C:\Users\Administrator\.m2\repository\commons-codec\commons-codec\1.6\commons-codec-1.6.jar;C:\Users\Administrator\.m2\repository\commons-io\commons-io\2.1\commons-io-2.1.jar;C:\Users\Administrator\.m2\repository\net\jcip\jcip-annotations\1.0\jcip-annotations-1.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-client\3.0.12.Final\resteasy-client-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jackson-provider\3.0.12.Final\resteasy-jackson-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.12\jackson-core-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.12\jackson-mapper-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-jaxrs\1.9.12\jackson-jaxrs-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-xc\1.9.12\jackson-xc-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-netty4\3.0.12.Final\resteasy-netty4-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-validator-provider-11\3.0.12.Final\resteasy-validator-provider-11-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\hibernate\hibernate-validator\5.0.1.Final\hibernate-validator-5.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\validation\validation-api\1.1.0.Final\validation-api-1.1.0.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\logging\jboss-logging\3.1.1.GA\jboss-logging-3.1.1.GA.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\classmate\0.8.0\classmate-0.8.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\jaxrs-api\3.0.12.Final\jaxrs-api-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-multipart-provider\3.0.12.Final\resteasy-multipart-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxb-provider\3.0.12.Final\resteasy-jaxb-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-impl\2.2.7\jaxb-impl-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-core\2.2.7\jaxb-core-2.2.7.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jaxb-api\2.2.7\jaxb-api-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\istack\istack-commons-runtime\2.16\istack-commons-runtime-2.16.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\fastinfoset\FastInfoset\1.2.12\FastInfoset-1.2.12.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar;C:\Users\Administrator\.m2\repository\javax\mail\mail\1.5.0-b01\mail-1.5.0-b01.jar;C:\Users\Administrator\.m2\repository\org\apache\james\apache-mime4j\0.6\apache-mime4j-0.6.jar;C:\Users\Administrator\.m2\repository\javax\el\javax.el-api\2.2.5\javax.el-api-2.2.5.jar;C:\Users\Administrator\.m2\repository\org\glassfish\web\javax.el\2.2.6\javax.el-2.2.6.jar;C:\Users\Administrator\.m2\repository\com\alibaba\dubbo\2.4.10\dubbo-2.4.10.jar;C:\Users\Administrator\.m2\repository\org\jboss\netty\netty\3.2.5.Final\netty-3.2.5.Final.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-beans\4.3.4.RELEASE\spring-beans-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-core\4.3.4.RELEASE\spring-core-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\1.4.2.RELEASE\spring-boot-autoconfigure-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\test-sofa-boot-starter\2.4.0\test-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\healthcheck-sofa-boot-starter\2.4.0\healthcheck-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\infra-sofa-boot-starter\2.4.0\infra-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-context\4.3.4.RELEASE\spring-context-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-aop\4.3.4.RELEASE\spring-aop-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-expression\4.3.4.RELEASE\spring-expression-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot\1.4.2.RELEASE\spring-boot-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-actuator\1.4.2.RELEASE\spring-boot-starter-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter\1.4.2.RELEASE\spring-boot-starter-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-logging\1.4.2.RELEASE\spring-boot-starter-logging-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-classic\1.1.7\logback-classic-1.1.7.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-core\1.1.7\logback-core-1.1.7.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jcl-over-slf4j\1.7.21\jcl-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jul-to-slf4j\1.7.21\jul-to-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\log4j-over-slf4j\1.7.21\log4j-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\yaml\snakeyaml\1.17\snakeyaml-1.17.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-actuator\1.4.2.RELEASE\spring-boot-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-web\1.4.2.RELEASE\spring-boot-starter-web-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-tomcat\1.4.2.RELEASE\spring-boot-starter-tomcat-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\8.5.6\tomcat-embed-core-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-el\8.5.6\tomcat-embed-el-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-websocket\8.5.6\tomcat-embed-websocket-8.5.6.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.8.4\jackson-databind-2.8.4.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.8.0\jackson-annotations-2.8.0.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.8.4\jackson-core-2.8.4.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-web\4.3.4.RELEASE\spring-web-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-webmvc\4.3.4.RELEASE\spring-webmvc-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alibaba\fastjson\1.2.47\fastjson-1.2.47.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\common\sofa-common-tools\1.0.12\sofa-common-tools-1.0.12.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-test\2.9.1\curator-test-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\zookeeper\zookeeper\3.4.6\zookeeper-3.4.6.jar;C:\Users\Administrator\.m2\repository\log4j\log4j\1.2.16\log4j-1.2.16.jar;C:\Users\Administrator\.m2\repository\jline\jline\0.9.94\jline-0.9.94.jar;C:\Users\Administrator\.m2\repository\io\netty\netty\3.7.0.Final\netty-3.7.0.Final.jar;C:\Users\Administrator\.m2\repository\org\javassist\javassist\3.18.1-GA\javassist-3.18.1-GA.jar;C:\Users\Administrator\.m2\repository\org\apache\commons\commons-math\2.2\commons-math-2.2.jar;C:\Users\Administrator\.m2\repository\com\google\guava\guava\16.0.1\guava-16.0.1.jar;C:\Users\Administrator\.m2\repository\com\101tec\zkclient\0.10\zkclient-0.10.jar;D:\Program\JetBrains\IntelliJ\lib\idea_rt.jar
2018-06-02 23:26:37.727  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.library.path=C:\Program Files\Java\jdk1.8.0_141\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\ProgramData\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\Program Files\Java\jdk1.8.0_141\bin;C:\Program Files\Java\jdk1.8.0_141\jre\bin;C:\Program Files\Maven\bin;C:\Program Files (x86)\Git\cmd;C:\Program Files\MySQL\MySQL Utilities 1.6\;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;;C:\Program Files\Mercurial;.
2018-06-02 23:26:37.727  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.io.tmpdir=C:\Users\ADMINI~1\AppData\Local\Temp\
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.compiler=<NA>
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.name=Windows 10
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.arch=amd64
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.version=10.0
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.name=Administrator
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.home=C:\Users\Administrator
2018-06-02 23:26:37.728  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.dir=D:\Program\Github\sofa-rpc-boot-projects
2018-06-02 23:26:37.731  INFO 1236 --- [           main] org.apache.zookeeper.ZooKeeper           : Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=60000 watcher=org.apache.curator.ConnectionState@16fe9c29
2018-06-02 23:26:37.768  INFO 1236 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
2018-06-02 23:26:37.771  INFO 1236 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session
2018-06-02 23:26:37.833  INFO 1236 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x10001e7028f0000, negotiated timeout = 40000
2018-06-02 23:26:37.845  INFO 1236 --- [ain-EventThread] o.a.c.f.state.ConnectionStateManager     : State change: CONNECTED
2018-06-02 23:26:37.891  WARN 1236 --- [           main] org.apache.curator.utils.ZKPaths         : The version of ZooKeeper being used doesn't support Container nodes. CreateMode.PERSISTENT will be used instead.
2018-06-02 23:26:38.691  INFO 1236 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sampleGenericServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:26:53.798  INFO 1236 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)
2018-06-02 23:26:53.851  INFO 1236 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2018-06-02 23:26:53.947  INFO 1236 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.6
2018-06-02 23:26:55.152  INFO 1236 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2018-06-02 23:26:55.153  INFO 1236 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 22302 ms
2018-06-02 23:26:56.117  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: 'dispatcherServlet' to [/]
2018-06-02 23:26:56.188  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'metricsFilter' to: [/*]
2018-06-02 23:26:56.198  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
2018-06-02 23:26:56.198  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
2018-06-02 23:26:56.204  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
2018-06-02 23:26:56.205  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
2018-06-02 23:26:56.207  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'webRequestLoggingFilter' to: [/*]
2018-06-02 23:26:56.207  INFO 1236 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'applicationContextIdFilter' to: [/*]
2018-06-02 23:27:00.395  INFO 1236 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@59309333: startup date [Sat Jun 02 23:26:32 CST 2018]; root of context hierarchy
2018-06-02 23:27:01.364  INFO 1236 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity<java.util.Map<java.lang.String, java.lang.Object>> org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2018-06-02 23:27:01.368  INFO 1236 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=[text/html]}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
2018-06-02 23:27:01.714  INFO 1236 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:01.714  INFO 1236 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:01.999  INFO 1236 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:04.421  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health/readiness || /health/readiness.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.healthcheck.service.SofaBootReadinessCheckMvcEndpoint.invoke(java.security.Principal)
2018-06-02 23:27:04.435  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/dump || /dump.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.436  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/sofaboot/versions || /sofaboot/versions.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.infra.endpoint.SofaBootVersionEndpointMvcAdapter.invoke()
2018-06-02 23:27:04.442  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/trace || /trace.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.453  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/mappings || /mappings.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.457  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/heapdump || /heapdump.json],methods=[GET],produces=[application/octet-stream]}" onto public void org.springframework.boot.actuate.endpoint.mvc.HeapdumpMvcEndpoint.invoke(boolean,javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws java.io.IOException,javax.servlet.ServletException
2018-06-02 23:27:04.474  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.MetricsMvcEndpoint.value(java.lang.String)
2018-06-02 23:27:04.475  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics || /metrics.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.477  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/logfile || /logfile.json],methods=[GET || HEAD]}" onto public void org.springframework.boot.actuate.endpoint.mvc.LogFileMvcEndpoint.invoke(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws javax.servlet.ServletException,java.io.IOException
2018-06-02 23:27:04.483  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EnvironmentMvcEndpoint.value(java.lang.String)
2018-06-02 23:27:04.484  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env || /env.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.485  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health || /health.json],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.HealthMvcEndpoint.invoke(java.security.Principal)
2018-06-02 23:27:04.490  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/beans || /beans.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.496  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/info || /info.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.498  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/autoconfig || /autoconfig.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:04.500  INFO 1236 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/configprops || /configprops.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:05.084  INFO 1236 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-06-02 23:27:05.161  INFO 1236 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-02 23:27:06.128  INFO 1236 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-02 23:27:11.373  INFO 1236 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2018-06-02 23:27:11.388  INFO 1236 --- [           main] c.a.s.r.s.g.GenericServerApplication     : Started GenericServerApplication in 40.159 seconds (JVM running for 43.778)

```

è¿è¡Œæ³›åŒ–è°ƒç”¨å®¢æˆ·ç«¯èŒƒä¾‹ç±»GenericClientApplicationæŸ¥çœ‹æ³›åŒ–è°ƒç”¨å®¢æˆ·ç«¯è¾“å‡ºæ—¥å¿—ï¼š

```Java
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.4.2.RELEASE)

Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
2018-06-02 23:26:59.572  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual logging.path is [ ./logs ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
2018-06-02 23:26:59.594  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.infra Logback ]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-02 23:27:00.052  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.healthcheck Logback ]
2018-06-02 23:27:00.179  INFO 13708 --- [           main] c.a.s.r.s.g.GenericClientApplication     : Starting GenericClientApplication on Program with PID 13708 (D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes started by Administrator in D:\Program\Github\sofa-rpc-boot-projects)
2018-06-02 23:27:00.181  INFO 13708 --- [           main] c.a.s.r.s.g.GenericClientApplication     : No active profile set, falling back to default profiles: default
2018-06-02 23:27:00.444  INFO 13708 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4c12331b: startup date [Sat Jun 02 23:27:00 CST 2018]; root of context hierarchy
2018-06-02 23:27:04.610  INFO 13708 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [generic-server-example.xml]
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-02 23:27:05.133  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc.boot Logback ]
2018-06-02 23:27:05.361  INFO 13708 --- [           main] o.s.b.f.xml.XmlBeanDefinitionReader      : Loading XML bean definitions from class path resource [generic-client-example.xml]
2018-06-02 23:27:08.260  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration' of type [class com.alipay.sofa.runtime.spring.configuration.SofaRuntimeAutoConfiguration$$EnhancerBySpringCGLIB$$d986ce61] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:09.510  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingConverterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingConverterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:09.882  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'bindingAdapterFactory' of type [class com.alipay.sofa.runtime.service.impl.BindingAdapterFactoryImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:09.885  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeProperties' of type [class com.alipay.sofa.runtime.spring.config.SofaRuntimeProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:09.892  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaRuntimeContext' of type [class com.alipay.sofa.runtime.spi.component.SofaRuntimeContext] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-02 23:27:10.115  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.runtime Logback ]
2018-06-02 23:27:10.145  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration' of type [class com.alipay.sofa.rpc.boot.SofaBootRpcAutoConfiguration$$EnhancerBySpringCGLIB$$de58776] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:10.242  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigHelper' of type [class com.alipay.sofa.rpc.boot.runtime.adapter.helper.ConsumerConfigHelper] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:10.265  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sofaBootRpcProperties' of type [class com.alipay.sofa.rpc.boot.config.SofaBootRpcProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:10.272  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'zookeeperConfigurator' of type [class com.alipay.sofa.rpc.boot.config.ZookeeperConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:10.277  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'localFileConfigurator' of type [class com.alipay.sofa.rpc.boot.config.LocalFileConfigurator] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:10.279  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'registryConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.RegistryConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-02 23:27:10.620  INFO 13708 --- [           main] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.sofa.rpc Logback ]
2018-06-02 23:27:11.172  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'consumerConfigContainer' of type [class com.alipay.sofa.rpc.boot.container.ConsumerConfigContainer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:16.049  INFO 13708 --- [           main] o.a.c.f.imps.CuratorFrameworkImpl        : Starting
2018-06-02 23:27:16.077  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT
2018-06-02 23:27:16.077  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:host.name=Program
2018-06-02 23:27:16.078  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.version=1.8.0_141
2018-06-02 23:27:16.078  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.vendor=Oracle Corporation
2018-06-02 23:27:16.078  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.home=C:\Program Files\Java\jdk1.8.0_141\jre
2018-06-02 23:27:16.079  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.class.path=C:\Program Files\Java\jdk1.8.0_141\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_141\jre\lib\rt.jar;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-samples\target\classes;D:\Program\Github\sofa-rpc-boot-projects\sofa-boot-starter\target\classes;C:\Users\Administrator\.m2\repository\com\alipay\sofa\sofa-rpc-all\5.4.0\sofa-rpc-all-5.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\bolt\1.4.1\bolt-1.4.1.jar;C:\Users\Administrator\.m2\repository\org\slf4j\slf4j-api\1.7.21\slf4j-api-1.7.21.jar;C:\Users\Administrator\.m2\repository\io\netty\netty-all\4.1.25.Final\netty-all-4.1.25.Final.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\hessian\3.3.0\hessian-3.3.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\tracer-core\2.1.1\tracer-core-2.1.1.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-api\0.22.0\opentracing-api-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-noop\0.22.0\opentracing-noop-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-mock\0.22.0\opentracing-mock-0.22.0.jar;C:\Users\Administrator\.m2\repository\io\opentracing\opentracing-util\0.22.0\opentracing-util-0.22.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\lookout\lookout-api\1.4.0\lookout-api-1.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\runtime-sofa-boot-starter\2.4.0\runtime-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-client\2.9.1\curator-client-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-framework\2.9.1\curator-framework-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-recipes\2.9.1\curator-recipes-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxrs\3.0.12.Final\resteasy-jaxrs-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\spec\javax\annotation\jboss-annotations-api_1.1_spec\1.0.1.Final\jboss-annotations-api_1.1_spec-1.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\activation\activation\1.1.1\activation-1.1.1.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpclient\4.3.6\httpclient-4.3.6.jar;C:\Users\Administrator\.m2\repository\org\apache\httpcomponents\httpcore\4.3.3\httpcore-4.3.3.jar;C:\Users\Administrator\.m2\repository\commons-logging\commons-logging\1.1.3\commons-logging-1.1.3.jar;C:\Users\Administrator\.m2\repository\commons-codec\commons-codec\1.6\commons-codec-1.6.jar;C:\Users\Administrator\.m2\repository\commons-io\commons-io\2.1\commons-io-2.1.jar;C:\Users\Administrator\.m2\repository\net\jcip\jcip-annotations\1.0\jcip-annotations-1.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-client\3.0.12.Final\resteasy-client-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jackson-provider\3.0.12.Final\resteasy-jackson-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.12\jackson-core-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.12\jackson-mapper-asl-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-jaxrs\1.9.12\jackson-jaxrs-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\codehaus\jackson\jackson-xc\1.9.12\jackson-xc-1.9.12.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-netty4\3.0.12.Final\resteasy-netty4-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-validator-provider-11\3.0.12.Final\resteasy-validator-provider-11-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\hibernate\hibernate-validator\5.0.1.Final\hibernate-validator-5.0.1.Final.jar;C:\Users\Administrator\.m2\repository\javax\validation\validation-api\1.1.0.Final\validation-api-1.1.0.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\logging\jboss-logging\3.1.1.GA\jboss-logging-3.1.1.GA.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\classmate\0.8.0\classmate-0.8.0.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\jaxrs-api\3.0.12.Final\jaxrs-api-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-multipart-provider\3.0.12.Final\resteasy-multipart-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\org\jboss\resteasy\resteasy-jaxb-provider\3.0.12.Final\resteasy-jaxb-provider-3.0.12.Final.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-impl\2.2.7\jaxb-impl-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\bind\jaxb-core\2.2.7\jaxb-core-2.2.7.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jaxb-api\2.2.7\jaxb-api-2.2.7.jar;C:\Users\Administrator\.m2\repository\com\sun\istack\istack-commons-runtime\2.16\istack-commons-runtime-2.16.jar;C:\Users\Administrator\.m2\repository\com\sun\xml\fastinfoset\FastInfoset\1.2.12\FastInfoset-1.2.12.jar;C:\Users\Administrator\.m2\repository\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar;C:\Users\Administrator\.m2\repository\javax\mail\mail\1.5.0-b01\mail-1.5.0-b01.jar;C:\Users\Administrator\.m2\repository\org\apache\james\apache-mime4j\0.6\apache-mime4j-0.6.jar;C:\Users\Administrator\.m2\repository\javax\el\javax.el-api\2.2.5\javax.el-api-2.2.5.jar;C:\Users\Administrator\.m2\repository\org\glassfish\web\javax.el\2.2.6\javax.el-2.2.6.jar;C:\Users\Administrator\.m2\repository\com\alibaba\dubbo\2.4.10\dubbo-2.4.10.jar;C:\Users\Administrator\.m2\repository\org\jboss\netty\netty\3.2.5.Final\netty-3.2.5.Final.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-beans\4.3.4.RELEASE\spring-beans-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-core\4.3.4.RELEASE\spring-core-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\1.4.2.RELEASE\spring-boot-autoconfigure-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\test-sofa-boot-starter\2.4.0\test-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\healthcheck-sofa-boot-starter\2.4.0\healthcheck-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\infra-sofa-boot-starter\2.4.0\infra-sofa-boot-starter-2.4.0.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-context\4.3.4.RELEASE\spring-context-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-aop\4.3.4.RELEASE\spring-aop-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-expression\4.3.4.RELEASE\spring-expression-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot\1.4.2.RELEASE\spring-boot-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-actuator\1.4.2.RELEASE\spring-boot-starter-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter\1.4.2.RELEASE\spring-boot-starter-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-logging\1.4.2.RELEASE\spring-boot-starter-logging-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-classic\1.1.7\logback-classic-1.1.7.jar;C:\Users\Administrator\.m2\repository\ch\qos\logback\logback-core\1.1.7\logback-core-1.1.7.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jcl-over-slf4j\1.7.21\jcl-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\jul-to-slf4j\1.7.21\jul-to-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\slf4j\log4j-over-slf4j\1.7.21\log4j-over-slf4j-1.7.21.jar;C:\Users\Administrator\.m2\repository\org\yaml\snakeyaml\1.17\snakeyaml-1.17.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-actuator\1.4.2.RELEASE\spring-boot-actuator-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-web\1.4.2.RELEASE\spring-boot-starter-web-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\boot\spring-boot-starter-tomcat\1.4.2.RELEASE\spring-boot-starter-tomcat-1.4.2.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\8.5.6\tomcat-embed-core-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-el\8.5.6\tomcat-embed-el-8.5.6.jar;C:\Users\Administrator\.m2\repository\org\apache\tomcat\embed\tomcat-embed-websocket\8.5.6\tomcat-embed-websocket-8.5.6.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.8.4\jackson-databind-2.8.4.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.8.0\jackson-annotations-2.8.0.jar;C:\Users\Administrator\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.8.4\jackson-core-2.8.4.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-web\4.3.4.RELEASE\spring-web-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\org\springframework\spring-webmvc\4.3.4.RELEASE\spring-webmvc-4.3.4.RELEASE.jar;C:\Users\Administrator\.m2\repository\com\alibaba\fastjson\1.2.47\fastjson-1.2.47.jar;C:\Users\Administrator\.m2\repository\com\alipay\sofa\common\sofa-common-tools\1.0.12\sofa-common-tools-1.0.12.jar;C:\Users\Administrator\.m2\repository\org\apache\curator\curator-test\2.9.1\curator-test-2.9.1.jar;C:\Users\Administrator\.m2\repository\org\apache\zookeeper\zookeeper\3.4.6\zookeeper-3.4.6.jar;C:\Users\Administrator\.m2\repository\log4j\log4j\1.2.16\log4j-1.2.16.jar;C:\Users\Administrator\.m2\repository\jline\jline\0.9.94\jline-0.9.94.jar;C:\Users\Administrator\.m2\repository\io\netty\netty\3.7.0.Final\netty-3.7.0.Final.jar;C:\Users\Administrator\.m2\repository\org\javassist\javassist\3.18.1-GA\javassist-3.18.1-GA.jar;C:\Users\Administrator\.m2\repository\org\apache\commons\commons-math\2.2\commons-math-2.2.jar;C:\Users\Administrator\.m2\repository\com\google\guava\guava\16.0.1\guava-16.0.1.jar;C:\Users\Administrator\.m2\repository\com\101tec\zkclient\0.10\zkclient-0.10.jar;D:\Program\JetBrains\IntelliJ\lib\idea_rt.jar
2018-06-02 23:27:16.509  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.library.path=C:\Program Files\Java\jdk1.8.0_141\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\ProgramData\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\Program Files\Java\jdk1.8.0_141\bin;C:\Program Files\Java\jdk1.8.0_141\jre\bin;C:\Program Files\Maven\bin;C:\Program Files (x86)\Git\cmd;C:\Program Files\MySQL\MySQL Utilities 1.6\;C:\Users\Administrator\AppData\Local\Microsoft\WindowsApps;;C:\Program Files\Mercurial;.
2018-06-02 23:27:16.509  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.io.tmpdir=C:\Users\ADMINI~1\AppData\Local\Temp\
2018-06-02 23:27:16.510  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:java.compiler=<NA>
2018-06-02 23:27:16.510  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.name=Windows 10
2018-06-02 23:27:16.510  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.arch=amd64
2018-06-02 23:27:16.510  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:os.version=10.0
2018-06-02 23:27:16.510  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.name=Administrator
2018-06-02 23:27:16.511  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.home=C:\Users\Administrator
2018-06-02 23:27:16.511  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Client environment:user.dir=D:\Program\Github\sofa-rpc-boot-projects
2018-06-02 23:27:16.514  INFO 13708 --- [           main] org.apache.zookeeper.ZooKeeper           : Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=60000 watcher=org.apache.curator.ConnectionState@6124287a
2018-06-02 23:27:17.613  INFO 13708 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
2018-06-02 23:27:17.617  INFO 13708 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session
2018-06-02 23:27:17.643  INFO 13708 --- [127.0.0.1:2181)] org.apache.zookeeper.ClientCnxn          : Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x10001e7028f0001, negotiated timeout = 40000
2018-06-02 23:27:17.654  INFO 13708 --- [ain-EventThread] o.a.c.f.state.ConnectionStateManager     : State change: CONNECTED
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-02 23:27:17.968  INFO 13708 --- [ricService-3-T1] com.alipay.sofa.common.log               : Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
2018-06-02 23:27:20.058  INFO 13708 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'sampleGenericServiceReference' of type [class com.alipay.sofa.runtime.spring.factory.ReferenceFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2018-06-02 23:27:21.352  INFO 13708 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8081 (http)
2018-06-02 23:27:21.384  INFO 13708 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2018-06-02 23:27:21.387  INFO 13708 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.6
2018-06-02 23:27:23.164  INFO 13708 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2018-06-02 23:27:23.164  INFO 13708 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 22720 ms
2018-06-02 23:27:23.970  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: 'dispatcherServlet' to [/]
2018-06-02 23:27:23.986  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'metricsFilter' to: [/*]
2018-06-02 23:27:23.987  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
2018-06-02 23:27:23.988  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
2018-06-02 23:27:23.989  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
2018-06-02 23:27:23.989  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
2018-06-02 23:27:23.989  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'webRequestLoggingFilter' to: [/*]
2018-06-02 23:27:23.990  INFO 13708 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'applicationContextIdFilter' to: [/*]
2018-06-02 23:27:25.649  INFO 13708 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4c12331b: startup date [Sat Jun 02 23:27:00 CST 2018]; root of context hierarchy
2018-06-02 23:27:25.881  INFO 13708 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity<java.util.Map<java.lang.String, java.lang.Object>> org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2018-06-02 23:27:25.884  INFO 13708 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=[text/html]}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
2018-06-02 23:27:25.989  INFO 13708 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:25.989  INFO 13708 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:26.130  INFO 13708 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2018-06-02 23:27:27.489  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/logfile || /logfile.json],methods=[GET || HEAD]}" onto public void org.springframework.boot.actuate.endpoint.mvc.LogFileMvcEndpoint.invoke(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws javax.servlet.ServletException,java.io.IOException
2018-06-02 23:27:27.498  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/mappings || /mappings.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.500  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/trace || /trace.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.504  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health || /health.json],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.HealthMvcEndpoint.invoke(java.security.Principal)
2018-06-02 23:27:27.506  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/autoconfig || /autoconfig.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.511  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/sofaboot/versions || /sofaboot/versions.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.infra.endpoint.SofaBootVersionEndpointMvcAdapter.invoke()
2018-06-02 23:27:27.517  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/info || /info.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.519  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/health/readiness || /health/readiness.json],produces=[application/json]}" onto public java.lang.Object com.alipay.sofa.healthcheck.service.SofaBootReadinessCheckMvcEndpoint.invoke(java.security.Principal)
2018-06-02 23:27:27.529  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.MetricsMvcEndpoint.value(java.lang.String)
2018-06-02 23:27:27.530  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/metrics || /metrics.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.533  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/heapdump || /heapdump.json],methods=[GET],produces=[application/octet-stream]}" onto public void org.springframework.boot.actuate.endpoint.mvc.HeapdumpMvcEndpoint.invoke(boolean,javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws java.io.IOException,javax.servlet.ServletException
2018-06-02 23:27:27.535  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/beans || /beans.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.540  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/dump || /dump.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.549  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env/{name:.*}],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EnvironmentMvcEndpoint.value(java.lang.String)
2018-06-02 23:27:27.549  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/env || /env.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:27.552  INFO 13708 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped "{[/configprops || /configprops.json],methods=[GET],produces=[application/json]}" onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()
2018-06-02 23:27:28.092  INFO 13708 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-06-02 23:27:28.124  INFO 13708 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
2018-06-02 23:27:29.278  INFO 13708 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8081 (http)
2018-06-02 23:27:29.287  INFO 13708 --- [           main] c.a.s.r.s.g.GenericClientApplication     : Started GenericClientApplication in 32.494 seconds (JVM running for 34.704)
com.alipay.sofa.rpc.samples.generic.SampleGenericResultModel
Bible
sample generic value
invoke result:sample generic value
generic invoke success

```

SOFARPCæ³›åŒ–è°ƒç”¨æµç¨‹ï¼š
 (1)åˆ›å»ºæœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigï¼Œè®¾ç½®ConsumerConfigå®ä¾‹åº”ç”¨ä¿¡æ¯é…ç½®ã€æ¥å£åç§°ã€ç›´è¿è°ƒç”¨åœ°å€ä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé€šè¿‡setGenericè®¾ç½®æœåŠ¡å¼•ç”¨æ˜¯å¦æ³›åŒ–è°ƒç”¨ä¸ºtrueï¼š

```Java
/**
 * æ˜¯å¦æ³›åŒ–è°ƒç”¨
 */
protected boolean generic;
/**
 * Sets generic.
 *
 * @param generic the generic
 * @return the generic
 */
public ConsumerConfig<T> setGeneric(boolean generic) {
    this.generic = generic;
    return this;
}

```

(2)æœåŠ¡å¼•ç”¨é…ç½®ç±»ConsumerConfigè°ƒç”¨å¼•ç”¨æœåŠ¡refer()æ–¹æ³•è·å–æ³›åŒ–è°ƒç”¨æ¥å£GenericServiceä»£ç†å¯¹è±¡å¼•ç”¨ï¼Œé€šè¿‡æ³›åŒ–æœåŠ¡GenericServiceä»£ç†å¯¹è±¡è°ƒç”¨$invoke/$genericInvoke()æ–¹æ³•å‘èµ·æœåŠ¡æ³›åŒ–è°ƒç”¨ï¼š

```Java
/**
 * æ³›åŒ–è°ƒç”¨çš„æ¥å£<br>
 *
 */
public interface GenericService {

    /**
     * æ³›åŒ–è°ƒç”¨
     *
     * @param methodName è°ƒç”¨æ–¹æ³•å
     * @param argTypes   å‚æ•°ç±»å‹
     * @param args       æ–¹æ³•å‚æ•°ï¼Œå‚æ•°ä¸èƒ½æ˜¯GenericObjectç±»å‹
     * @return æ­£å¸¸ç±»å‹ï¼ˆä¸èƒ½æ˜¯GenericObjectç±»å‹ï¼‰
     */
    Object $invoke(String methodName, String[] argTypes, Object[] args);

    /**
     * æ”¯æŒå‚æ•°ç±»å‹æ— æ³•åœ¨ç±»åŠ è½½å™¨åŠ è½½æƒ…å†µçš„æ³›åŒ–è°ƒç”¨
     *
     * @param methodName è°ƒç”¨æ–¹æ³•å
     * @param argTypes   å‚æ•°ç±»å‹
     * @param args       æ–¹æ³•å‚æ•°,å‚æ•°ç±»å‹æ”¯æŒGenericObject
     * @return é™¤äº†JDKç­‰å†…ç½®ç±»å‹ï¼Œå…¶å®ƒå¯¹è±¡æ˜¯GenericObjectç±»å‹
     */
    Object $genericInvoke(String methodName, String[] argTypes, Object[] args);

    /**
     * æ”¯æŒå‚æ•°ç±»å‹æ— æ³•åœ¨ç±»åŠ è½½å™¨åŠ è½½æƒ…å†µçš„æ³›åŒ–è°ƒç”¨
     *
     * @param methodName è°ƒç”¨æ–¹æ³•å
     * @param argTypes   å‚æ•°ç±»å‹
     * @param args       æ–¹æ³•å‚æ•°,å‚æ•°ç±»å‹æ”¯æŒGenericObject
     * @param clazz      è¿”å›ç±»å‹
     * @return è¿”å›æŒ‡å®šçš„Tç±»å‹è¿”å›å¯¹è±¡
     */
    <T> T $genericInvoke(String methodName, String[] argTypes, Object[] args, Class<T> clazz);

    /**
     * æ”¯æŒå‚æ•°ç±»å‹æ— æ³•åœ¨ç±»åŠ è½½å™¨åŠ è½½æƒ…å†µçš„æ³›åŒ–è°ƒç”¨
     *
     * @param methodName è°ƒç”¨æ–¹æ³•å
     * @param argTypes   å‚æ•°ç±»å‹
     * @param args       æ–¹æ³•å‚æ•°,å‚æ•°ç±»å‹æ”¯æŒGenericObject
     * @param context    ä¸Šä¸‹æ–‡ï¼Œä¼ é€’è¶…æ—¶ä»¥åŠLDCç›¸å…³ä¿¡æ¯
     * @return é™¤äº†JDKç­‰å†…ç½®ç±»å‹ï¼Œå…¶å®ƒå¯¹è±¡æ˜¯GenericObjectç±»å‹
     * @deprecated Use RpcInvokeContext instead of GenericContext
     */
    @Deprecated
    Object $genericInvoke(String methodName, String[] argTypes, Object[] args, GenericContext context);

    /**
     * æ”¯æŒå‚æ•°ç±»å‹æ— æ³•åœ¨ç±»åŠ è½½å™¨åŠ è½½æƒ…å†µçš„æ³›åŒ–è°ƒç”¨
     *
     * @param methodName è°ƒç”¨æ–¹æ³•å
     * @param argTypes   å‚æ•°ç±»å‹
     * @param args       æ–¹æ³•å‚æ•°,å‚æ•°ç±»å‹æ”¯æŒGenericObject
     * @param clazz      è¿”å›ç±»å‹
     * @param context    GenericContext
     * @return è¿”å›æŒ‡å®šçš„Tç±»å‹è¿”å›å¯¹è±¡
     * @deprecated Use RpcInvokeContext instead of GenericContext
     */
    @Deprecated
    <T> T $genericInvoke(String methodName, String[] argTypes, Object[] args, Class<T> clazz, GenericContext context);
}

```

æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨ç±»ConsumerBootstrapå¼•ç”¨æœåŠ¡å®¢æˆ·ç«¯é›†ç¾¤Clusteræ„é€ è°ƒç”¨ç«¯çš„æ‰§è¡Œé“¾åŠ è½½å®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨å¤„ç†è¿‡æ»¤å™¨ConsumerGenericFilterï¼Œè¿‡æ»¤å™¨ConsumerGenericFilterè°ƒç”¨needToLoad()æ–¹æ³•æ ¹æ®åŒ…è£…è°ƒç”¨å™¨æœåŠ¡å¼•ç”¨æ˜¯å¦æ³›åŒ–è°ƒç”¨é…ç½®åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨åŠ è½½æ·»åŠ åˆ°æ‰§è¡Œé“¾è¿‡æ»¤å™¨åˆ—è¡¨ï¼š

```Java
/**
 * æ„é€ æ‰§è¡Œé“¾
 *
 * @param filters     åŒ…è£…è¿‡æ»¤å™¨åˆ—è¡¨
 * @param lastInvoker æœ€ç»ˆè¿‡æ»¤å™¨
 * @param config      æ¥å£é…ç½®
 */
protected FilterChain(List<Filter> filters, FilterInvoker lastInvoker, AbstractInterfaceConfig config) {
    // è°ƒç”¨è¿‡ç¨‹å¤–é¢åŒ…è£…å¤šå±‚è‡ªå®šä¹‰filter
    // å‰é¢çš„è¿‡æ»¤å™¨åœ¨æœ€å¤–å±‚
    invokerChain = lastInvoker;
    if (CommonUtils.isNotEmpty(filters)) {
        loadedFilters = new ArrayList<Filter>();
        for (int i = filters.size() - 1; i >= 0; i--) {
            try {
                Filter filter = filters.get(i);
                if (filter.needToLoad(invokerChain)) {
                    invokerChain = new FilterInvoker(filter, invokerChain, config);
                    // cache this for filter when async respond
                    loadedFilters.add(filter);
                }
            } catch (Exception e) {
                LOGGER.error("Error when build filter chain", e);
                throw new SofaRpcRuntimeException("Error when build filter chain", e);
            }
        }
    }
}
/**
 * æ˜¯å¦è‡ªåŠ¨åŠ è½½
 *
 * @param invoker è°ƒç”¨å™¨
 * @return æ˜¯å¦åŠ è½½æœ¬è¿‡æ»¤å™¨
 */
public boolean needToLoad(FilterInvoker invoker) {
    ConsumerConfig consumerConfig = (ConsumerConfig) invoker.getConfig();
    return consumerConfig.isGeneric();
}

```

ä»£ç†è°ƒç”¨å™¨FilterInvokeræœåŠ¡è°ƒç”¨invoke()æ–¹æ³•åŠ è½½å®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨å¤„ç†è¿‡æ»¤å™¨ConsumerGenericFilter(ä¼˜å…ˆçº§æ’åºorder=-18000ï¼Œä¼˜å…ˆçº§ä½)çš„invoke()æ–¹æ³•ä½¿ç”¨getSerializeFactoryType()æ–¹æ³•åˆ¤æ–­æ–¹æ³•åæ˜¯å¦ä¸º$invoke/$genericInvokeè·å–åºåˆ—åŒ–å·¥å‚ç±»å‹å³æ™®é€šåºåˆ—åŒ–(åºåˆ—åŒ–ååºåˆ—åŒ–å‡ä½¿ç”¨SofaSerializerFactory)/æ³›å‹åºåˆ—åŒ–(åºåˆ—åŒ–ååºåˆ—åŒ–å‡ä½¿ç”¨SofaGenericSerializerFactory)æ·»åŠ åˆ°è¯·æ±‚é¢å¤–å±æ€§ï¼Œæ ¹æ®è°ƒç”¨æ–¹æ³•åã€å‚æ•°ç±»å‹ä»¥åŠæ–¹æ³•å‚æ•°ä¿®æ­£è¯·æ±‚å¯¹è±¡ï¼Œæ ¹æ®è°ƒç”¨å™¨æœåŠ¡å¼•ç”¨é…ç½®è·å–æ–¹æ³•è°ƒç”¨ç±»å‹ä¿®æ­£è¯·æ±‚è°ƒç”¨ç±»å‹ï¼Œè°ƒç”¨å™¨æŒ‰ç…§è¯·æ±‚å¯¹è±¡è®¾ç½®æ‰§è¡ŒæœåŠ¡è°ƒç”¨ï¼š

```Java
/**
 * å®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨å¤„ç†filter
 */
@Extension(value = "consumerGeneric", order = -18000)
@AutoActive(consumerSide = true)
public class ConsumerGenericFilter extends Filter {

    /**
     * æ–¹æ³•å $invoke
     */
    private static final String METHOD_INVOKE         = "$invoke";
    /**
     * æ–¹æ³•å $genericInvoke
     */
    private static final String METHOD_GENERIC_INVOKE = "$genericInvoke";

    public SofaResponse invoke(FilterInvoker invoker, SofaRequest request) throws SofaRpcException {
        try {
            String type = getSerializeFactoryType(request.getMethodName(), request.getMethodArgs());
            request.addRequestProp(RemotingConstants.HEAD_GENERIC_TYPE, type);

            // ä¿®æ­£è¯·æ±‚å¯¹è±¡
            Object[] genericArgs = request.getMethodArgs();
            String methodName = (String) genericArgs[0];
            String[] argTypes = (String[]) genericArgs[1];
            Object[] args = (Object[]) genericArgs[2];

            request.setMethodName(methodName);
            request.setMethodArgSigs(argTypes);
            request.setMethodArgs(args);

            // ä¿®æ­£ç±»å‹
            ConsumerConfig consumerConfig = (ConsumerConfig) invoker.getConfig();
            String invokeType = consumerConfig.getMethodInvokeType(methodName);
            request.setInvokeType(invokeType);
            request.addRequestProp(RemotingConstants.HEAD_INVOKE_TYPE, invokeType);

            return invoker.invoke(request);
        } catch (SofaRpcException e) {
            throw e;
        } catch (Exception e) {
            throw new SofaRpcException(RpcErrorType.CLIENT_FILTER, e.getMessage(), e);
        }
    }

    private String getSerializeFactoryType(String method, Object[] args) throws SofaRpcException {
        if (METHOD_INVOKE.equals(method)) {
            // æ–¹æ³•åä¸º $invoke
            return RemotingConstants.SERIALIZE_FACTORY_NORMAL;
        } else if (METHOD_GENERIC_INVOKE.equals(method)) {
            if (args.length == 3) {
                // æ–¹æ³•åä¸º$genericInvoke,ä¸”é•¿åº¦ä¸º3
                return RemotingConstants.SERIALIZE_FACTORY_GENERIC;
            } else if (args.length == 4) {
                // æ–¹æ³•åä¸º$genericInvoke,ä¸”é•¿åº¦ä¸º4
                if (args[3] instanceof GenericContext) {
                    return RemotingConstants.SERIALIZE_FACTORY_GENERIC;
                }
                // ç¬¬å››ä¸ªå‚æ•°æ˜¯ç±»å‹å®šä¹‰
                if (args[3] instanceof Class) {
                    return RemotingConstants.SERIALIZE_FACTORY_MIX;
                }
            } else if (args.length == 5) {
                // æ–¹æ³•åä¸º$genericInvoke,ä¸”é•¿åº¦ä¸º5
                return RemotingConstants.SERIALIZE_FACTORY_MIX;
            }
        }
        throw new SofaRpcException(RpcErrorType.CLIENT_FILTER, "Unsupported method of generic service");
    }
}

```

æ¶ˆè´¹è€…è°ƒç”¨å™¨ConsumerInvokerè°ƒç”¨invoke()æ–¹æ³•ä½¿ç”¨Clientå‘é€æ•°æ®ç»™Serveræ‰§è¡ŒåŒæ­¥/å•å‘/Callback/FutureæœåŠ¡è°ƒç”¨è¿‡ç¨‹ï¼ŒBoltå®¢æˆ·ç«¯é•¿è¿æ¥BoltClientTransportåˆ›å»ºè°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextæ ¹æ®è¯·æ±‚æ³›åŒ–è°ƒç”¨å±æ€§è®¾ç½®è°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯å¦æ³›åŒ–è°ƒç”¨ï¼š

```Java
protected InvokeContext createInvokeContext(SofaRequest request) {
    InvokeContext invokeContext = new InvokeContext();
    invokeContext.put(InvokeContext.BOLT_CUSTOM_SERIALIZER, request.getSerializeType());
    invokeContext.put(RemotingConstants.HEAD_TARGET_SERVICE, request.getTargetServiceUniqueName());
    invokeContext.put(RemotingConstants.HEAD_METHOD_NAME, request.getMethodName());
    String genericType = (String) request.getRequestProp(RemotingConstants.HEAD_GENERIC_TYPE);
    if (genericType != null) {
        invokeContext.put(RemotingConstants.HEAD_GENERIC_TYPE, genericType);
    }
    return invokeContext;
}

```

Sofa RPC Boltåè®®çš„å¯¹è±¡åºåˆ—åŒ–/ååºåˆ—åŒ–SofaRpcSerializationåºåˆ—åŒ–/ååºåˆ—åŒ–SofaRequestè¯·æ±‚/SofaResponseå“åº”å†…å®¹è·å–è°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextæ˜¯å¦æ³›åŒ–è°ƒç”¨é…ç½®ï¼Œåºåˆ—åŒ–/ååºåˆ—åŒ–å™¨SofaHessianSerializerç¼–ç /è§£ç SofaRequestè¯·æ±‚/SofaResponseå“åº”æ ¹æ®SerializeTypeæ³›åŒ–è°ƒç”¨ä¿¡æ¯é‡‡ç”¨SofaHessianSerializerå®ä¾‹æ„é€ æ–¹æ³•åˆå§‹åŒ–çš„æ³›åŒ–åºåˆ—åŒ–/ååºåˆ—åŒ–å·¥å‚GenericMultipleClassLoaderSofaSerializerFactory/GenericSingleClassLoaderSofaSerializerFactoryè®¾ç½®Hessian2Output/Hessian2Inputåºåˆ—åŒ–å·¥å‚ï¼ŒHessian2Output/Hessian2Inputæ ¹æ®åºåˆ—åŒ–å·¥å‚è·å–åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨ç¼–ç /è§£ç SofaRequestè¯·æ±‚/SofaResponseå“åº”ï¼š

```
public <Request extends RequestCommand> boolean serializeContent(Request request, InvokeContext invokeContext)
    throws SerializationException {
    if (request instanceof RpcRequestCommand) {
        RpcRequestCommand requestCommand = (RpcRequestCommand) request;
        Object requestObject = requestCommand.getRequestObject();
        if (requestObject instanceof SofaRequest) {
            byte serializerCode = requestCommand.getSerializer();
            try {
                Map<String, String> header = (Map<String, String>) requestCommand.getRequestHeader();
                if (header == null) {
                    header = new HashMap<String, String>();
                }
                putKV(header, RemotingConstants.HEAD_GENERIC_TYPE,
                    (String) invokeContext.get(RemotingConstants.HEAD_GENERIC_TYPE));

                Serializer rpcSerializer = com.alipay.sofa.rpc.codec.SerializerFactory
                    .getSerializer(serializerCode);
                AbstractByteBuf byteBuf = rpcSerializer.encode(requestObject, header);
                request.setContent(byteBuf.array());
                return true;
            } catch (Exception ex) {
                throw new SerializationException(ex.getMessage(), ex);
            } finally {
                recordSerializeRequest(requestCommand, invokeContext);
            }
        }
        return true;
    }
    return false;
}
public <Request extends RequestCommand> boolean deserializeContent(Request request)
    throws DeserializationException {
    if (request instanceof RpcRequestCommand) {
        RpcRequestCommand requestCommand = (RpcRequestCommand) request;
        Object header = requestCommand.getRequestHeader();
        if (!(header instanceof Map)) {
            throw new DeserializationException("Head of request is null or is not map");
        }
        Map<String, String> headerMap = (Map<String, String>) header;
        byte[] content = requestCommand.getContent();
        if (content == null || content.length == 0) {
            throw new DeserializationException("Content of request is null");
        }
        try {
            String service = headerMap.get(RemotingConstants.HEAD_SERVICE);
            ClassLoader oldClassLoader = Thread.currentThread().getContextClassLoader();

            ClassLoader serviceClassLoader = ReflectCache.getServiceClassLoader(service);
            try {
                Thread.currentThread().setContextClassLoader(serviceClassLoader);

                Serializer rpcSerializer = com.alipay.sofa.rpc.codec.SerializerFactory
                    .getSerializer(requestCommand.getSerializer());
                SofaRequest sofaRequest = new SofaRequest();
                rpcSerializer.decode(new ByteArrayWrapperByteBuf(requestCommand.getContent()),
                    sofaRequest, headerMap);
                requestCommand.setRequestObject(sofaRequest);
            } finally {
                Thread.currentThread().setContextClassLoader(oldClassLoader);
            }

            return true;
        } catch (Exception ex) {
            throw new DeserializationException(ex.getMessage(), ex);
        } finally {
            recordDeserializeRequest(requestCommand);
        }
    }
    return false;
}
/**
 * Generic Serializer Factory
 */
protected SerializerFactory genericSerializerFactory;
/**
 * Instantiates a new Sofa hessian serializer.
 */
public SofaHessianSerializer() {
    boolean enableMultipleClassLoader = RpcConfigs.getBooleanValue(RpcOptions.MULTIPLE_CLASSLOADER_ENABLE);
    serializerFactory = getSerializerFactory(enableMultipleClassLoader, false);
    genericSerializerFactory = getSerializerFactory(enableMultipleClassLoader, true);
    if (RpcConfigs.getBooleanValue(RpcOptions.SERIALIZE_BLACKLIST_ENABLE) &&
        SofaConfigs.getBooleanValue(SofaOptions.CONFIG_SERIALIZE_BLACKLIST, true)) {
        ClassNameResolver resolver = new ClassNameResolver();
        resolver.addFilter(new NameBlackListFilter(BlackListFileLoader.SOFA_SERIALIZE_BLACK_LIST, 8192));
        serializerFactory.setClassNameResolver(resolver);
        genericSerializerFactory.setClassNameResolver(resolver);
    }
}
/**
 * Gets serializer factory.
 *
 * @param multipleClassLoader the multiple class loader
 * @param generic             the generic
 * @return the serializer factory
 */
protected SerializerFactory getSerializerFactory(boolean multipleClassLoader, boolean generic) {
    if (generic) {
        return multipleClassLoader ? new GenericMultipleClassLoaderSofaSerializerFactory() :
            new GenericSingleClassLoaderSofaSerializerFactory();
    } else {
        return multipleClassLoader ? new MultipleClassLoaderSofaSerializerFactory() :
            new SingleClassLoaderSofaSerializerFactory();
    }
}
/**
 * Do encode SofaRequest
 *
 * @param sofaRequest è¯·æ±‚
 * @param context     ä¸Šä¸‹æ–‡
 * @return byteæ•°æ® abstract byte buf
 */
protected AbstractByteBuf encodeSofaRequest(SofaRequest sofaRequest, Map<String, String> context) {
    try {
        UnsafeByteArrayOutputStream outputStream = new UnsafeByteArrayOutputStream();
        Hessian2Output output = new Hessian2Output(outputStream);

        // æ ¹æ®SerializeTypeä¿¡æ¯å†³å®šåºåˆ—åŒ–å™¨
        boolean genericSerialize = context != null &&
            isGenericRequest(context.get(RemotingConstants.HEAD_GENERIC_TYPE));
        if (genericSerialize) {
            output.setSerializerFactory(genericSerializerFactory);
        } else {
            output.setSerializerFactory(serializerFactory);
        }

        output.writeObject(sofaRequest);
        final Object[] args = sofaRequest.getMethodArgs();
        if (args != null) {
            for (Object arg : args) {
                output.writeObject(arg);
            }
        }
        output.close();

        return new ByteStreamWrapperByteBuf(outputStream);
    } catch (IOException e) {
        throw buildSerializeError(e.getMessage(), e);
    }
}
/**
 * Do decode SofaResponse
 *
 * @param data    AbstractByteBuf
 * @param context ä¸Šä¸‹æ–‡
 * @return å“åº” sofa response
 * @throws SofaRpcException åºåˆ—åŒ–å‡ºç°å¼‚å¸¸
 */
protected SofaResponse decodeSofaResponse(AbstractByteBuf data, Map<String, String> context)
    throws SofaRpcException {
    try {
        UnsafeByteArrayInputStream inputStream = new UnsafeByteArrayInputStream(data.array());
        Hessian2Input input = new Hessian2Input(inputStream);
        // æ ¹æ®SerializeTypeä¿¡æ¯å†³å®šåºåˆ—åŒ–å™¨
        Object object;
        boolean genericSerialize = context != null && isGenericResponse(
            context.get(RemotingConstants.HEAD_GENERIC_TYPE));
        if (genericSerialize) {
            input.setSerializerFactory(genericSerializerFactory);
            GenericObject genericObject = (GenericObject) input.readObject();
            SofaResponse sofaResponse = new SofaResponse();
            sofaResponse.setErrorMsg((String) genericObject.getField("errorMsg"));
            sofaResponse.setAppResponse(genericObject.getField("appResponse"));
            sofaResponse.setResponseProps((Map<String, String>) genericObject.getField("responseProps"));
            object = sofaResponse;
        } else {
            input.setSerializerFactory(serializerFactory);
            object = input.readObject();
        }
        input.close();
        return (SofaResponse) object;
    } catch (IOException e) {
        throw buildDeserializeError(e.getMessage(), e);
    }
}

```

**è§£ææ€»ç»“**
 SOFARPCåŒæ­¥/å¼‚æ­¥/å›è°ƒ/å•å‘è°ƒç”¨é€šè¿‡setInvokeTypeè®¾ç½®æœåŠ¡å¼•ç”¨è°ƒç”¨ç±»å‹(é»˜è®¤ä¸ºåŒæ­¥è°ƒç”¨)ï¼ŒæœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigè°ƒç”¨refer()æ–¹æ³•å¼•ç”¨æœåŠ¡ä½¿ç”¨Clientå‘é€æ•°æ®ç»™Serveræ‰§è¡Œå®¢æˆ·ç«¯é›†ç¾¤Clusterçš„doSendMsg()æ–¹æ³•æŒ‰ç…§è°ƒç”¨ç±»å‹é‡‡å–æŒ‡å®šè°ƒç”¨æ–¹å¼ï¼Œå®¢æˆ·ç«¯ä¼ è¾“ClientTransportè°ƒç”¨syncSend/asyncSend/oneWaySendæ–¹æ³•æŒ‡å®šè¶…æ—¶èŒƒç•´æŒ‰ç…§é…ç½®è°ƒç”¨ç±»å‹å‘é€è¯·æ±‚ï¼ŒBoltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransport doInvokeAsyncå›è°ƒè°ƒç”¨åˆ¤æ–­ç”¨æˆ·å±‚è°ƒç”¨çº§åˆ«æœåŠ¡å›è°ƒç›‘å¬å™¨æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºè°ƒç”¨/æ–¹æ³•çº§åˆ«Callbackè°ƒç”¨æ–¹å¼è®¾ç½®æä¾›æœåŠ¡å›è°ƒç›‘å¬å™¨ï¼Œæ ¹æ®å®¢æˆ·ç«¯æœåŠ¡å‘å¸ƒé…ç½®ã€æœåŠ¡å¼•ç”¨é…ç½®ã€æœåŠ¡å›è°ƒç›‘å¬å™¨SofaResponseCallbackã€SofaRequstè¯·æ±‚ã€ä¸Šä¸‹æ–‡ä¼ é€’RpcInternalContextä»¥åŠå½“å‰ç±»åŠ è½½å™¨æ„å»ºCallbackæ¨¡å¼è°ƒç”¨åŒ…è£…BoltFutureInvokeCallback/BoltInvokerCallbackã€‚Boltå®¢æˆ·ç«¯ä¼ è¾“BoltClientTransporté€šè¿‡RpcClientè°ƒç”¨RPCè¿œç¨‹è¿æ¥RpcRemotingçš„invokeSync/invokeWithCallback/onewayæ–¹æ³•æ ¹æ®è°ƒç”¨è¯·æ±‚URLè·å–æ£€æŸ¥è¿œç¨‹è¿æ¥ï¼Œä½¿ç”¨ç®¡é“Channelçš„writeAndFlush(Object msg)æ–¹æ³•å¼‚æ­¥å‘é€å®¢æˆ·ç«¯æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æ·»åŠ ç›‘å¬å™¨æä¾›æ“ä½œå®Œæˆå‘é€å¤±è´¥å¼‚å¸¸åœºæ™¯ç›‘å¬ã€‚
 SOFARPCæ³›åŒ–è°ƒç”¨é€šè¿‡setGenericè®¾ç½®æœåŠ¡å¼•ç”¨é…ç½®æ˜¯å¦æ³›åŒ–è°ƒç”¨ä¸ºtrueï¼ŒæœåŠ¡å¼•ç”¨é…ç½®ConsumerConfigå¼•ç”¨æœåŠ¡è·å–æ³›åŒ–è°ƒç”¨æ¥å£GenericServiceä»£ç†å¯¹è±¡ï¼Œé€šè¿‡æ³›åŒ–æœåŠ¡GenericServiceä»£ç†å‘èµ·æœåŠ¡æ³›åŒ–è°ƒç”¨ï¼Œå®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨å¤„ç†è¿‡æ»¤å™¨ConsumerGenericFilteråˆ¤æ–­æ˜¯å¦è‡ªåŠ¨åŠ è½½æ·»åŠ åˆ°æ‰§è¡Œé“¾è¿‡æ»¤å™¨ï¼Œä»£ç†è°ƒç”¨å™¨FilterInvokeræœåŠ¡è°ƒç”¨åŠ è½½å®¢æˆ·ç«¯æ³›åŒ–è°ƒç”¨å¤„ç†è¿‡æ»¤å™¨è·å–åºåˆ—åŒ–å·¥å‚ç±»å‹æ·»åŠ åˆ°è¯·æ±‚é¢å¤–å±æ€§ï¼ŒBolté•¿è¿æ¥BoltClientTransportè®¾ç½®è°ƒç”¨ä¸Šä¸‹æ–‡InvokeContextæ˜¯å¦æ³›åŒ–è°ƒç”¨ï¼ŒSofaRpcSerializationåºåˆ—åŒ–/ååºåˆ—åŒ–é€šè¿‡åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨SofaHessianSerializeré‡‡ç”¨GenericMultipleClassLoaderSofaSerializerFactory/GenericSingleClassLoaderSofaSerializerFactoryè·å–æ³›åŒ–åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨ç¼–ç /è§£ç è¯·æ±‚/å“åº”å†…å®¹ï¼Œé€šè¿‡GenericObjectæŒæœ‰Map<String, Object>ç±»å‹fieldså˜é‡æè¿°å‚æ•°ï¼Œä½¿ç”¨getFieldæ–¹æ³•è·å–ç»“æœç±»çš„å±æ€§å€¼ï¼Œä½¿ç”¨getTypeæ–¹æ³•è·å–ç»“æœç±»çš„å…¨ç±»åã€‚

