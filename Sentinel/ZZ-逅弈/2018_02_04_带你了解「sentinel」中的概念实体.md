title: å¸¦ä½ äº†è§£ã€Œsentinelã€ä¸­çš„æ¦‚å¿µå®ä½“
date: 2018-02-04
tags:
categories: Sentinel
permalink: Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel
author:  é€…å¼ˆ
from_url: https://www.jianshu.com/p/4a19f675ef5f
wechat_url:

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.jianshu.com/p/4a19f675ef5f ã€Œé€…å¼ˆã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [Resource](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)
- [Slot](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)
- [Context](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)
- [Entry](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)
- [Node](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)
- [Metric](http://www.iocoder.cn/Sentinel/houyi/Learn-about-the-concept-entities-in-the-sentinel/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

sentinelä¸­æœ‰å¾ˆå¤šæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¦äº†è§£ä¸€ä¸ªæ¡†æ¶ï¼Œé¦–å…ˆè¦å¯¹æ¡†æ¶ä¸­é‡è¦çš„æ¦‚å¿µå®ä½“è¿›è¡Œåˆ†æï¼Œæœ¬æ–‡æˆ‘å°†è·Ÿå¤§å®¶ä¸€èµ·æ¥åˆ†æä¸€ä¸‹sentinelä¸­éå¸¸é‡è¦çš„å‡ ä¸ªæ¦‚å¿µã€‚

# Resource

resourceæ˜¯sentinelä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œsentinelé€šè¿‡èµ„æºæ¥ä¿æŠ¤å…·ä½“çš„ä¸šåŠ¡ä»£ç æˆ–å…¶ä»–åæ–¹æœåŠ¡ã€‚sentinelæŠŠå¤æ‚çš„é€»è¾‘ç»™å±è”½æ‰äº†ï¼Œç”¨æˆ·åªéœ€è¦ä¸ºå—ä¿æŠ¤çš„ä»£ç æˆ–æœåŠ¡å®šä¹‰ä¸€ä¸ªèµ„æºï¼Œç„¶åå®šä¹‰è§„åˆ™å°±å¯ä»¥äº†ï¼Œå‰©ä¸‹çš„é€šé€šäº¤ç»™sentinelæ¥å¤„ç†äº†ã€‚å¹¶ä¸”èµ„æºå’Œè§„åˆ™æ˜¯è§£è€¦çš„ï¼Œè§„åˆ™ç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹ã€‚å®šä¹‰å®Œèµ„æºåï¼Œå°±å¯ä»¥é€šè¿‡åœ¨ç¨‹åºä¸­åŸ‹ç‚¹æ¥ä¿æŠ¤ä½ è‡ªå·±çš„æœåŠ¡äº†ï¼ŒåŸ‹ç‚¹çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š

- try-catch æ–¹å¼ï¼ˆé€šè¿‡ `SphU.entry(...)`ï¼‰ï¼Œå½“ catch åˆ°BlockExceptionæ—¶æ‰§è¡Œå¼‚å¸¸å¤„ç†(æˆ–fallback)
- if-else æ–¹å¼ï¼ˆé€šè¿‡ `SphO.entry(...)`ï¼‰ï¼Œå½“è¿”å› false æ—¶æ‰§è¡Œå¼‚å¸¸å¤„ç†(æˆ–fallback)

ä»¥ä¸Šè¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯é€šè¿‡ç¡¬ç¼–ç çš„å½¢å¼å®šä¹‰èµ„æºç„¶åè¿›è¡Œèµ„æºåŸ‹ç‚¹çš„ï¼Œå¯¹ä¸šåŠ¡ä»£ç çš„ä¾µå…¥å¤ªå¤§ï¼Œä»0.1.1ç‰ˆæœ¬å¼€å§‹ï¼ŒsentinelåŠ å…¥äº†æ³¨è§£çš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ¥å®šä¹‰èµ„æºï¼Œå…·ä½“çš„æ³¨è§£ä¸ºï¼š`SentinelResource` ã€‚é€šè¿‡æ³¨è§£é™¤äº†å¯ä»¥å®šä¹‰èµ„æºå¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®š `blockHandler` å’Œ `fallback` æ–¹æ³•ã€‚

åœ¨sentinelä¸­å…·ä½“è¡¨ç¤ºèµ„æºçš„ç±»æ˜¯ï¼š`ResourceWrapper` ï¼Œä»–æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åŒ…è£…ç±»ï¼ŒåŒ…è£…äº†èµ„æºçš„ **Name** å’Œ**EntryType**ã€‚ä»–æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š`StringResourceWrapper` å’Œ `MethodResourceWrapper`

é¡¾åæ€ä¹‰ï¼Œ`StringResourceWrapper` æ˜¯é€šè¿‡å¯¹ä¸€ä¸²å­—ç¬¦ä¸²è¿›è¡ŒåŒ…è£…ï¼Œæ˜¯ä¸€ä¸ªé€šç”¨çš„èµ„æºåŒ…è£…ç±»ï¼Œ`MethodResourceWrapper` æ˜¯å¯¹æ–¹æ³•è°ƒç”¨çš„åŒ…è£…ã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-82808173410b5a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/996/format/jpeg)

resource.png

# Slot

slotæ˜¯å¦ä¸€ä¸ªsentinelä¸­éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œsentinelçš„å·¥ä½œæµç¨‹å°±æ˜¯å›´ç»•ç€ä¸€ä¸ªä¸ªæ’æ§½æ‰€ç»„æˆçš„æ’æ§½é“¾æ¥å±•å¼€çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªæ’æ§½éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼Œä»–ä»¬å„å¸å…¶èŒå®Œå¥½çš„é…åˆï¼Œé€šè¿‡ä¸€å®šçš„ç¼–æ’é¡ºåºï¼Œæ¥è¾¾åˆ°æœ€ç»ˆçš„é™æµé™çº§çš„ç›®çš„ã€‚é»˜è®¤çš„å„ä¸ªæ’æ§½ä¹‹é—´çš„é¡ºåºæ˜¯å›ºå®šçš„ï¼Œå› ä¸ºæœ‰çš„æ’æ§½éœ€è¦ä¾èµ–å…¶ä»–çš„æ’æ§½è®¡ç®—å‡ºæ¥çš„ç»“æœæ‰èƒ½è¿›è¡Œå·¥ä½œã€‚

ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬åªèƒ½æŒ‰ç…§æ¡†æ¶çš„å®šä¹‰æ¥ï¼Œsentinel é€šè¿‡ `SlotChainBuilder` ä½œä¸º SPI æ¥å£ï¼Œä½¿å¾— Slot Chain å…·å¤‡äº†æ‰©å±•çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° `SlotsChainBuilder` æ¥å£åŠ å…¥è‡ªå®šä¹‰çš„ slot å¹¶è‡ªå®šä¹‰ç¼–æ’å„ä¸ª slot ä¹‹é—´çš„é¡ºåºï¼Œä»è€Œå¯ä»¥ç»™ sentinel æ·»åŠ è‡ªå®šä¹‰çš„åŠŸèƒ½ã€‚

é‚£SlotChainæ˜¯åœ¨å“ªåˆ›å»ºçš„å‘¢ï¼Ÿæ˜¯åœ¨ `CtSph.lookProcessChain()` æ–¹æ³•ä¸­åˆ›å»ºçš„ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä¼šæ ¹æ®å½“å‰è¯·æ±‚çš„èµ„æºå…ˆå»ä¸€ä¸ªé™æ€çš„HashMapä¸­è·å–ï¼Œå¦‚æœè·å–ä¸åˆ°æ‰ä¼šåˆ›å»ºï¼Œåˆ›å»ºåä¼šä¿å­˜åˆ°HashMapä¸­ã€‚è¿™å°±æ„å‘³ç€ï¼ŒåŒä¸€ä¸ªèµ„æºä¼šå…¨å±€å…±äº«ä¸€ä¸ªSlotChain



![img](https:////upload-images.jianshu.io/upload_images/5417792-42bbbac532927898.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/jpeg)

slot-chain.png

# Context

contextä¸Šä¸‹æ–‡æ˜¯sentinelä¸­ä¸€ä¸ªæ¯”è¾ƒéš¾æ‡‚çš„æ¦‚å¿µã€‚æºç ä¸­æ˜¯è¿™æ ·æè¿°contextç±»çš„ï¼š

> This class holds metadata of current invocation

å°±æ˜¯è¯´åœ¨contextä¸­ç»´æŠ¤ç€å½“å‰è°ƒç”¨é“¾çš„å…ƒæ•°æ®ï¼Œé‚£å…ƒæ•°æ®æœ‰å“ªäº›å‘¢ï¼Œä»contextç±»çš„æºç ä¸­å¯ä»¥çœ‹åˆ°æœ‰ï¼š

- entranceNodeï¼šå½“å‰è°ƒç”¨é“¾çš„å…¥å£èŠ‚ç‚¹
- curEntryï¼šå½“å‰è°ƒç”¨é“¾çš„å½“å‰entry
- nodeï¼šä¸å½“å‰entryæ‰€å¯¹åº”çš„curNode
- originï¼šå½“å‰è°ƒç”¨é“¾çš„è°ƒç”¨æº



![img](https:////upload-images.jianshu.io/upload_images/5417792-c57a61d4a1c68e46.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/820/format/jpeg)

context.png

æ¯æ¬¡è°ƒç”¨ `SphU.entry()` æˆ– `SphO.entry()` éƒ½éœ€è¦åœ¨ä¸€ä¸ª context ä¸­æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å½“å‰æ‰§è¡Œæ—¶è¿˜æ²¡æœ‰ contextï¼Œé‚£ä¹ˆæ¡†æ¶ä¼šä½¿ç”¨é»˜è®¤çš„ contextï¼Œé»˜è®¤çš„ context æ˜¯é€šè¿‡ `MyContextUtil.myEnter()` åˆ›å»ºçš„ã€‚

é‚£å¦‚æœæˆ‘æƒ³è‡ªå·±åœ¨è°ƒç”¨  `SphU.entry()` æˆ– `SphO.entry()` å‰ï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªcontextè¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿé‚£å¯ä»¥é€šè¿‡è°ƒç”¨ `ContextUtil.enter()` æ–¹æ³•æ¥åˆ›å»ºã€‚

å¦å¤–contextæ˜¯ä¿å­˜åœ¨ThreadLocalä¸­çš„ï¼Œæ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¼šä¼˜å…ˆåˆ°ThreadLocalä¸­è·å–ã€‚å¦‚æœcontextä¸ºnullæ—¶æ‰ä¼šå†æ¬¡å»åˆ›å»ºä¸€ä¸ªcontextã€‚

é‚£ä»€ä¹ˆæ—¶å€™contextä¼šè¢«ç½®ä¸ºnullå¹¶ä»ThreadLocalä¸­æ¸…ç©ºå‘¢ï¼Ÿå½“Entryæ‰§è¡Œexitæ–¹æ³•æ—¶ï¼Œå½“å½“å‰entryçš„parentä¸ºnullæ—¶ï¼Œä¹Ÿå°±è¯´æ˜å½“å‰entryæ˜¯æœ€ä¸Šå±‚çš„èŠ‚ç‚¹äº†ï¼Œæ­¤æ—¶è¦æŠŠä¿å­˜åœ¨ThreadLocalä¸­çš„contextä¹Ÿæ¸…ç©ºæ‰ã€‚

**åœ¨NodeSelectorSlotç±»ä¸­æœ‰ä¸€ä¸ªMapä¿å­˜äº†DefaultNodeï¼Œä½†æ˜¯keyæ˜¯ç”¨çš„contextNameï¼Œè€Œä¸æ˜¯resourceNameï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ**

è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœç”¨resourceNameæ¥åšmapçš„keyï¼Œé‚£å¯¹äºåŒä¸€ä¸ªèµ„æºresourceAæ¥è¯´ï¼Œåœ¨context1ä¸­è·å–åˆ°çš„defaultNodeAå’Œåœ¨context2ä¸­è·å–åˆ°çš„defaultNodeAæ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆæ€ä¹ˆåœ¨è¿™ä¸¤ä¸ªcontextä¸­å¯¹defaultNodeAè¿›è¡Œæ›´æ”¹å‘¢ï¼Œä¿®æ”¹äº†ä¸€ä¸ªå¿…å®šä¼šå¯¹å¦ä¸€ä¸ªäº§ç”Ÿå½±å“ã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-c2c986e29379ade7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/jpeg)

resource-node.png

è€Œå¦‚æœç”¨contextNameæ¥ä½œä¸ºkeyï¼Œé‚£å¯¹äºåŒä¸€ä¸ªèµ„æºresourceAæ¥è¯´ï¼Œåœ¨context1ä¸­è·å–åˆ°çš„æ˜¯defaultNodeA1ï¼Œåœ¨context2ä¸­è·å–åˆ°æ˜¯defaultNodeA2ï¼Œé‚£åœ¨ä¸åŒçš„contextä¸­å¯¹åŒä¸€ä¸ªèµ„æºå¯ä»¥ä½¿ç”¨ä¸åŒçš„DefaultNodeè¿›è¡Œåˆ†åˆ«ç»Ÿè®¡å’Œè®¡ç®—ï¼Œæœ€åå†é€šè¿‡ClusterNodeè¿›è¡Œåˆå¹¶å°±å¯ä»¥äº†ã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-0c0a7ec2694f7506.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/jpeg)

content-node.png

æ‰€ä»¥åœ¨NodeSelectorSlotè¿™ä¸ªç±»é‡Œé¢ï¼Œmapé‡Œé¢ä¿å­˜çš„æ˜¯contextNameå’ŒDefaultNodeçš„æ˜ å°„å…³ç³»ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯ä»¥åœ¨ä¸åŒçš„contextå¯¹ç›¸åŒçš„èµ„æºè¿›è¡Œåˆ†å¼€ç»Ÿè®¡ã€‚

åŒä¸€ä¸ªcontextä¸­å¯¹åŒä¸€ä¸ªresourceè¿›è¡Œå¤šæ¬¡entry()è°ƒç”¨æ—¶ï¼Œä¼šå½¢å¼ä¸€é¢—è°ƒç”¨æ ‘ï¼Œè¿™ä¸ªæ ‘æ˜¯é€šè¿‡CtEntryä¹‹é—´çš„parent/childå…³ç³»ç»´æŠ¤çš„ã€‚

> å…·ä½“çš„è°ƒç”¨é“¾çš„åŸç†åˆ†æå¯ä»¥å‚è€ƒç¬”è€…çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š[é™æµé™çº§ç¥å™¨-å“¨å…µ(sentinel)çš„èµ„æºè°ƒç”¨é“¾åŸç†åˆ†æ](https://mp.weixin.qq.com/s/UEzwD22YC6jpp02foNSXnw)

# Entry

entryæ˜¯sentinelä¸­ç”¨æ¥è¡¨ç¤ºæ˜¯å¦é€šè¿‡é™æµçš„ä¸€ä¸ªå‡­è¯ï¼Œå°±åƒä¸€ä¸ªtokenä¸€æ ·ã€‚æ¯æ¬¡æ‰§è¡Œ  `SphU.entry()` æˆ– `SphO.entry()` éƒ½ä¼šè¿”å›ä¸€ä¸ª `Entry` ç»™è°ƒç”¨è€…ï¼Œæ„æ€å°±æ˜¯å‘Šè¯‰è°ƒç”¨è€…ï¼Œå¦‚æœæ­£ç¡®è¿”å›äº† `Entry` ç»™ä½ ï¼Œé‚£è¡¨ç¤ºä½ å¯ä»¥æ­£å¸¸è®¿é—®è¢«sentinelä¿æŠ¤çš„åæ–¹æœåŠ¡äº†ï¼Œå¦åˆ™sentinelä¼šæŠ›å‡ºä¸€ä¸ªBlockException(å¦‚æœæ˜¯ `SphO.entry()` ä¼šè¿”å›false)ï¼Œè¿™å°±è¡¨ç¤ºè°ƒç”¨è€…æƒ³è¦è®¿é—®çš„æœåŠ¡è¢«ä¿æŠ¤äº†ï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è€…æœ¬èº«è¢«é™æµäº†ã€‚

entryä¸­ä¿å­˜äº†æœ¬æ¬¡æ‰§è¡Œ entry() æ–¹æ³•çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

- createTimeï¼šå½“å‰Entryçš„åˆ›å»ºæ—¶é—´ï¼Œä¸»è¦ç”¨æ¥åæœŸè®¡ç®—rt
- nodeï¼šå½“å‰Entryæ‰€å…³è”çš„nodeï¼Œè¯¥nodeä¸»è¦æ˜¯è®°å½•äº†å½“å‰contextä¸‹è¯¥èµ„æºçš„ç»Ÿè®¡ä¿¡æ¯
- originï¼šå½“å‰Entryçš„è°ƒç”¨æ¥æºï¼Œé€šå¸¸æ˜¯è°ƒç”¨æ–¹çš„åº”ç”¨åç§°ï¼Œåœ¨ `ClusterBuilderSlot.entry()` æ–¹æ³•ä¸­è®¾ç½®çš„
- resourceWrapperï¼šå½“å‰Entryæ‰€å…³è”çš„èµ„æº

å½“åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­å¤šæ¬¡è°ƒç”¨äº† `SphU.entry()` æ–¹æ³•æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªè°ƒç”¨æ ‘ï¼Œè¿™ä¸ªæ ‘çš„èŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡parentå’Œchildå…³ç³»ç»´æŒçš„ã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼šparentå’Œchildæ˜¯åœ¨ CtSph ç±»çš„ä¸€ä¸ªç§æœ‰å†…éƒ¨ç±» CtEntry ä¸­å®šä¹‰çš„ï¼ŒCtEntry æ˜¯ Entry çš„ä¸€ä¸ªå­ç±»ã€‚**
 ç”±äºcontextä¸­æ€»æ˜¯ä¿å­˜ç€è°ƒç”¨é“¾æ ‘ä¸­çš„å½“å‰å…¥å£ï¼Œæ‰€ä»¥å½“å½“å‰entryæ‰§è¡Œexité€€å‡ºæ—¶ï¼Œéœ€è¦å°†parentè®¾ç½®ä¸ºå½“å‰å…¥å£ã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-70c407d5dde36b31.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/966/format/jpeg)

entry.png

# Node

nodeä¸­ä¿å­˜äº†èµ„æºçš„å®æ—¶ç»Ÿè®¡æ•°æ®ï¼Œä¾‹å¦‚ï¼špassQpsï¼ŒblockQpsï¼Œrtç­‰å®æ—¶æ•°æ®ã€‚æ­£æ˜¯æœ‰äº†è¿™äº›ç»Ÿè®¡æ•°æ®åï¼Œsentinelæ‰èƒ½è¿›è¡Œé™æµã€é™çº§ç­‰ä¸€ç³»åˆ—çš„æ“ä½œã€‚

nodeæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»–æœ‰ä¸€ä¸ªå®ç°ç±»ï¼šStatisticNodeï¼Œä½†æ˜¯StatisticNodeæœ¬èº«ä¹Ÿæœ‰ä¸¤ä¸ªå­ç±»ï¼Œä¸€ä¸ªæ˜¯DefaultNodeï¼Œå¦ä¸€ä¸ªæ˜¯ClusterNodeï¼ŒDefaultNodeåˆæœ‰ä¸€ä¸ªå­ç±»å«EntranceNodeã€‚

å…¶ä¸­entranceNodeæ˜¯æ¯ä¸ªä¸Šä¸‹æ–‡çš„å…¥å£ï¼Œè¯¥èŠ‚ç‚¹æ˜¯ç›´æ¥æŒ‚åœ¨rootä¸‹çš„ï¼Œæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œæ¯ä¸€ä¸ªcontextéƒ½ä¼šå¯¹åº”ä¸€ä¸ªentranceNodeã€‚å¦å¤–defaultNodeæ˜¯è®°å½•å½“å‰è°ƒç”¨çš„å®æ—¶æ•°æ®çš„ï¼Œæ¯ä¸ªdefaultNodeéƒ½å…³è”ç€ä¸€ä¸ªèµ„æºå’ŒclusterNodeï¼Œæœ‰ç€ç›¸åŒèµ„æºçš„defaultNodeï¼Œä»–ä»¬å…³è”ç€åŒä¸€ä¸ªclusterNodeã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-ace3d1297df2d282.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/jpeg)

node.png

# Metric

metricæ˜¯sentinelä¸­ç”¨æ¥è¿›è¡Œå®æ—¶æ•°æ®ç»Ÿè®¡çš„åº¦é‡æ¥å£ï¼Œnodeå°±æ˜¯é€šè¿‡metricæ¥è¿›è¡Œæ•°æ®ç»Ÿè®¡çš„ã€‚è€Œmetricæœ¬èº«ä¹Ÿå¹¶æ²¡æœ‰ç»Ÿè®¡çš„èƒ½åŠ›ï¼Œä»–ä¹Ÿæ˜¯é€šè¿‡Windowæ¥è¿›è¡Œç»Ÿè®¡çš„ã€‚

> å…·ä½“çš„ç»Ÿè®¡åŸç†ï¼Œå¯ä»¥å‚è€ƒç¬”è€…å¦ä¸€ç¯‡æ–‡ç« ï¼š[sentinelåŸºäºæ»‘åŠ¨æ—¶é—´çª—å£çš„å®æ—¶æŒ‡æ ‡ç»Ÿè®¡åŸç†åˆ†æ](https://mp.weixin.qq.com/s/B1_7Kb_CxeKEAv43kdCWOA)

Metricæœ‰ä¸€ä¸ªå®ç°ç±»ï¼šArrayMetricï¼Œåœ¨ArrayMetricä¸­ä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ªå«WindowLeapArrayçš„å¯¹è±¡è¿›è¡Œçª—å£ç»Ÿè®¡çš„ã€‚



![img](https:////upload-images.jianshu.io/upload_images/5417792-0c26b0016a95c8ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/890/format/jpeg)

metric.png