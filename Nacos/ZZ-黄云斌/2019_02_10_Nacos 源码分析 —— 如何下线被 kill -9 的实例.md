title: Nacos æºç åˆ†æ â€”â€” å¦‚ä½•ä¸‹çº¿è¢« kill -9 çš„å®ä¾‹
date: 2019-02-10
tag:
categories: Nacos
permalink: Nacos/huangbin/How-to-log-off-an-instance-of-kill-9
author: é»„äº‘æ–Œ
from_url: https://www.jianshu.com/p/661498752ab9
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.jianshu.com/p/661498752ab9 ã€Œé»„äº‘æ–Œã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸ªæ‰æ˜¯æœåŠ¡å‘ç°çš„é‡ç‚¹äº†ã€‚](http://www.iocoder.cn/Nacos/huangbin/How-to-log-off-an-instance-of-kill-9/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

### ä¸Šæ–‡è¯´åˆ°äº†æœåŠ¡å®ä¾‹çš„æ­£å¸¸ä¸Šä¸‹çº¿ï¼Œéƒ½æ˜¯å®ä¾‹ä¸»åŠ¨è°ƒæ¥å£å®Œæˆçš„ã€‚ä½†æ˜¯å¦‚æœå®ä¾‹è¢«kill -9å‘¢ï¼Œå°±ä¸ä¼šä¸»åŠ¨é€šçŸ¥ä¸‹çº¿äº†ã€‚

# å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸ªæ‰æ˜¯æœåŠ¡å‘ç°çš„é‡ç‚¹äº†ã€‚

### è§£å†³çš„åŠæ³•å°±æ˜¯  å¿ƒè·³+å®šæ—¶ä»»åŠ¡å»åˆ¤æ–­ï¼Œä¸è¿‡è¿™é‡Œå®šæ—¶ä»»åŠ¡çš„åˆ†é…ä¹Ÿæ˜¯æœ‰è®²ç©¶äº†ã€‚

-------

### 1 å¿ƒè·³

nacosæºç åˆ†æâ€”â€”å¦‚ä½•åšå¿ƒè·³ç»­çº¦ ä¸­è¯´åˆ°äº†ï¼ŒæœåŠ¡å®ä¾‹çš„å¿ƒè·³è°ƒç”¨/clientBeatæ¥å£ï¼Œä¼šæ›´æ–°lastBeatä¸ºå½“å‰æ—¶é—´ã€‚

![](http://upload-images.jianshu.io/upload_images/7835103-e9be06567857fed4.png)

#### ä½†æ˜¯è¿™ä¸ªlastBeatæ—¶é—´è¦å¦‚ä½•ç”¨èµ·æ¥å‘¢ï¼Ÿ

-------

### 2 å®šæ—¶ä»»åŠ¡

VirtualClusterDomain ä¼šèµ·ä¸ªå®šæ—¶ä»»åŠ¡

![](http://upload-images.jianshu.io/upload_images/7835103-c41ebefd9e9cba96.png)

#### ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œå°±åˆ é™¤è¿™ä¸ªå®ä¾‹

![](http://upload-images.jianshu.io/upload_images/7835103-f89e1a703b43716c.png)

### 3 å®šæ—¶ä»»åŠ¡çš„åˆ†é…

ä¸Šé¢çš„åšæ³•æœ‰ä¸ªé—®é¢˜ï¼Œnacosæœ‰å¾ˆå¤šæœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½è¦å®šæ—¶ä»»åŠ¡æ£€æŸ¥æ‰€æœ‰çš„æœåŠ¡åˆ—è¡¨å—ï¼Ÿ

å¦‚æœé‡å¤çš„åšï¼Œä¼šæœ‰å¾ˆå¤§çš„èµ„æºæµªè´¹ï¼Œè€Œä¸”å¦‚æœéƒ½æ£€æŸ¥åˆ°è¶…æ—¶äº†ï¼Œéƒ½å’Œleaderé€šä¿¡è¯´è¦ä¸‹çº¿ï¼Œå¯¹ç½‘ç»œçš„è´Ÿæ‹…ä¹Ÿæ¯”è¾ƒé«˜ã€‚

### è§£å†³çš„åŠæ³•å°±æ˜¯  æœåŠ¡åhash % nacosæœåŠ¡å™¨æ•°ç›® ï¼Œå¾—åˆ°å…¶ä¸­ä¸€å° nacosæœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„è¯ï¼Œå°±å¼€å§‹æ£€æŸ¥è¿™ä¸ªæœåŠ¡çš„å®ä¾‹åˆ—è¡¨ï¼Œå¦‚æœä¸æ˜¯å°±è·³è¿‡ã€‚

æ¯ä¸ªnacosæœåŠ¡å™¨éƒ½è¿™æ ·å»æ£€æŸ¥ï¼Œè‡ªç„¶ä¼šè¦†ç›–åˆ°æ‰€æœ‰æœåŠ¡çš„æ£€æŸ¥ã€‚

![](http://upload-images.jianshu.io/upload_images/7835103-51e3fcab1e459145.png)

![](http://upload-images.jianshu.io/upload_images/7835103-d62fc5e239834190.png)

![](http://upload-images.jianshu.io/upload_images/7835103-727be61e52f587fa.png)

-------

### 4 serveråˆ—è¡¨åŒæ­¥

ä¸‹é‡ç‚¹æ¥äº†ï¼Œæ¯ä¸ªnacosæœåŠ¡å™¨æ•°æ˜¯æ€ä¹ˆä¿è¯healthyListï¼ˆserveråˆ—è¡¨ï¼‰æ˜¯ä¸€æ ·çš„å‘¢ï¼Ÿ

è§£å†³çš„åŠæ³•ä»ç„¶æ˜¯å¿ƒè·³ï¼š

DistroMapper åˆå§‹åŒ–çš„æ—¶å€™ä¼šå¯åŠ¨ä¸€ä¸ªServerStatusReporter

![](http://upload-images.jianshu.io/upload_images/7835103-fdebee866706e695.png)

### ServerStatusReporter ä¼šå‘å…¶ä»–çš„nacosæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±æ˜¯å¥åº·çš„

![](http://upload-images.jianshu.io/upload_images/7835103-087f1f96e6d141a9.png)

ServerStatusReporterçš„runæ–¹æ³•çš„finallyä¼šç»§ç»­è°ƒç”¨è‡ªå·±ï¼Œè¿™æ ·å°±ç›¸å½“äºæ˜¯ä¸ªå®šæ—¶ä»»åŠ¡äº†ã€‚

![](http://upload-images.jianshu.io/upload_images/7835103-ee36b27658c72c5a.png)

å®é™…è°ƒç”¨çš„æ¥å£æ˜¯ /api/serverStatusï¼Œæ”¶åˆ°è¯·æ±‚çš„nacosæœåŠ¡å™¨å°±ä¼šæ›´æ–°è‡ªå·±çš„healthyListã€‚

### å¦‚æœä¸€ç›´æ²¡æ”¶åˆ°å…¶ä»–nacosæœåŠ¡å™¨çš„å¿ƒè·³ä¿¡æ¯å‘¢ï¼Œè¿™é‡Œå°±æœ‰ä¸ªç¥å¥‡çš„é€»è¾‘äº†ï¼š

### ServerStatusReporteræ˜¯ä¼šæ¨¡æ‹Ÿå‘é€å¿ƒè·³ç»™è‡ªå·±ï¼Œä¿è¯healthyListçš„é€»è¾‘ä¸€å®šä¼šæ‰§è¡Œã€‚ã€‚

![](http://upload-images.jianshu.io/upload_images/7835103-7eb4586bf83aa771.png)

          

