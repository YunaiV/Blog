title: Kafka æ˜¯ä»€ä¹ˆ
date: 2018-10-23
tags:
categories: ç²¾è¿›
permalink: Fight/What-is-kafka
author: é˜¿é£
from_url: http://www.jianshu.com/p/8d7f30f87f95
wechat_url: https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247485388&idx=2&sn=6ffb07ee5d124241962699bacf351368&chksm=fa49787dcd3ef16bf6960a7d74099104e738ce3ed61ffd9bce22e56918e53e3e94906e2806a8&token=1125060202&lang=zh_CN#rd

----

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.jianshu.com/p/8d7f30f87f95 ã€Œé˜¿é£ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [å®šä¹‰](http://www.iocoder.cn/Fight/What-is-kafka/)
- [æ¶æ„](http://www.iocoder.cn/Fight/What-is-kafka/)
- [topic](http://www.iocoder.cn/Fight/What-is-kafka/)
- [durable](http://www.iocoder.cn/Fight/What-is-kafka/)
- [consumer](http://www.iocoder.cn/Fight/What-is-kafka/)
- [consumer group](http://www.iocoder.cn/Fight/What-is-kafka/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# å®šä¹‰

ä¸€åƒä¸ªäººçœ¼é‡Œæœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ã€‚å¦‚æœè¯´è°æœ€æœ‰èµ„æ ¼å®šä¹‰kafkaæ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å®˜æ–¹æ–‡æ¡£ï¼š

```java
Apache KafkaÂ® is a distributed streaming platform.
```

å®˜æ–¹è¿˜å¯¹æµå¹³å°è¿›è¡Œäº†å®šä¹‰--æµå¹³å°æœ‰ä¸‰å¤§å…³é”®èƒ½åŠ›ï¼ˆA streaming platform has three key capabilitiesï¼‰ï¼š

- Publish and subscribe to streams of records, similar to a message queue or enterprise messaging system.
- Store streams of records in a fault-tolerant durable way.
- Process streams of records as they occur.

ç¬¬ä¸€ä¸ªç‰¹æ€§æ˜¯ç±»MQçš„å‘å¸ƒè®¢é˜…ç‰¹æ€§ï¼Œç¬¬äºŒä¸ªç‰¹æ€§å°±æ˜¯å…·å¤‡å®¹é”™çš„å­˜å‚¨èƒ½åŠ›ï¼Œç¬¬ä¸‰ä¸ªç‰¹æ€§æ˜¯å¤„ç†æ•°æ®ã€‚æ‰€ä»¥kafkaå¯ä»¥æ›¿ä»£ActiveMQè¿™ç±»æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å¦å¤–æˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹å¯¹kafkaçš„å®šä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![kafkaå®šä½](https:////upload-images.jianshu.io/upload_images/6918995-ea4d7e038243c7c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/846/format/jpeg)

kafkaå‡ ä¸ªé‡è¦çš„æ¦‚å¿µ:

- Kafka is run as a cluster on one or more servers that can span multiple datacenters.
- The Kafka cluster stores streams of records in categories called topics.
- Each record consists of a key, a value, and a timestamp.

# æ¶æ„

kafkaæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¶ˆæ¯ä¸­é—´ä»¶çš„æœ¬è´¨å°±æ˜¯ï¼š**ç”Ÿäº§-å­˜å‚¨-æ¶ˆè´¹**ã€‚ç”±ä¸‹å›¾å¯çŸ¥ï¼Œåœ¨kafkaçš„æ¶æ„è®¾è®¡é‡Œï¼Œæ— è®ºæ˜¯ç”Ÿäº§è€…ï¼Œè¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œè¿˜æ˜¯æ¶ˆæ¯å­˜å‚¨ï¼Œéƒ½å¯ä»¥æ°´å¹³æ‰©å®¹ä»è€Œæé«˜æ•´ä¸ªé›†ç¾¤çš„å¤„ç†èƒ½åŠ›ï¼Œç”Ÿæ¥å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦å¤–ï¼Œå›¾ä¸­æ²¡æœ‰å±•ç¤ºå‡ºæ¥çš„kafkaå¦ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å‰¯æœ¬ï¼Œåœ¨åˆ›å»ºtopicçš„æ—¶å€™æŒ‡å®šåˆ†åŒºæ•°é‡çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šå‰¯æœ¬çš„æ•°é‡ï¼ˆå‰¯æœ¬æœ€å¤§æ•°é‡ä¸å…è®¸è¶…è¿‡brokerçš„æ•°é‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šReplication factor: 2 larger than available brokers: 1ï¼‰ã€‚å„ä¸ªå‰¯æœ¬ä¹‹é—´åªæœ‰ä¸€ä¸ªleaderï¼Œå…¶ä»–æ˜¯followï¼Œåªæœ‰leaderå‰¯æœ¬æä¾›è¯»å†™æœåŠ¡ï¼Œfollowå‰¯æœ¬åªæ˜¯å†·å¤‡ï¼Œå½“leaderæŒ‚æ‰ä¼šä»followä¸­é€‰ä¸¾ä¸€ä¸ªleaderï¼Œä»è€Œè¾¾åˆ°é«˜å¯ç”¨ã€‚

![kafka architecture](https:////upload-images.jianshu.io/upload_images/6918995-c50ce98319677c06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/858/format/jpeg)


> å›¾ç‰‡æ¥æºäº`https://en.wikipedia.org/wiki/File:Overview_of_Apache_Kafka.svg`

# topic

ä¸‹å›¾æ˜¯topicçš„è§£å‰–å›¾ï¼Œkafkaåªæœ‰topicçš„æ¦‚å¿µï¼Œæ²¡æœ‰ç±»ä¼¼ActiveMQä¸­çš„Queueï¼ˆä¸€å¯¹ä¸€ï¼‰çš„æ¦‚å¿µï¼ˆActiveMQæ—¢æœ‰Topicåˆæœ‰Queueï¼‰ã€‚ä¸€ä¸ªtopicå¯ä»¥æœ‰è‹¥å¹²ä¸ªåˆ†åŒºï¼Œä¸”åˆ†åŒºå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œä½†æ˜¯åªå…è®¸å¢åŠ ä¸å…è®¸å‡å°‘ã€‚æ¯ä¸ªåˆ†åŒºä¸­çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚å„ä¸ªåˆ†åŒºä¹‹é—´çš„æ¶ˆæ¯æ˜¯æ— åºçš„ã€‚æ–°æ¶ˆæ¯é‡‡ç”¨è¿½åŠ çš„æ–¹å¼å†™å…¥ï¼Œè¿™ç§é¡ºåºå†™å…¥æ–¹å¼ï¼Œä»è€Œä½¿kafkaçš„ååèƒ½åŠ›éå¸¸å¼ºå¤§ï¼ˆä¸€äº›éªŒè¯è¡¨åé¡ºåºå†™å…¥ç£ç›˜çš„é€Ÿåº¦è¶…è¿‡éšæœºå†™å…¥å†…å­˜ï¼‰ã€‚



![kafka topic](https:////upload-images.jianshu.io/upload_images/6918995-75ed3cc390a1cc9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/748/format/jpeg)



- topicå®šä¹‰
   å®˜æ–¹å®šä¹‰ï¼šA topic is a category or feed name to which records are published. Topics in Kafka are always multi-subscriber; that is, a topic can have zero, one, or many consumers that subscribe to the data written to it.
   ä¾‹å¦‚è®¢å•æ”¯ä»˜æˆåŠŸåï¼Œå‘é€åä¸º`TOPIC_PAYMENT_ORDER_SUCCESS`ï¼Œç§¯åˆ†ç³»ç»Ÿå¯ä»¥æ¥æ”¶è¿™ä¸ªtopicï¼Œç»™ç”¨æˆ·é€ç§¯åˆ†ã€‚ä¼šå‘˜ç³»ç»Ÿå¯ä»¥æ¥æ”¶è¿™ä¸ªtopicï¼Œå¢åŠ ä¼šå‘˜æˆé•¿å€¼ã€‚æ”¯ä»˜å®é‡Œçš„èš‚èšåº„å›­è¿˜æœ‰æ”¯ä»˜æˆåŠŸåé€é¥²æ–™ç­‰ã€‚

- ç£ç›˜&å†…å­˜é€Ÿåº¦å¯¹æ¯”
   ç”±ä¸‹å›¾å¯çŸ¥ï¼Œé¡ºåºå†™å…¥ç£ç›˜çš„é€Ÿåº¦ï¼ˆSequential, diskï¼‰ä¸º53.2Mï¼Œè€Œéšæœºå†™å…¥å†…å­˜çš„é€Ÿåº¦ï¼ˆRandom, memoryï¼‰ä¸º36.7Mã€‚



  ![ç£ç›˜&å†…å­˜é€Ÿåº¦å¯¹æ¯”](https:////upload-images.jianshu.io/upload_images/6918995-935190691611febf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/585/format/jpeg)


> å›¾ç‰‡æ¥æºäºç½‘ç»œï¼š<http://searene.me/2017/07/09/Why-is-Kafka-so-fast/>

# durable

kafkaå¯¹æ¶ˆæ¯æ—¥å¿—çš„å­˜å‚¨ç­–ç•¥ä¸ºï¼šThe Kafka cluster durably persists all published recordsâ€”whether or not they have been consumedâ€”using a configurable retention period. For example, if the retention policy is set to two days, then for the two days after a record is published, it is available for consumption, after which it will be discarded to free up space. Kafka's performance is effectively constant with respect to data size so storing data for a long time is not a problem.
 å³æ— è®ºå¦‚ä½•ï¼Œkafkaä¼šæŒä¹…åŒ–ä¿å­˜æ‰€æœ‰æ¶ˆæ¯ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å·²ç»è¢«æ¶ˆè´¹ã€‚è€Œkafkaæ¶ˆæ¯æ—¥å¿—ä¿ç•™ç­–ç•¥é€šè¿‡é…ç½®å†³å®šï¼ˆä»¥`log.retention`å¼€å¤´çš„ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚`log.retention.ms`ï¼Œ`log.retention.minutes`ï¼Œ`log.retention.hours`ï¼Œ`log.retention.bytes`ï¼‰ï¼Œä¾‹å¦‚é…ç½®æœ‰æ•ˆæœŸä¸¤å¤©ï¼Œé‚£ä¹ˆä¸¤å¤©å†…è¿™äº›æ¶ˆæ¯æ—¥å¿—éƒ½èƒ½é€šè¿‡offsetè®¿é—®ã€‚åˆ°æœŸåï¼Œkafkaä¼šåˆ é™¤è¿™äº›æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚

# consumer

kafkaæ¶ˆè´¹topicä¸­æŸä¸ªåˆ†åŒºç¤ºæ„å›¾å¦‚ä¸‹ï¼Œè‡³äºkafkaå¦‚ä½•åœ¨å„ä¸ªtopicçš„å„ä¸ªåˆ†åŒºä¸­é€‰æ‹©æŸä¸ªåˆ†åŒºï¼Œåé¢çš„æ–‡ç« ä¼šæåˆ°ã€‚ç”±ä¸‹å›¾å¯çŸ¥ï¼Œæ¶ˆè´¹è€…é€šè¿‡offsetå®šä½å¹¶è¯»å–æ¶ˆæ¯ï¼Œä¸”å„ä¸ªæ¶ˆè´¹è€…æŒæœ‰çš„offsetæ˜¯è‡ªå·±çš„æ¶ˆè´¹è¿›åº¦ã€‚



![kafka consumer](https:////upload-images.jianshu.io/upload_images/6918995-60cc0a5474876929.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/872/format/jpeg)

# consumer group

- each record published to a topic is delivered to one consumer instance within each subscribing consumer group. Consumer instances can be in separate processes or on separate machines.
- If all the consumer instances have the same consumer group, then the records will effectively be load balanced over the consumer instances.
- If all the consumer instances have different consumer groups, then each record will be broadcast to all the consumer processes.

å³å¯¹äºè®¢é˜…äº†æŸä¸ªtopicçš„consumer groupä¸‹çš„æ‰€æœ‰consumerï¼Œä»»æ„ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªconsumeræ¶ˆè´¹ã€‚å¦‚æœæœ‰å¤šä¸ªconsumer groupï¼Œå„ä¸ªconsumer groupä¹‹é—´äº’ä¸å¹²æ‰°ã€‚consumer groupç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼ŒæŸä¸ªtopicæ¶ˆæ¯æœ‰4ä¸ªåˆ†åŒºï¼šP0, P1, P2, P3ã€‚Consumer Group Aä¸­æœ‰ä¸¤ä¸ªconsumerï¼šC1å’ŒC2ã€‚Consumer Group Bä¸­æœ‰4ä¸ªconsumerï¼šC3ï¼ŒC4ï¼ŒC5å’ŒC6ã€‚å¦‚æœç°åœ¨ç”Ÿäº§è€…å‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯åªä¼šè¢«Consumer Group Aä¸­çš„C1å’ŒC2ä¹‹ä¸­æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ï¼Œä»¥åŠè¢«Consumer Group Bä¸­çš„C3ï¼ŒC4ï¼ŒC5å’ŒC6ä¹‹ä¸­æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ã€‚


![consumer group](https:////upload-images.jianshu.io/upload_images/6918995-2f66a2b6ce7d84b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/799/format/jpeg)