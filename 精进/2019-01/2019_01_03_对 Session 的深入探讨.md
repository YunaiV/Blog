title: å¯¹ Session çš„æ·±å…¥æ¢è®¨
date: 2019-01-03
tags:
categories: ç²¾è¿›
permalink: Fight/An-in-depth-discussion-of-sessions
author: åƒé‡Œæ˜æœˆ
from_url: https://my.oschina.net/u/3490860/blog/2986928
wechat_url: https://mp.weixin.qq.com/s/Koto-w9U9mt8H1zZW2ETZQ

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://my.oschina.net/u/3490860/blog/2986928 ã€Œåƒé‡Œæ˜æœˆã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [ç®€ä»‹](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [sessionæœ¬è´¨](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [cookieç®€ä»‹](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [ç–‘ç‚¹](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [æ¨è®º](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [è§£å†³æ–¹æ¡ˆ](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)
- [ä¸è¶³](http://www.iocoder.cn/Fight/An-in-depth-discussion-of-sessions/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# ç®€ä»‹

â€‹       sessionï¼Œä¼šè¯ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå®¹æ˜“è®©äººè¯¯è§£çš„è¯ã€‚å®ƒæ€»è·Ÿwebç³»ç»Ÿçš„ä¼šè¯æŒ‚é’©ï¼Œåˆ©ç”¨sessionï¼Œjavawebé¡¹ç›®å®ç°äº†ç™»å½•çŠ¶æ€çš„æ§åˆ¶ã€‚åŠé—´æµä¼ ï¼Œå…³é—­æµè§ˆå™¨ï¼Œå°±æ˜¯å…³é—­äº†webç³»ç»Ÿçš„ä¼šè¯ã€‚å…¶å®æµè§ˆå™¨å¯¹äºä¼šè¯æœ‰è‡ªå·±çš„å®šä¹‰ï¼Œè€Œwebç³»ç»Ÿå¯¹äºä¼šè¯ä¹Ÿæœ‰è‡ªå·±çš„å®šä¹‰ã€‚åœ¨tomcatä¸­ï¼Œsessioné€šå¸¸æ˜¯æŒ‡å®ç°äº†HttpSessionæ¥å£çš„å®ç°ç±»ã€‚å¹¶ä¸”ä¸å­˜åœ¨å…³é—­æµè§ˆå™¨å°±ä¼šå…³é—­tomcatçš„HttpSessionè¿™ç§çŠ¶å†µã€‚

â€‹       sessionæœ¬èº«å¹¶ä¸éš¾ï¼Œå¦‚æœåªæ˜¯åšç™»å½•æ ¡éªŒä¹‹ç±»çš„åŠŸèƒ½ï¼Œå¹¶ä¸éœ€è¦æ·±å…¥äº†è§£ï¼Œä½†éš¾çš„æ˜¯sessionå’Œcookieçš„ç»“åˆä½¿ç”¨ï¼Œåœ¨ä¸åŒæƒ…å†µä¸‹æµè§ˆå™¨å¯¹cookieçš„æ§åˆ¶è¡Œä¸ºæ‰€æ¶‰åŠåˆ°çš„è¯¸å¤šç»†èŠ‚ï¼Œæˆ‘æœæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼ŒæŸ¥çœ‹è¿‡tomcatæºç ï¼Œäº¦æ˜¯æ²¡æœ‰æ‰¾åˆ°å…¨é¢çš„æ¦‚è¿°ã€‚å½“ç„¶æˆ‘å¹¶æœªçœ‹è¿‡ã€ä¹Ÿä¸çŸ¥é“å»å“ªé‡Œçœ‹æ¯”è¾ƒå…¨é¢çš„å…³äºæµè§ˆå™¨å¯¹cookieçš„æ§åˆ¶èµ„æ–™ï¼Œå¦‚æœæœ‰çŸ¥é“çš„å¤§ç¥ï¼Œè¿˜æœ›ç•™è¨€é“¾æ¥ã€‚æœ¬æ–‡é¢˜ç›®ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯æ¢è®¨ï¼Œè€Œä¸æ˜¯äº†è§£æˆ–è€…ä»‹ç»ï¼Œå› ä¸ºæˆ‘è‡ªå·±ä¹Ÿå¡åœ¨äº†æŸä¸ªç‚¹ä¸Šï¼Œç”±äºæ—¶é—´å…³ç³»ï¼Œæˆ‘ä¸èƒ½èŠ±å¤ªå¤šæ—¶é—´å»ç ”ç©¶ï¼Œä½†åˆä¸å¿å¿ƒå°±æ­¤æ”¾å¼ƒï¼Œæ‰€ä»¥å…ˆè®°å½•ä¸‹æ¥ï¼Œæ—¥åæœ‰æœºä¼šå†ç ”ç©¶ï¼Œè¿™æœŸé—´å¦‚æœ‰å¤§ç¥æŒ‡ç‚¹ï¼Œä¹Ÿè®¸èƒ½è®©æˆ‘èŒ…å¡é¡¿å¼€ã€‚





# sessionæœ¬è´¨

â€‹        æˆ‘ç”¨çš„æ˜¯javawebé¡¹ç›®ï¼Œå› æ­¤è¿™é‡Œçš„sessionç‰¹æŒ‡HttpSessionã€‚å…ˆæ¥çœ‹ä¸‹tomcatæºç ä¸­å¯¹sessionçš„è®¾è®¡ï¼Œåœ¨org.apache.catalina.sessionåŒ…ä¸‹ï¼Œæœ‰å¦‚ä¸‹è®¾è®¡ï¼š

![img](http://static.iocoder.cn/78c6d9f277c523f0866711a3dec8fe8f)

å¹³æ—¶æ‰€ç”¨åˆ°çš„HttpSessionçš„å®ç°ç±»å°±æ˜¯è¿™ä¸ªstandardSessionã€‚ä½†æ˜¯æ‰€è·å–çš„HttpSessionå®ä¾‹ç¡®æ˜¯å¤–è§‚ç±»StandardSessionFacadeï¼Œå…¶å±è”½äº†è®¸å¤šæ–¹æ³•ï¼Œä½†ä¹Ÿå¢å¼ºäº†å®‰å…¨æ€§ã€‚HttpSessionæä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œæ¥æ§åˆ¶sessionæˆ–è€…è·å–sessionçš„çŠ¶æ€ï¼Œå¦‚è·å–sessionçš„idï¼Œè·å–sessionçš„åˆ›å»ºæ—¶é—´ï¼Œè®¾ç½®sessionçš„attributeï¼Œä½¿sessionå¤±æ•ˆç­‰ã€‚å€¼å¾—ä¸€æçš„æ˜¯sessionçš„attributeå…¶å®æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„hashMapï¼š

```
    /**
     * The collection of user data attributes associated with this Session.
     */
    protected ConcurrentMap<String, Object> attributes = new ConcurrentHashMap<>();
```

ä½†æ˜¯ï¼Œåˆ›å»ºsessionã€æ ¹æ®idè·å–sessionçš„æ–¹æ³•å¹¶ä¸åœ¨è¿™é‡Œï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç®¡ç†å™¨ä¸­ï¼Œå…¶è®¾è®¡å¦‚ä¸‹ï¼š

![img](http://static.iocoder.cn/a187b1b2de9f2d80f7afcfd33415a30d)

ManagerBaseæ˜¯å®ç°äº†Manageræ¥å£çš„æŠ½è±¡ç±»ï¼Œå®ç°äº†ç®¡ç†sessionçš„åŠŸèƒ½ã€‚å…¶å®ç°å­ç±»PersistentManagerBaseæ‹“å±•äº†å°†sessionæŒä¹…åŒ–çš„åŠŸèƒ½ã€‚ä½†æ˜¯è¿™é‡Œä¸éœ€è¦è®²åˆ°å…¶å­ç±»ã€‚çœ‹ManagerBaseä¸­çš„ä¸€æ®µä»£ç ï¼š

```
    /**
     * The set of currently active Sessions for this Manager, keyed by
     * session identifier.
     */
    protected Map<String, Session> sessions = new ConcurrentHashMap<>();
```

ç”±æ­¤å¯çŸ¥ï¼Œæ‰€è°“çš„sessionï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªç”¨çº¿ç¨‹å®‰å…¨çš„hashMapå­˜å‚¨èµ·æ¥çš„å®ç°äº†Sessionæ¥å£çš„standardSessionå¯¹è±¡ï¼Œåœ¨hashmapä¸­ä»¥å…¶idä¸ºkeyï¼Œè‡ªèº«ä¸ºvalueã€‚

å†çœ‹è·å–sessionçš„æ–¹æ³•ï¼Œä¸€ç›®äº†ç„¶ï¼š

```
    @Override
    public Session findSession(String id) throws IOException {
        if (id == null) {
            return null;
        }
        return sessions.get(id);
    }
```

æœ€é‡è¦çš„æ˜¯çœ‹å…¶createSessionæ–¹æ³•ï¼š

```
 @Override
    public Session createSession(String sessionId) {

        if ((maxActiveSessions >= 0) &&
                (getActiveSessions() >= maxActiveSessions)) {
            rejectedSessions++;
            throw new TooManyActiveSessionsException(
                    sm.getString("managerBase.createSession.ise"),
                    maxActiveSessions);
        }

        // Recycle or create a Session instance
        Session session = createEmptySession();

        // Initialize the properties of the new session and return it
        session.setNew(true);
        session.setValid(true);
        session.setCreationTime(System.currentTimeMillis());
        session.setMaxInactiveInterval(getContext().getSessionTimeout() * 60);
        String id = sessionId;
        if (id == null) {
            id = generateSessionId();
        }
        session.setId(id);
        sessionCounter++;

        SessionTiming timing = new SessionTiming(session.getCreationTime(), 0);
        synchronized (sessionCreationTiming) {
            sessionCreationTiming.add(timing);
            sessionCreationTiming.poll();
        }
        return session;
    }
```

è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿå½“æµè§ˆå™¨è®¿é—®ç³»ç»Ÿæ—¶ï¼Œrequestä¼šè§£æè¯·æ±‚ä¸­æºå¸¦çš„jssesionidï¼Œç”¨å®ƒå»æ‰¾åˆ°å­˜åœ¨äºåº”ç”¨ä¸­çš„sessionï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨sessionçš„åˆ›å»ºæ–¹æ³•ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªæ–°çš„jssessionidï¼Œè¿”å›sessionã€‚

æ€»è€Œè¨€ä¹‹ï¼Œsessionæ˜¯å­˜åœ¨äºçº¿ç¨‹å®‰å…¨çš„mapä¸­çš„å€¼ï¼Œå¯ä»¥é€šè¿‡idæ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨invalidateæ–¹æ³•é”€æ¯ï¼Œä½†ç»ä¸ä¼šæ˜¯æµè§ˆå™¨å…³é—­ï¼Œå°±èƒ½å¯¹å®ƒè¿›è¡Œé”€æ¯çš„ã€‚





# cookieç®€ä»‹

â€‹        æåˆ°sessionï¼Œé‚£ä¹ˆcookieæ˜¯ä¸å¾—ä¸è¯´çš„ã€‚è‡³äºcookieæ˜¯ä»€ä¹ˆï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå¤§å®¶éƒ½æ‡‚ã€‚ç›´æ¥çœ‹å…¶å†…å®¹å§ï¼š

![img](http://static.iocoder.cn/1cdac8bcb2363147fe5e8cc1060c97de)

è¿™æ˜¯ä¸€æ¬¡httpè¯·æ±‚ä¸­ï¼ˆhttp://localhost:8080/test1ï¼‰ï¼ŒåŒ…å«çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯ï¼Œæ˜¯å¯¹ä¸€ä¸ªç³»ç»Ÿçš„åˆæ¬¡è®¿é—®ï¼Œç”¨çš„æ˜¯è°·æ­Œæµè§ˆå™¨ã€‚

è¯·æ±‚å¤´ä¸­ï¼ŒåŒ…å«çš„Cookieä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰ä¸Šæ–‡æåˆ°çš„jsessionid, é‚£æ˜¯å› ä¸ºè¿™æ˜¯å¯¹ç³»ç»Ÿçš„åˆæ¬¡è®¿é—®ï¼Œç³»ç»Ÿè¿˜æ²¡ç”Ÿæˆsessionã€‚ä½†æ˜¯è®¿é—®ä¹‹åï¼Œç³»ç»Ÿå°±ä¼šç”Ÿæˆä¸€ä¸ªsessionï¼Œè€Œä¸”ï¼Œä¼šåœ¨å“åº”æµä¸­è®¾ç½®å“åº”å¤´Set-Cookieï¼Œå…¶å€¼ä¸ºJESSIONID=xxxã€‚è¿™æ ·æµè§ˆå™¨å¯¹localhost:8080å’Œcookieçš„è”ç³»å°±æœ‰äº†è®°å¿†ï¼Œæµè§ˆå™¨ä¼šå°†å…¶å­˜å‚¨èµ·æ¥ï¼Œå¯åœ¨è°ƒè¯•å·¥å…·ä¸­çœ‹åˆ°ï¼š

![img](http://static.iocoder.cn/20caedf7517e70b52391b7cd6014be4c)

é‚£ä¹ˆå†æ¬¡è®¿é—®http://localhost:8080/test1, æµè§ˆå™¨ä¼šä¸»åŠ¨åœ¨è¯·æ±‚å¤´æ·»åŠ åŒ…æ‹¬jsessionçš„cookieä¿¡æ¯

![img](http://static.iocoder.cn/2898e749bf2546ba0230915182a36e6e)

ç³»ç»Ÿæ ¹æ®è¿™ä¸ªjsessionidæ‰¾åˆ°sessionï¼Œä¹Ÿå°±ä¸ä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ Set-Cookieä¿¡æ¯ã€‚

è¿™é‡Œè¯´ä¸€ä¸‹cookieä¸­çš„ä¸¤ä¸ªé‡è¦å±æ€§ï¼š

1. domainè¡¨ç¤ºçš„æ˜¯cookieæ‰€åœ¨çš„åŸŸï¼Œé»˜è®¤ä¸ºè¯·æ±‚çš„åœ°å€ï¼Œå¦‚ç½‘å€ä¸ºwww.test.com/test/test.aspxï¼Œé‚£ä¹ˆdomainé»˜è®¤ä¸ºwww.test.comã€‚è€Œè·¨åŸŸè®¿é—®ï¼Œå¦‚åŸŸAä¸ºt1.test.comï¼ŒåŸŸBä¸ºt2.test.comï¼Œé‚£ä¹ˆåœ¨åŸŸAç”Ÿäº§ä¸€ä¸ªä»¤åŸŸAå’ŒåŸŸBéƒ½èƒ½è®¿é—®çš„cookieå°±è¦å°†è¯¥cookieçš„domainè®¾ç½®ä¸º.test.comï¼›å¦‚æœè¦åœ¨åŸŸAç”Ÿäº§ä¸€ä¸ªä»¤åŸŸAä¸èƒ½è®¿é—®è€ŒåŸŸBèƒ½è®¿é—®çš„cookieå°±è¦å°†è¯¥cookieçš„domainè®¾ç½®ä¸ºt2.test.comã€‚
2. pathè¡¨ç¤ºcookieæ‰€åœ¨çš„ç›®å½•ï¼Œé»˜è®¤ä¸º/ï¼Œå°±æ˜¯æ ¹ç›®å½•ã€‚åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šæœ‰ç›®å½•å¦‚ä¸‹ï¼š/test/,/test/cd/,/test/dd/ï¼Œç°è®¾ä¸€ä¸ªcookie1çš„pathä¸º/test/ï¼Œcookie2çš„pathä¸º/test/cd/ï¼Œé‚£ä¹ˆtestä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥è®¿é—®åˆ°cookie1ï¼Œè€Œ/test/å’Œ/test/dd/çš„å­é¡µé¢ä¸èƒ½è®¿é—®cookie2ã€‚è¿™æ˜¯å› ä¸ºcookieèƒ½è®©å…¶pathè·¯å¾„ä¸‹çš„é¡µé¢è®¿é—®ã€‚





# ç–‘ç‚¹

â€‹        ä¸‹é¢ï¼Œå°±è¯¥è¯´ä¸‹æˆ‘çš„ç–‘ç‚¹äº†ã€‚

**æƒ…å†µ1ï¼š**

â€‹        ä½†æ˜¯å½“æˆ‘åœ¨8081çš„ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œé‡å®šå‘åˆ°8080çš„ä¸€ä¸ªè·¯å¾„æ—¶ï¼Œå‘ç°äº†å¥‡æ€ªçš„ç°è±¡ã€‚

8081ç³»ç»Ÿçš„æ–¹æ³•å¦‚ä¸‹ï¼š

```
   @GetMapping("/test")
    public void get1(HttpServletRequest request, HttpServletResponse response) throws IOException {
        HttpSession session = request.getSession();
        String id = session.getId();
        System.out.println(id);
        response.sendRedirect("http://localhost:8080/test1");
    }
```

8080ç³»ç»Ÿçš„è¢«é‡å®šå‘è·¯å¾„å¦‚ä¸‹ï¼š

```
    @GetMapping("/test1")
    public void get11(HttpServletRequest request, HttpServletResponse response) throws IOException {
        HttpSession session = request.getSession();
        String id = session.getId();
        System.out.println(id);
    }
```

1ã€åˆæ¬¡è®¿é—®localhost:8081/test å¾—åˆ°ä¸¤æ¬¡è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸€æ¬¡æ˜¯é‡å®šå‘çš„ï¼Œä¸€æ¬¡æ˜¯8080çš„

![img](http://static.iocoder.cn/b2a69141ee93953a113e951c42e652f7)

è¿™è¯´æ˜å¯¹8081ç³»ç»Ÿçš„åˆæ¬¡è®¿é—®ï¼Œæ˜¯æ²¡æœ‰å‘é€jsessionidä¿¡æ¯çš„ï¼Œè€Œ8081ç³»ç»Ÿç”Ÿæˆäº†ä¸€ä¸ªidä¸ºCAAB6AED34716A0394705BDE8CAC0042çš„sessionå¹¶è®¾ç½®åˆ°äº†å“åº”å¤´ï¼Œå†æ¬¡è®¿é—®8081æ—¶**ç†åº”**ä¼šå¸¦ä¸Šè¿™ä¹ˆä¸€ä¸ªidã€‚

2ã€

![img](http://static.iocoder.cn/f6e7192e770c09f049c8f5f12ba10bd8)

è¿™ä¸ªå¯¹8080ç³»ç»Ÿçš„è¯·æ±‚ä¸­å¸¦æœ‰jsessionidä¸ºCAAB6AED34716A0394705BDE8CAC0042çš„cookieä¿¡æ¯ï¼Œè¦çŸ¥é“ï¼Œæˆ‘ä»¬å¯¹8080çš„è®¿é—®ä¹Ÿæ˜¯åˆæ¬¡çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå¸¦ä¸Šjsessionidå‘¢ï¼Ÿè€Œä¸”è¿™ä¸ªjsessionidæ˜æ˜¾æ˜¯åœ¨8081ç³»ç»Ÿä¸­ç”Ÿæˆå¹¶è®¾ç½®åˆ°å“åº”å¤´çš„çš„jsessionidã€‚è¿™ä¸ªç°è±¡æˆ‘ç”¨è°·æ­Œå’Œedgeæµè§ˆå™¨åˆ†åˆ«å°è¯•è¿‡ï¼Œéƒ½æ˜¯è¿™æ ·ã€‚é‚£ä¹ˆæ˜¯ä¸æ˜¯è¯´æ˜ï¼Œæµè§ˆå™¨æŠŠè¿™ä¸ªé‡å®šå‘åˆ°localhost:8080çš„è¯·æ±‚å½“æˆæ˜¯åŒåŸŸçš„è¯·æ±‚äº† ã€‚

æš‚ä¸”æ”¾ä¸‹è¿™ä¸ªç–‘æƒ‘ï¼Œç»§ç»­å¾€ä¸‹éªŒè¯ã€‚ç”±äºè¿™ä¸ªè¯·æ±‚æ˜¯å¯¹8080çš„ç³»ç»Ÿçš„è®¿é—®ï¼Œç”±äºæ˜¯åˆæ¬¡è®¿é—®ï¼Œç³»ç»Ÿæ ¹æœ¬æ²¡æœ‰idä¸ºCAAB6AED34716A0394705BDE8CAC0042çš„sessionï¼Œå› æ­¤åªå¥½ç”Ÿæˆä¸€ä¸ªæ–°çš„sessionï¼Œåœ¨å“åº”å¤´ä¸­å¢åŠ Set-Cookieã€‚

3ã€å†æ¬¡è®¿é—®localhost:8081/testï¼Œè¿™æ—¶æ ¹æ®ä¸Šæ–‡è¯´çš„ï¼Œâ€œå†æ¬¡è®¿é—®8081æ—¶**ç†åº”**ä¼šå¸¦ä¸Šè¿™ä¹ˆä¸€ä¸ªidâ€ï¼Œä¹Ÿå°±æ˜¯åœ¨cookieä¸­å¸¦ä¸ŠJSESSION=CAAB6AED34716A0394705BDE8CAC0042,  ä½†æ˜¯,æˆ‘å‘ç°å®ƒå¸¦çš„å´æ˜¯åœ¨ç³»ç»Ÿ8080ä¸­ç”Ÿæˆçš„BA0D2C939ADEC087C0A5F0C9B3354891 ï¼ï¼ï¼

è¿™å°±å¯¼è‡´äº†8081æ‰¾ä¸åˆ°sessionåˆå†æ¬¡ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„sessionï¼Œå¾ªç¯å¾€å¤ï¼Œæ¯æ¬¡å¯¹8081çš„è®¿é—®éƒ½ä¼šäº§ç”Ÿæ–°çš„sessionã€‚è€Œè¿™æƒ…å†µï¼Œæˆ‘è§‰å¾—å¾ˆæ˜æ˜¾ï¼Œæ˜¯æµè§ˆå™¨æŠŠå¯¹8081çš„è®¿é—®å½“æˆæ˜¯äº8080åŒæºçš„äº†ã€‚

åŸºäºæ­¤æ¨è®ºï¼Œæˆ‘æ¨¡æ‹Ÿäº†å¦ä¸€ç§å®éªŒæƒ…å†µï¼Œå»æ‰é‡å®šå‘çš„åŠŸèƒ½ï¼š

**æƒ…å†µ2ï¼š**

åœ¨æœ¬åœ°å¼€ä¸¤ä¸ªwebæœåŠ¡ï¼Œç«¯å£åˆ†åˆ«æ˜¯8080,8081ã€‚

localhost:8081/test

```
    @GetMapping("/test")
    public void get1(HttpServletRequest request, HttpServletResponse response) throws IOException {
        HttpSession session = request.getSession();
        String id = session.getId();
        System.out.println(id);

    }
```

localhost:8080/test1

```
    @GetMapping("/test1")
    public void get11(HttpServletRequest request, HttpServletResponse response) throws IOException {
        HttpSession session = request.getSession();
        String id = session.getId();
        System.out.println(id);
    }
```

1ã€ç¬¬ä¸€æ¬¡è®¿é—®8081/test

![img](http://static.iocoder.cn/5f9c7eb638aa799bc8674d6c00c4c1d1)

æ²¡æœ‰cookieï¼ŒæœåŠ¡å™¨è®¾ç½®set-cookieï¼Œæ­£å¸¸ã€‚

2ã€ç¬¬äºŒæ¬¡è®¿é—®8081/test

![img](http://static.iocoder.cn/43a5c5ee6c0dfb100bf9a82750fad040)

cookieä¸ä¸Šæ¬¡çš„set-cookieä¸€è‡´ï¼Œæ­£å¸¸ã€‚

3ã€ç¬¬ä¸€æ¬¡è®¿é—®8080/test1

![img](http://static.iocoder.cn/6e492746cffdf5d047c4ecc186e28832)

æµè§ˆå™¨æŠŠ8081/testçš„cookieå‘è¿‡å»äº†ã€‚8080çš„æœåŠ¡å™¨æ‰¾ä¸åˆ°è¿™ä¸ªjsessionidï¼Œåˆé‡æ–°è®¾ç½®äº†jsessionidï¼Œç­‰åˆ°å†æ¬¡è®¿é—®8081/testæ—¶ï¼Œå¤§å®¶ä¹Ÿèƒ½çŒœåˆ°ä¼šå‘ç”Ÿä»€ä¹ˆäº†å§ã€‚





# æ¨è®º

è‡³æ­¤ï¼Œæˆ‘æ–—èƒ†æ¨è®ºï¼Œæµè§ˆå™¨ä¼šå¯¹åŒä¸€ipä¸åŒç«¯å£çš„æœåŠ¡è®¿é—®è®¤å®šæ˜¯å¯ä»¥è¿›è¡Œcookieå…±äº«çš„ï¼Œä¸¤ä¸ªcookieçš„domainæ˜¯ä¸€è‡´çš„ã€‚è€Œè¿™ç§cookieçš„æˆªå›¾ä¹Ÿä¸€å®šç¨‹åº¦ä¸Šå°è¯äº†æˆ‘çš„æƒ³æ³•ï¼š

![img](http://static.iocoder.cn/7f878fbb4bbf4ff40723ff81640225d5)

cookieçš„domainä¼¼ä¹åªè®¤å®šåŸŸåï¼Œæ— å…³ç«¯å£ã€‚

ä½†æ˜¯æ ¹æ®æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ŒåŒåŸŸåä¸åŒç«¯å£çš„è®¿é—®ä¹Ÿåº”è¯¥æ˜¯è·¨åŸŸçš„å•Šã€‚é™¤éæµè§ˆå™¨çš„åŸŸè·Ÿcookieçš„domainåœ¨æ¦‚å¿µä¸Šæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¯¹äºè¿™ç‚¹ï¼Œæˆ‘æ²¡æ‰¾åˆ°ç¡®åˆ‡çš„å®˜æ–¹èµ„æ–™ï¼Œä½†ç½‘ä¸Šå¤§ç¥æ˜¯è¿™ä¹ˆè¯´çš„â€”â€”

![img](http://static.iocoder.cn/e0ff2655153f82969568db07813e7652)





# è§£å†³æ–¹æ¡ˆ

â€‹        åŸºäºä¸Šé¢çš„æœªæŸ¥é˜…å®˜æ–¹èµ„æ–™è€Œåšå‡ºçš„ä¸ä¸¥è°¨çš„æ¨è®ºï¼Œæˆ‘æƒ³ï¼Œåªè¦å®Œå…¨é¿å…åŒåŸŸçš„æƒ…å†µå°±å¯ä»¥é¿å¼€è¿™ä¸ªé—®é¢˜ã€‚äºæ˜¯æˆ‘æŠŠ8081å’Œ8080ç³»ç»Ÿåˆ†åˆ«éƒ¨ç½²åœ¨ä¸¤ä¸ªæœºå™¨ä¸Šã€‚ç”±äºä¸åŒipï¼Œè¿™æ ·æ— è®ºå¦‚ä½•ï¼Œä¸¤ä¸ªcookieéƒ½ä¸ä¼šæ˜¯åŒdomainçš„äº†ã€‚æœç„¶ï¼Œç»“æœæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚





# ä¸è¶³

â€‹        è™½ç„¶è¿™ä¸ªè§£å†³æ–¹æ¡ˆé¿å¼€äº†åŒåŸŸçš„é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰å½»åº•è§£å†³ï¼Œæ¯•ç«ŸåŒåŸŸçš„ç³»ç»Ÿç›¸äº’ä¹‹é—´çš„è®¿é—®ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œä¸ºæ­¤å¸Œæœ›èƒ½è·å¾—æ›´å¤šçš„å»ºè®®æˆ–è€…èµ„æ–™ï¼Œè¡¥å……è¿™æ–¹é¢çŸ¥è¯†çš„ä¸è¶³ï¼Œè®©æˆ‘å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
