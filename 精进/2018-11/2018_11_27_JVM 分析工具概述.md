title: JVM åˆ†æå·¥å…·æ¦‚è¿°
date: 2018-11-27
tags:
categories: ç²¾è¿›
permalink: Fight/Overview-of-JVM-analysis-tools
author: å¾®ç¬‘é¢å¯¹ç”Ÿæ´»
from_url: https://juejin.im/post/5b59975fe51d4519700f70aa
wechat_url: https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247485724&idx=2&sn=744f48ad7a9ccbfaf132ee899a5e1442&chksm=fa4976adcd3effbbb5dd610fecff50a9e16094de00c31470baee9a397b2e576a17a17adda92a&token=582518212&lang=zh_CN#rd

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://juejin.im/post/5b59975fe51d4519700f70aa ã€Œå¾®ç¬‘é¢å¯¹ç”Ÿæ´»ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [JPS](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jstat](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jinfo](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jmap](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jhat ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼‰](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jstack](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [Jconsole](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)
- [visualVm](http://www.iocoder.cn/Fight/Overview-of-JVM-analysis-tools/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# JPS

> java process status æŸ¥çœ‹è¿›ç¨‹

#### jps

```Bash
C:\Users\84407>jps
13680 Jps
14704 JConsole
10148 Launcher
8788
10844 ThreadConsole
```

#### jps -q

ä»…ä»…æ˜¾ç¤ºVM æ ‡ç¤ºï¼Œä¸æ˜¾ç¤ºjar,class, mainå‚æ•°ç­‰ä¿¡æ¯

```Bash
C:\Users\84407>jps -q
18324
15336
19144
19816

```

#### jps -m

è¾“å‡ºä¸»å‡½æ•°ä¼ å…¥çš„å‚æ•°

```Bash
C:\Users\84407>jps -m
15336 ThreadConsole
19144
19816 Launcher C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/annotations.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/httpclient-4.5.2.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/slf4j-api-1.7.10.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/log4j.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/snappy-in-java-0.5.1.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/util.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/jna.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/idea_rt.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/jps-model.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/jna-platform.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/oro-2.0.8.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/aether-dependency-resolver.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/httpcore-4.4.5.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/netty-all-4.1.13.Final.jar;C:/Program Files/
19148 Jps -m
```

IntelliJ IDEAçš„pidï¼š19816ï¼Œå‚æ•°å°±æ˜¯åé¢é‚£ä¸€å¤§å †

#### jps  -l

è¾“å‡ºåº”ç”¨ç¨‹åºä¸»ç±»å®Œæ•´packageåç§°æˆ–jarå®Œæ•´åç§°

```Bash
C:\Users\84407>jps -l
15336 com.jvm.jconsole.ThreadConsole
19144
19816 org.jetbrains.jps.cmdline.Launcher
9704 jdk.jcmd/sun.tools.jps.Jps
```

#### jps  -v

åˆ—å‡ºjvmå‚æ•°

```Bash
15336 ThreadConsole -javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\lib\idea_rt.jar=61866:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\bin -Dfile.encoding=UTF-8
19144  -Xms128m -Xmx750m -XX:ReservedCodeCacheSize=240m -XX:+UseConcMarkSweepGC -XX:SoftRefLRUPolicyMSPerMB=50 -ea -Dsun.io.useCanonCaches=false -Djava.net.preferIPv4Stack=true -XX:+HeapDumpOnOutOfMemoryError -XX:-OmitStackTraceInFastThrow -Dide.no.platform.update=true -Djb.vmOptionsFile=C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\bin\idea64.exe.vmoptions -Didea.jre.check=true -Dide.native.launcher=true -Didea.paths.selector=IntelliJIdea2018.1 -XX:ErrorFile=C:\Users\84407\java_error_in_idea_%p.log -XX:HeapDumpPath=C:\Users\84407\java_error_in_idea.hprof
19816 Launcher -Xmx700m -Djava.awt.headless=true -Djava.endorsed.dirs="" -Djdt.compiler.useSingleThread=true -Dpreload.project.path=D:/workspace/java-nio-and-netty-spring-demo -Dpreload.config.path=C:/Users/84407/.IntelliJIdea2018.1/config/options -Dcompile.parallel=false -Drebuild.on.dependency.change=true -Djava.net.preferIPv4Stack=true -Dio.netty.initialSeedUniquifier=-6623792082140627021 -Dfile.encoding=GBK -Duser.language=zh -Duser.country=CN -Didea.paths.selector=IntelliJIdea2018.1 -Didea.home.path=C:\Program Files\JetBrains\IntelliJ IDEA 2018.1 -Didea.config.path=C:\Users\84407\.IntelliJIdea2018.1\config -Didea.plugins.path=C:\Users\84407\.IntelliJIdea2018.1\config\plugins -Djps.log.dir=C:/Users/84407/.IntelliJIdea2018.1/system/log/build-log -Djps.fallback.jdk.home=C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/jre64 -Djps.fallback.jdk.version=1.8.0_152-release -Dio.netty.noUnsafe=true -Djava.io.tmpdir=C:/Users/84407/.IntelliJIdea2018.1/system/compile-server/java-nio-and-netty-spring-demo_64d579b4/_temp_ -Djps.backw
15052 Jps -Denv.class.path=.;C:\Program Files\Java\jdk-10\lib;C:\Program Files\Java\jre-10\lib; -Dapplication.home=C:\Program Files\Java\jdk-10 -Xms8m -Djdk.module.main=jdk.jcmd

```

è¯¦æƒ…è¯·å‚è€ƒï¼šhttps://docs.oracle.com/javase/8/docs/technotes/tools/unix/jps.html

# Jstat

ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€jitç¼–è¯‘ä¿¡æ¯

Mï¼šè¡¨ç¤ºå…ƒç©ºé—´ï¼Œä¸å†è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚

# Jinfo

> å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºçš„å„é¡¹å‚æ•°

#### jinfo -flags 

æŸ¥çœ‹jvmçš„å‚æ•°

```Bash
C:\Users\84407>jinfo -flags 15336
VM Flags:
-XX:CICompilerCount=3 -XX:InitialHeapSize=201326592 -XX:MaxHeapSize=3196059648 -XX:MaxNewSize=1065353216 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=67108864 -XX:OldSize=134217728 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
```

#### jinfo -sysprops 

æŸ¥çœ‹javaç³»ç»Ÿå‚æ•°

```Bash
...
user.name=84407
java.vm.specification.version=1.8
sun.java.command=com.jvm.jconsole.ThreadConsole
java.home=C\:\\Program Files\\Java\\jdk1.8.0_144\\jre
sun.arch.data.model=64
user.language=zh
java.specification.vendor=Oracle Corporation
awt.toolkit=sun.awt.windows.WToolkit
java.vm.info=mixed mode
java.version=1.8.0_144
java.ext.dirs=C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\ext;C\:\\WINDOWS\\Sun\\Java\\lib\\ext
sun.boot.class.path=C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\resources.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\rt.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\sunrsasign.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\jsse.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\jce.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\charsets.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\lib\\jfr.jar;C\:\\Program Files\\Java\\jdk1.8.0_144\\jre\\classes
java.vendor=Oracle Corporation
file.separator=\\
java.vendor.url.bug=http\://bugreport.sun.com/bugreport/
sun.io.unicode.encoding=UnicodeLittle
sun.cpu.endian=little
sun.desktop=windows
sun.cpu.isalist=amd64
...

```

#### jinfo -flag -PrintGC 

è¡¨ç¤ºç¦ç”¨GCæ—¥å¿—çš„æ‰“å°,æ³¨æ„æ˜¯å‡å·

#### jinfo -flag +PrintGC 

è¡¨ç¤ºå¯ç”¨GCæ—¥å¿—çš„æ‰“å°ï¼Œæ³¨æ„æ˜¯åŠ å·

#### jinfo -flag PrintGC 

æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†GCæ—¥å¿—çš„æ‰“å°ï¼Œæ³¨æ„æ²¡æœ‰åŠ å‡å·

è¯¦æƒ…è¯·å‚è€ƒï¼šhttps://docs.oracle.com/javase/8/docs/technotes/tools/unix/jinfo.html#BCGEBFDD

------

# Jmap

> æ‰“å°JVMå †å†…å¯¹è±¡æƒ…å†µ,æŸ¥è¯¢Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½¿ç”¨ç‡ï¼Œä½¿ç”¨å¤§å°

#### jmap -finalizerinfo

æ‰“å°æ­£ç­‰å€™å›æ”¶çš„å¯¹è±¡çš„ä¿¡æ¯ã€‚

#### jmap -heap

æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ï¼ŒGCä½¿ç”¨çš„ç®—æ³•ï¼Œheapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µ

#### jmap -clstats

æ‰“å°classloadçš„ä¿¡æ¯ã€‚åŒ…å«æ¯ä¸ªclassloaderçš„åå­—ã€æ´»æ³¼æ€§ã€åœ°å€ã€çˆ¶classloaderå’ŒåŠ è½½çš„classæ•°é‡

#### jmap   -histo[:live] 

æ‰“å°å †çš„ç›´æ–¹å›¾

#### jmap -clstats

æ‰“å°classloadçš„ä¿¡æ¯ã€‚åŒ…å«æ¯ä¸ªclassloaderçš„åå­—ã€æ´»æ³¼æ€§ã€åœ°å€ã€çˆ¶classloaderå’ŒåŠ è½½çš„classæ•°é‡

#### jmap -dump:format=b,file=d:\a.bin pid

ç”Ÿæˆå †ä¿¡æ¯ï¼Œå¹¶å­˜åˆ°d:\a.binè¿™ä¸ªæ–‡ä»¶

#### jmap -histo pid | more

æŸ¥çœ‹ç±»å’Œå®ä¾‹æ•°é‡å’Œè¯¦æƒ…ï¼š

# Jhat ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼‰

jvm heap analysis tool jvmå †åˆ†æå·¥å…·

#### jhat d:\a.bin

åˆ†æå †ä¿¡æ¯æ–‡ä»¶ï¼Œç„¶åé»˜è®¤å¼€7000ç«¯å£ï¼Œä»¥ç½‘é¡µçš„å½¢å¼æ˜¾ç¤º

#### oql

object query languageï¼Œå¯¹è±¡æŸ¥è¯¢è¯­è¨€

# Jstack

> æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯

#### jstack 

æŸ¥çœ‹æŸä¸ªJavaè¿›ç¨‹å†…çš„çº¿ç¨‹å †æ ˆä¿¡æ¯

#### jstack -l 

åœ¨å‘ç”Ÿæ­»é”æ—¶å¯ä»¥ç”¨jstack -l pidæ¥è§‚å¯Ÿé”æŒæœ‰æƒ…å†µ

```Java
"Finalizer" #3 daemon prio=8 os_prio=1 tid=0x00000000033b9000 nid=0x268c in Object.wait() [0x000000001b7be000]
   java.lang.Thread.State: WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        - waiting on <0x0000000780808ec8> (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
        - locked <0x0000000780808ec8> (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

   Locked ownable synchronizers:
        - None

```

#### jstack -m 

ä¸ä»…ä¼šè¾“å‡ºJavaå †æ ˆä¿¡æ¯ï¼Œè¿˜ä¼šè¾“å‡ºC/C++å †æ ˆä¿¡æ¯ï¼ˆæ¯”å¦‚Nativeæ–¹æ³•ï¼‰

# Jconsole

#### å†…å­˜ç›‘æ§



![img](https://user-gold-cdn.xitu.io/2018/7/26/164d5f7727cda937?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)



#### çº¿ç¨‹ç›‘æ§

ç”¨ä¸‹é¢è¿™æ®µä»£ç æ¥æµ‹è¯•ï¼š

```Java
public class ThreadConsole {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        scanner.next();

        new Thread(new Runnable() {
            @Override
            public void run() {
                while (true){
                    //ç©ºè½¬
                }
            }
        },"while thread").start();
        scanner.next();
        new Thread(new Runnable() {
            @Override
            public void run() {
                Object object = new Object();
                synchronized (object){
                    try {
                        object.wait();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }
        }).start();
    }
}

```



![ç¬¬ä¸€æ¬¡è¾“å…¥å‰](https://user-gold-cdn.xitu.io/2018/7/26/164d5f7727e36bcb?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)





![ç¬¬ä¸€æ¬¡è¾“å…¥å&ç¬¬äºŒæ¬¡è¾“å…¥å‰](https://user-gold-cdn.xitu.io/2018/7/26/164d5f7728045f35?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)





![ç¬¬äºŒæ¬¡è¾“å…¥å](https://user-gold-cdn.xitu.io/2018/7/26/164d5f7727ddedc3?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)



#### æ£€æŸ¥æ­»é”

```Java
/**
 * æ¨¡æ‹Ÿæ­»é”å¹¶ç”¨jconsoleè¿›è¡Œæ£€æµ‹
 *
 * Created by Fant.J.
 */
public class DeadLock {
    public static void main(String[] args) {
        Object o1 = new Object();
        Object o2 = new Object();
        new Thread(new Runnable() {
            @Override
            public void run() {
                synchronized (o1){
                    try {
                        System.out.println("è·å–åˆ°o1çš„é”");
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    synchronized (o2){
                        System.out.println("è·å–åˆ°o2çš„é”");
                    }
                }
            }
        }).start();
        new Thread(new Runnable() {
            @Override
            public void run() {
                synchronized (o2){
                    try {
                        System.out.println("è·å–åˆ°o2çš„é”");
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    synchronized (o1){
                        System.out.println("è·å–åˆ°o1çš„é”");
                    }
                }
            }
        }).start();
    }
}


```



![çº¿ç¨‹1](https://user-gold-cdn.xitu.io/2018/7/26/164d5f77280d29aa?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)





![çº¿ç¨‹0](https://user-gold-cdn.xitu.io/2018/7/26/164d5f7728775957?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)





![æ­»é”æ£€æŸ¥](https://user-gold-cdn.xitu.io/2018/7/26/164d5f77562718eb?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)





![æ­»é”æŸ¥çœ‹](https://user-gold-cdn.xitu.io/2018/7/26/164d5f775c0cc731?imageView2/0/w/1280/h/960/format/jpeg/ignore-error/1)



# visualVm

ä¸‹è½½åœ°å€ï¼šhttps://visualvm.github.io/download.html ä½¿ç”¨ä¸€çœ‹å°±æ‡‚ï¼Œä¸åšæ¼”ç¤º