title: Git æäº¤è®°å½•å’Œåˆ†æ”¯æ¨¡å‹
date: 2018-12-11
tags:
categories: ç²¾è¿›
permalink: Fight/Git-commits-records-and-branching-models
author: çŒ«å°¾
from_url: https://cattail.me/tech/2016/06/06/git-commit-message-and-branching-model.html
wechat_url: https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247485785&idx=2&sn=00898cd79afaf2e840344f864ca0d166&chksm=fa4976e8cd3efffe6c5d806d09c390eb6f073b4d8634a35fcf3873e66f6dadcbaecb551455b4&token=55862109&lang=zh_CN#rd

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://cattail.me/tech/2016/06/06/git-commit-message-and-branching-model.html ã€ŒçŒ«å°¾ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [Commit Message](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
  - [æ ¼å¼](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
  - [åº”ç”¨](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
  - [Commitizen](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
- [Branching Model](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
  - [gitflow](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)
  - [ç›¸å…³é“¾æ¥](http://www.iocoder.cn/Fight/Git-commits-records-and-branching-models/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

ä¸¤å¹´å‰ç¼–å†™çš„æ–‡ç«  [Git Style](https://cattail.me/tech/2013/08/21/git-style.html)ï¼Œæ˜¯å‚è€ƒä¸šç•Œå®è·µå¯¹ Git æäº¤è®°å½•æ ¼å¼å’Œåˆ†æ”¯æ¨¡å‹æ‰€åšçš„æ€»ç»“ã€‚**æœ¬æ–‡åœ¨ Git Style åŸºç¡€ä¸Šï¼Œå†æ¬¡æè¿°æäº¤è®°å½•çš„æ ¼å¼å’Œåˆ†æ”¯æ¨¡å‹ï¼Œå¹¶ä»‹ç»ä¸¤ä¸ªå·¥å…· commitizen å’Œ gitflowï¼Œåˆ†åˆ«å¤„ç†ç»´æŠ¤æäº¤è®°å½•æ ¼å¼å’Œåˆ†æ”¯åˆ‡æ¢çš„å·¥ä½œ**ã€‚

# Commit Message

åœ¨ Git Style ä¸­å·²ç»ä»‹ç»äº†æäº¤è®°å½•ï¼ˆCommit Messageï¼‰çš„æ ¼å¼ï¼Œä½†æ˜¯æ²¡æœ‰è¯´æ˜ä¸ºä»€ä¹ˆè¦éµå¾ªè¿™æ ·çš„çº¦å®šã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªæ ¼å¼å‚è€ƒäº† [AngularJSâ€™s commit message convention](https://github.com/angular/angular.js/blob/f3377da6a748007c11fde090890ee58fae4cefa5/CONTRIBUTING.md#commit)ï¼Œè€Œ AngularJS åˆ¶å®šè¿™æ ·çš„çº¦å®šæ˜¯å‡ºäºå‡ ä¸ªç›®çš„

- è‡ªåŠ¨ç”Ÿæˆ CHANGELOG.md
- è¯†åˆ«ä¸é‡è¦çš„æäº¤
- ä¸ºæµè§ˆæäº¤å†å²æ—¶æä¾›æ›´å¥½çš„ä¿¡æ¯

åé¢ç®€ç§° AngularJSâ€™s commit message convention ä¸º conventional messageã€‚

## æ ¼å¼

**Conventional message æ ¼å¼**æ˜¯è¿™æ ·çš„

```XML
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

`subject` æ˜¯å¯¹å˜æ›´çš„ç®€è¦æè¿°ã€‚

`body` æ˜¯æ›´ä¸ºè¯¦ç»†çš„æè¿°ã€‚

`type` åˆ™å®šä¹‰äº†æ­¤æ¬¡å˜æ›´çš„ç±»å‹ï¼Œåªèƒ½ä½¿ç”¨ä¸‹é¢å‡ ç§ç±»å‹

- featï¼šå¢åŠ æ–°åŠŸèƒ½
- fixï¼šé—®é¢˜ä¿®å¤
- docsï¼šæ–‡æ¡£å˜æ›´
- styleï¼šä»£ç é£æ ¼å˜æ›´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- refactorï¼šæ—¢ä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯é—®é¢˜ä¿®å¤çš„ä»£ç å˜æ›´
- perfï¼šæ”¹å–„æ€§èƒ½
- testï¼šå¢åŠ æµ‹è¯•
- choreï¼šå¼€å‘å·¥å…·ï¼ˆæ„å»ºï¼Œè„šæ‰‹æ¶å·¥å…·ç­‰ï¼‰

`footer` å¯ä»¥åŒ…å« Breaking Changes å’Œ Closes ä¿¡æ¯ã€‚

## åº”ç”¨

[node-trail-agent](https://github.com/open-trail/node-trail-agent) é¡¹ç›®éµå¾ª conventional messageï¼Œè¿™é‡Œä»¥è¿™ä¸ªé¡¹ç›®ä¸¾ä¾‹ï¼Œæ¼”ç¤ºå…¶åº”ç”¨åœºæ™¯ã€‚

**CHANGELOG**

é€šè¿‡ `git log` å¯ä»¥ç”Ÿæˆ CHANGELOG.md ä¸­ç‰ˆæœ¬é—´æ–°å¢åŠŸèƒ½ï¼Œ

```Bash
$ git log v0.4.0..v1.1.2 --grep feat --pretty=format:%s

feat: add "type" tag to distinguish client and server span
feat: instrument via Module._load hook
```

ä¹Ÿå¯ä»¥åŒæ—¶è·å–ä¿®å¤çš„é—®é¢˜ï¼Œ

```Bash
$ git log v0.4.0..v1.1.2 --grep 'feat\|fix' --pretty=format:%s

fix: wrapper function not returned
feat: add "type" tag to distinguish client and server span
feat: instrument via Module._load hook
```

**å®šä½é”™è¯¯**

ä½¿ç”¨ `git bisect` å¯ä»¥å®šä½å¼•å…¥é—®é¢˜çš„æäº¤ï¼Œé€šè¿‡ `type` å¯ä»¥å¿«é€Ÿè¾¨åˆ«ä¸ä¼šå¼•å…¥ bug çš„æäº¤ï¼Œ

```Bash
(master) $ git bisect start
(master) $ git bisect bad
(master) $ gco v0.1.0
(7f04616) $ git bisect good

Bisecting: 15 revisions left to test after this (roughly 4 steps)
[433f58f26a53b519ab7fc52927895e67eb068c64] docs: how to use agent

(433f58f) $ git bisect good

Bisecting: 7 revisions left to test after this (roughly 3 steps)
[02894fb497f41eecc7b21462d3b020687b3aaee2] docs(CHANGELOG): 1.1.0

(02894fb) $ git bisect good

Bisecting: 3 revisions left to test after this (roughly 2 steps)
[9d15ca2166075aa180cd38a3b4d3be22aa336575] chore(release): 1.1.1

(9d15ca2) $ git bisect good

Bisecting: 1 revision left to test after this (roughly 1 step)
[f024d7c0382c4ff8b0543cbd66c6fe05b199bfbc] fix: wrapper function not returned

(f024d7c) $ npm test
...
```

å› ä¸º docs æˆ– chore ä¸ä¼šå¼•å…¥ bugï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‰§è¡Œ `git bisect good`ã€‚

ä½¿ç”¨ `git bisect skip` å¯ä»¥ç›´æ¥è¿‡æ»¤æ‰è¿™äº›æäº¤ï¼Œ

```Bash
$ git bisect skip $(git rev-list --grep 'style\|docs\|chore' v0.1.0..HEAD)
```

## Commitizen

å‘½ä»¤è¡Œå·¥å…· [commitizen](https://github.com/commitizen/cz-cli) å¸®åŠ©å¼€å‘è€…ç”Ÿæˆç¬¦åˆ conventional message çš„æäº¤è®°å½•ã€‚

æˆåŠŸå®‰è£…å¹¶åˆå§‹åŒ– commitizen åï¼Œé€šè¿‡è°ƒç”¨ `git cz` æ¥æäº¤ä»£ç ï¼Œ

```Bash
$ git cz

Line 1 will be cropped at 100 characters. All other lines will be wrapped after 100 characters.

? Select the type of change that you're committing: (Use arrow keys)
â¯ feat:     A new feature
  fix:      A bug fix
  docs:     Documentation only changes
  style:    Changes that do not affect the meaning of the code
            (white-space, formatting, missing semi-colons, etc)
  refactor: A code change that neither fixes a bug or adds a feature
  perf:     A code change that improves performance
```

æäº¤åä¼šæŒ‰ç…§ convertional message æ ¼å¼åŒ–æäº¤è®°å½•ï¼Œ

```Bash
commit f024d7c0382c4ff8b0543cbd66c6fe05b199bfbc
Author: zhongchiyu <zhongchiyu@gmail.com>
Date:   Mon May 30 14:49:17 2016 +0800

    fix: wrapper function not returned
```

é™¤æ­¤ä¹‹å¤–ï¼Œcommitizen è¿˜ä¾æ® conventional messageï¼Œåˆ›å»ºèµ·ä¸€ä¸ªç”Ÿæ€

- [conventional-changelog-cli](https://github.com/conventional-changelog/conventional-changelog-cli)ï¼šé€šè¿‡æäº¤è®°å½•ç”Ÿæˆ CHANGELOG.md
- [conventional-github-releaser](https://github.com/conventional-changelog/conventional-github-releaser)ï¼šé€šè¿‡æäº¤è®°å½•ç”Ÿæˆ github release ä¸­çš„å˜æ›´æè¿°
- [conventional-recommended-bump](https://github.com/conventional-changelog/conventional-recommended-bump)ï¼šæ ¹æ®æäº¤è®°å½•åˆ¤æ–­éœ€è¦å‡çº§ [Semantic Versioning](http://semver.org/) å“ªä¸€ä½ç‰ˆæœ¬å·
- [validate-commit-msg](https://github.com/kentcdodds/validate-commit-msg)ï¼šæ£€æŸ¥æäº¤è®°å½•æ˜¯å¦ç¬¦åˆçº¦å®š

ä½¿ç”¨è¿™äº›å·¥å…·å¯ä»¥ç®€åŒ– npm åŒ…çš„å‘å¸ƒæµç¨‹ï¼Œ

```Bash
#! /bin/bash

# https://gist.github.com/stevemao/280ef22ee861323993a0
# npm install -g commitizen cz-conventional-changelog trash-cli conventional-recommended-bump conventional-changelog-cli conventional-commits-detector json
trash node_modules &>/dev/null;
git pull --rebase &&
npm install &&
npm test &&
cp package.json _package.json &&
preset=`conventional-commits-detector` &&
echo $preset &&
bump=`conventional-recommended-bump -p angular` &&
echo ${1:-$bump} &&
npm --no-git-tag-version version ${1:-$bump} &>/dev/null &&
conventional-changelog -i History.md -s -p ${2:-$preset} &&
git add History.md &&
version=`cat package.json | json version` &&
git commit -m"docs(CHANGELOG): $version" &&
mv -f _package.json package.json &&
npm version ${1:-$bump} -m "chore(release): %s" &&
git push --follow-tags &&
npm publish
```

è¿è¡Œä¸Šè¿°è„šæœ¬ä¼šæ›´æ–° CHANGELOG.mdã€å‡çº§ç‰ˆæœ¬å·å¹¶å‘å¸ƒæ–°ç‰ˆæœ¬åˆ° npmï¼Œæ‰€æœ‰è¿™äº›æ“ä½œéƒ½åŸºäºæäº¤è®°å½•è‡ªåŠ¨å¤„ç†ã€‚

# Branching Model

[Vincent Driessen](http://nvie.com/about/) çš„åˆ†æ”¯æ¨¡å‹ï¼ˆBranching Modelï¼‰ä»‹ç» Git åˆ†æ”¯å’Œå¼€å‘ï¼Œéƒ¨ç½²ï¼Œé—®é¢˜ä¿®å¤æ—¶çš„å·¥ä½œæµç¨‹ï¼Œ

![workflow](http://static.iocoder.cn/fe036a9a914ffe39c36c0bcdf91e12d6)

> Author: Vincent Driessen Original blog post: http://nvie.com/posts/a-succesful-git-branching-model License: Creative Commons BY-SA

åœ¨æ•´ä¸ªå¼€å‘æµç¨‹ä¸­ï¼Œå§‹ç»ˆå­˜åœ¨ master å’Œ develop åˆ†æ”¯ï¼Œå…¶ä¸­ master åˆ†æ”¯ä»£ç å’Œç”Ÿäº§ç¯å¢ƒä»£ç ä¿æŒä¸€è‡´ï¼Œdevelop åˆ†æ”¯è¿˜åŒ…æ‹¬æ–°åŠŸèƒ½ä»£ç ã€‚

**åˆ†æ”¯æ¨¡å‹ä¸»è¦æ¶‰åŠä¸‰ä¸ªè¿‡ç¨‹ï¼šåŠŸèƒ½å¼€å‘ï¼Œä»£ç å‘å¸ƒå’Œé—®é¢˜ä¿®å¤**ã€‚

**åŠŸèƒ½å¼€å‘**

1. ä» develop åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼ˆfeature/*ï¼‰
2. åŠŸèƒ½å¼€å‘
3. ç”Ÿäº§ç¯å¢ƒæµ‹è¯•
4. Review
5. Merge å› develop åˆ†æ”¯

**ä»£ç å‘å¸ƒ**

éœ€è¦å‘å¸ƒæ–°åŠŸèƒ½åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶

1. ä» develop åˆ›å»ºæ–°åˆ†æ”¯ï¼ˆrelease/*ï¼‰
2. å‘å¸ƒ feature åˆ†æ”¯ä»£ç åˆ°é¢„ä¸Šçº¿ç¯å¢ƒ
3. æµ‹è¯•å¹¶ä¿®å¤é—®é¢˜
4. Review
5. åˆ†åˆ« merge å› develop å’Œ master åˆ†æ”¯
6. å‘å¸ƒ master ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒ

**é—®é¢˜ä¿®å¤**

å½“ç”Ÿäº§ç¯å¢ƒä»£ç å‡ºç°é—®é¢˜éœ€è¦ç«‹åˆ»ä¿®å¤æ—¶

1. ä» master åˆ›å»ºæ–°åˆ†æ”¯ï¼ˆhotfix/*ï¼‰
2. å‘å¸ƒ hotfix ä»£ç åˆ°é¢„ä¸Šçº¿ç¯å¢ƒ
3. ä¿®å¤é—®é¢˜å¹¶æµ‹è¯•
4. Review
5. åˆ†åˆ« merge ä¼š develop å’Œ master åˆ†æ”¯
6. å‘å¸ƒ master ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒ

è¯¥åˆ†æ”¯æ¨¡å‹å€¼å¾—å€Ÿé‰´çš„åœ°æ–¹åŒ…æ‹¬ï¼Œ

- **è§„èŒƒçš„åˆ†æ”¯å‘½å**
- **å°†åˆ†æ”¯å’Œä»£ç è¿è¡Œç¯å¢ƒå…³è”èµ·æ¥**

åˆ†æ”¯å’Œä»£ç è¿è¡Œç¯å¢ƒçš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œ

- master => ç”Ÿäº§ç¯å¢ƒ
- release/*ï¼Œhotfix/* => é¢„ä¸Šçº¿ç¯å¢ƒ
- feature/*ï¼Œdevelop => å¼€å‘ç¯å¢ƒ

## gitflow

Vincent Driessen çš„åˆ†æ”¯æ¨¡å‹å°†å¼€å‘æµç¨‹å’ŒGitåˆ†æ”¯å¾ˆå¥½çš„ç»“åˆèµ·æ¥ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­æ¶‰åŠå¤æ‚çš„åˆ†æ”¯åˆ‡æ¢ï¼Œ[gitflow](https://github.com/nvie/gitflow) å¯ä»¥ç®€åŒ–è¿™äº›å·¥ä½œã€‚

å®‰è£…å¹¶åœ¨ä»£ç ä»“åº“åˆå§‹åŒ– gitflow åï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒå®Œæˆåˆ†æ”¯å·¥ä½œæµç¨‹ï¼Œ

```Bash
$ git flow init

No branches exist yet. Base branches must be created now.
Branch name for production releases: [master]
Branch name for "next release" development: [develop]

How to name your supporting branch prefixes?
Feature branches? [feature/]
Release branches? [release/]
Hotfix branches? [hotfix/]
Support branches? [support/]
Version tag prefix? []
```

**åŠŸèƒ½å¼€å‘**

å¼€å§‹å¼€å‘æ—¶

```Bash
(develop) $ git flow feature start demo

Switched to a new branch 'feature/demo'

Summary of actions:
- A new branch 'feature/demo' was created, based on 'develop'
- You are now on branch 'feature/demo'
```

å®Œæˆå¼€å‘å

```Bash
(feature/demo) $ git flow feature finish demo

Switched to branch 'develop'
Already up-to-date.
Deleted branch feature/demo (was 48fbada).

Summary of actions:
- The feature branch 'feature/demo' was merged into 'develop'
- Feature branch 'feature/demo' has been removed
- You are now on branch 'develop'
```

**ä»£ç å‘å¸ƒ**

å‘å¸ƒä»£ç å‰

```Bash
(develop) $ git flow release start demo

Switched to a new branch 'release/demo'

Summary of actions:
- A new branch 'release/demo' was created, based on 'develop'
- You are now on branch 'release/demo'
```

æµ‹è¯•å®Œæˆå‡†å¤‡ä¸Šçº¿æ—¶

```Bash
(release/demo) $ git flow release finish demo

Switched to branch 'master'
Deleted branch release/demo (was 48fbada).

Summary of actions:
- Latest objects have been fetched from 'origin'
- Release branch has been merged into 'master'
- The release was tagged 'demo'
- Release branch has been back-merged into 'develop'
- Release branch 'release/demo' has been deleted
```

å‘å¸ƒ master ä»£ç åˆ°çº¿ä¸Šç¯å¢ƒ

**é—®é¢˜ä¿®å¤**

å‘ç°çº¿ä¸Šæ•…éšœæ—¶ï¼Œ

```Bash
(master) $ git flow hotfix start demo-hotfix

Switched to a new branch 'hotfix/demo-hotfix'

Summary of actions:
- A new branch 'hotfix/demo-hotfix' was created, based on 'master'
- You are now on branch 'hotfix/demo-hotfix'
```

ä¿®å¤é—®é¢˜å

```Bash
(hotfix/demo-hotfix) $ git flow hotfix finish demo-hotfix

Deleted branch hotfix/demo-hotfix (was 48fbada).

Summary of actions:
- Latest objects have been fetched from 'origin'
- Hotfix branch has been merged into 'master'
- The hotfix was tagged 'demo-hotfix'
- Hotfix branch has been back-merged into 'develop'
- Hotfix branch 'hotfix/demo-hotfix' has been deleted
```

## ç›¸å…³é“¾æ¥

- [commitizen](https://github.com/commitizen/cz-cli)
- [gitflow](https://github.com/nvie/gitflow)
- [AngularJS Git Commit Message Conventions](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit)
- [Git Style](https://cattail.me/tech/2013/08/22/git-style.html)
- [node-trail-agent](https://github.com/open-trail/node-trail-agent)
- [A successful Git branching model](http://nvie.com/posts/a-successful-git-branching-model/)
- [Using git-flow to automate your git branching workflow](http://jeffkreeftmeijer.com/2010/why-arent-you-using-git-flow/)
