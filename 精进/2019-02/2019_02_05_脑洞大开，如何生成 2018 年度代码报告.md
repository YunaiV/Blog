title: è„‘æ´å¤§å¼€ï¼Œå¦‚ä½•ç”Ÿæˆ 2018 å¹´åº¦ä»£ç æŠ¥å‘Š
date: 2019-02-05
tags:
categories: ç²¾è¿›
permalink: Fight/2018_annual_code_report
author: zhenbianshu
from_url: https://zhenbianshu.github.io/2019/01/2018_annual_code_report.html
wechat_url: https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247486061&idx=1&sn=1680696c615ffe688c13d48f00709a3d&chksm=fa4975dccd3efcca3820776cff4b7be1e2d15a8bbf0cc527cef7a1875f5de536a70d86342b07&token=810316232&lang=zh_CN#rd

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://zhenbianshu.github.io/2019/01/2018_annual_code_report.html ã€Œzhenbianshuã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [æ”¶é›†ä¿¡æ¯](http://www.iocoder.cn/Fight/2018_annual_code_report/)
- [åˆ†æ](http://www.iocoder.cn/Fight/2018_annual_code_report/)
- [å›¾ç‰‡å¤„ç†](http://www.iocoder.cn/Fight/2018_annual_code_report/)
- [æˆæœ](http://www.iocoder.cn/Fight/2018_annual_code_report/)
- [å°ç»“](http://www.iocoder.cn/Fight/2018_annual_code_report/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

æ˜¨å¤©ç½‘æ˜“äº‘éŸ³ä¹ã€Bç«™ç­‰ APP éƒ½æ”¾å‡ºäº†ç”¨æˆ·çš„ 2018 å¹´åº¦ä½¿ç”¨æŠ¥å‘Šï¼Œåœ¨æœ‹å‹åœˆæ€èµ·äº†ä¸€è‚¡å¹´åº¦æŠ¥å‘Šçš„çƒ­æ½®ï¼Œæˆ‘æ˜¨å¤©åœ¨åˆ·å¾®åšæ—¶çœ‹åˆ°â€ç²¾åˆ†å›â€åˆ†äº«çš„ã€Šå¹´åº¦éª‚äººæŠ¥å‘Šã€‹åï¼Œåœ¨è¢«ç¬‘å¾—çœ¼æ³ªéƒ½å‡ºæ¥çš„åŒæ—¶ï¼Œä¹Ÿåœ¨æƒ³æˆ‘æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‡ºä¸€ä¸ªã€Šå¹´åº¦ä»£ç æŠ¥å‘Šã€‹å‘¢ï¼Ÿ

# æ”¶é›†ä¿¡æ¯

å¾—ç›Šäºä»Šå¹´å·¥ä½œçš„ç¨³å®šï¼Œæ‰€æœ‰æœ¬åœ°ä»£ç ä»“åº“éƒ½è€å®åœ°æ”¾åœ¨å„ä¸ª jetBean è½¯ä»¶ç›®å½•ä¸‹ï¼Œè€Œä¸”ä»£ç ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¸Šï¼Œå·¥ä½œç”¨ Gitlabï¼Œä¸šä½™ç”¨ Githubï¼Œéƒ½å±äº git ç³»åˆ—ï¼Œæ‰€æœ‰çš„æäº¤è®°å½•éƒ½å¯ä»¥ä» git log é‡ŒæŸ¥è¯¢åˆ°ï¼Œæå¤§åœ°æ–¹ä¾¿äº†æˆ‘æ”¶é›†ä¿¡æ¯ã€‚

### git log

ä½¿ç”¨ `git log` å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŸ¥çœ‹ git çš„æäº¤è®°å½•ï¼Œæˆ‘ä»¬åœ¨ git ç›®å½•ä¸‹ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ä½¿ç”¨ git log å‘½ä»¤æ—¶ï¼Œä¼šåƒå¹³å¸¸ä½¿ç”¨ less ç­‰å‘½ä»¤æ—¶ï¼Œè¿›å…¥ä¸€ä¸ªå†…å®¹æµè§ˆç•Œé¢ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç¿»é¡µä»å‰åˆ°åæŸ¥çœ‹æ‰€æœ‰çš„ git æäº¤è®°å½•ã€‚ä½¿ç”¨ `>` å†…å®¹é‡å®šå‘ç¬¦å¯ä»¥æŠŠ git log é‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çœ‹åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ï¼š

```Bash
commit ee66af2de2e0b11bb9c987969916fcf486c25f1e
Author: zhenbianshu <zhenbianshu@foxmail.com>
Date:   Thu Dec 27 19:32:28 2018 +0800

    fix site base url;
```

å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€æ¡æäº¤è®°å½•éƒ½è¢«æ‹†åˆ†æˆäº†å¤šè¡Œï¼Œè€Œä¸”å¦‚æœ commit comment æœ‰å¤šè¡Œçš„è¯ï¼Œæ—¥å¿—ä¼šæ›´ä¸è§„åˆ™ã€‚git log æä¾›äº† `--pretty` å‚æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬æå–æŒ‡å®šå­—æ®µï¼Œå¹¶å°†å®ƒä»¬é›†æˆåˆ°åŒä¸€è¡Œã€‚

pretty å‚æ•°çš„ç”¨æ³•ä¸º `git log --pretty="FORMAT"`ï¼Œå¦‚æˆ‘ä»¬å¸¸ç”¨çš„ printf å‡½æ•°ä¸€æ ·ï¼Œå¯ä»¥åœ¨ FORMAT ä¸­æŒ‡å®šéœ€è¦å­—æ®µçš„å ä½ç¬¦ï¼Œå„ä¸ªå­—æ®µå¯¹åº”çš„å ä½ç¬¦éƒ½å¯ä»¥åœ¨ Git å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥æ‰¾åˆ°ï¼Œè¿™é‡Œæˆ‘åªéœ€è¦ `%h(çŸ­ hash)ã€%cd(å®Œæ•´æäº¤æ—¶é—´)ã€%s(æäº¤æ—¶çš„ comment)`ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ `--after` å„ `--before` é™åˆ¶ git log çš„æ—¶é—´èŒƒå›´ï¼Œåœ¨å¤šäººåˆä½œçš„é¡¹ç›®ä¸­ï¼Œè¿˜éœ€è¦ä½¿ç”¨ `--author`é™å®šæäº¤çš„ä½œè€…ï¼Œæœ€ç»ˆå®Œæ•´çš„å‘½ä»¤å¦‚ä¸‹ï¼š

```Bash
git log --after="2018-01-01" --before="2019-01-01" --author="zhenbianshu" --no-merges --pretty=format:"%h | %cd | %s" >> /tmp/git.log
```

### æ·»åŠ ä¿¡æ¯

é€šè¿‡ git logï¼Œæˆ‘æ‹¿åˆ°åƒè¿™æ ·çš„æäº¤ä¿¡æ¯ï¼š`81cb3a0bb | Fri Feb 9 10:25:12 2018 +0800 | fix bad smell;`ï¼Œç”±äºç¼ºå°‘é¡¹ç›®å’Œè¯­è¨€ä¿¡æ¯ï¼Œè¿˜éœ€è¦å®Œå–„ä¸€ä¸‹è¿™äº›æäº¤ä¿¡æ¯ã€‚

é¦–å…ˆï¼Œåœ¨ä¸Šä¸€æ­¥ï¼Œæˆ‘å°†å„ä¸ªé¡¹ç›®çš„ git log éƒ½ä¿å­˜åœ¨ `é¡¹ç›®.log` çš„æ–‡ä»¶é‡Œäº†ï¼Œä¸€å…±æœ‰ 20 ä¸ªé¡¹ç›®ï¼Œæ„å‘³ç€æˆ‘å»å¹´å‘ 20 ä¸ªä»“åº“è´¡çŒ®äº†ä»£ç ã€‚ ä½†è¿™äº›ä»“åº“ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æ˜¯æ²¡æ³•è‡ªåŠ¨è¯†åˆ«çš„ï¼Œæˆ‘åªå¥½æ‰‹åŠ¨æŠŠè¿™äº›ä»“åº“éƒ½æ”¾åˆ° `ç¼–ç¨‹è¯­è¨€` æ–‡ä»¶å¤¹å†…ï¼Œæœ€ç»ˆçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š

```Bash
./C/rsync.log
./go/gotorch.log
./Java/story.log
./shell/video-simulation.log
...
```

æ¥ä¸‹æ¥ï¼Œå†æŠŠå„ä¸ªæ–‡ä»¶çš„çš„è·¯å¾„åå¡«å……åˆ°å„è¡Œåæ•´åˆåˆ°ä¸€ä¸ªæ–‡ä»¶å°±è¡Œäº†ã€‚

è¿™é‡Œæˆ‘ä½¿ç”¨äº† `findã€ xargs å’Œ awk` å‘½ä»¤ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```Bash
find . -name "*.log" | xargs -I {} awk -v file="{}" '{print file,$0 }' {} >> /tmp/raw.log
```

xargs æŒ‡å®šäº† `{}` ä½œä¸º find æŸ¥åˆ°æ–‡ä»¶çš„æ›¿ä»£ç¬¦ï¼Œç„¶åä½¿ç”¨ awk çš„ `-v` é€‰é¡¹å°†æ–‡ä»¶åä½œä¸ºå˜é‡ä¼ å…¥æ¯ä¸€è¡Œã€‚

# åˆ†æ

### shell å‘½ä»¤

åˆ†æå…¶å®æŒºç®€å•ï¼Œå°±æ˜¯æŠŠå¸¸ç”¨çš„ linux å‘½ä»¤æ‰åˆä¸€ä¸‹ï¼Œæ— éæ˜¯ `awkã€grepã€sortã€uniqã€wc` ç­‰ã€‚

ä¸»è¦ç”¨åˆ°çš„å‘½ä»¤é€‰é¡¹æ˜¯ï¼š

- `grep -e XX -e YY` æœç´¢åŒ…å« XX æˆ–åŒ…å« YY çš„è¡Œ;
- `grep -E 'regex'` æŒ‰ç…§æ­£åˆ™æœç´¢ï¼›
- `awk '{if(A){B}}'` awk é‡Œçš„æ¡ä»¶åˆ¤æ–­è¯­å¥ã€‚
- `sort -f '*' -kn` ä»¥ * åˆ†éš”æ¯è¡Œåï¼ŒæŒ‰ç¬¬ n åˆ—æ’åºï¼›

### åˆ†æå‘½ä»¤

è´´ä¸¤ä¸ªæ‰€ç”¨çš„åˆ†æå‘½ä»¤å§ã€‚

- æäº¤ä»£ç æœ€å¤šæ—¶æ®µã€‚

  æˆ‘æŠŠä¸€å¤©çš„æ—¶é—´åˆ’åˆ†ä¸ºå››ä¸ªæ—¶æ®µï¼š 0-6ç‚¹å‡Œæ™¨ã€6-12ç‚¹ä¸Šåˆã€12-18ç‚¹åˆåã€18-24ç‚¹å¤œæ™šï¼Œå¯¹åº”å‘½ä»¤æ˜¯ï¼š `awk '{if($6>="00:00:00" && $6<"06:00:00"){print "å‡Œæ™¨"};if($6>="06:00:00" && $6<"12:00:00"){print "ä¸Šåˆ"};if($6>="12:00:00" && $6<"18:00:00"){print "åˆå"};if($6>="18:00:00" && $6<="23:59:59"){print "å¤œæ™š"};}' git.log | sort | uniq -C` ç»“æœæ˜¯:

  ```
   5 å‡Œæ™¨
   296 ä¸Šåˆ
   679 åˆå
   346 å¤œæ™š
  ```

- æäº¤å¤©æ•°æœ€å¤šçš„é¡¹ç›®ã€‚

  ç¬¬äºŒé¡¹æ˜¯é¡¹ç›®åï¼Œç¬¬äº”é¡¹æ˜¯æ—¥æœŸã€‚ `awk '{print $2,$5}' | sort | uniq | awk '{print $1}' | sort | uniq -c`

# å›¾ç‰‡å¤„ç†

æ•°æ®åˆ†æå‡ºæ¥ä¹‹åï¼Œå°±æ˜¯å¤„ç†å›¾ç‰‡äº†ã€‚

æˆ‘æ˜¯åœ¨ç½‘æ˜“äº‘éŸ³ä¹å¹´åº¦å¬æ­ŒæŠ¥å‘Šçš„åŸºç¡€ä¸Šæ”¹çš„ï¼ˆä¸ç”¨ä½œå•†ä¸šï¼Œåº”è¯¥æ²¡é—®é¢˜å§ï¼Œæœ‰é—®é¢˜è¯·ç§æˆ‘ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåƒ Photoshop ä¸€æ ·çš„ P å›¾å·¥å…·ï¼Œåœ¨ Mac ä¸Šæ¨èç”¨ `Pixelmator`ï¼ŒåŠŸèƒ½ä¸Šè·Ÿ Photoshop æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½†è½¯ä»¶å¤§å°æ‰ 100 å¤š Mï¼Œæ¯”åŠ¨è¾™ 1G å¤šçš„ Photoshop å¥½å¤šäº†ã€‚

è½¯ä»¶å·¥å…·ä¸Šï¼Œä¸»è¦ç”¨äº†è¡¥ä¸ã€æ–‡å­—ã€é€‰åŒºã€è£å‰ªã€å–è‰²ã€å€’è‰²ã€å›¾å±‚ç­‰å·¥å…·ï¼Œä¹‹å‰æœ‰äº› Ps åŸºç¡€ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ã€‚

# æˆæœ

ç„¶åå°±æ˜¯æˆæœå±•ç¤ºäº†ï¼Œæœ‰äº›åœ°æ–¹æŠ¹èŠ±äº†ï¼Œå‡‘åˆçœ‹å§~

![](https://zhenbianshu.github.io/images/2019/code_report_1.png)

![](https://zhenbianshu.github.io/images/2019/code_report_2.png)

![](https://zhenbianshu.github.io/images/2019/code_report_3.png)

![](https://zhenbianshu.github.io/images/2019/code_report_4.png)

![](https://zhenbianshu.github.io/images/2019/code_report_5.png)

![](https://zhenbianshu.github.io/images/2019/code_report_6.png)

![](https://zhenbianshu.github.io/images/2019/code_report_7.png)

![](https://zhenbianshu.github.io/images/2019/code_report_8.png)

![](https://zhenbianshu.github.io/images/2019/code_report_9.png)

# å°ç»“

åšäº›æœ‰æ„æ€çš„äº‹ï¼Œä»£ç å†™èµ·æ¥æ›´æ¬¢å¿«äº†å‘¢~

å¦å¤–ï¼Œshell ç”¨ç€çœŸèˆ’æœ~