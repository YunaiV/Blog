title: Zuul æ€§èƒ½æµ‹è¯•
date: 2018-01-08
tag: 
categories: Zuul
permalink: Zuul/laoxu/zuul-test
author: è€å¾
from_url: https://www.cnkirito.moe/zuul-test/
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.cnkirito.moe/zuul-test/ ã€Œè€å¾ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

  - [ç¯å¢ƒå‡†å¤‡](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)
  - [å‹æµ‹å·¥å…·å‡†å¤‡](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)
  - [æœåŠ¡å™¨,ç½‘å…³é…ç½®](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)
  - [ç›‘æ§å·¥å…·](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)
  - [å¼€å§‹æµ‹è¯•](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)
  - [æ€»ç»“](http://www.iocoder.cn/Zuul/laoxu/zuul-test/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

## ç¯å¢ƒå‡†å¤‡

é‡‡ç”¨ä¸‰å°é˜¿é‡Œäº‘æœåŠ¡å™¨ä½œä¸ºæµ‹è¯•
10.19.52.8 éƒ¨ç½²ç½‘å…³åº”ç”¨-gateway
10.19.52.9, 10.19.52.10 éƒ¨ç½²ç”¨äºæµ‹è¯•çš„ä¸šåŠ¡ç³»ç»Ÿ
[![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20170408122814192?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)](http://static.iocoder.cn/csdn/20170408122814192?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)è¿™é‡Œå†™å›¾ç‰‡æè¿°

## å‹æµ‹å·¥å…·å‡†å¤‡

é€‰ç”¨abä½œä¸ºå‹åŠ›æµ‹è¯•çš„å·¥å…·ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œç›´æ¥å°†abå·¥å…·å®‰è£…åœ¨10.19.52.8è¿™å°æœº
æµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š

```
ab -n 10000 -c 100 http://10.19.52.8:8080/hello/testOK?access_token=e0345712-c30d-4bf8-ae61-8cae1ec38c52
```

å…¶ä¸­ï¼nè¡¨ç¤ºè¯·æ±‚æ•°ï¼Œï¼cè¡¨ç¤ºå¹¶å‘æ•°,ä¸Šé¢ä¸€æ¡å‘½ä»¤ä¹Ÿå°±æ„å‘³ç€ï¼Œ100ä¸ªç”¨æˆ·å¹¶å‘å¯¹`http://10.19.52.8/hello/testOK`ç´¯è®¡å‘é€äº†10000æ¬¡è¯·æ±‚ã€‚

## æœåŠ¡å™¨,ç½‘å…³é…ç½®

ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„tomcatå®¹å™¨ï¼Œå…³äºtomcatçš„ä¸€ç‚¹çŸ¥è¯†æ€»ç»“å¦‚ä¸‹ï¼š

> Tomcatçš„æœ€å¤§å¹¶å‘æ•°æ˜¯å¯ä»¥é…ç½®çš„ï¼Œå®é™…è¿ç”¨ä¸­ï¼Œæœ€å¤§å¹¶å‘æ•°ä¸ç¡¬ä»¶æ€§èƒ½å’ŒCPUæ•°é‡éƒ½æœ‰å¾ˆå¤§å…³ç³»çš„ã€‚æ›´å¥½çš„ç¡¬ä»¶ï¼Œæ›´å¤šçš„å¤„ç†å™¨éƒ½ä¼šä½¿Tomcatæ”¯æŒæ›´å¤šçš„å¹¶å‘ã€‚
>
> Tomcat é»˜è®¤çš„HTTPå®ç°æ˜¯é‡‡ç”¨é˜»å¡å¼çš„Socketé€šä¿¡ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹æœ‰500ä¸ªçº¿ç¨‹åœ¨è·‘çš„è¯ï¼Œé‚£æ€§èƒ½å·²ç»æ˜¯å¾ˆä½å¾ˆä½äº†ã€‚Tomcaté»˜è®¤é…ç½®çš„æœ€å¤§è¯·æ±‚æ•°æ˜¯150ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ—¶æ”¯æŒ150ä¸ªå¹¶å‘ã€‚å…·ä½“èƒ½æ‰¿è½½å¤šå°‘å¹¶å‘ï¼Œéœ€è¦çœ‹ç¡¬ä»¶çš„é…ç½®ï¼ŒCPUè¶Šå¤šæ€§èƒ½è¶Šé«˜ï¼Œåˆ†é…ç»™JVMçš„å†…å­˜è¶Šå¤šæ€§èƒ½ä¹Ÿå°±è¶Šé«˜ï¼Œä½†ä¹Ÿä¼šåŠ é‡GCçš„è´Ÿæ‹…ã€‚å½“æŸä¸ªåº”ç”¨æ‹¥æœ‰ 250ä¸ªä»¥ä¸Šå¹¶å‘çš„æ—¶å€™ï¼Œåº”è€ƒè™‘åº”ç”¨æœåŠ¡å™¨çš„é›†ç¾¤ã€‚æ“ä½œç³»ç»Ÿå¯¹äºè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°æœ‰ä¸€å®šçš„é™åˆ¶ï¼š
> Windows æ¯ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°ä¸å…è®¸è¶…è¿‡ 2000
> Linux æ¯ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°ä¸å…è®¸è¶…è¿‡ 1000
> åœ¨Javaä¸­æ¯å¼€å¯ä¸€ä¸ªçº¿ç¨‹éœ€è¦è€—ç”¨1MBçš„JVMå†…å­˜ç©ºé—´ç”¨äºä½œä¸ºçº¿ç¨‹æ ˆä¹‹ç”¨ï¼Œæ­¤å¤„ä¹Ÿåº”è€ƒè™‘ã€‚

æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹é…ç½®tomcatçš„é»˜è®¤é…ç½®ï¼Œå¦‚ä¸‹ï¼š

```
server:
  tomcat:
    accept-count: 1000
    max-threads: 1000
    max-connections: 2000
```

æ— è®ºæ˜¯ç½‘å…³åº”ç”¨ï¼Œè¿˜æ˜¯ç”¨äºæµ‹è¯•çš„ä¸šåŠ¡ç³»ç»Ÿçš„tomcatï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¦‚ä¸Šé…ç½®ï¼Œå¦åˆ™ä¼šå¼•èµ·æœ¨æ¡¶æ•ˆåº”ï¼Œæ•´ä¸ªè°ƒç”¨æµç¨‹ä¼šå—åˆ°é…ç½®æœ€å·®çš„åº”ç”¨çš„å¹²æ‰°ã€‚
zuulå†…éƒ¨è·¯ç”±å¯ä»¥ç†è§£ä¸ºä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ± å»å‘é€è·¯ç”±è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦æ‰©å¤§è¿™ä¸ªçº¿ç¨‹æ± çš„å®¹é‡ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```
zuul:
  host:
    max-per-route-connections: 1000
    max-total-connections: 1000
```

## ç›‘æ§å·¥å…·

ä¸ºäº†ç¡®ä¿ä¸Šè¿°é…ç½®çœŸæ­£èµ·ä½œç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨Java VisualVMè¿™ä¸ªå·¥å…·ç›‘æ§è¿™å‡ å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„tomcatçš„çº¿ç¨‹ä»¥åŠå†…å­˜ä½¿ç”¨æƒ…å†µã€‚
å¯åŠ¨è„šæœ¬åŠ ä¸Šå¦‚ä¸‹å‚æ•°ï¼Œä¹‹åé€šè¿‡å·¥å…·è¿æ¥2099ç«¯å£å³å¯ç›‘æ§

```Java
-Dcom.sun.management.jmxremote.port=2099 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=10.19.52.8
```

## å¼€å§‹æµ‹è¯•

- æµ‹è¯•ä¸€

  â€‹

  1.é€šè¿‡è®¿é—®ç½‘å…³ï¼Œç”±ç½‘å…³è½¬å‘ï¼Œåº”ç”¨ç«¯æ¥å£å»¶è¿Ÿ200msåè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¨¡æ‹ŸçœŸå®æ¥å£çš„ä¸šåŠ¡å¤„ç†å»¶è¿Ÿ

  â€‹

  2.300ä¸ªçº¿ç¨‹å¹¶å‘è¯·æ±‚ï¼Œå…±è®¡100000 æ¬¡

  ```
  ab -n 100000 -c 300 http://10.19.52.8:8080/hello/testOK?access_token=e0345712-c30d-4bf8-ae61-8cae1ec38c52
  ```

```
Document Path:          /hello/testOK?access_token=e0345712-c30d-4bf8-ae61-8cae1ec38c52
Document Length:        2 bytes

Concurrency Level:      300
Time taken for tests:   151.026 seconds
Complete requests:      100000
Failed requests:        0
Write errors:           0
Total transferred:      42200844 bytes
HTML transferred:       200004 bytes
**Requests per second:    662.14 [#/sec] (mean)**
Time per request:       453.078 [ms] (mean)
Time per request:       1.510 [ms] (mean, across all concurrent requests)
Transfer rate:          272.88 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    5   7.0      2      98
Processing:   206  447 478.7    230    3171
Waiting:      197  445 478.7    227    3165
Total:        206  451 478.8    236    3177

Percentage of the requests served within a certain time (ms)
  50%    236
  66%    250
  75%    273
  80%    322
  90%   1408
  95%   1506
  98%   1684
  99%   1764
 100%   3177 (longest request)
```

æµ‹è¯•äºŒï¼š
1.ç›´æ¥è®¿é—®åº”ç”¨ï¼Œåº”ç”¨ç«¯æ¥å£å»¶è¿Ÿ200msåè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¨¡æ‹ŸçœŸå®æ¥å£çš„ä¸šåŠ¡å¤„ç†å»¶è¿Ÿ
2.300ä¸ªçº¿ç¨‹å¹¶å‘è¯·æ±‚ï¼Œå…±è®¡100000 æ¬¡

```
ab -n 100000 -c 300 http://10.19.52.9:9091/testOK
```

```
Server Hostname:        10.19.52.9
Server Port:            9091

Document Path:          /testOK
Document Length:        2 bytes

Concurrency Level:      300
Time taken for tests:   69.003 seconds
Complete requests:      100000
Failed requests:        0
Write errors:           0
Total transferred:      13400000 bytes
HTML transferred:       200000 bytes
**Requests per second:    1449.21 [#/sec] (mean)**
Time per request:       207.009 [ms] (mean)
Time per request:       0.690 [ms] (mean, across all concurrent requests)
Transfer rate:          189.64 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.8      0      10
Processing:   200  206   7.7    202     286
Waiting:      200  205   7.7    202     286
Total:        201  206   7.9    203     295

Percentage of the requests served within a certain time (ms)
  50%    203
  66%    205
  75%    207
  80%    209
  90%    215
  95%    220
  98%    229
  99%    240
 100%    295 (longest request)
```

ç»è¿‡ç½‘å…³è·¯ç”±ä¹‹åçš„æ€§èƒ½ä¸‹é™æ˜¯ä¸å¯é¿å…çš„ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼ŒæŸ¥çœ‹ç›‘æ§ç«¯çš„çº¿ç¨‹å˜åŒ–ï¼Œå¦‚ä¸‹å›¾ï¼š

[![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20170408145703703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)](http://static.iocoder.cn/csdn/20170408145703703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)è¿™é‡Œå†™å›¾ç‰‡æè¿°

æˆ‘ä»¬çš„é…ç½®çš„ç¡®äº§ç”Ÿäº†ä½œç”¨ã€‚

æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹ä¸Šé¢æµ‹è¯•ç»“æœçš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡ï¼šRequests per secondï¼Œæˆ‘ä»¬çš„ç½‘å…³ç»è¿‡äº†é‰´æƒä¹‹åï¼Œæ€§èƒ½ä»ç„¶å¯ä»¥è¾¾åˆ°600+æ¯ç§’çš„å“åº”ï¼Œæ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œå³°å€¼æ—¶å†…å­˜æƒ…å†µï¼Œä½¿ç”¨topæŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š[![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20170408150216769?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)](http://static.iocoder.cn/csdn/20170408150216769?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxNTU0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)è¿™é‡Œå†™å›¾ç‰‡æè¿°
abæµ‹è¯•å‘½ä»¤ä¹Ÿå ç”¨äº†ä¸€å®šçš„cpuä½¿ç”¨ç‡ï¼Œæ€»åº”ç”¨æ¥è¿‘70%çš„cpuä½¿ç”¨ç‡ï¼Œè¿™ä¼°è®¡ä¹Ÿæ˜¯å•ä¸ªtomcatå®ä¾‹çš„ç“¶é¢ˆäº†ã€‚å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨ä¼šå•ç‹¬éƒ¨ç½²ç½‘å…³ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æœå¯ä»¥æ¥å—ã€‚

ä¸ºäº†é¿å…å•æ¬¡å“åº”å¸¦æ¥çš„å¶ç„¶å› ç´ ï¼Œæˆ‘ä»¬é‡å¤è¿›è¡Œæµ‹è¯•ä¸€ï¼ˆæ›´æ”¹ä¸º10000æ¬¡è¯·æ±‚ï¼Œå¹¶å‘é‡200ï¼‰ï¼Œçœ‹çœ‹Requests per secondçš„å˜åŒ–ã€‚

```
1. 799.45
2. 818.86
3. 838.67
4. 833.90
5. 973.65
```

## æ€»ç»“

æœ‰ä¸€äº›å…¶ä»–çš„æ•°æ®æ²¡æœ‰æ•´ç†åˆ°åšå®¢ä¸­ï¼Œä½†æ˜¯ä¹Ÿé¡ºä¾¿æŠŠç»“è®ºå†™ä¸€ä¸‹ã€‚

è¿™æ¬¡çš„æµ‹è¯•æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š

1. æ˜¯åœ¨åº”ç”¨æœåŠ¡å™¨ç«¯æ¨¡æ‹Ÿ200msçš„å»¶æ—¶ï¼Œå› ä¸ºå®é™…è¯·æ±‚ä¸å¯èƒ½ä¸ä¼´éšç€è€—æ—¶çš„ä¸šåŠ¡æ“ä½œï¼Œå®é™…å‘ç°å¯¹abçš„æµ‹è¯•å½±å“è¿˜æ˜¯è¾ƒå¤§çš„ï¼Œæ¯•ç«Ÿçº¿ç¨‹é˜»å¡ç€ï¼Œä¸å»¶è¿Ÿæ—¶request per secondèƒ½è¾¾åˆ°2000ï¼ŒåŠ äº†200mså»¶è¿Ÿä¹‹åä¸‹é™åˆ°1000+ã€‚
2. æ¨¡æ‹Ÿæ€»è¯·æ±‚æ•°å’Œçº¿ç¨‹æ•°çš„å˜åŒ–ä¼šå¼•èµ·QPS/TPSçš„æŠ–åŠ¨ï¼Œå³ä½¿æ˜¯åœ¨å¤šæ ¸CPUçš„æ‰¿å—èŒƒå›´ä¹‹å†…ï¼Œä¹Ÿå¹¶ä¸æ˜¯è¯´çº¿ç¨‹è¶Šå¤šï¼ŒQPS/TPSå°±è¶Šé«˜ï¼Œå› ä¸ºå¯åŠ¨çº¿ç¨‹çš„å¼€é”€ï¼Œä»¥åŠçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—æ—¶ï¼Œå¼€è¾Ÿçº¿ç¨‹å¸¦æ¥çš„å†…å­˜æŸè€—éƒ½ä¼šå½±å“æ€§èƒ½ã€‚é’±æ€»è¯´å•ä¸ªtomcatå®ä¾‹çš„å¹¶å‘åº¦ç†è®ºå€¼200å°±å¯ä»¥æ¥å—äº†ï¼Œç»è¿‡å‚æ•°è°ƒä¼˜åçš„tomcatä½¿ç”¨zuulåšç½‘å…³èƒ½è¾¾åˆ°å¦‚ä¸Šçš„æµ‹è¯•ç»“æœï¼Œå®Œå…¨å¯ä»¥æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨äº†ã€‚è€Œtomcaté»˜è®¤çš„150çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨200çš„å¹¶å‘åº¦æµ‹è¯•å°±æ˜¾ç„¶æ˜¯â€œä¸å…¬å¹³çš„â€ã€‚
3. æµ‹è¯•æ³¨æ„ç‚¹æœ‰å‡ ä¸ªï¼Œä¾‹å¦‚abéƒ¨ç½²åœ¨äº†api-gatewayæœ¬æœºä¼šå½±å“æ€§èƒ½ï¼Œtomcatå‚æ•°ä»¥åŠzuulå‚æ•°åº”å½“å°½å¯èƒ½æ”¾å¼€ï¼Œä¸è®©å…¶é»˜è®¤é…ç½®å½±å“æµ‹è¯•ã€‚

æœ¬æ–‡è¿˜æœ‰äº›é—æ¼çš„æ•°æ®ï¼Œåç»­ä¼šè¡¥ä¸Šâ€¦

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Zuul  æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)