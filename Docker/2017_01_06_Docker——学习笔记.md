title: Docker â€”â€” å­¦ä¹ ç¬”è®°
date: 2017-01-06
tags:
categories: Docker
permalink: Docker/docker-learning-notes

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# æœ¬æ–‡èƒŒæ™¯
* ç³»ç»Ÿï¼šmacOS Sierra 10.12.1
* Dockerç‰ˆæœ¬ï¼šDocker version 1.12.3, build 6b644ec
* ã€ŠDocker â€”â€” ä»å…¥é—¨åˆ°å®è·µã€‹PDFç‰ˆæœ¬ï¼š6448a627f6c4a9f0ca762951f390d3f9a571d310
* æœ¬æ–‡è®°å½•ï¼šåœ¨å­¦ä¹ Dockerçš„è¿‡ç¨‹ä»¥åŠå°è¯•ä¸­ç¢°åˆ°çš„é—®é¢˜ã€‚

-------

# ã€ŠDocker â€”â€” ä»å…¥é—¨åˆ°å®è·µã€‹ç¢°åˆ°çš„é—®é¢˜ï¼š
1. æ‰§è¡Œ`docker run -d -p 80:80 --name webserver nginx`æŠ¥é”™ï¼š`docker: Cannot connect to the Docker daemon. Is the docker daemon running on this host?.`

    * åŸå› ï¼šTODO
    * è§£å†³æ–¹å¼ï¼š`sudo docker run -d -p 80:80 --name webserver nginx`
    psï¼šè¯¥è§£å†³æ–¹å¼æš‚æ—¶ä¸æ˜¯æœ€ä¼˜ã€‚TODO
    
2. æ‰§è¡Œ`docker run -d -p 80:80 --name webserver nginx`æŠ¥é”™ï¼š`docker: Network timed out while trying to connect to https://index.docker.io/v1/repositories/library/nginx/images. You may want to check your internet connection or if you are`

    * åŸå› ï¼šdocker.ioå­˜åœ¨è¢«å¢™ã€è¿æ¥å›°éš¾çš„æƒ…å†µã€‚
    * è§£å†³æ–¹å¼ï¼šæ›´æ¢é˜¿é‡Œäº‘dockeré•œåƒã€‚
            
        ![*](images/008CD83F-DF1E-470C-8192-5B5D0F9DFE70.png)
3. `nsenter`ï¼šéšç€docker1.3ç‰ˆæœ¬å¼€å§‹ï¼Œ`docker exec -it CONTAINER_NAME bash`æˆä¸ºæ¨èçš„è¿æ¥åˆ°å®¹å™¨çš„æ–¹å¼ã€‚å‚è€ƒï¼šhttps://github.com/jpetazzo/nsenterã€‚
    > There are differences between nsenter and docker exec; namely, nsenter doesn't enter the cgroups, and therefore evades resource limitations. The potential benefit of this would be debugging and external audit, **but for remote access, docker exec is the current recommended approach**.
4. åœ¨ã€Šä½¿ç”¨ç½‘ç»œ-å®¹å™¨äº’è”ã€‹ç« èŠ‚ï¼Œ 
    * `sudo docker run -d --name db training/postgres`
    * `sudo docker run -d -P --name web --link db:db training/webapp python app.py`
    åè¿›è¡Œ`docker ps`ï¼Œæ— æ³•å¾—åˆ°å¦‚ä¸‹å›¾ï¼š
            ![*](http://www.iocoder.cn/images/4A097CA8-F4DC-44AA-91D0-C4397C753576.png)
    å¾—åˆ°çš„ç»“æœå¦‚ä¸‹å›¾ï¼š
            ![*](http://www.iocoder.cn/images/452D8BD2-8FDF-45F2-B3D8-BA8BF04BE294.png)
    * åŸå› ï¼šTODO
    * è§£å†³æ–¹å¼ï¼š`sudo docker inspect -f "" web` // hexo markdown ç¼–è¯‘ä¸è¿‡ï¼Œçœ‹ä¸‹å›¾
        > [/db:/web/db]

        ç¤ºä¾‹æˆåŠŸã€‚

    ![](http://www.iocoder.cn/images/Docker/2017_01_06/03.png)
 
-------
-------

       
# æœåŠ¡å‘ç°çš„é€‰æ‹©

### ç›®å‰è€ƒè™‘é€‰æ‹©Etcdï¼š

ä¸»è¦æœ‰3ç§é€‰æ‹©ï¼š    

* Etcd
* Consul
* ZooKeeper

é€‰æ‹©Etcdçš„åŸå› å¦‚ä¸‹ï¼š

* `CoreOS` å‘èµ·çš„å¼€æºé¡¹ç›®
* `K8s` å¯¹etcdçš„å®˜æ–¹æ”¯æŒ

-------

### Etcdæœ¬åœ°æµ‹è¯•é›†ç¾¤æ­å»º
    
* å‚è€ƒæ–‡ç« ï¼šhttps://github.com/coreos/etcd/blob/master/Documentation/dev-guide/local_cluster.md  
* å¯èƒ½ä¼šç¢°åˆ°çš„é—®é¢˜ï¼š 
    1. goå®‰è£…ï¼š`yum install go`
    2. gitå®‰è£…ï¼š`yum install git`
    3. `go get github.com/mattn/goreman` æŠ¥é”™ï¼š`package github.com/mattn/goreman: cannot download, $GOPATH not set. For more details see: go help gopath`ã€‚
    
        è§£å†³æ–¹å¼ï¼š`export GOPATH=~/work`ã€‚ç„¶åæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚æœ€ç»ˆ`goreman`åœ¨`~/work/bin`ä¸‹ã€‚
    4. `goreman -f Procfile start`æŠ¥é”™ï¼š`open Procfile: no such file or directory`ã€‚ä»[https://github.com/coreos/etcd/blob/master/Procfile](https://github.com/coreos/etcd/blob/master/Procfile)è¿›è¡Œä¸‹è½½ã€‚ä¸‹è½½å®Œåï¼Œéœ€è¦ä¿®æ”¹ä¸‹æ–‡ä»¶é‡Œçš„`bin/etcd`ä¸º`etcd`æ‰€åœ¨ç›®å½•ã€‚

-------

### Etcdå¤šæœåŠ¡å™¨é›†ç¾¤æ­å»º     



    curl -X PUT http://127.0.0.1:2379/v2/keys/upstreams/test/127.0.0.1:8080


curl -X PUT -d value="{\"weight\":1, \"max_fails\":100, \"fail_timeout\":1000}" http://127.0.0.1:2379/v2/keys/upstreams/test/127.0.0.1:8080


    curl -X DELETE http://127.0.0.1:2379/v2/keys/upstreams/test/127.0.0.1:8080

    curl -X DELETE http://127.0.0.1:2379/v2/keys/upstreams/test/127.0.0.1:8080;
    cat conf/servers/servers_test.conf;

./configure --add-module=/root/nginx/nginx-1.10.1/modules/nginx-upsync-module --add-module=/root/nginx/nginx-1.10.1/modules/nginx_upstream_check_module-0.3.0

./configure --add-module=/root/nginx/nginx-1.10.1/modules/nginx-upsync-module --add-module=/root/nginx/nginx-1.10.1/modules/nginx_upstream_check_module

05.24ï¼šhttps://github.com/weibocom/nginx-upsync-module/releases/tag/v1.0.0
07.31ä¿®å¤ï¼šhttps://github.com/weibocom/nginx-upsync-module/issues/91
è‡ªå·±æäº¤çš„issueï¼šhttps://github.com/weibocom/nginx-upsync-module/issues/133


