title: Kafka æ¶ˆæ¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆä¸Šï¼‰
date: 2018-01-04
tag: 
categories: Kafka
permalink: Kafka/message-serialize-1
author: æœ±å°å®
from_url: https://blog.csdn.net/u013256816/article/details/78657982
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://blog.csdn.net/u013256816/article/details/78657982 ã€Œæœ±å°å®ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

Kafka Produceråœ¨å‘é€æ¶ˆæ¯æ—¶å¿…é¡»é…ç½®çš„å‚æ•°ä¸ºï¼šbootstrap.serversã€key.serializerã€value.serializerã€‚åºåˆ—åŒ–æ“ä½œæ˜¯åœ¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ‰§è¡Œä¹‹åå¹¶ä¸”åœ¨åˆ†é…åˆ†åŒº(partitions)ä¹‹å‰æ‰§è¡Œçš„ã€‚

é¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€æ®µç¤ºä¾‹ä»£ç æ¥çœ‹ä¸‹æ™®é€šæƒ…å†µä¸‹Kafka Producerå¦‚ä½•ç¼–å†™ï¼š

```Java
public class ProducerJavaDemo {
    public static final String brokerList = "192.168.0.2:9092,192.168.0.3:9092,192.168.0.4:9092";
    public static final String topic = "hidden-topic";

    public static void main(String[] args) {
        Properties properties = new Properties();
        properties.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        properties.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        properties.put("client.id", "hidden-producer-client-id-1");
        properties.put("bootstrap.servers", brokerList);

        Producer<String,String> producer = new KafkaProducer<String,String>(properties);

        while (true) {
            String message = "kafka_message-" + new Date().getTime() + "-edited by hidden.zhu";
            ProducerRecord<String, String> producerRecord = new ProducerRecord<String, String>(topic,message);
            try {
                Future<RecordMetadata> future =  producer.send(producerRecord, new Callback() {
                    public void onCompletion(RecordMetadata metadata, Exception exception) {
                        System.out.print(metadata.offset()+"    ");
                        System.out.print(metadata.topic()+"    ");
                        System.out.println(metadata.partition());
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();
            }
            try {
                TimeUnit.MILLISECONDS.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
```

è¿™é‡Œé‡‡ç”¨çš„å®¢æˆ·ç«¯ä¸æ˜¯0.8.x.xæ—¶ä»£çš„Scalaç‰ˆæœ¬ï¼Œè€Œæ˜¯Javaç¼–å†™çš„æ–°Kafka Producer, ç›¸åº”çš„Mavenä¾èµ–å¦‚ä¸‹ï¼š

```XML
<dependency>
    <groupId>org.apache.kafka</groupId>
    <artifactId>kafka-clients</artifactId>
    <version>1.0.0</version>
</dependency>
```

ä¸Šé¢çš„ç¨‹åºä¸­ä½¿ç”¨çš„æ˜¯Kafkaå®¢æˆ·ç«¯è‡ªå¸¦çš„org.apache.kafka.common.serialization.StringSerializerï¼Œé™¤äº†ç”¨äºStringç±»å‹çš„åºåˆ—åŒ–å™¨ä¹‹å¤–è¿˜æœ‰ï¼šByteArrayã€ByteBufferã€Bytesã€Doubleã€Integerã€Longè¿™å‡ ç§ç±»å‹ï¼Œå®ƒä»¬éƒ½å®ç°äº†org.apache.kafka.common.serialization.Serializeræ¥å£ï¼Œæ­¤æ¥å£æœ‰ä¸‰ç§æ–¹æ³•ï¼š

1. public void configure(Map<String, ?> configs, boolean isKey)ï¼šç”¨æ¥é…ç½®å½“å‰ç±»ã€‚
2. public byte[] serialize(String topic, T data)ï¼šç”¨æ¥æ‰§è¡Œåºåˆ—åŒ–ã€‚
3. public void close()ï¼šç”¨æ¥å…³é—­å½“å‰åºåˆ—åŒ–å™¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œå¦‚æœå®ç°äº†æ­¤æ–¹æ³•ï¼Œå¿…é¡»ç¡®ä¿æ­¤æ–¹æ³•çš„å¹‚ç­‰æ€§ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•å¾ˆå¯èƒ½ä¼šè¢«KafkaProducerè°ƒç”¨å¤šæ¬¡ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Kafkaä¸­org.apache.kafka.common.serialization.StringSerializerçš„å…·ä½“å®ç°ï¼Œæºç å¦‚ä¸‹ï¼š

```Java
public class StringSerializer implements Serializer<String> {
    private String encoding = "UTF8";

    @Override
    public void configure(Map<String, ?> configs, boolean isKey) {
        String propertyName = isKey ? "key.serializer.encoding" : "value.serializer.encoding";
        Object encodingValue = configs.get(propertyName);
        if (encodingValue == null)
            encodingValue = configs.get("serializer.encoding");
        if (encodingValue != null && encodingValue instanceof String)
            encoding = (String) encodingValue;
    }

    @Override
    public byte[] serialize(String topic, String data) {
        try {
            if (data == null)
                return null;
            else
                return data.getBytes(encoding);
        } catch (UnsupportedEncodingException e) {
            throw new SerializationException("Error when serializing string to byte[] due to unsupported encoding " + encoding);
        }
    }

    @Override
    public void close() {
        // nothing to do
    }
}
```

é¦–å…ˆçœ‹ä¸‹StringSerializerä¸­çš„configure(Map

```Java
public class Company {
    private String name;
    private String address;
    //çœç•¥Getter, Setter, Constructor & toStringæ–¹æ³•
}
```

æ¥ä¸‹å»æˆ‘ä»¬æ¥å®ç°Companyç±»å‹çš„Serializerï¼Œå³ä¸‹é¢ä»£ç ç¤ºä¾‹ä¸­çš„DemoSerializerã€‚

```Java
package com.hidden.client;

public class DemoSerializer implements Serializer<Company> {
    public void configure(Map<String, ?> configs, boolean isKey) {}
    public byte[] serialize(String topic, Company data) {
        if (data == null) {
            return null;
        }
        byte[] name, address;
        try {
            if (data.getName() != null) {
                name = data.getName().getBytes("UTF-8");
            } else {
                name = new byte[0];
            }
            if (data.getAddress() != null) {
                address = data.getAddress().getBytes("UTF-8");
            } else {
                address = new byte[0];
            }
            ByteBuffer buffer = ByteBuffer.allocate(4+4+name.length + address.length);
            buffer.putInt(name.length);
            buffer.put(name);
            buffer.putInt(address.length);
            buffer.put(address);
            return buffer.array();
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        return new byte[0];
    }
    public void close() {}
}
```

ä½¿ç”¨æ—¶åªéœ€è¦åœ¨Kafka Producerçš„configä¸­ä¿®æ”¹value.serializerå±æ€§å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```Java
properties.put("value.serializer", "com.hidden.client.DemoSerializer");
//è®°å¾—ä¹Ÿè¦å°†ç›¸åº”çš„Stringç±»å‹æ”¹ä¸ºCompanyç±»å‹ï¼Œå¦‚ï¼š
//Producer<String,Company> producer = new KafkaProducer<String,Company>(properties);
//Company company = new Company();
//company.setName("hidden.cooperation-" + new Date().getTime());
//company.setAddress("Shanghai, China");
//ProducerRecord<String, Company> producerRecord = new ProducerRecord<String, Company>(topic,company);1234567
```

ç¤ºä¾‹ä¸­åªä¿®æ”¹äº†value.serializer,è€Œkey.serializerå’Œvalue.serializeræ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚æœæœ‰çœŸå®éœ€è¦ï¼Œä¿®æ”¹ä»¥ä¸‹ä¹Ÿæœªå°ä¸å¯ã€‚

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Kafka å¹¶å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†ä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)