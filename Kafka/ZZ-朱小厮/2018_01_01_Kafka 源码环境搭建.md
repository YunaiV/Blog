title: Kafka æºç ç¯å¢ƒæ­å»º
date: 2018-01-01
tag: 
categories: Kafka
permalink: Kafka/build-debugging-environment
author: æœ±å°å®
from_url: https://blog.csdn.net/u013256816/article/details/78533725
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://blog.csdn.net/u013256816/article/details/78533725 ã€Œæœ±å°å®ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [NOTE: When you change this version number, you should also make sure to update](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [the version numbers in tests/kafkatest/__init__.py and kafka-merge-pr.py.](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [æ˜¯å¦å…è®¸topicè¢«åˆ é™¤ï¼Œè®¾ç½®ä¸ºtrueåˆ™topicå¯ä»¥è¢«åˆ é™¤ï¼Œ](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [å¼€å¯è¿™ä¸ªåŠŸèƒ½æ–¹ä¾¿Kafkaåœ¨è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œèƒ½å¤Ÿåˆ é™¤ä¸€äº›ä¸éœ€è¦çš„ä¸´æ—¶topic](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [ç¦ç”¨è‡ªåŠ¨åˆ›å»ºtopicçš„åŠŸèƒ½](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [å­˜å‚¨logæ–‡ä»¶çš„ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º/tmp/kafka-logs](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [ç¤ºä¾‹æ˜¯åœ¨Windowsç¯å¢ƒä¸‹è¿è¡Œï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼Œæ³¨æ„è¿™é‡Œçš„åŒåæ–œæ ã€‚](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [é…ç½®kafkaä¾èµ–çš„zookeeperè·¯å¾„åœ°å€ï¼Œè¿™é‡Œçš„å‰ææ˜¯åœ¨æœ¬åœ°å¼€å¯äº†ä¸€ä¸ªzookeeperçš„æœåŠ¡](http://www.iocoder.cn/Kafka/build-debugging-environment/)
- [å¦‚æœæœ¬åœ°æ²¡æœ‰zookeeperæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒä¸‹ä¸€èŠ‚ä¸­zookeeperçš„å®‰è£…ã€é…ç½®åŠè¿è¡Œ](http://www.iocoder.cn/Kafka/build-debugging-environment/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

æœ¬æ–‡ä¸»è¦è®²è¿°çš„æ˜¯å¦‚ä½•æ­å»ºKafkaçš„æºç ç¯å¢ƒï¼Œä¸»è¦é’ˆå¯¹çš„Windowsæ“ä½œç³»ç»Ÿä¸‹IntelliJ IDEAç¼–è¯‘å™¨ï¼Œå…¶ä½™æ“ä½œç³»ç»Ÿæˆ–è€…IDEå¯ä»¥ç±»æ¨ã€‚

### 1.å®‰è£…å’Œé…ç½®JDK

ç¡®è®¤JDKç‰ˆæœ¬è‡³å°‘ä¸º1.7ï¼Œæœ€å¥½æ˜¯1.8åŠä»¥ä¸Šã€‚ä½¿ç”¨java -versionå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰JDKçš„ç‰ˆæœ¬ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
C:\Users\hidden> java -version
java version "1.8.0_112"
Java(TM) SE Runtime Environment (build 1.8.0_112-b15)
Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode)
```

### 2.ä¸‹è½½å¹¶å®‰è£…é…ç½®Gradle

ä¸‹è½½åœ°å€ä¸ºï¼š<https://gradle.org/releases/>ï¼Œç¬”è€…ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯3.1ã€‚ä¸€èˆ¬åªéœ€è¦å°†ä¸‹è½½çš„åŒ…è§£å‹ï¼Œç„¶åå†å°†$çš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­å³å¯ï¼Œå…¶ä¸­GRADLE_HOME/binçš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡Pathä¸­å³å¯ï¼Œå…¶ä¸­$GRADLE_HOMEæŒ‡çš„æ˜¯Gradleçš„æ ¹ç›®å½•ã€‚å¯ä»¥ä½¿ç”¨gradle -vå‘½ä»¤æ¥éªŒè¯Gradleæ˜¯å¦å·²ç»é…ç½®å®Œæˆï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
C:\Users\hidden>gradle -v

------------------------------------------------------------
Gradle 3.1
------------------------------------------------------------

Build time:   2016-09-19 10:53:53 UTC
Revision:     13f38ba699afd86d7cdc4ed8fd7dd3960c0b1f97

Groovy:       2.4.7
Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015
JVM:          1.8.0_112 (Oracle Corporation 25.112-b15)
OS:           Windows 10 10.0 amd64
```

### 3.ä¸‹è½½å¹¶å®‰è£…é…ç½®Scala

ä¸‹è½½åœ°å€ä¸ºï¼š<http://www.scala-lang.org/download/all.html>ï¼Œç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯2.12.4ï¼Œä¸è¿‡ç¬”è€…è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯2.11.11ã€‚å¦‚Gradleä¸€æ ·ï¼Œåªéœ€è¦è§£å‹å¹¶å°†$çš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡å³å¯ï¼Œå…¶ä¸­SCALA_HOME/binçš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡Pathå³å¯ï¼Œå…¶ä¸­$SCALA_HOMEæŒ‡çš„æ˜¯Scalaçš„æ ¹ç›®å½•ã€‚å¯ä»¥ä½¿ç”¨scala -versionå‘½ä»¤æ¥éªŒè¯scalaæ˜¯å¦å·²ç»é…ç½®å®Œæˆï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
C:\Users\hidden>scala -version
Scala code runner version 2.11.11 -- Copyright 2002-2017, LAMP/EPFL
```

### 4. æ„å»ºKafkaæºç ç¯å¢ƒ

Kafkaä¸‹è½½åœ°å€ä¸ºï¼š<http://kafka.apache.org/downloads>ï¼Œç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯1.0.0ã€‚å°†ä¸‹è½½çš„å‹ç¼©åŒ…è§£å‹ï¼Œå¹¶åœ¨Kafkaçš„æ ¹ç›®å½•æ‰§è¡Œgradle ideaå‘½ä»¤è¿›è¡Œæ„å»ºï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Eclipseï¼Œåˆ™åªéœ€é‡‡ç”¨gradle eclipseå‘½ä»¤æ„å»ºå³å¯ã€‚æ„å»ºç»†èŠ‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```
D:\IntelliJ IDEA Files\kafka-sources\kafka-1.0.0-src>gradle idea
Starting a Gradle Daemon, 2 incompatible and 1 stopped Daemons could not be reused, use --status for details
Building project 'core' with Scala version 2.11.11
:ideaModule
:ideaProject
(......çœç•¥è‹¥å¹²......)
:streams:examples:ideaModule
:streams:examples:idea

BUILD SUCCESSFUL

Total time: 1 mins 11.991 secs
```

ä¹‹åå°†Kafkaå¯¼å…¥åˆ°IDEAä¸­å³å¯ã€‚ä¸è¿‡è¿™æ ·è¿˜æ²¡æœ‰ç»“æŸï¼Œå¯¹äºIDEAè€Œè¨€ï¼Œè¿˜éœ€è¦å®‰è£…Scalaæ’ä»¶ï¼Œåœ¨Setting->Pluginä¸­æœç´¢scalaå¹¶å®‰è£…ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾ï¼Œç¬”è€…è¿™é‡Œæ˜¯å·²ç»å®‰è£…å¥½çš„çŠ¶æ€ï¼š

![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20171114004759447?)

### 5. é…ç½®Kafkaæºç ç¯å¢ƒ

å‰é¢å‡ ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåå°±å¯ä»¥å¾ˆèˆ’é€‚çš„é˜…è¯»Kafkaçš„æºç ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¯åŠ¨Kafkaçš„æœåŠ¡è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚

é¦–å…ˆç¡®ä¿gradle.propertiesé…ç½®æ–‡ä»¶ä¸­çš„scalaVersionä¸å®‰è£…çš„ä¸€è‡´ã€‚gradle.propertiesé…ç½®æ–‡ä»¶çš„ç»†èŠ‚å¦‚ä¸‹ï¼š

```
group=org.apache.kafka
# NOTE: When you change this version number, you should also make sure to update
# the version numbers in tests/kafkatest/__init__.py and kafka-merge-pr.py.
version=1.0.0
scalaVersion=2.11.11
task=build
org.gradle.jvmargs=-XX:MaxPermSize=512m -Xmx1024m -Xss2m
```

å¦‚æœæ›´æ”¹äº†scalaVersionï¼Œéœ€è¦é‡æ–°æ‰§è¡Œgradle ideaå‘½ä»¤æ¥é‡æ–°æ„å»ºã€‚è™½ç„¶å¾ˆå¤šæ—¶å€™åœ¨æ“ä½œç³»ç»Ÿä¸­å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„Scalaä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¯”å¦‚å®‰è£…2.12.4ç‰ˆæœ¬ã€‚ä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹è¿è¡ŒKafkaæ—¶ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸ï¼Œè€Œè¿™äº›å¼‚å¸¸å´åˆæ˜¯ç”±äºScalaç‰ˆæœ¬ä¸ä¸€è‡´è€Œå¼•èµ·çš„ï¼Œæ¯”å¦‚ä¼šå‡ºç°ä¸‹é¢ç¤ºä¾‹ä¸­çš„æŠ¥é”™ï¼š

```Java
[2017-11-13 17:09:21,119] FATAL  (kafka.Kafka$)
java.lang.NoSuchMethodError: scala.collection.TraversableOnce.$init$(Lscala/collection/TraversableOnce;)V
    at kafka.message.MessageSet.<init>(MessageSet.scala:72)
    at kafka.message.ByteBufferMessageSet.<init>(ByteBufferMessageSet.scala:129)
    at kafka.message.MessageSet$.<init>(MessageSet.scala:32)
    at kafka.message.MessageSet$.<clinit>(MessageSet.scala)
    at kafka.server.Defaults$.<init>(KafkaConfig.scala:52)
    at kafka.server.Defaults$.<clinit>(KafkaConfig.scala)
    at kafka.server.KafkaConfig$.<init>(KafkaConfig.scala:686)
    at kafka.server.KafkaConfig$.<clinit>(KafkaConfig.scala)
    at kafka.server.KafkaServerStartable$.fromProps(KafkaServerStartable.scala:28)
    at kafka.Kafka$.main(Kafka.scala:82)
    at kafka.Kafka.main(Kafka.scala)
```

æ‰€ä»¥ä¸ºäº†çœå»ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ï¼Œè¿˜æ˜¯å»ºè®®è¯»è€…åœ¨å®‰è£…Scalaç‰ˆæœ¬ä¹‹å‰å…ˆæŸ¥çœ‹ä¸‹Kafkaæºç ä¸­gradle.propertiesæ–‡ä»¶ä¸­é…ç½®çš„scalaVersionã€‚

å†ç¡®ä¿äº†scalaVersionä¹‹åï¼Œéœ€è¦å°†configç›®å½•ä¸‹çš„log4j.propertiesæ–‡ä»¶æ‹·è´åˆ°core/src/main/scalaç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥è®©Kafkaåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š

![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20171114004845189?)

ä¹‹åè¿˜éœ€è¦é…ç½®server.propertiesæ–‡ä»¶ï¼Œä¸€èˆ¬åªéœ€è¦ä¿®æ”¹ä»¥ä¸‹ä¸€äº›é…ç½®é¡¹ï¼š

```
# æ˜¯å¦å…è®¸topicè¢«åˆ é™¤ï¼Œè®¾ç½®ä¸ºtrueåˆ™topicå¯ä»¥è¢«åˆ é™¤ï¼Œ
# å¼€å¯è¿™ä¸ªåŠŸèƒ½æ–¹ä¾¿Kafkaåœ¨è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œèƒ½å¤Ÿåˆ é™¤ä¸€äº›ä¸éœ€è¦çš„ä¸´æ—¶topic
delete.topic.enable=true
# ç¦ç”¨è‡ªåŠ¨åˆ›å»ºtopicçš„åŠŸèƒ½
auto.create.topics.enable=false
# å­˜å‚¨logæ–‡ä»¶çš„ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º/tmp/kafka-logs
# ç¤ºä¾‹æ˜¯åœ¨Windowsç¯å¢ƒä¸‹è¿è¡Œï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®ï¼Œæ³¨æ„è¿™é‡Œçš„åŒåæ–œæ ã€‚
log.dir=D:\\kafka\\tmp\\kafka-logs
# é…ç½®kafkaä¾èµ–çš„zookeeperè·¯å¾„åœ°å€ï¼Œè¿™é‡Œçš„å‰ææ˜¯åœ¨æœ¬åœ°å¼€å¯äº†ä¸€ä¸ªzookeeperçš„æœåŠ¡
# å¦‚æœæœ¬åœ°æ²¡æœ‰zookeeperæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒä¸‹ä¸€èŠ‚ä¸­zookeeperçš„å®‰è£…ã€é…ç½®åŠè¿è¡Œ
zookeeper.connect=localhost:2181/kafka
```

ä¹‹åé…ç½®Kafkaçš„å¯åŠ¨å‚æ•°ï¼Œè¯¦ç»†å‚è€ƒä¸‹å›¾ï¼š

![è¿™é‡Œå†™å›¾ç‰‡æè¿°](http://static.iocoder.cn/csdn/20171114004857498?)

è¿™é‡Œé…ç½®Main classä¸ºkafka.Kafkaï¼Œå¹¶åˆ¶å®šå¯åŠ¨æ—¶æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶åœ°å€ï¼Œå³ï¼šconfig/server.propertiesã€‚é…ç½®JMX_PORTæ˜¯ä¸ºäº†æ–¹ä¾¿æœé›†Kafkaè‡ªèº«çš„Metricsæ•°æ®ã€‚

å¦‚æ­¤ä¾¿å¯ä»¥é¡ºåˆ©çš„è¿è¡ŒKafkaæœåŠ¡äº†ï¼ˆç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªè€—æ—¶è¾ƒé•¿çš„ç¼–è¯‘è¿‡ç¨‹ï¼‰ï¼Œéƒ¨åˆ†å¯åŠ¨æ—¥å¿—å¦‚ä¸‹ï¼š

```Java
[2017-11-14 00:24:14,472] INFO KafkaConfig values:
    advertised.host.name = null
    advertised.listeners = null
    advertised.port = null
    authorizer.class.name =
(......çœç•¥è‹¥å¹²......)
[2017-11-14 00:24:35,001] INFO Registered broker 0 at path /brokers/ids/0 with addresses: EndPoint(LAPTOP-1IN9UPT7,9092,ListenerName(PLAINTEXT),PLAINTEXT) (kafka.utils.ZkUtils)
[2017-11-14 00:24:35,019] INFO Kafka version : 1.0.0 (org.apache.kafka.common.utils.AppInfoParser)
[2017-11-14 00:24:35,020] INFO Kafka commitId : e89bffd6b2eff799 (org.apache.kafka.common.utils.AppInfoParser)
[2017-11-14 00:24:35,021] INFO [Kafka Server 0], started (kafka.server.KafkaServer)
```

### 6. Zookeeperçš„å®‰è£…ã€é…ç½®åŠå¯åŠ¨

Kafkaéœ€è¦ä½¿ç”¨Zookeeperæ¥ç®¡ç†å…ƒæ•°æ®ï¼Œæ¯”å¦‚è®°å½•topicã€partitionsï¼ˆåˆ†åŒºï¼‰ä»¥åŠreplicaï¼ˆå‰¯æœ¬ï¼‰çš„åˆ†é…ä¿¡æ¯ã€‚ç”±äºè¿™é‡Œåªæ˜¯é˜è¿°å¦‚ä½•æ„å»ºKafkaçš„æºç ç¯å¢ƒæ­å»ºï¼Œæ‰€ä»¥è¿™é‡Œçš„Zookeeperçš„å®‰è£…ä¹Ÿä»¥æç®€ä¸ºä¸»ï¼Œå³é‡‡ç”¨å•æœºé…ç½®ã€‚Zookeeperä¸‹è½½åœ°å€ä¸ºï¼š<http://zookeeper.apache.org/releases.html>ï¼Œä¸‹è½½ä¹‹åè§£å‹ï¼Œç„¶åå°†$ç›®å½•ä¸‹çš„é‡å‘½åä¸ºï¼Œå…¶ä¸­ZOOKEEPER_HOMEç›®å½•ä¸‹çš„conf/zoo_sample.cfgé‡å‘½åä¸ºzoo.cfgï¼Œå…¶ä¸­$ZOOKEEPER_HOMEæŒ‡çš„æ˜¯ZooKeeperçš„æ ¹ç›®å½•ã€‚

ä¿®æ”¹$ZOOKEEPER_HOME/conf/zoo.cfgé…ç½®ï¼Œç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼ˆå…¶ä½™é…ç½®å¯ä»¥ä¸åšä¿®æ”¹ï¼‰ï¼š

```
dataDir=D:\\zookeeper-3.4.10\\tmp\\zookeeper\\data
```

å°†$ZOOKEEPER_HOME/biné…ç½®åˆ°Pathä¸­ï¼Œä¹‹åç›´æ¥è¿è¡ŒzkServerå‘½ä»¤å³å¯å¼€å¯ZookeeperæœåŠ¡ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```Cmd
C:\Users\hidden>zkServer

C:\Users\hidden>call "C:\Program Files\Java\jdk1.8.0_112"\bin\java "-Dzookeeper.log.dir=D:\zookeeper-3.4.10\bin\.." "-Dzookeeper.root.logger=INFO,CONSOLE" -cp "D:\zookeeper-3.4.10\bin\..\build\classes;D:\zookeeper-3.4.10\bin\..\build\lib\*;D:\zookeeper-3.4.10\bin\..\*;D:\zookeeper-3.4.10\bin\..\lib\*;D:\zookeeper-3.4.10\bin\..\conf" org.apache.zookeeper.server.quorum.QuorumPeerMain "D:\zookeeper-3.4.10\bin\..\conf\zoo.cfg"
2017-11-14 00:44:20,135 [myid:] - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: D:\zookeeper-3.4.10\bin\..\conf\zoo.cfg
2017-11-14 00:44:20,147 [myid:] - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount set to 3
2017-11-14 00:44:20,147 [myid:] - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval set to 0
2017-11-14 00:44:20,147 [myid:] - INFO  [main:DatadirCleanupManager@101] - Purge task is not scheduled.
2017-11-14 00:44:20,150 [myid:] - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined in config, running  in standalone mode
2017-11-14 00:44:20,250 [myid:] - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: D:\zookeeper-3.4.10\bin\..\conf\zoo.cfg
2017-11-14 00:44:20,250 [myid:] - INFO  [main:ZooKeeperServerMain@96] - Starting server
```

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Kafka å¹¶å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†ä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)