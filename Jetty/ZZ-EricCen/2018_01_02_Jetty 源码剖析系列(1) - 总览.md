title: Jetty æºç å‰–æç³»åˆ—(1) - æ€»è§ˆ
date: 2018-01-02
tag: 
categories: Jetty
permalink: Jetty/EricCen/intro
author: Eric Cen
from_url: http://ericcenblog.com/2017/05/27/jettyyuan-ma-pou-xi/
wechat_url: 

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://ericcenblog.com/2017/05/27/jettyyuan-ma-pou-xi/ ã€ŒEric Cenã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [Jetty Architecture](http://www.iocoder.cn/Jetty/EricCen/intro/)
- [å¯åŠ¨ä¸€ä¸ªå†…åµŒçš„JettyæœåŠ¡å™¨](http://www.iocoder.cn/Jetty/EricCen/intro/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

[Jetty](http://www.eclipse.org/jetty/)æ˜¯Eclipse Foundationå‡ºçš„ä¸€ä¸ªè½»é‡çº§WebæœåŠ¡å™¨å’ŒServletå®¹å™¨ã€‚[Spark](http://sparkjava.com/)ä½¿ç”¨äº†Jettyä½œä¸ºå®ƒçš„å†…åµŒæœåŠ¡å™¨ã€‚æˆ‘ä¸€ç›´éƒ½å¯¹WebæœåŠ¡å™¨æœ‰ç€è¿·ä¹‹å…´è¶£ï¼Œå‰å‰ååå»è¯»è¿‡å¥½å‡ ä¸ªWebæœåŠ¡å™¨çš„æºç ï¼Œæœ‰ä»£ç é‡å¤ªå¤§è®¾è®¡æ¨¡å¼å¤æ‚è€ŒåŠé€”è€ŒåºŸçš„ï¼Œå¦‚Tomcatï¼Œæœ‰å› ä¸ºä»£ç é‡å°è€Œç®€å•è€Œè¯»å®Œçš„ï¼Œå¦‚NanoHTTPDã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒJettyå¤§å°é€‚ä¸­ï¼Œè€Œä¸”ä¹Ÿå¤Ÿæˆç†Ÿï¼Œä¹‹å‰åœ¨å·¥ä½œä¸­å†™çš„ä¸€ä¸ªé¡¹ç›®å°±æ˜¯ç”¨äº†Jetty Runneræ¥å®ç°äº†ä¸€ä¸ªRESTful Serviceã€‚è¿™æ®µæ—¶é—´é‡æ–°å»å­¦ä¹ äº†ä¸€éJava NIOï¼Œæ‰€ä»¥è¿™æ¬¡å°±è¶æœºæŠŠJettyçš„æºç å¥½å¥½æ’¸ä¸€éã€‚

Jetty Versionï¼š 9.4.5

Let's hit on the road!

# Jetty Architecture

åœ¨å¼€å§‹å‰–æä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Jettyçš„æ•´ä½“æ¶æ„ï¼ŒJettyçš„å®˜æ–¹æ–‡æ¡£å¯¹Jettyæ¶æ„æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»([ç‚¹è¿™é‡Œ](http://www.eclipse.org/jetty/documentation/current/architecture.html))ã€‚
![img](http://ericcenblog.com/content/images/2017/05/Capture-38.JPG)
å¦‚æ–‡æ¡£æ‰€è¿°ï¼š

> The Jetty Server is the plumbing between a collection of 'Connector's that accept connections and a collection of 'Handler's that service requests from the connections and produce responses, with threads from a thread pool doing the work.

Connectorè´Ÿè´£æ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼ŒHandlerè´Ÿè´£è§£æè¯·æ±‚å¹¶äº§ç”Ÿå“åº”ï¼Œé€šè¿‡çº¿ç¨‹æ± ThreadPoolæ¥æ‰§è¡Œä»»åŠ¡ï¼Œè€ŒConnectorï¼ŒHandlerï¼ŒThreadPoolè¿™ä¸‰ä¸ªç»„ä»¶éƒ½æ˜¯ä¾é™„åœ¨Serverä¸­ã€‚

# å¯åŠ¨ä¸€ä¸ªå†…åµŒçš„JettyæœåŠ¡å™¨

æœ¬æ–‡å¼€å¤´æåˆ°è¿‡Sparkå°±æ˜¯ç”¨äº†Jettyåšä¸ºå®ƒå†…åµŒçš„æœåŠ¡å™¨ï¼Œä»ä¸Šæ–‡æ‰€çœ‹åˆ°Jettyæ˜¯ç”±Serverï¼ŒConnectorï¼ŒHandlerï¼ŒThreadPoolè¿™å‡ ä¸ªç»„ä»¶ç»„æˆï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å¯åŠ¨ä¸€ä¸ªå†…åµŒçš„JettyæœåŠ¡å™¨ã€‚![img](http://ericcenblog.com/content/images/2017/05/Capture-44.JPG)æ˜¯çš„ï¼Œä¸Šé¢çš„ä»£ç å°±å·²ç»æ˜¯å¯åŠ¨äº†ä¸€ä¸ªå†…åµŒçš„JettyæœåŠ¡å™¨ï¼(å½“ç„¶ï¼Œæœ‰éƒ¨åˆ†ä»£ç æˆ‘å·²ç»çœç•¥)ã€‚ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œ`Server`ï¼Œ`Connector`ï¼Œ`Handler`ï¼Œéƒ½æœ‰äº†ï¼Œé‚£`ThreadPool`å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹Serverç±»çš„æ„é€ å‡½æ•°ï¼š![img](http://ericcenblog.com/content/images/2017/05/Capture-42.JPG)![img](http://ericcenblog.com/content/images/2017/05/Capture-43.JPG)æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çº¿ç¨‹æ± æ˜¯åœ¨`Server`çš„æ„é€ å‡½æ•°é‡Œé¢åˆ›å»ºå‡ºæ¥äº†ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ª`QueuedThreadPool`ï¼ŒåŸºäºé˜Ÿåˆ—çš„çº¿ç¨‹æ± ã€‚ å®ç°ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯ä¸€ä¸ªä¸é”™çš„Javaé¢è¯•é¢˜ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹ä¸€ä¸‹Jettyæ˜¯å¦‚ä½•å®ç°çš„ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹`QueuedThreadPool`çš„å±‚çº§å…³ç³»:![img](http://ericcenblog.com/content/images/2017/05/Capture-45.JPG)
å†çœ‹`QueuedThreadPool`çš„æ„é€ å‡½æ•°ï¼š![img](http://ericcenblog.com/content/images/2017/05/Capture-46.JPG)æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`QueuedThreadPool`æ˜¯æŠŠ`Runnable`çš„jobæ”¾åœ¨ä¸€ä¸ª`org.eclipse.jetty.util.BlockingArrayQueue`é‡Œï¼Œ`org.eclipse.jetty.util.BlockingArrayQueue`æ˜¯Jettyè‡ªå·±å®ç°çš„åŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—ã€‚![img](http://ericcenblog.com/content/images/2017/05/Capture-47.JPG)ä»å‰æ–‡`QueuedThreadPool`çš„å±‚çº§å…³ç³»å›¾çœ‹åˆ°`QueuedThreadPool`å®ç°äº†`LifeCycle`æ¥å£ï¼Œè¿™ä¸ª`LifeCycle`æ¥å£åœ¨Jettyé‡Œé¢æ˜¯ä¸€ä¸ªéå¸¸é‡è¦æ¦‚å¿µï¼Œ`Server`ï¼Œ`Connector`ï¼Œ`Handler`ï¼Œå’Œ`QueuedThreadPool`éƒ½æ˜¯å®ç°`LifeCycle`æ¥å£ã€‚è¿™äº›ç»„ä»¶éƒ½ä¼šé€šè¿‡è°ƒç”¨`start()`æ–¹æ³•æ¥å¯åŠ¨ï¼Œè€Œ`start()`æ–¹æ³•æœ€ç»ˆåˆä¼šè°ƒç”¨`doStar()`æ–¹æ³•ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹`QueuedThreadPool`è¿™ä¸ªçº¿ç¨‹æ± æ˜¯æ€æ ·å¯åŠ¨çš„ï¼š![img](http://ericcenblog.com/content/images/2017/05/Capture-48.JPG)å®ƒå…ˆæŠŠ`_threadsStarted`è¿™ä¸ª`Atomic`çš„å˜é‡è®¾æˆ0ï¼Œç„¶åå¯åŠ¨`_minThreads`ä¸ªçº¿ç¨‹ï¼š![img](http://ericcenblog.com/content/images/2017/05/Capture-49.JPG)![img](http://ericcenblog.com/content/images/2017/05/Capture-50.JPG)å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯åŠ¨äº†`_minThreads`ä¸ª_runnableçº¿ç¨‹ï¼Œè€Œè¿™ä¸ª`_runnable`çº¿ç¨‹åšçš„æ˜¯ä»€ä¹ˆçš„ï¼Ÿ![img](http://ericcenblog.com/content/images/2017/05/Capture-51.JPG)æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ª`_runnable`çº¿ç¨‹æ˜¯å»`_jobs`ä¹Ÿå°±æ˜¯`BlockingArrayQueue`è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢å–å‡ºä¸€ä¸ª`Runnable`çš„`job`,ç„¶åæ‰§è¡Œè¿™ä¸ªjobï¼š![img](http://ericcenblog.com/content/images/2017/05/Capture-52.JPG)![img](http://ericcenblog.com/content/images/2017/05/Capture-53.JPG)

To Be Continue......