title: å“åº”å¼ä¸€äº›å†…å®¹çš„åˆ†äº«æ€»ç»“
date: 2020-01-01
tags:
categories: RxJava
permalink: RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response
author: ä¸€å¶çŸ¥ç§‹
from_url: https://muyinchen.github.io/2018/09/12/2018.9.10%20%E5%93%8D%E5%BA%94%E5%BC%8F%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%E7%9A%84%E5%88%86%E4%BA%AB%E6%80%BB%E7%BB%93/
wechat_url:

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://t.cn/EqKFh4g ã€Œä¸€å¶çŸ¥ç§‹ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [å“åº”å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)
- [å¹¶å‘ä¸å¹¶è¡Œçš„å…³ç³»](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)
- [å“åº”å¼ä¸­çš„èƒŒå‹åˆ°åº•æ˜¯ä¸€ç§æ€æ ·çš„ç†è§£](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)
- [å¦‚ä½•å»çœ‹Rxjavaæˆ–è€…Reactorçš„æºç ï¼Œæ ¹æ®æºç çš„æ¥å£çš„è®¾è®¡æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›ä»€ä¹ˆå¯ç¤º](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)
- [å¦‚ä½•å»çœ‹å¾…ä¼—å¤šå‡½æ•°è¡¨è¾¾å¼](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)
- [å…³äºå“åº”å¼çš„ä½¿ç”¨æ€§èƒ½çš„è€ƒç©¶](http://www.iocoder.cn/RxJava/zhiqiu/Share-a-summary-of-some-of-the-content-in-response/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

> 2018.9.10 å“åº”å¼ä¸€äº›å†…å®¹çš„åˆ†äº«æ€»ç»“

# å“åº”å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

ç°å®ç”Ÿæ´»ä¸­ï¼Œå½“æˆ‘ä»¬å¬åˆ°æœ‰äººå–Šæˆ‘ä»¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¯¹å…¶è¿›è¡Œå“åº”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å¼æ¥è¿›è¡Œçš„ç¼–ç¨‹ã€‚
æ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯å¯¹äºæ‰€äº§ç”Ÿäº‹ä»¶çš„ä¸‹å‘ï¼Œæˆ‘ä»¬çš„æ¶ˆè´¹è€…å¯¹å…¶è¿›è¡Œçš„ä¸€ç³»åˆ—çš„æ¶ˆè´¹ã€‚
ä»è¿™ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒï¼Œæ•´ä¸ªä»£ç çš„è®¾è®¡æˆ‘ä»¬åº”è¯¥æ˜¯é’ˆå¯¹äºæ¶ˆè´¹è€…æ¥è®²çš„ï¼Œæ¯”å¦‚çœ‹ç”µå½±ï¼Œæœ‰äº›ç”»é¢æˆ‘ä»¬ä¸æƒ³çœ‹ï¼Œé‚£å°±é—­ä¸Šçœ¼ç›ï¼Œæœ‰äº›å£°éŸ³ä¸æƒ³å¬ï¼Œé‚£å°±æ‚ä¸Šè€³æœµï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯å¯¹äºæ¶ˆè´¹è€…çš„å¢å¼ºåŒ…è£…ï¼Œæˆ‘ä»¬å°†è¿™äº›å¤æ‚çš„é€»è¾‘ç»™å…¶æ‹†åˆ†ï¼Œç„¶ååˆ†å‰²æˆä¸€ä¸ªä¸ªçš„å°ä»»åŠ¡è¿›è¡Œå°è£…ï¼Œäºæ˜¯å°±æœ‰äº†è¯¸å¦‚ï¬lterã€mapã€skipã€limitç­‰æ“ä½œã€‚è€Œå¯¹äºå…¶ä¸­æºç çš„è®¾è®¡é€»è¾‘ï¼Œæˆ‘ä»¬æ”¾åœ¨åé¢æ¥è®²ã€‚





# å¹¶å‘ä¸å¹¶è¡Œçš„å…³ç³»

å¯ä»¥è¿™ä¹ˆè¯´ï¼Œå¹¶å‘å¾ˆå¥½çš„åˆ©ç”¨äº†CPUæ—¶é—´ç‰‡çš„ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿé€‰æ‹©å¹¶è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ¥ç€åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ä¼šè¿è¡Œå¦ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æŠŠå‰ä¸€ä¸ªä»»åŠ¡è®¾ç½®æˆç­‰å¾…çŠ¶æ€ã€‚
å…¶å®è¿™é‡Œæƒ³è¡¨è¾¾çš„æ˜¯**å¹¶å‘å¹¶ä¸æ„å‘³ç€å¹¶è¡Œ**ã€‚
å…·ä½“æ¥ä¸¾å‡ ä¸ªæƒ…å†µ:

- æœ‰æ—¶å€™å¤šçº¿ç¨‹æ‰§è¡Œä¼šæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œè€Œæœ‰æ—¶å€™åè€Œä¼šé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚è¿™åœ¨å…³äºJDKä¸­å…¶Stream APIçš„ä½¿ç”¨ä¸Šä½“ç°çš„å¾ˆæ˜æ˜¾ï¼Œå¦‚æœä»»åŠ¡é‡å¾ˆå°ï¼Œè€Œæˆ‘ä»¬åˆä½¿ç”¨äº†å¹¶è¡Œæµï¼Œåè€Œé™ä½äº†æ€§èƒ½ã€‚

- æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¯èƒ½ä¼šåŒæ—¶å¼€å¯æˆ–è€…å…³é—­å¤šä¸ªçº¿ç¨‹ï¼Œè¿™ä¼šäº§ç”Ÿçš„å¾ˆå¤šæ€§èƒ½å¼€é”€ï¼Œè¿™ä¹Ÿé™ä½äº†ç¨‹åºæ€§èƒ½ã€‚

- å½“æˆ‘ä»¬çš„çº¿ç¨‹åŒæ—¶éƒ½åœ¨ç­‰å¾…IOè¿‡ç¨‹ï¼Œæ­¤æ—¶å¹¶å‘ä¹Ÿå°±å¯èƒ½ä¼šé˜»å¡CPUèµ„æºï¼Œå…¶é€ æˆçš„åæœä¸ä»…ä»…æ˜¯ç”¨æˆ·åœ¨ç­‰å¾…ç»“æœï¼ŒåŒæ—¶ä¼šæµªè´¹CPUçš„è®¡ç®—èµ„æºã€‚

- å¦‚æœå‡ ä¸ªçº¿ç¨‹å…±äº«äº†ä¸€ä¸ªæ•°æ®ï¼Œæƒ…å†µå°±å˜å¾—æœ‰äº›å¤æ‚äº†ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ•°æ®åœ¨å„ä¸ªçº¿ç¨‹ä¸­çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¼šä½¿ç”¨Synchronizedæˆ–è€…æ˜¯lockæ¥è§£å†³ã€‚

  ç°åœ¨ï¼Œåº”è¯¥å¯¹å¹¶å‘æœ‰ä¸€å®šçš„è®¤çŸ¥äº†å§ã€‚å¹¶å‘æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¸œè¥¿ï¼Œä½†å¹¶ä¸ä¸€å®šä¼šå®ç°å¹¶è¡Œã€‚å¹¶è¡Œæ˜¯åœ¨å¤šä¸ªCPUæ ¸å¿ƒä¸Šçš„åŒä¸€æ—¶é—´è¿è¡Œå¤šä¸ªä»»åŠ¡æˆ–è€…ä¸€ä¸ªä»»åŠ¡åˆ†ä¸ºå¤šå—æ‰§è¡Œ(å¦‚ForkJoin)ã€‚å•æ ¸CPUçš„è¯å°±ä¸è¦è€ƒè™‘äº†ã€‚
  è¡¥å……ä¸€ç‚¹ï¼Œå®é™…ä¸Šå¤šçº¿ç¨‹å°±æ„å‘³ç€å¹¶å‘ï¼Œä½†æ˜¯å¹¶è¡Œåªå‘ç”Ÿåœ¨å½“è¿™äº›çº¿ç¨‹åœ¨åŒä¸€æ—¶é—´è°ƒåº¦åˆ†é…åœ¨ä¸åŒCPUä¸Šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶è¡Œæ˜¯å¹¶å‘çš„ä¸€ç§ç‰¹å®šçš„å½¢å¼ã€‚å¾€å¾€æˆ‘ä»¬ä¸€ä¸ªä»»åŠ¡é‡Œä¼šäº§ç”Ÿå¾ˆå¤šå…ƒç´ ï¼Œç„¶è€Œè¿™äº›ä¸ªå…ƒç´ åœ¨ä¸åšæ“ä½œçš„æƒ…å†µä¸‹å¤§éƒ½åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ“ä½œï¼Œè¦ä¹ˆæˆ‘ä»¬å°±è¦å¯¹å…¶è¿›è¡ŒForkJoinï¼Œä½†è¿™äº›å¯¹äºæˆ‘ä»¬å¾ˆå¤šç¨‹åºå‘˜æ¥è®²æœ‰æ—¶å€™å¾ˆä¸å¥½æ“ä½œæ§åˆ¶ï¼Œä¸Šæ‰‹éš¾åº¦æœ‰äº›é«˜ï¼Œå“åº”å¼çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„é€šè¿‡å…¶è°ƒåº¦APIå°±å¯ä»¥è½»æ¾åšåˆ°äº‹ä»¶å…ƒç´ çš„ä¸‹å‘åˆ†é…ï¼Œå…¶å†…éƒ¨å°†æ¯ä¸ªå…ƒç´ åŒ…è£…æˆä¸€ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ˜¯å¦æ˜¯è®¡ç®—å‹ä»»åŠ¡è¿˜æ˜¯IOç±»å‹çš„ä»»åŠ¡æ¥é€‰æ‹©ç›¸åº”çš„çº¿ç¨‹æ± ã€‚
  è¿™é‡Œï¼Œéœ€è¦**å¼ºè°ƒ**ä¸€ä¸‹ï¼šçº¿ç¨‹åªæ˜¯ä¸€ä¸ªå¯¹è±¡è€Œå·²ï¼Œä¸è¦æŠŠå…¶æƒ³è±¡æˆcpuä¸­çš„æŸä¸€ä¸ªæ‰§è¡Œæ ¸å¿ƒï¼Œè¿™æ˜¯å¾ˆå¤šäººéƒ½åœ¨çŠ¯çš„é”™ï¼Œcpuæ—¶é—´ç‰‡åˆ‡æ¢æ‰§è¡Œè¿™äº›ä¸ªçº¿ç¨‹ã€‚

# å“åº”å¼ä¸­çš„èƒŒå‹åˆ°åº•æ˜¯ä¸€ç§æ€æ ·çš„ç†è§£

ç”¨ä¸€ä¸ªä¸ç®—å¾ˆæ°å½“çš„ä¸­å›½çš„æˆè¯­æ¥è®²ï¼Œå°±æ˜¯æ‰¿ä¸Šå¯ä¸‹ã€‚ä¸ºäº†æ›´å¥½çš„è§£é‡Šï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œå¤§åï¼Œåœ¨æ´ªæ°´æ—¶æœŸï¼Œä¸‹æ¸¸æ²¡æœ‰åŠæ³•ä¸€ä¸‹å­æ¶ˆè€—é‚£ä¹ˆå¤šæ°´ï¼Œå¤§ååœ¨æ­¤çš„ä½œç”¨å°±æ˜¯æ‹¦æˆªæ´ªæ°´ï¼Œå¹¶æ ¹æ®ä¸‹æ¸¸çš„æ¶ˆè€—æƒ…å†µé…Œæƒ…æ’æ”¾ã€‚å†è€…ï¼Œçˆ¶äº²çš„èƒŒï¼Œæˆ‘ä»¬å°æ—¶å€™ï¼Œç¤¾ä¼šä¸Šå¾ˆå¤šçš„äº‹æƒ…é¦–å…ˆç”±çˆ¶äº²ç”¨è‡ªå·±çš„èƒŒæ¥å¸®æˆ‘ä»¬æ¥æ‰›èµ·ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬è‡ªèº«çš„èƒ½åŠ›æ¥é€‚å½“çš„ä¸‹å‘ç»™æˆ‘ä»¬å‹åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒèƒŒå‹åº”è¯¥å†™åœ¨è¿æ¥å…ƒç´ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä¸€ä¸ªåœ°æ–¹ï¼Œå³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„è¿çº¿è€…ã€‚ç„¶åï¼Œé€šè¿‡è¿™é‡Œçš„æè¿°ï¼ŒèƒŒå‹åº”è¯¥å…·æœ‰æ‰¿è½½å…ƒç´ çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å…¶å¿…é¡»æ˜¯ä¸€ä¸ªå®¹å™¨çš„ï¼Œè€Œä¸”å…ƒç´ çš„å­˜å‚¨ä¸ä¸‹å‘åº”è¯¥å…·æœ‰å…ˆåçš„ï¼Œé‚£ä¹ˆä½¿ç”¨é˜Ÿåˆ—åˆ™æ˜¯æœ€é€‚åˆä¸è¿‡äº†ã€‚

# å¦‚ä½•å»çœ‹Rxjavaæˆ–è€…Reactorçš„æºç ï¼Œæ ¹æ®æºç çš„æ¥å£çš„è®¾è®¡æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›ä»€ä¹ˆå¯ç¤º

å…³äºå“åº”å¼çš„Rxæ ‡å‡†å·²ç»å†™å…¥äº†JDKä¸­:`java.util.concurrent.Flow`ï¼š

```Java
@FunctionalInterface
public static interface Publisher<T> {
    
    public void subscribe(Subscriber<? super T> subscriber);
}


public static interface Subscriber<T> {
    
    public void onSubscribe(Subscription subscription);

    
    public void onNext(T item);

    
    public void onError(Throwable throwable);

    
    public void onComplete();
}


public static interface Subscription {
    
    public void request(long n);

    
    public void cancel();
}


public static interface Processor<T,R> extends Subscriber<T>, Publisher<R> {
}
```



å¯ä»¥çœ‹åˆ°ï¼ŒFlowè¿™ä¸ªç±»ä¸­åŒ…å«äº†è¿™4ä¸ªæ¥å£å®šä¹‰ï¼Œ`Publisher` é€šè¿‡`subscribe`æ–¹æ³•æ¥å’Œ`Subscriber`äº§ç”Ÿè®¢é˜…å…³ç³»ï¼Œè€Œ`Subscriber`ä¾é `onSubscribe`æ¥é¦–å…ˆå’Œä¸Šæ¸¸äº§ç”Ÿè”ç³»ï¼Œè¿™é‡Œå°±æ˜¯é `Subscription`æ¥åšåˆ°çš„ï¼Œæ‰€ä»¥è¯´ï¼Œ`Subscription`å¾€å¾€ä¼šä½œä¸ºç”Ÿäº§è€…çš„å†…éƒ¨ç±»å®šä¹‰å…¶ä¸­ï¼Œå…¶ç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…æ‰€ç”Ÿäº§çš„å…ƒç´ ï¼Œæ”¯æŒèƒŒå‹çš„è¯ï¼Œ`Subscription`åº”è¯¥é¦–å…ˆå°†å…¶æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®è¯·æ±‚æ•°é‡æ¥è°ƒç”¨`Subscriber`çš„`onNext`ç­‰æ–¹æ³•è¿›è¡Œä¸‹å‘ã€‚è¿™ä¸ªåœ¨Rxç¼–ç¨‹ä¸­éƒ½æ˜¯ç»Ÿä¸€çš„æ¨¡å¼ï¼Œæˆ‘ä»¬é€šè¿‡Reactorä¸­`reactor.core.publisher.Flux#fromArray`æ‰€æ¶‰åŠçš„`FluxArray`çš„æºç æ¥å¯¹æ­¤æ®µå†…å®¹è¿›è¡Œç†è§£:

```Java
final class FluxArray<T> extends Flux<T> implements Fuseable, Scannable {

	final T[] array;

	@SafeVarargs
	public FluxArray(T... array) {
		this.array = Objects.requireNonNull(array, "array");
	}

	@SuppressWarnings("unchecked")
	public static <T> void subscribe(CoreSubscriber<? super T> s, T[] array) {
		if (array.length == 0) {
			Operators.complete(s);
			return;
		}
		if (s instanceof ConditionalSubscriber) {
			s.onSubscribe(new ArrayConditionalSubscription<>((ConditionalSubscriber<? super T>) s, array));
		}
		else {
			s.onSubscribe(new ArraySubscription<>(s, array));
		}
	}

	@Override
	public void subscribe(CoreSubscriber<? super T> actual) {
		subscribe(actual, array);
	}


	@Override
	public Object scanUnsafe(Attr key) {
		if (key == Attr.BUFFERED) return array.length;
		return null;
	}

	static final class ArraySubscription<T>
			implements InnerProducer<T>, SynchronousSubscription<T> {

		final CoreSubscriber<? super T> actual;

		final T[] array;

		int index;

		volatile boolean cancelled;

		volatile long requested;
		@SuppressWarnings("rawtypes")
		static final AtomicLongFieldUpdater<ArraySubscription> REQUESTED =
				AtomicLongFieldUpdater.newUpdater(ArraySubscription.class, "requested");

		ArraySubscription(CoreSubscriber<? super T> actual, T[] array) {
			this.actual = actual;
			this.array = array;
		}

		@Override
		public void request(long n) {
			if (Operators.validate(n)) {
				if (Operators.addCap(REQUESTED, this, n) == 0) {
					if (n == Long.MAX_VALUE) {
						fastPath();
					}
					else {
						slowPath(n);
					}
				}
			}
		}

		void slowPath(long n) {
			final T[] a = array;
			final int len = a.length;
			final Subscriber<? super T> s = actual;

			int i = index;
			int e = 0;

			for (; ; ) {
				if (cancelled) {
					return;
				}

				while (i != len && e != n) {
					T t = a[i];

					if (t == null) {
						s.onError(new NullPointerException("The " + i + "th array element was null"));
						return;
					}

					s.onNext(t);

					if (cancelled) {
						return;
					}

					i++;
					e++;
				}

				if (i == len) {
					s.onComplete();
					return;
				}

				n = requested;

				if (n == e) {
					index = i;
					n = REQUESTED.addAndGet(this, -e);
					if (n == 0) {
						return;
					}
					e = 0;
				}
			}
		}

		void fastPath() {...}
				
	}

	static final class ArrayConditionalSubscription<T>
			implements InnerProducer<T>, SynchronousSubscription<T> {
		....
	}

}
```



æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¹‹å‰æ–‡å­—åœ¨æºç å†…éƒ¨çš„è¡¨è¾¾ã€‚è¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚è€Œå¯¹äºå„ç§ä¸­é—´æ“ä½œçš„åŒ…è£…æˆ‘ä»¬è¯¥å¦‚ä½•å»åšï¼Œä¾æ®ä¹‹å‰çš„æ¥å£å®šä¹‰ï¼Œæˆ‘ä»¬åº”è¯¥æ›´æ³¨é‡åŠŸèƒ½çš„è®¾å®šï¼Œè€Œæ— è®ºæ˜¯filterï¼Œflatmapï¼Œmapç­‰è¿™äº›å¸¸ç”¨çš„æ“ä½œï¼Œå…¶å®éƒ½æ˜¯æ¶ˆè´¹åŠ¨ä½œï¼Œç†åº”å®šä¹‰åœ¨æ¶ˆè´¹è€…å±‚é¢ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å»åšï¼Ÿ
è¿™é‡Œï¼Œæˆ‘ä»¬å°±è¦ç»“åˆæˆ‘ä»¬çš„è®¾è®¡æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼ï¼Œå¯¹`subscribe(Subscriber<? super T> subscriber)`æ‰€ä¼ å…¥çš„`Subscriber`è¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œå³ä»`Subscriber`è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œä½¿ç”¨çš„æ˜¯è£…é¥°å¢å¼ºæ¨¡å¼ï¼Œä½†ä»å¤–é¢æ¥çœ‹ï¼Œå…¶æ•´ä½“å®šä¹‰çš„ä¾ç„¶æ˜¯ä¸€ä¸ª`Flux`æˆ–è€…`Mono`ï¼Œè¿™é‡Œ`FluxArray`çš„è¯å°±æ˜¯ä¾‹å­ï¼Œè¿™æ ·ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œå…¶å±äºå‘ä¸Šé€‚é…ï¼Œä¹Ÿå°±æ˜¯é€‚é…æ¨¡å¼ï¼Œè¿™é‡Œçš„é€‚é…ç©çš„æ¯”è¾ƒæœ‰æ„æ€ï¼Œå®Œå…¨å°±æ˜¯é å¯¹å†…éƒ¨ç±»çš„åŒ…è£…ç„¶åé€šè¿‡`subscribe(Subscriber<? super T> subscriber)`è¡”æ¥æ¥å®Œæˆçš„ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥æƒ³åˆ°ä¸­å›½å¤ä»£è‹è½¼çš„é¢˜è¥¿æ—å£é‡Œæœ‰ä¸€å¥è¯:`æ¨ªçœ‹æˆå²­ä¾§æˆå³° è¿œè¿‘é«˜ä½å„ä¸åŒ`è®²çš„å°±æ˜¯ä»ä¸åŒçš„è§’åº¦å»çœ‹å¾…ä¸€ä¸ªäº‹ç‰©ï¼Œå°±ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœã€‚åŒæ ·ï¼Œä¸€ç™¾ä¸ªäººå¿ƒä¸­æœ‰ä¸€ç™¾ä¸ªå“ˆå§†é›·ç‰¹ï¼Œä¹Ÿæ˜¯å¯¹äºåŒä¸€ä¸ªäº‹ç‰©çš„çœ‹æ³•ï¼Œä»è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å­¦åˆ°è®¾è®¡æ¨¡å¼åƒä¸‡ä¸è¦ç‰¹åˆ«åˆ»æ„çš„å»ç»å¯¹åŒ–ï¼

æˆ‘ä»¬å¯ä»¥ç»“åˆ`reactor.core.publisher.Flux#filter`æ¶‰åŠçš„`FluxFilter`æ¥è§‚å¯Ÿç†è§£ä¸Šè¿°æ¶‰åŠçš„å†…å®¹:

```Java
final class FluxFilter<T> extends FluxOperator<T, T> {

	final Predicate<? super T> predicate;

	FluxFilter(Flux<? extends T> source, Predicate<? super T> predicate) {
		super(source);
		this.predicate = Objects.requireNonNull(predicate, "predicate");
	}

	@Override
	@SuppressWarnings("unchecked")
	public void subscribe(CoreSubscriber<? super T> actual) {
		if (actual instanceof ConditionalSubscriber) {
			source.subscribe(new FilterConditionalSubscriber<>((ConditionalSubscriber<? super T>) actual,
					predicate));
			return;
		}
		source.subscribe(new FilterSubscriber<>(actual, predicate));
	}

	static final class FilterSubscriber<T>
			implements InnerOperator<T, T>,
			           Fuseable.ConditionalSubscriber<T> {

		final CoreSubscriber<? super T> actual;

		final Predicate<? super T> predicate;

		Subscription s;

		boolean done;

		FilterSubscriber(CoreSubscriber<? super T> actual, Predicate<? super T> predicate) {
			this.actual = actual;
			this.predicate = predicate;
		}

		@Override
		public void onSubscribe(Subscription s) {
			if (Operators.validate(this.s, s)) {
				this.s = s;
				actual.onSubscribe(this);
			}
		}

		@Override
		public void onNext(T t) {
			if (done) {
				Operators.onNextDropped(t, actual.currentContext());
				return;
			}

			boolean b;

			try {
				b = predicate.test(t);
			}
			catch (Throwable e) {
				onError(Operators.onOperatorError(s, e, t, actual.currentContext()));
				return;
			}
			if (b) {
				actual.onNext(t);
			}
			else {
				s.request(1);
			}
		}

		@Override
		public boolean tryOnNext(T t) {
			if (done) {
				Operators.onNextDropped(t, actual.currentContext());
				return false;
			}

			boolean b;

			try {
				b = predicate.test(t);
			}
			catch (Throwable e) {
				onError(Operators.onOperatorError(s, e, t, actual.currentContext()));
				return false;
			}
			if (b) {
				actual.onNext(t);
			}
			return b;
		}

		@Override
		public void onError(Throwable t) {
			if (done) {
				Operators.onErrorDropped(t, actual.currentContext());
				return;
			}
			done = true;
			actual.onError(t);
		}

		@Override
		public void onComplete() {
			if (done) {
				return;
			}
			done = true;
			actual.onComplete();
		}

		@Override
		@Nullable
		public Object scanUnsafe(Attr key) {
			if (key == Attr.PARENT) return s;
			if (key == Attr.TERMINATED) return done;

			return InnerOperator.super.scanUnsafe(key);
		}

		@Override
		public CoreSubscriber<? super T> actual() {
			return actual;
		}

		@Override
		public void request(long n) {
			s.request(n);
		}

		@Override
		public void cancel() {
			s.cancel();
		}
	}

	static final class FilterConditionalSubscriber<T>
			implements InnerOperator<T, T>,
			           Fuseable.ConditionalSubscriber<T> {

		...
	}

}
```

æ ¹æ®è¿™äº›è®¾è®¡ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥ä½œä¸ºå‚è€ƒæ¥é€šè¿‡ä¸€å¥—apiæ¥å£è®¾è®¡ï¼Œå¯ä»¥è¡ç”Ÿå‡ºå¾ˆå¤šè§„èŒƒé€»è¾‘çš„å¼€å‘ï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ä¼—å¤šçš„Rxè¡ç”Ÿæ“ä½œAPIçš„è®¾è®¡å®ç°ï¼Œå…¶éƒ½æ˜¯æŒ‰ç…§ä¸€å¥—æ¨¡æ¿æ¥è¿›è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºä»£ç å±‚é¢çš„å¾®æœåŠ¡è®¾è®¡ã€‚

# å¦‚ä½•å»çœ‹å¾…ä¼—å¤šå‡½æ•°è¡¨è¾¾å¼

äººç±»æœ€æ“…é•¿æè¿°åœºæ™¯ï¼Œæ¯”å¦‚ä¸€å¥—åŠ¨ä½œï¼Œå‡å¦‚æ˜¯èˆè¹ˆçš„è¯ï¼Œå¯ä»¥è®²æ˜¯ä»€ä¹ˆä»€ä¹ˆç¼–èˆï¼Œä½†æ˜¯è¿™ä¸ªç¼–èˆåˆè¦åœ¨ä¸€å®šçš„æ¡†æ¶ä¹‹ä¸‹ï¼Œå³æœ‰ä¸€å®šçš„è§„èŒƒï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬æ–½å±•ä¸€å¥—æ‹³æ³•ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªè§„èŒƒï¼Œä¸èƒ½è¸¢ä¸€è„šä¹Ÿå«æ‹³æ³•ã€‚è€Œå¯¹äºè¿™ä¸ªè§„èŒƒçš„å®ç°ï¼Œé‚£å°±æ˜¯ä¸€å¥—åŠ¨ä½œï¼Œå¯¹äºæ‹³æ³•æ¥è®²ï¼Œå¯èƒ½å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å·¦å‹¾æ‹³æˆ–è€…å³å‹¾æ‹³ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯”è¾ƒå¤æ‚çš„å’æ˜¥æ‹³ï¼Œå¤ªææ‹³ç­‰ï¼Œè€Œä¸”ä¸€å¥—æ‹³æ³•å¯èƒ½æœ‰å¾ˆå¤šå°å¥—è·¯ç»„æˆï¼Œè¿™äº›å°å¥—è·¯ä¹Ÿæ˜¯éµå¾ªç€è¿™ä¸ªè§„èŒƒè¿›è¡Œçš„ï¼Œé‚£ä¹ˆä¾æ®è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„å‡½æ•°å¼æ¥å£å®šä¹‰:

```Java
@FunctionalInterface
public interface Predicate<T> {
	 boolean test(T t);
	  default Predicate<T> and(Predicate<? super T> other) {
        Objects.requireNonNull(other);
        return (t) -> test(t) && other.test(t);
    }
	 default Predicate<T> negate() {
        return (t) -> !test(t);
    }
	default Predicate<T> or(Predicate<? super T> other) {
        Objects.requireNonNull(other);
        return (t) -> test(t) || other.test(t);
    }
	static <T> Predicate<T> isEqual(Object targetRef) {
        return (null == targetRef)
                ? Objects::isNull
                : object -> targetRef.equals(object);
    }
}

@FunctionalInterface
public interface BiConsumer<T, U> {
	 
    void accept(T t, U u);

    
    default BiConsumer<T, U> andThen(BiConsumer<? super T, ? super U> after) {
        Objects.requireNonNull(after);

        return (l, r) -> {
            accept(l, r);
            after.accept(l, r);
        };
    }
}
```



å¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼`Predicate`è¿˜æ˜¯æ— è¿”å›å€¼åŠ¨ä½œå¤„ç†å‡½æ•°`BiConsumer`éƒ½éµå¾ªä¸€ä¸ªæ ‡å‡†åŠ¨ä½œçš„è®¾è®¡å®šä¹‰æ€è·¯ï¼Œå¹¶é€šè¿‡`default`æ–¹æ³•æ¥å¯¹åŒç±»åŠ¨ä½œè¿›è¡Œç¼–æ’ï¼Œä»¥è¾¾åˆ°æ›´åŠ ä¸°å¯Œçš„æ•ˆæœã€‚æ‰€ä»¥ï¼Œå‡½æ•°å¼çš„åº”ç”¨æ›´åŠ å€¾å‘äºå¹²å‡€åˆ©è½ï¼Œå‡¸æ˜¾è‡ªå·±è¦åšçš„äº‹æƒ…å°±å¥½ï¼Œæœªæ¥ï¼Œæˆ‘ä¼šåœ¨è‡ªå·±çš„`Javaç¼–ç¨‹æ–¹æ³•è®º- JDKç¯‡`ä¸­èŠ±å¤§é‡ç¯‡å¹…æ¥è§£è¯»å‡½æ•°å¼ç¼–ç¨‹çš„å„ç§å¥‡ç‰¹è€Œå®ç”¨çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ¥é™ä½æˆ‘ä»¬å¤æ‚æ¥å£çš„è®¾è®¡é€»è¾‘éš¾åº¦ï¼Œåšåˆ°çŸ¥åè§ä¹‰ï¼Œäº†ç„¶äºèƒ¸çš„æ•ˆæœã€‚è¿™ä¸ªåœ¨æˆ‘çš„`Javaç¼–ç¨‹æ–¹æ³•è®º- Reactorä¸Spring webfluxç¯‡`ä¸­ä¹Ÿæ˜¯æœ‰æ¶‰åŠçš„ã€‚

# å…³äºå“åº”å¼çš„ä½¿ç”¨æ€§èƒ½çš„è€ƒç©¶

å“åº”å¼ç¼–ç¨‹çŸ¥è¯†ä¸€ç§æ¨¡å¼ï¼Œç”¨çš„å¥½ä¸åå…¨çœ‹è‡ªå·±å¯¹äºapiçš„ç†è§£ç¨‹åº¦ï¼Œä¸è¦æƒ³ç€ä¼šå¤šä¹ˆçš„é™ä½æ€§èƒ½ï¼Œè¿™ä¸ªå¹¶æ²¡æœ‰è¿›è¡Œä»€ä¹ˆè¿‡åº¦åŒ…è£…è¿™ä¸€è¯´çš„ï¼Œå½“è®²åˆ°jdbcè¿™é‡Œå¦‚ä½•è¡¨ç°ä¸è¡Œçš„æ—¶å€™ï¼Œå½“å‰å¹¶æ²¡æœ‰ä¸€ä¸ªå¼€æºçš„Reactor-jdbcçš„æ¡†æ¶ï¼Œä¹Ÿå°±é€ æˆçš„æµ‹è¯•çš„ä¸åˆç†æ€§ï¼Œä½•å†µæ–°çš„çŸ¥è¯†æ˜¯éœ€è¦å¤§å®¶ä¸€èµ·å…±åŒæ¥å­¦ä¹ æ¨åŠ¨çš„ï¼Œä¸å¥½çš„åœ°æ–¹æˆ‘ä»¬æ¨åŠ¨å°±å¥½ï¼Œä¸éœ€è¦ä¸Šæ¥å°±å¯¹å…¶è¿›è¡Œå¦å®šï¼Œmongodbæœ‰æä¾›ç›¸åº”çš„å“åº”å¼apiï¼Œä½†å…¶å†…éƒ¨è¿˜æ˜¯ä¹‹å‰çš„æ–¹å¼ï¼ŒåŒæ ·ï¼Œå…³ç³»å‹æ•°æ®åº“ä¹Ÿæ˜¯ä¸€ä¸ªé“ç†ï¼Œå“åº”å¼ç¼–ç¨‹æ³¨é‡çš„æ˜¯ä¸­é—´è¿‡ç¨‹çš„å¤„ç†ï¼Œå…³äºç”Ÿäº§å…ƒç´ çš„è·å–å®ƒæ²¡å¤ªå¤šå…³ç³»ï¼Œæ›´å¤šçš„è¿˜æ˜¯çœ‹å…ƒç´ ç”Ÿäº§è€…çš„æ€§èƒ½ï¼Œä¸€å®¶ä¹‹è¨€ï¼Œå¯èƒ½æœ‰åé¢‡ï¼Œå¸Œæœ›ç†è§£ï¼Œæœ‰é—®é¢˜æå‡ºå°±å¥½ã€‚