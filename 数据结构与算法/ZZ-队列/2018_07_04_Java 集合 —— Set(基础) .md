title: Javaé›†åˆ â€”â€” Set(åŸºç¡€)
date: 2018-07-04
tags:
categories: æ•°æ®ç»“æ„ä¸ç®—æ³•
permalink: Data-Structures-and-Algorithms/Java-collection-Set-base
author: è´¾åšå²©
from_url: https://www.jianshu.com/p/b48c47a42916
wechat_url:

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ https://www.jianshu.com/p/b48c47a42916 ã€Œè´¾åšå²©ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [1.Set](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.1 Setå¸¸ç”¨æ–¹æ³•](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.2 HashSet](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.3 HashSetåŸºæœ¬æ“ä½œ](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.4 HashSetå…ƒç´ æ·»åŠ åˆ†æ](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.5 TreeSet](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.6 TreeSetåŸºæœ¬æ“ä½œ](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
  - [1.7 TreeSetå…ƒç´ æ’åº](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)
- [666. å½©è›‹](http://www.iocoder.cn/Data-Structures-and-Algorithms/Java-collection-Set-base/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# 1.Set

[ä¸Šä¸€ç¯‡](https://www.jianshu.com/p/25aa92f8d681)ï¼Œæˆ‘ä»¬ä»‹ç»Javaä¸­çš„Listé›†åˆã€‚æœ¬ç¯‡ï¼Œè®©æˆ‘ä»¬ç»§ç»­å­¦ä¹ ï¼Œæ¥äº†è§£ä¸‹Seté›†åˆï¼›

Setç»§æ‰¿äºCollectionæ¥å£ï¼Œæ˜¯ä¸€ä¸ªä¸å…è®¸å‡ºç°é‡å¤å…ƒç´ ï¼Œå¹¶ä¸”æ— åºçš„é›†åˆï¼Œä¸»è¦æœ‰HashSetå’ŒTreeSetä¸¤å¤§å®ç°ç±»ã€‚

åœ¨åˆ¤æ–­é‡å¤å…ƒç´ çš„æ—¶å€™ï¼ŒSeté›†åˆä¼šè°ƒç”¨hashCode()å’Œequal()æ–¹æ³•æ¥å®ç°ã€‚

HashSetæ˜¯å“ˆå¸Œè¡¨ç»“æ„ï¼Œä¸»è¦åˆ©ç”¨HashMapçš„keyæ¥å­˜å‚¨å…ƒç´ ï¼Œè®¡ç®—æ’å…¥å…ƒç´ çš„hashCodeæ¥è·å–å…ƒç´ åœ¨é›†åˆä¸­çš„ä½ç½®ï¼›

TreeSetæ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯æ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ’å…¥çš„å…ƒç´ éƒ½ä¼šè¿›è¡Œæ’åºï¼›

Seté›†åˆæ¡†æ¶ç»“æ„ï¼š

![img](https://upload-images.jianshu.io/upload_images/5621908-6d6c75cbd1581bb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/424)

## 1.1 Setå¸¸ç”¨æ–¹æ³•

ä¸Listæ¥å£ä¸€æ ·ï¼ŒSetæ¥å£ä¹Ÿæä¾›äº†é›†åˆæ“ä½œçš„åŸºæœ¬æ–¹æ³•ã€‚

ä½†ä¸Listä¸åŒçš„æ˜¯ï¼ŒSetè¿˜æä¾›äº†equals(Object o)å’ŒhashCode()ï¼Œä¾›å…¶å­ç±»é‡å†™ï¼Œä»¥å®ç°å¯¹é›†åˆä¸­æ’å…¥é‡å¤å…ƒç´ çš„å¤„ç†ï¼›

```java
public interface Set<E> extends Collection<E> {

    A:æ·»åŠ åŠŸèƒ½
    boolean add(E e);
    boolean addAll(Collection<? extends E> c);

    B:åˆ é™¤åŠŸèƒ½
    boolean remove(Object o);
    boolean removeAll(Collection<?> c);
    void clear();

    C:é•¿åº¦åŠŸèƒ½
    int size();

    D:åˆ¤æ–­åŠŸèƒ½
    boolean isEmpty();
    boolean contains(Object o);
    boolean containsAll(Collection<?> c);
    boolean retainAll(Collection<?> c);

    E:è·å–Seté›†åˆçš„è¿­ä»£å™¨ï¼š
    Iterator<E> iterator();

    F:æŠŠé›†åˆè½¬æ¢æˆæ•°ç»„
    Object[] toArray();
    <T> T[] toArray(T[] a);

    //åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤ï¼Œä¸ºå­ç±»æé«˜é‡å†™æ–¹æ³•
    boolean equals(Object o);
    int hashCode();
}
```

## 1.2 HashSet

HashSetå®ç°Setæ¥å£ï¼Œåº•å±‚ç”±HashMap(åé¢è®²è§£)æ¥å®ç°ï¼Œä¸ºå“ˆå¸Œè¡¨ç»“æ„ï¼Œæ–°å¢å…ƒç´ ç›¸å½“äºHashMapçš„keyï¼Œvalueé»˜è®¤ä¸ºä¸€ä¸ªå›ºå®šçš„Objectã€‚åœ¨æˆ‘çœ‹æ¥ï¼ŒHashSetç›¸å½“äºä¸€ä¸ªé˜‰å‰²ç‰ˆçš„HashMap;

å½“æœ‰å…ƒç´ æ’å…¥çš„æ—¶å€™ï¼Œä¼šè®¡ç®—å…ƒç´ çš„hashCodeå€¼ï¼Œå°†å…ƒç´ æ’å…¥åˆ°å“ˆå¸Œè¡¨å¯¹åº”çš„ä½ç½®ä¸­æ¥ï¼›

å®ƒç»§æ‰¿äºAbstractSetï¼Œå®ç°äº†Set, Cloneable, Serializableæ¥å£ã€‚

(1)HashSetç»§æ‰¿AbstractSetç±»ï¼Œè·å¾—äº†Setæ¥å£å¤§éƒ¨åˆ†çš„å®ç°ï¼Œå‡å°‘äº†å®ç°æ­¤æ¥å£æ‰€éœ€çš„å·¥ä½œï¼Œå®é™…ä¸Šæ˜¯åˆç»§æ‰¿äº†AbstractCollectionç±»ï¼›

(2)HashSetå®ç°äº†Setæ¥å£ï¼Œè·å–Setæ¥å£çš„æ–¹æ³•ï¼Œå¯ä»¥è‡ªå®šä¹‰å…·ä½“å®ç°ï¼Œä¹Ÿå¯ä»¥ç»§æ‰¿AbstractSetç±»ä¸­çš„å®ç°ï¼›

(3)HashSetå®ç°Cloneableï¼Œå¾—åˆ°äº†clone()æ–¹æ³•ï¼Œå¯ä»¥å®ç°å…‹éš†åŠŸèƒ½ï¼›

(4)HashSetå®ç°Serializableï¼Œè¡¨ç¤ºå¯ä»¥è¢«åºåˆ—åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ï¼Œå…¸å‹çš„åº”ç”¨å°±æ˜¯hessianåè®®ã€‚

å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- ä¸å…è®¸å‡ºç°é‡å¤å› ç´ ï¼›
- å…è®¸æ’å…¥Nullå€¼ï¼›
- å…ƒç´ æ— åºï¼ˆæ·»åŠ é¡ºåºå’Œéå†é¡ºåºä¸ä¸€è‡´ï¼‰ï¼›
- çº¿ç¨‹ä¸å®‰å…¨ï¼Œè‹¥2ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œHashSetï¼Œå¿…é¡»é€šè¿‡ä»£ç å®ç°åŒæ­¥ï¼›

## 1.3 HashSetåŸºæœ¬æ“ä½œ

HashSetåº•å±‚ç”±HashMapå®ç°ï¼Œæ’å…¥çš„å…ƒç´ è¢«å½“åšæ˜¯HashMapçš„keyï¼Œæ ¹æ®hashCodeå€¼æ¥ç¡®å®šé›†åˆä¸­çš„ä½ç½®ï¼Œç”±äºSeté›†åˆä¸­å¹¶æ²¡æœ‰è§’æ ‡çš„æ¦‚å¿µï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰åƒListä¸€æ ·æä¾›getï¼ˆï¼‰æ–¹æ³•ã€‚å½“è·å–HashSetä¸­æŸä¸ªå…ƒç´ æ—¶ï¼Œåªèƒ½é€šè¿‡éå†é›†åˆçš„æ–¹å¼è¿›è¡Œequals()æ¯”è¾ƒæ¥å®ç°ï¼›

```java
public class HashSetTest {
    public static void main(String[] agrs){
        //åˆ›å»ºHashSeté›†åˆï¼š
        Set<String> hashSet = new HashSet<String>();
        System.out.println("HashSetåˆå§‹å®¹é‡å¤§å°ï¼š"+hashSet.size());

        //å…ƒç´ æ·»åŠ ï¼š
        hashSet.add("my");
        hashSet.add("name");
        hashSet.add("is");
        hashSet.add("jiaboyan");
        hashSet.add(",");
        hashSet.add("hello");
        hashSet.add("world");
        hashSet.add("!");
        System.out.println("HashSetå®¹é‡å¤§å°ï¼š"+hashSet.size());

        //è¿­ä»£å™¨éå†ï¼š
        Iterator<String> iterator = hashSet.iterator();
        while (iterator.hasNext()){
            String str = iterator.next();
            System.out.println(str);
        }
        //å¢å¼ºforå¾ªç¯
        for(String str:hashSet){
            if("jiaboyan".equals(str)){
                System.out.println("ä½ å°±æ˜¯æˆ‘æƒ³è¦çš„å…ƒç´ :"+str);
            }
            System.out.println(str);
        }

        //å…ƒç´ åˆ é™¤ï¼š
        hashSet.remove("jiaboyan");
        System.out.println("HashSetå…ƒç´ å¤§å°ï¼š" + hashSet.size());
        hashSet.clear();
        System.out.println("HashSetå…ƒç´ å¤§å°ï¼š" + hashSet.size());

        //é›†åˆåˆ¤æ–­ï¼š
        boolean isEmpty = hashSet.isEmpty();
        System.out.println("HashSetæ˜¯å¦ä¸ºç©ºï¼š" + isEmpty);
        boolean isContains = hashSet.contains("hello");
        System.out.println("HashSetæ˜¯å¦ä¸ºç©ºï¼š" + isContains);
    }
}
```

## 1.4 HashSetå…ƒç´ æ·»åŠ åˆ†æ

Seté›†åˆä¸å…è®¸æ·»åŠ é‡å¤å…ƒç´ ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä¸ªæ€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ

æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```java
public class HashSetTest {

    public static void main(String[] agrs){
        //hashCode() å’Œ equals()æµ‹è¯•ï¼š
        hashCodeAndEquals();
    }
    public static void hashCodeAndEquals(){
        //ç¬¬ä¸€ä¸ª Seté›†åˆï¼š
        Set<String> set1 = new HashSet<String>();
        String str1 = new String("jiaboyan");
        String str2 = new String("jiaboyan");
        set1.add(str1);
        set1.add(str2);
        System.out.println("é•¿åº¦ï¼š"+set1.size()+",å†…å®¹ä¸ºï¼š"+set1);

        //ç¬¬äºŒä¸ª Seté›†åˆï¼š
        Set<App> set2 = new HashSet<App>();
        App app1 = new App();
        app1.setName("jiaboyan");

        App app2 = new App();
        app2.setName("jiaboyan");

        set2.add(app1);
        set2.add(app2);
        System.out.println("é•¿åº¦ï¼š"+set2.size()+",å†…å®¹ä¸ºï¼š"+set2);

        //ç¬¬ä¸‰ä¸ª Seté›†åˆï¼š
        Set<App> set3 = new HashSet<App>();
        App app3 = new App();
        app3.setName("jiaboyan");
        set3.add(app3);
        set3.add(app3);
        System.out.println("é•¿åº¦ï¼š"+set3.size()+",å†…å®¹ä¸ºï¼š"+set3);
    }
}
```

æµ‹è¯•ç»“æœï¼š

```java
é•¿åº¦ï¼š1,å†…å®¹ä¸ºï¼š[jiaboyan]
é•¿åº¦ï¼š2,å†…å®¹ä¸ºï¼š[com.jiaboyan.collection.App@efb78af, com.jiaboyan.collection.App@5f3306ad]
é•¿åº¦ï¼š1,å†…å®¹ä¸ºï¼š[com.jiaboyan.collection.App@1fb030d8]
```

å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªSeté›†åˆä¸­æœ€ç»ˆåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼›ç¬¬äºŒä¸ªSeté›†åˆä¿ç•™äº†2ä¸ªå…ƒç´ ï¼›ç¬¬ä¸‰ä¸ªé›†åˆä¹Ÿåªæœ‰1ä¸ªå…ƒç´ ï¼›

ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ

è®©æˆ‘ä»¬æ¥çœ‹çœ‹**HashSet**çš„add(E e)æ–¹æ³•ï¼š

```java
public boolean add(E e) {
    return map.put(e, PRESENT)==null;
}
```

åœ¨åº•å±‚HashSetè°ƒç”¨äº†**HashMap**çš„put(K key, V value)æ–¹æ³•:

```java
public V put(K key, V value) {
    if (table == EMPTY_TABLE) {
        inflateTable(threshold);
    }
    if (key == null)
        return putForNullKey(value);
    int hash = hash(key);
    int i = indexFor(hash, table.length);
    for (Entry<K,V> e = table[i]; e != null; e = e.next) {
        Object k;
        if (e.hash == hash && ((k = e.key) == key || key.equals(k))) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }
    modCount++;
    addEntry(hash, key, value, i);
    return null;
}
```

é€šè¿‡æŸ¥çœ‹ä»¥ä¸Šçš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼šå®é™…çš„é€»è¾‘éƒ½æ˜¯åœ¨HashMapçš„put()æ–¹æ³•ä¸­ã€‚

int hash = hash(key) å¯¹ä¼ å…¥çš„keyè®¡ç®—hashå€¼ï¼›

int i = indexFor(hash, table.length) å¯¹hashå€¼è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢æˆæ•°ç»„çš„index(HashMapä¸­åº•å±‚å­˜å‚¨ä½¿ç”¨äº†Entry<K,V>[]æ•°ç»„)ï¼›

for (Entry<K,V> e = table[i]; e != null; e = e.next) åˆ¤æ–­å¯¹åº”indexä¸‹æ˜¯å¦å­˜åœ¨å…ƒç´ ï¼›

å¦‚æœå­˜åœ¨ï¼Œåˆ™if(e.hash == hash && ((k = e.key) == key || key.equals(k)))åˆ¤æ–­ï¼›

å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™addEntry(hash, key, value, i)ç›´æ¥æ·»åŠ ï¼›

ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š

åœ¨å‘HashMapä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå…ˆåˆ¤æ–­keyçš„hashCodeå€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™è°ƒç”¨equals()ã€==è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ç›¸åŒåˆ™è¦†ç›–åŸæœ‰å…ƒç´ ï¼›å¦‚æœä¸åŒï¼Œåˆ™ç›´æ¥å‘Mapä¸­æ·»åŠ å…ƒç´ ï¼›

åè¿‡æ¥ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼š

åœ¨ç¬¬ä¸€ä¸ªSeté›†åˆä¸­ï¼Œæˆ‘ä»¬newäº†ä¸¤ä¸ªStringå¯¹è±¡ï¼Œèµ‹äº†ç›¸åŒçš„å€¼ã€‚å½“ä¼ å…¥åˆ°HashMapä¸­æ—¶ï¼Œkeyå‡ä¸ºâ€œjiaboyanâ€ï¼Œæ‰€ä»¥hashå’Œiçš„å€¼éƒ½ç›¸åŒã€‚è¿›è¡Œif (e.hash == hash && ((k = e.key) == key || key.equals(k)))åˆ¤æ–­ï¼Œç”±äºStringå¯¹è±¡é‡å†™äº†equals()æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨((k = e.key) == key || key.equals(k))åˆ¤æ–­æ—¶ï¼Œè¿”å›äº†trueï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡çš„æ’å…¥å¹¶ä¸ä¼šå¢åŠ Seté›†åˆçš„é•¿åº¦ï¼›

ç¬¬äºŒä¸ªSeté›†åˆä¸­ï¼Œä¹Ÿæ˜¯newäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œä½†æ²¡æœ‰é‡å†™equals()æ–¹æ³•ï¼ˆåº•å±‚è°ƒç”¨çš„Objectçš„equals()ï¼Œä¹Ÿå°±æ˜¯==åˆ¤æ–­ï¼‰ï¼Œæ‰€ä»¥ä¼šå¢åŠ 2ä¸ªå…ƒç´ ï¼›

ç¬¬ä¸‰ä¸ªSeté›†åˆä¸­ï¼Œåªnewäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒç”¨çš„ä¸¤æ¬¡addæ–¹æ³•éƒ½æ·»åŠ çš„è¿™ä¸ªæ–°newçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿåªæ˜¯ä¿ç•™äº†1ä¸ªå…ƒç´ ï¼›

## 1.5 TreeSet

ä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºï¼Œæ­¤é›†åˆçš„å®ç°å’Œæ ‘ç»“æ„æœ‰å…³ã€‚ä¸HashSeté›†åˆç±»ä¼¼ï¼ŒTreeSetä¹Ÿæ˜¯åŸºäºMapæ¥å®ç°ï¼Œå…·ä½“å®ç°**TreeMap**(åé¢è®²è§£)ï¼Œå…¶åº•å±‚ç»“æ„ä¸º**çº¢é»‘æ ‘**ï¼ˆç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼‰ï¼›

ä¸HashSetä¸åŒçš„æ˜¯ï¼ŒTreeSetå…·æœ‰æ’åºåŠŸèƒ½ï¼Œåˆ†ä¸ºè‡ªç„¶æ’åº(123456)å’Œè‡ªå®šä¹‰æ’åºä¸¤ç±»ï¼Œé»˜è®¤æ˜¯è‡ªç„¶æ’åºï¼›åœ¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå°†å…ƒç´ æ’å…¥åˆ°é›†åˆä¸­ï¼Œç­‰åˆ°éå†æ—¶TreeSetä¼šæŒ‰ç…§ä¸€å®šé¡ºåºè¾“å‡º--å€’åºæˆ–è€…å‡åºï¼›

å®ƒç»§æ‰¿AbstractSetï¼Œå®ç°NavigableSet, Cloneable, Serializableæ¥å£ã€‚

ï¼ˆ1ï¼‰ä¸HashSetåŒç†ï¼ŒTreeSetç»§æ‰¿AbstractSetç±»ï¼Œè·å¾—äº†Seté›†åˆåŸºç¡€å®ç°æ“ä½œï¼›

ï¼ˆ2ï¼‰TreeSetå®ç°NavigableSetæ¥å£ï¼Œè€ŒNavigableSetåˆæ‰©å±•äº†SortedSetæ¥å£ã€‚è¿™ä¸¤ä¸ªæ¥å£ä¸»è¦å®šä¹‰äº†æœç´¢å…ƒç´ çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ç»™å®šæŸä¸ªå…ƒç´ ï¼ŒæŸ¥æ‰¾è¯¥é›†åˆä¸­æ¯”ç»™å®šå…ƒç´ å¤§äºã€å°äºã€ç­‰äºçš„å…ƒç´ é›†åˆï¼Œæˆ–è€…æ¯”ç»™å®šå…ƒç´ å¤§äºã€å°äºã€ç­‰äºçš„å…ƒç´ ä¸ªæ•°ï¼›ç®€å•åœ°è¯´ï¼Œå®ç°NavigableSetæ¥å£ä½¿å¾—TreeSetå…·å¤‡äº†å…ƒç´ æœç´¢åŠŸèƒ½ï¼›

ï¼ˆ3ï¼‰TreeSetå®ç°Cloneableæ¥å£ï¼Œæ„å‘³ç€å®ƒä¹Ÿå¯ä»¥è¢«å…‹éš†ï¼›

ï¼ˆ4ï¼‰TreeSetå®ç°äº†Serializableæ¥å£ï¼Œå¯ä»¥è¢«åºåˆ—åŒ–ï¼Œå¯ä»¥ä½¿ç”¨hessianåè®®æ¥ä¼ è¾“ï¼›

å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- å¯¹æ’å…¥çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œæ˜¯ä¸€ä¸ªæœ‰åºçš„é›†åˆï¼ˆä¸»è¦ä¸HashSetçš„åŒºåˆ«ï¼‰;
- åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ç»“æ„ï¼Œè€Œä¸æ˜¯å“ˆå¸Œè¡¨ç»“æ„ï¼›
- å…è®¸æ’å…¥Nullå€¼ï¼›
- ä¸å…è®¸æ’å…¥é‡å¤å…ƒç´ ï¼›
- çº¿ç¨‹ä¸å®‰å…¨ï¼›

## 1.6 TreeSetåŸºæœ¬æ“ä½œ

```java
public class TreeSetTest {
    public static void main(String[] agrs){
        TreeSet<String> treeSet = new TreeSet<String>();
        System.out.println("TreeSetåˆå§‹åŒ–å®¹é‡å¤§å°ï¼š"+treeSet.size());

        //å…ƒç´ æ·»åŠ ï¼š
        treeSet.add("my");
        treeSet.add("name");
        treeSet.add("jiaboyan");
        treeSet.add("hello");
        treeSet.add("world");
        treeSet.add("1");
        treeSet.add("2");
        treeSet.add("3");
        System.out.println("TreeSetå®¹é‡å¤§å°ï¼š" + treeSet.size());
        System.out.println("TreeSetå…ƒç´ é¡ºåºä¸ºï¼š" + treeSet.toString());

        //å¢åŠ forå¾ªç¯éå†ï¼š
        for(String str:treeSet){
            System.out.println("éå†å…ƒç´ ï¼š"+str);
        }

        //è¿­ä»£å™¨éå†ï¼šå‡åº
        Iterator<String> iteratorAesc = treeSet.iterator();
        while(iteratorAesc.hasNext()){
            String str = iteratorAesc.next();
            System.out.println("éå†å…ƒç´ å‡åºï¼š"+str);
        }

        //è¿­ä»£å™¨éå†ï¼šé™åº
        Iterator<String> iteratorDesc = treeSet.descendingIterator();
        while(iteratorDesc.hasNext()){
            String str = iteratorDesc.next();
            System.out.println("éå†å…ƒç´ é™åºï¼š"+str);
        }

        //å…ƒç´ è·å–:å®ç°NavigableSetæ¥å£
        String firstEle = treeSet.first();//è·å–TreeSetå¤´èŠ‚ç‚¹ï¼š
        System.out.println("TreeSetå¤´èŠ‚ç‚¹ä¸ºï¼š" + firstEle);

        // è·å–æŒ‡å®šå…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ é›†åˆï¼š(ä¸åŒ…å«æŒ‡å®šå…ƒç´ )
        SortedSet<String> headSet = treeSet.headSet("jiaboyan");
        System.out.println("jiaboyanèŠ‚ç‚¹ä¹‹å‰çš„å…ƒç´ ä¸ºï¼š"+headSet.toString());

        //è·å–ç»™å®šå…ƒç´ ä¹‹é—´çš„é›†åˆï¼šï¼ˆåŒ…å«å¤´ï¼Œä¸åŒ…å«å°¾ï¼‰
        SortedSet subSet = treeSet.subSet("1","world");
        System.out.println("1--jiaboanä¹‹é—´èŠ‚ç‚¹å…ƒç´ ä¸ºï¼š"+subSet.toString());

        //é›†åˆåˆ¤æ–­ï¼š
        boolean isEmpty = treeSet.isEmpty();
        System.out.println("TreeSetæ˜¯å¦ä¸ºç©ºï¼š"+isEmpty);
        boolean isContain = treeSet.contains("who");
        System.out.println("TreeSetæ˜¯å¦åŒ…å«whoå…ƒç´ ï¼š"+isContain);

        //å…ƒç´ åˆ é™¤ï¼š
        boolean jiaboyanRemove = treeSet.remove("jiaboyan");
        System.out.println("jiaboyanå…ƒç´ æ˜¯å¦è¢«åˆ é™¤"+jiaboyanRemove);

        //é›†åˆä¸­ä¸å­˜åœ¨çš„å…ƒç´ ï¼Œåˆ é™¤è¿”å›false
        boolean whoRemove = treeSet.remove("who");
        System.out.println("whoå…ƒç´ æ˜¯å¦è¢«åˆ é™¤"+whoRemove);

       //åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šå¦‚æœseté›†åˆä¸å­˜åœ¨å…ƒç´ ï¼Œåˆ™è¿”å›null
        String pollFirst = treeSet.pollFirst();
        System.out.println("åˆ é™¤çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š"+pollFirst);

        //åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼šå¦‚æœseté›†åˆä¸å­˜åœ¨å…ƒç´ ï¼Œåˆ™è¿”å›null
        String pollLast = treeSet.pollLast();
        System.out.println("åˆ é™¤çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼š"+pollLast);


        treeSet.clear();//æ¸…ç©ºé›†åˆ:
    }
}
```

## 1.7 TreeSetå…ƒç´ æ’åº

åœ¨å‰é¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬è®²åˆ°äº†TreeSetæ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œå¯ä»¥å¯¹é›†åˆå…ƒç´ æ’åºï¼Œå…¶ä¸­åˆ†ä¸ºè‡ªç„¶æ’åºå’Œè‡ªå®šä¹‰æ’åºï¼Œé‚£ä¹ˆè¿™ä¸¤ç§æ–¹å¼å¦‚ä½•å®ç°å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡JDKæä¾›çš„å¯¹è±¡æ¥å±•ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨Stringã€Integerï¼š

```java
public class TreeSetTest {
    public static void main(String[] agrs){
        naturalSort();
    }

    //è‡ªç„¶æ’åºé¡ºåºï¼šå‡åº
    public static void naturalSort(){
        TreeSet<String> treeSetString = new TreeSet<String>();
        treeSetString.add("a");
        treeSetString.add("z");
        treeSetString.add("d");
        treeSetString.add("b");
        System.out.println("å­—æ¯é¡ºåºï¼š" + treeSetString.toString());

        TreeSet<Integer> treeSetInteger = new TreeSet<Integer>();
        treeSetInteger.add(1);
        treeSetInteger.add(24);
        treeSetInteger.add(23);
        treeSetInteger.add(6);
        System.out.println(treeSetInteger.toString());
        System.out.println("æ•°å­—é¡ºåºï¼š" + treeSetString.toString());
    }
}
```

æµ‹è¯•ç»“æœï¼š

```java
å­—æ¯é¡ºåºï¼š[a, b, d, z]
æ•°å­—é¡ºåºï¼š[1, 6, 23, 24]
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰å¯¹è±¡ï¼Œçœ‹èƒ½å¦å®ç°ï¼š

```java
public class App{

    private String name;

    private Integer age;

    public App(){}

    public App(String name,Integer age){
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public static void main(String[] args ){
        System.out.println( "Hello World!" );
    }
}

public class TreeSetTest {
    public static void main(String[] agrs){
        customSort();
    }

     //è‡ªå®šä¹‰æ’åºé¡ºåºï¼šå‡åº
    public static void customSort(){
        TreeSet<App> treeSet = new TreeSet<App>();

        //æ’åºå¯¹è±¡ï¼š
        App app1 = new App("hello",10);
        App app2 = new App("world",20);
        App app3 = new App("my",15);
        App app4 = new App("name",25);

        //æ·»åŠ åˆ°é›†åˆï¼š
        treeSet.add(app1);
        treeSet.add(app2);
        treeSet.add(app3);
        treeSet.add(app4);
        System.out.println("TreeSeté›†åˆé¡ºåºä¸ºï¼š"+treeSet);
    }
}
```

æµ‹è¯•ç»“æœï¼š

```java
æŠ›å‡ºå¼‚å¸¸ï¼šæç¤ºAppä¸èƒ½è½¬æ¢ä¸ºComparableå¯¹è±¡ï¼š
Exception in thread "main" java.lang.ClassCastException: com.jiaboyan.collection.App cannot be cast to java.lang.Comparable
```

ä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿ

```java
compare(key, key); // type (and possibly null) check

final int compare(Object k1, Object k2) {
    return comparator==null ? ((Comparable<? super K>)k1).compareTo((K)k2)
        : comparator.compare((K)k1, (K)k2);
}
```

é€šè¿‡æŸ¥çœ‹æºç å‘ç°ï¼Œåœ¨TreeSetè°ƒç”¨addæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°åº•å±‚TreeMapçš„putæ–¹æ³•ï¼Œåœ¨putæ–¹æ³•ä¸­ä¼šè°ƒç”¨åˆ°compare(key, key)æ–¹æ³•ï¼Œè¿›è¡Œkeyå¤§å°çš„æ¯”è¾ƒï¼›

åœ¨æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†ä¼ å…¥çš„keyè¿›è¡Œç±»å‹å¼ºè½¬ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è‡ªå®šä¹‰çš„Appç±»è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œè‡ªç„¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºAppç±»å¹¶æ²¡æœ‰å®ç°Comparableæ¥å£ï¼›

å°†Appå®ç°Comparableæ¥å£ï¼Œåœ¨åšæ¯”è¾ƒ:

```java
public class App implements Comparable<App>{
    private String name;
    private Integer age;
    public App(){}
    public App(String name,Integer age){
        this.name = name;
        this.age = age;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public Integer getAge() {
        return age;
    }
    public void setAge(Integer age) {
        this.age = age;
    }
    //è‡ªå®šä¹‰æ¯”è¾ƒï¼šå…ˆæ¯”è¾ƒnameçš„é•¿åº¦ï¼Œåœ¨æ¯”è¾ƒageçš„å¤§å°ï¼›
    public int compareTo(App app) {
        //æ¯”è¾ƒnameçš„é•¿åº¦ï¼š
        int num = this.name.length() - app.name.length();
        //å¦‚æœnameé•¿åº¦ä¸€æ ·ï¼Œåˆ™æ¯”è¾ƒå¹´é¾„çš„å¤§å°ï¼š
        return num == 0 ? this.age - app.age : num;
    }
    @Override
    public String toString() {
        return "App{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
}
```

æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

```java
TreeSeté›†åˆé¡ºåºä¸ºï¼š[App{name='my', age=15}, App{name='name', age=25}, App{name='hello', age=10}, App{name='world', age=20}]
```

æ­¤å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼Œé‚£å°±æ˜¯å®ç°Comparetor<t>æ¥å£ï¼Œå¹¶é‡å†™compareæ–¹æ³•ï¼›

```java
//è‡ªå®šä¹‰Appç±»çš„æ¯”è¾ƒå™¨ï¼š
public class AppComparator implements Comparator<App> {

    //æ¯”è¾ƒæ–¹æ³•ï¼šå…ˆæ¯”è¾ƒå¹´é¾„ï¼Œå¹´é¾„è‹¥ç›¸åŒåœ¨æ¯”è¾ƒåå­—é•¿åº¦ï¼›
    public int compare(App app1, App app2) {
        int num = app1.getAge() - app2.getAge();
        return num == 0 ? app1.getName().length() - app2.getName().length() : num;
    }
}
```

æ­¤æ—¶ï¼ŒAppä¸ç”¨åœ¨å®ç°Comparerableæ¥å£äº†ï¼Œå•çº¯çš„å®šä¹‰ä¸€ä¸ªç±»å³å¯ï¼›

```java
public class App{

    private String name;

    private Integer age;

    public App(){}

    public App(String name,Integer age){
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public static void main(String[] args ){
        System.out.println( "Hello World!" );
    }
}

public class TreeSetTest {
    public static void main(String[] agrs){
        customSort();
    }

    //è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼šå‡åº
    public static void customComparatorSort(){
        TreeSet<App> treeSet = new TreeSet<App>(new AppComparator());

        //æ’åºå¯¹è±¡ï¼š
        App app1 = new App("hello",10);
        App app2 = new App("world",20);
        App app3 = new App("my",15);
        App app4 = new App("name",25);

        //æ·»åŠ åˆ°é›†åˆï¼š
        treeSet.add(app1);
        treeSet.add(app2);
        treeSet.add(app3);
        treeSet.add(app4);

        System.out.println("TreeSeté›†åˆé¡ºåºä¸ºï¼š"+treeSet);
    }
}
```

æµ‹è¯•ç»“æœï¼š

```java
TreeSeté›†åˆé¡ºåºä¸ºï¼š[App{name='hello', age=10}, App{name='my', age=15}, App{name='world', age=20}, App{name='name', age=25}]
```

æœ€åï¼Œåœ¨è¯´ä¸‹å…³äºcompareTo()ã€compare()æ–¹æ³•ï¼š

```
ç»“æœè¿”å›å¤§äº0æ—¶ï¼Œæ–¹æ³•å‰é¢çš„å€¼å¤§äºæ–¹æ³•ä¸­çš„å€¼ï¼›

ç»“æœè¿”å›ç­‰äº0æ—¶ï¼Œæ–¹æ³•å‰é¢çš„å€¼ç­‰äºæ–¹æ³•ä¸­çš„å€¼ï¼›

ç»“æœè¿”å›å°äº0æ—¶ï¼Œæ–¹æ³•å‰é¢çš„å€¼å°äºæ–¹æ³•ä¸­çš„å€¼ï¼›
```

# 666. å½©è›‹

å¦‚æœä½ å¯¹ Dubbo æ„Ÿå…´è¶£ï¼Œæ¬¢è¿åŠ å…¥æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒä¸€èµ·äº¤æµã€‚

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)