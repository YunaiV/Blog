title: Eureka æºç è§£æ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º
date: 2018-04-08
tags:
categories: Eureka
permalink: Eureka/build-debugging-environment

---

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Eureka/build-debugging-environment/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

**æœ¬æ–‡ä¸»è¦åŸºäº Eureka 1.8.X ç‰ˆæœ¬** 

- [1. ä¾èµ–å·¥å…·](http://www.iocoder.cn/Eureka/build-debugging-environment/)
- [2. æºç æ‹‰å–](http://www.iocoder.cn/Eureka/build-debugging-environment/)
- [3. Eureka-Server å¯åŠ¨](http://www.iocoder.cn/Eureka/build-debugging-environment/)
	- [3.1 MockRemoteEurekaServer](http://www.iocoder.cn/Eureka/build-debugging-environment/)
	- [3.2 Eureka-Server war åŒ…](http://www.iocoder.cn/Eureka/build-debugging-environment/)
	- [3.3 Eureka-Server ç›´æ¥å¯åŠ¨](http://www.iocoder.cn/Eureka/build-debugging-environment/)
- [4. Eureka-Client å¯åŠ¨](http://www.iocoder.cn/Eureka/build-debugging-environment/)
- [666. å½©è›‹](http://www.iocoder.cn/Eureka/build-debugging-environment/)

---

![](http://www.iocoder.cn/images/common/wechat_mp_2018_05_18.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š  
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨  
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**  
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚  
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚  
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

---

# 1. ä¾èµ–å·¥å…·

* Gradle
* JDK
* IntelliJ IDEA

**æ¨è Spring Cloud ä¹¦ç±**ï¼š

* è¯·æ”¯æŒæ­£ç‰ˆã€‚ä¸‹è½½ç›—ç‰ˆï¼Œ**ç­‰äºä¸»åŠ¨ç¼–å†™ä½çº§ BUG** ã€‚
* ç¨‹åºçŒ¿DD â€”â€” [ã€ŠSpring Cloudå¾®æœåŠ¡å®æˆ˜ã€‹](https://union-click.jd.com/jdc?d=505Twi)
* å‘¨ç«‹ â€”â€” [ã€ŠSpring Cloudä¸Dockerå¾®æœåŠ¡æ¶æ„å®æˆ˜ã€‹](https://union-click.jd.com/jdc?d=k3sAaK)
* ä¸¤ä¹¦é½ä¹°ï¼Œäº¬ä¸œåŒ…é‚®ã€‚



# 2. æºç æ‹‰å–

ä»å®˜æ–¹ä»“åº“ [https://github.com/Netflix/eureka.git](https://github.com/Netflix/eureka.git) `Fork` å‡ºå±äºè‡ªå·±çš„ä»“åº“ã€‚ä¸ºä»€ä¹ˆè¦ `Fork` ï¼Ÿæ—¢ç„¶å¼€å§‹é˜…è¯»ã€è°ƒè¯•æºç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™ä¸€äº›æ³¨é‡Šï¼Œæœ‰äº†è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±çš„æäº¤ã€‚ğŸ˜ˆ

ä½¿ç”¨ `IntelliJ IDEA` ä» `Fork` å‡ºæ¥çš„ä»“åº“æ‹‰å–ä»£ç ã€‚æ‹‰å–å®Œæˆåï¼Œ`Gradle` ä¼šä¸‹è½½ä¾èµ–åŒ…ï¼Œå¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…ä¸‹ã€‚

æœ¬æ–‡åŸºäº `master` åˆ†æ”¯ã€‚

# 3. Eureka-Server å¯åŠ¨

Eureka-Server å¯åŠ¨è°ƒè¯•æ–¹å¼ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ¥å°è¯•æ¯ä¸€ç§ã€‚

## 3.1 MockRemoteEurekaServer

`com.netflix.eureka.AbstractTester`ï¼Œæµ‹è¯•æŠ½è±¡ç±»ï¼Œæœ‰å¦‚ä¸‹å®ç°å­ç±»ï¼š

![](http://www.iocoder.cn/images/Eureka/2018_04_08/01.png)

ä½¿ç”¨ä»»æ„ä¸€ä¸ªå­ç±»çš„å•å…ƒæµ‹è¯•æ‰§è¡Œå³å¯æ‰§è¡Œ Eureka-Server é€»è¾‘çš„è°ƒè¯•ï¼Œè¿™é‡Œä»¥ `com.netflix.eureka.resources.ApplicationsResourceTest` ä½œä¸ºä¾‹å­ã€‚

Debug è¿è¡Œ `ApplicationsResourceTest#testFullAppsGetJson()` å•å…ƒæµ‹è¯•ã€‚åœ¨æ–¹æ³•æ‰§è¡Œå‰ï¼Œ`ApplicationsResourceTest#setUp()` ä¼šè¿è¡Œï¼Œåˆå§‹åŒ– Eureka-Server **æ¨¡æ‹Ÿç¯å¢ƒ**ï¼Œä¾‹å¦‚ï¼š
`com.netflix.eureka.mock.MockRemoteEurekaServer` ( æ¨¡æ‹Ÿ Eureka-Server )ã€‚

å› ä¸ºæ˜¯**æ¨¡æ‹Ÿç¯å¢ƒ**ï¼Œå¯¹ Eureka-Server çš„æ“ä½œä¸æ˜¯ Eureka-Client è¯·æ±‚ Eureka-Server çš„æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨å•å…ƒæµ‹è¯•å¯¹åº”çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

```Java
// ApplicationsResourceTest.java
@Test
public void testFullAppsGetJson() throws Exception {
   Response response = applicationsResource.getContainers(
           Version.V2.name(),
           MediaType.APPLICATION_JSON,
           null, // encoding
           EurekaAccept.full.name(),
           null,  // uriInfo
           null  // remote regions
   );

   String json = String.valueOf(response.getEntity());
   DecoderWrapper decoder = CodecWrappers.getDecoder(CodecWrappers.LegacyJacksonJson.class);

   Applications decoded = decoder.decode(json, Applications.class);
   // test per app as the full apps list include the mock server that is not part of the test apps
   for (Application application : testApplications.getRegisteredApplications()) {
       Application decodedApp = decoded.getRegisteredApplications(application.getName());
       assertThat(EurekaEntityComparators.equal(application, decodedApp), is(true));
   }
}
```

* ç›´æ¥è°ƒç”¨ `ApplicationsResource#getContainers(...)` æ–¹æ³•ã€‚

**æ€»ç»“**ï¼šè¿™ç§æ–¹å¼ï¼Œç®€å•ç²—æš´ï¼Œå®¹æ˜“ä¸Šæ‰‹ã€‚å½“ç„¶ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯**æ¨¡æ‹Ÿ**ã€‚åˆšå¼€å§‹è°ƒè¯• Eureka-Server å¯ä»¥å°è¯•è¿™ç§æ–¹å¼ã€‚

## 3.2 Eureka-Server war åŒ…

ç¬¬ä¸€æ­¥ï¼Œç¼–è¯‘ Eureka-Server war åŒ…ã€‚è¯¥æ­¥éª¤å¯èƒ½æ¶ˆè€—æ¼«é•¿çš„æ—¶é—´ï¼Œå¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œè¯·ä¸æ–­é‡è¯•ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
cd eureka
./gradlew clean build
```

ç¬¬äºŒæ­¥ï¼ŒDebug è¿è¡Œ`com.netflix.eureka.resources.EurekaClientServerRestIntegrationTest` ä»»æ„å•å…ƒæµ‹è¯•æ–¹æ³•ã€‚

**æ€»ç»“**ï¼šè¿™ç§æ–¹å¼ï¼Œç¼–è¯‘çš„è¿‡ç¨‹æ¯”è¾ƒç—›è‹¦ï¼Œä¸æ’é™¤å¤±è´¥çš„å¯èƒ½æ€§ã€‚æ¯æ¬¡å¢åŠ å¯¹ä»£ç çš„æ³¨å†Œåï¼Œéƒ½éœ€è¦é‡æ–°ç¼–è¯‘æ‰“åŒ…ã€‚å› æ­¤ä¸å»ºè®®é‡‡ç”¨ã€‚é‚£å’‹åŠå‘¢ï¼Ÿè§ç¬¬ä¸‰ç§ã€‚è‰¯å¿ƒå¦‚åšä¸»ï¼Œèµ¶ç´§å…³æ³¨åšä¸»çš„å¾®ä¿¡å…¬ä¼—å·ï¼šã€**èŠ‹é“æºç **ã€‘ã€‚

## 3.3 Eureka-Server ç›´æ¥å¯åŠ¨

ç¬¬ä¸€æ­¥ï¼Œä¿®æ”¹ `EurekaClientServerRestIntegrationTest#startServer()` æ–¹æ³•ï¼Œè§£å†³ç¬¬äºŒç§æ–¹å¼ä½¿ç”¨ war åŒ…è¿è¡Œæ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½éœ€è¦é‡æ–°ç¼–è¯‘çš„é—®é¢˜ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š

```Java
// EurekaClientServerRestIntegrationTest.java
private static void startServer() throws Exception {
   server = new Server(8080);

   // TODO Thread.currentThread().getContextClassLoader() è·å–ä¸åˆ°è·¯å¾„ï¼Œå…ˆæš‚æ—¶è¿™æ ·ï¼›
   WebAppContext webAppCtx = new WebAppContext(new File("./eureka-server/src/main/webapp").getAbsolutePath(), "/");
   webAppCtx.setDescriptor(new File("./eureka-server/src/main/webapp/WEB-INF/web.xml").getAbsolutePath());
   webAppCtx.setResourceBase(new File("./eureka-server/src/main/resources").getAbsolutePath());
   webAppCtx.setClassLoader(Thread.currentThread().getContextClassLoader());
   server.setHandler(webAppCtx);
   server.start();

   eurekaServiceUrl = "http://localhost:8080/v2";
}
```

* ç¬”è€…ä¸å¤ªç†Ÿæ‚‰ Gradle çš„æ‰“åŒ…æ–¹å¼ï¼Œä½¿ç”¨ `Thread.currentThread().getContextClassLoader().getResource()` æ–¹æ³•ï¼Œä¸€ç›´æ— æ³•æ‹¿åˆ°è·¯å¾„ï¼Œæœ‰çŸ¥é“çš„åŒå­¦éº»çƒ¦å‘ŠçŸ¥ä¸‹ã€‚

ç¬¬äºŒæ­¥ï¼ŒDebug è¿è¡Œ`com.netflix.eureka.resources.EurekaClientServerRestIntegrationTest` ä»»æ„å•å…ƒæµ‹è¯•æ–¹æ³•ã€‚TODO[0003]ï¼šThread.currentThread().getContextClassLoader() è·å–ä¸åˆ°è·¯å¾„ï¼Œå…ˆæš‚æ—¶è¿™æ ·ï¼›

**æ€»ç»“**ï¼šè¿™ç§æ–¹å¼ï¼Œå®Œç¾ã€‚å»ºè®®ä½¿ç”¨è¯¥æ–¹å¼è°ƒè¯•ã€‚

# 4. Eureka-Client å¯åŠ¨

æˆ‘ä»¬ä»¥ `com.netflix.eureka.ExampleEurekaClient` ä¸ºä¾‹å­ã€‚

ç¬¬ä¸€æ­¥ï¼Œåœ¨ `EurekaClientServerRestIntegrationTest#setUp()` æ–¹æ³•æœ«å°¾æ·»åŠ  `Thread.sleep(Long.MAX_VALUE)` ä»£ç ã€‚

ç¬¬äºŒæ­¥ï¼ŒæŒ‰ç…§[ã€Œ 3.3 Eureka-Server ç›´æ¥å¯åŠ¨ã€](#)æ–¹æ³•å¯åŠ¨ Eureka-Serverã€‚

ç¬¬ä¸‰æ­¥ï¼Œå°† `EurekaClientServerRestIntegrationTest#injectEurekaConfiguration` å¤åˆ¶åˆ° ExampleEurekaClient ç±»é‡Œã€‚

ç¬¬å››æ­¥ï¼Œåœ¨ `ExampleEurekaClient#main()` æ–¹æ³•çš„ç¬¬ä¸€è¡Œï¼Œæ·»åŠ  `injectEurekaConfiguration()` ä»£ç ã€‚

ç¬¬äº”æ­¥ï¼ŒDebug è¿è¡Œ `ExampleEurekaClient#main()` æ–¹æ³•ã€‚

![](http://www.iocoder.cn/images/Eureka/2018_04_08/02.png)

`eureka-examples` æ¨¡å—è¿˜æä¾›åˆ«çš„ä¾‹å­ï¼Œå¯ä»¥é€ä¸ªè°ƒè¯•ã€‚

# 666. å½©è›‹

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)

æœ¬æ–‡å†™çš„ï¼Œç›¸å¯¹æ¯”è¾ƒç®€æ´ï¼Œå¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œå¯ä»¥ç»™æˆ‘å…¬ä¼—å·ç•™è¨€ã€‚

ä¸‹ä¸€ç¯‡æ›´æ–°ï¼Ÿæ©ï¼Œæˆ‘è¿˜æ²¡æƒ³å¥½ï¼Œæ•´ç†[ã€ŠEureka æºç è§£æã€‹](#)æ•´ä¸ªç³»åˆ—çš„ç›®å½•ingã€‚

èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ï¼


